var YR=Object.defineProperty;var GR=(t,e,r)=>e in t?YR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Q=(t,e,r)=>GR(t,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function r(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(o){if(o.ep)return;o.ep=!0;const c=r(o);fetch(o.href,c)}})();var KR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function QR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var lE={exports:{}},oy={},cE={exports:{}},br={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cp=Symbol.for("react.element"),JR=Symbol.for("react.portal"),ek=Symbol.for("react.fragment"),tk=Symbol.for("react.strict_mode"),rk=Symbol.for("react.profiler"),nk=Symbol.for("react.provider"),ik=Symbol.for("react.context"),sk=Symbol.for("react.forward_ref"),ok=Symbol.for("react.suspense"),ak=Symbol.for("react.memo"),lk=Symbol.for("react.lazy"),W2=Symbol.iterator;function ck(t){return t===null||typeof t!="object"?null:(t=W2&&t[W2]||t["@@iterator"],typeof t=="function"?t:null)}var uE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},hE=Object.assign,dE={};function nd(t,e,r){this.props=t,this.context=e,this.refs=dE,this.updater=r||uE}nd.prototype.isReactComponent={};nd.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};nd.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function fE(){}fE.prototype=nd.prototype;function Db(t,e,r){this.props=t,this.context=e,this.refs=dE,this.updater=r||uE}var Ob=Db.prototype=new fE;Ob.constructor=Db;hE(Ob,nd.prototype);Ob.isPureReactComponent=!0;var H2=Array.isArray,pE=Object.prototype.hasOwnProperty,Fb={current:null},gE={key:!0,ref:!0,__self:!0,__source:!0};function mE(t,e,r){var n,o={},c=null,d=null;if(e!=null)for(n in e.ref!==void 0&&(d=e.ref),e.key!==void 0&&(c=""+e.key),e)pE.call(e,n)&&!gE.hasOwnProperty(n)&&(o[n]=e[n]);var a=arguments.length-2;if(a===1)o.children=r;else if(1<a){for(var y=Array(a),S=0;S<a;S++)y[S]=arguments[S+2];o.children=y}if(t&&t.defaultProps)for(n in a=t.defaultProps,a)o[n]===void 0&&(o[n]=a[n]);return{$$typeof:Cp,type:t,key:c,ref:d,props:o,_owner:Fb.current}}function uk(t,e){return{$$typeof:Cp,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Nb(t){return typeof t=="object"&&t!==null&&t.$$typeof===Cp}function hk(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var X2=/\/+/g;function zv(t,e){return typeof t=="object"&&t!==null&&t.key!=null?hk(""+t.key):e.toString(36)}function Em(t,e,r,n,o){var c=typeof t;(c==="undefined"||c==="boolean")&&(t=null);var d=!1;if(t===null)d=!0;else switch(c){case"string":case"number":d=!0;break;case"object":switch(t.$$typeof){case Cp:case JR:d=!0}}if(d)return d=t,o=o(d),t=n===""?"."+zv(d,0):n,H2(o)?(r="",t!=null&&(r=t.replace(X2,"$&/")+"/"),Em(o,e,r,"",function(S){return S})):o!=null&&(Nb(o)&&(o=uk(o,r+(!o.key||d&&d.key===o.key?"":(""+o.key).replace(X2,"$&/")+"/")+t)),e.push(o)),1;if(d=0,n=n===""?".":n+":",H2(t))for(var a=0;a<t.length;a++){c=t[a];var y=n+zv(c,a);d+=Em(c,e,r,y,o)}else if(y=ck(t),typeof y=="function")for(t=y.call(t),a=0;!(c=t.next()).done;)c=c.value,y=n+zv(c,a++),d+=Em(c,e,r,y,o);else if(c==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return d}function Hg(t,e,r){if(t==null)return t;var n=[],o=0;return Em(t,n,"","",function(c){return e.call(r,c,o++)}),n}function dk(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ji={current:null},Am={transition:null},fk={ReactCurrentDispatcher:Ji,ReactCurrentBatchConfig:Am,ReactCurrentOwner:Fb};function _E(){throw Error("act(...) is not supported in production builds of React.")}br.Children={map:Hg,forEach:function(t,e,r){Hg(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return Hg(t,function(){e++}),e},toArray:function(t){return Hg(t,function(e){return e})||[]},only:function(t){if(!Nb(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};br.Component=nd;br.Fragment=ek;br.Profiler=rk;br.PureComponent=Db;br.StrictMode=tk;br.Suspense=ok;br.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fk;br.act=_E;br.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=hE({},t.props),o=t.key,c=t.ref,d=t._owner;if(e!=null){if(e.ref!==void 0&&(c=e.ref,d=Fb.current),e.key!==void 0&&(o=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(y in e)pE.call(e,y)&&!gE.hasOwnProperty(y)&&(n[y]=e[y]===void 0&&a!==void 0?a[y]:e[y])}var y=arguments.length-2;if(y===1)n.children=r;else if(1<y){a=Array(y);for(var S=0;S<y;S++)a[S]=arguments[S+2];n.children=a}return{$$typeof:Cp,type:t.type,key:o,ref:c,props:n,_owner:d}};br.createContext=function(t){return t={$$typeof:ik,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:nk,_context:t},t.Consumer=t};br.createElement=mE;br.createFactory=function(t){var e=mE.bind(null,t);return e.type=t,e};br.createRef=function(){return{current:null}};br.forwardRef=function(t){return{$$typeof:sk,render:t}};br.isValidElement=Nb;br.lazy=function(t){return{$$typeof:lk,_payload:{_status:-1,_result:t},_init:dk}};br.memo=function(t,e){return{$$typeof:ak,type:t,compare:e===void 0?null:e}};br.startTransition=function(t){var e=Am.transition;Am.transition={};try{t()}finally{Am.transition=e}};br.unstable_act=_E;br.useCallback=function(t,e){return Ji.current.useCallback(t,e)};br.useContext=function(t){return Ji.current.useContext(t)};br.useDebugValue=function(){};br.useDeferredValue=function(t){return Ji.current.useDeferredValue(t)};br.useEffect=function(t,e){return Ji.current.useEffect(t,e)};br.useId=function(){return Ji.current.useId()};br.useImperativeHandle=function(t,e,r){return Ji.current.useImperativeHandle(t,e,r)};br.useInsertionEffect=function(t,e){return Ji.current.useInsertionEffect(t,e)};br.useLayoutEffect=function(t,e){return Ji.current.useLayoutEffect(t,e)};br.useMemo=function(t,e){return Ji.current.useMemo(t,e)};br.useReducer=function(t,e,r){return Ji.current.useReducer(t,e,r)};br.useRef=function(t){return Ji.current.useRef(t)};br.useState=function(t){return Ji.current.useState(t)};br.useSyncExternalStore=function(t,e,r){return Ji.current.useSyncExternalStore(t,e,r)};br.useTransition=function(){return Ji.current.useTransition()};br.version="18.3.1";cE.exports=br;var ui=cE.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pk=ui,gk=Symbol.for("react.element"),mk=Symbol.for("react.fragment"),_k=Object.prototype.hasOwnProperty,yk=pk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,vk={key:!0,ref:!0,__self:!0,__source:!0};function yE(t,e,r){var n,o={},c=null,d=null;r!==void 0&&(c=""+r),e.key!==void 0&&(c=""+e.key),e.ref!==void 0&&(d=e.ref);for(n in e)_k.call(e,n)&&!vk.hasOwnProperty(n)&&(o[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)o[n]===void 0&&(o[n]=e[n]);return{$$typeof:gk,type:t,key:c,ref:d,props:o,_owner:yk.current}}oy.Fragment=mk;oy.jsx=yE;oy.jsxs=yE;lE.exports=oy;var Wr=lE.exports,vE={exports:{}},Ls={},xE={exports:{}},bE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Je,Qe){var gt=Je.length;Je.push(Qe);e:for(;0<gt;){var dt=gt-1>>>1,yt=Je[dt];if(0<o(yt,Qe))Je[dt]=Qe,Je[gt]=yt,gt=dt;else break e}}function r(Je){return Je.length===0?null:Je[0]}function n(Je){if(Je.length===0)return null;var Qe=Je[0],gt=Je.pop();if(gt!==Qe){Je[0]=gt;e:for(var dt=0,yt=Je.length,_r=yt>>>1;dt<_r;){var lr=2*(dt+1)-1,bt=Je[lr],mt=lr+1,nr=Je[mt];if(0>o(bt,gt))mt<yt&&0>o(nr,bt)?(Je[dt]=nr,Je[mt]=gt,dt=mt):(Je[dt]=bt,Je[lr]=gt,dt=lr);else if(mt<yt&&0>o(nr,gt))Je[dt]=nr,Je[mt]=gt,dt=mt;else break e}}return Qe}function o(Je,Qe){var gt=Je.sortIndex-Qe.sortIndex;return gt!==0?gt:Je.id-Qe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;t.unstable_now=function(){return c.now()}}else{var d=Date,a=d.now();t.unstable_now=function(){return d.now()-a}}var y=[],S=[],E=1,M=null,F=3,N=!1,G=!1,re=!1,me=typeof setTimeout=="function"?setTimeout:null,Y=typeof clearTimeout=="function"?clearTimeout:null,q=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Z(Je){for(var Qe=r(S);Qe!==null;){if(Qe.callback===null)n(S);else if(Qe.startTime<=Je)n(S),Qe.sortIndex=Qe.expirationTime,e(y,Qe);else break;Qe=r(S)}}function le(Je){if(re=!1,Z(Je),!G)if(r(y)!==null)G=!0,Ot(Ae);else{var Qe=r(S);Qe!==null&&$t(le,Qe.startTime-Je)}}function Ae(Je,Qe){G=!1,re&&(re=!1,Y(Ue),Ue=-1),N=!0;var gt=F;try{for(Z(Qe),M=r(y);M!==null&&(!(M.expirationTime>Qe)||Je&&!Ke());){var dt=M.callback;if(typeof dt=="function"){M.callback=null,F=M.priorityLevel;var yt=dt(M.expirationTime<=Qe);Qe=t.unstable_now(),typeof yt=="function"?M.callback=yt:M===r(y)&&n(y),Z(Qe)}else n(y);M=r(y)}if(M!==null)var _r=!0;else{var lr=r(S);lr!==null&&$t(le,lr.startTime-Qe),_r=!1}return _r}finally{M=null,F=gt,N=!1}}var we=!1,je=null,Ue=-1,Ze=5,qe=-1;function Ke(){return!(t.unstable_now()-qe<Ze)}function ht(){if(je!==null){var Je=t.unstable_now();qe=Je;var Qe=!0;try{Qe=je(!0,Je)}finally{Qe?Pt():(we=!1,je=null)}}else we=!1}var Pt;if(typeof q=="function")Pt=function(){q(ht)};else if(typeof MessageChannel<"u"){var xt=new MessageChannel,Zt=xt.port2;xt.port1.onmessage=ht,Pt=function(){Zt.postMessage(null)}}else Pt=function(){me(ht,0)};function Ot(Je){je=Je,we||(we=!0,Pt())}function $t(Je,Qe){Ue=me(function(){Je(t.unstable_now())},Qe)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Je){Je.callback=null},t.unstable_continueExecution=function(){G||N||(G=!0,Ot(Ae))},t.unstable_forceFrameRate=function(Je){0>Je||125<Je?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ze=0<Je?Math.floor(1e3/Je):5},t.unstable_getCurrentPriorityLevel=function(){return F},t.unstable_getFirstCallbackNode=function(){return r(y)},t.unstable_next=function(Je){switch(F){case 1:case 2:case 3:var Qe=3;break;default:Qe=F}var gt=F;F=Qe;try{return Je()}finally{F=gt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Je,Qe){switch(Je){case 1:case 2:case 3:case 4:case 5:break;default:Je=3}var gt=F;F=Je;try{return Qe()}finally{F=gt}},t.unstable_scheduleCallback=function(Je,Qe,gt){var dt=t.unstable_now();switch(typeof gt=="object"&&gt!==null?(gt=gt.delay,gt=typeof gt=="number"&&0<gt?dt+gt:dt):gt=dt,Je){case 1:var yt=-1;break;case 2:yt=250;break;case 5:yt=1073741823;break;case 4:yt=1e4;break;default:yt=5e3}return yt=gt+yt,Je={id:E++,callback:Qe,priorityLevel:Je,startTime:gt,expirationTime:yt,sortIndex:-1},gt>dt?(Je.sortIndex=gt,e(S,Je),r(y)===null&&Je===r(S)&&(re?(Y(Ue),Ue=-1):re=!0,$t(le,gt-dt))):(Je.sortIndex=yt,e(y,Je),G||N||(G=!0,Ot(Ae))),Je},t.unstable_shouldYield=Ke,t.unstable_wrapCallback=function(Je){var Qe=F;return function(){var gt=F;F=Qe;try{return Je.apply(this,arguments)}finally{F=gt}}}})(bE);xE.exports=bE;var xk=xE.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bk=ui,Ns=xk;function ct(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var wE=new Set,ep={};function iu(t,e){$h(t,e),$h(t+"Capture",e)}function $h(t,e){for(ep[t]=e,t=0;t<e.length;t++)wE.add(e[t])}var Fa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),G0=Object.prototype.hasOwnProperty,wk=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Z2={},q2={};function Tk(t){return G0.call(q2,t)?!0:G0.call(Z2,t)?!1:wk.test(t)?q2[t]=!0:(Z2[t]=!0,!1)}function Sk(t,e,r,n){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Ek(t,e,r,n){if(e===null||typeof e>"u"||Sk(t,e,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function es(t,e,r,n,o,c,d){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=o,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=c,this.removeEmptyString=d}var Ei={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ei[t]=new es(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ei[e]=new es(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ei[t]=new es(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ei[t]=new es(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ei[t]=new es(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ei[t]=new es(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ei[t]=new es(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ei[t]=new es(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ei[t]=new es(t,5,!1,t.toLowerCase(),null,!1,!1)});var Lb=/[\-:]([a-z])/g;function zb(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Lb,zb);Ei[e]=new es(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Lb,zb);Ei[e]=new es(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Lb,zb);Ei[e]=new es(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ei[t]=new es(t,1,!1,t.toLowerCase(),null,!1,!1)});Ei.xlinkHref=new es("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ei[t]=new es(t,1,!1,t.toLowerCase(),null,!0,!0)});function Bb(t,e,r,n){var o=Ei.hasOwnProperty(e)?Ei[e]:null;(o!==null?o.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Ek(e,r,o,n)&&(r=null),n||o===null?Tk(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):o.mustUseProperty?t[o.propertyName]=r===null?o.type===3?!1:"":r:(e=o.attributeName,n=o.attributeNamespace,r===null?t.removeAttribute(e):(o=o.type,r=o===3||o===4&&r===!0?"":""+r,n?t.setAttributeNS(n,e,r):t.setAttribute(e,r))))}var Ua=bk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Xg=Symbol.for("react.element"),mh=Symbol.for("react.portal"),_h=Symbol.for("react.fragment"),Ub=Symbol.for("react.strict_mode"),K0=Symbol.for("react.profiler"),TE=Symbol.for("react.provider"),SE=Symbol.for("react.context"),Vb=Symbol.for("react.forward_ref"),Q0=Symbol.for("react.suspense"),J0=Symbol.for("react.suspense_list"),jb=Symbol.for("react.memo"),xl=Symbol.for("react.lazy"),EE=Symbol.for("react.offscreen"),Y2=Symbol.iterator;function pf(t){return t===null||typeof t!="object"?null:(t=Y2&&t[Y2]||t["@@iterator"],typeof t=="function"?t:null)}var wn=Object.assign,Bv;function Af(t){if(Bv===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);Bv=e&&e[1]||""}return`
`+Bv+t}var Uv=!1;function Vv(t,e){if(!t||Uv)return"";Uv=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(S){var n=S}Reflect.construct(t,[],e)}else{try{e.call()}catch(S){n=S}t.call(e.prototype)}else{try{throw Error()}catch(S){n=S}t()}}catch(S){if(S&&n&&typeof S.stack=="string"){for(var o=S.stack.split(`
`),c=n.stack.split(`
`),d=o.length-1,a=c.length-1;1<=d&&0<=a&&o[d]!==c[a];)a--;for(;1<=d&&0<=a;d--,a--)if(o[d]!==c[a]){if(d!==1||a!==1)do if(d--,a--,0>a||o[d]!==c[a]){var y=`
`+o[d].replace(" at new "," at ");return t.displayName&&y.includes("<anonymous>")&&(y=y.replace("<anonymous>",t.displayName)),y}while(1<=d&&0<=a);break}}}finally{Uv=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?Af(t):""}function Ak(t){switch(t.tag){case 5:return Af(t.type);case 16:return Af("Lazy");case 13:return Af("Suspense");case 19:return Af("SuspenseList");case 0:case 2:case 15:return t=Vv(t.type,!1),t;case 11:return t=Vv(t.type.render,!1),t;case 1:return t=Vv(t.type,!0),t;default:return""}}function ex(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case _h:return"Fragment";case mh:return"Portal";case K0:return"Profiler";case Ub:return"StrictMode";case Q0:return"Suspense";case J0:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case SE:return(t.displayName||"Context")+".Consumer";case TE:return(t._context.displayName||"Context")+".Provider";case Vb:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case jb:return e=t.displayName||null,e!==null?e:ex(t.type)||"Memo";case xl:e=t._payload,t=t._init;try{return ex(t(e))}catch{}}return null}function Ik(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ex(e);case 8:return e===Ub?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function jl(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function AE(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Pk(t){var e=AE(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var o=r.get,c=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return o.call(this)},set:function(d){n=""+d,c.call(this,d)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(d){n=""+d},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Zg(t){t._valueTracker||(t._valueTracker=Pk(t))}function IE(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),n="";return t&&(n=AE(t)?t.checked?"true":"false":t.value),t=n,t!==r?(e.setValue(t),!0):!1}function qm(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function tx(t,e){var r=e.checked;return wn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function G2(t,e){var r=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;r=jl(e.value!=null?e.value:r),t._wrapperState={initialChecked:n,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function PE(t,e){e=e.checked,e!=null&&Bb(t,"checked",e,!1)}function rx(t,e){PE(t,e);var r=jl(e.value),n=e.type;if(r!=null)n==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?nx(t,e.type,r):e.hasOwnProperty("defaultValue")&&nx(t,e.type,jl(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function K2(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function nx(t,e,r){(e!=="number"||qm(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var If=Array.isArray;function Fh(t,e,r,n){if(t=t.options,e){e={};for(var o=0;o<r.length;o++)e["$"+r[o]]=!0;for(r=0;r<t.length;r++)o=e.hasOwnProperty("$"+t[r].value),t[r].selected!==o&&(t[r].selected=o),o&&n&&(t[r].defaultSelected=!0)}else{for(r=""+jl(r),e=null,o=0;o<t.length;o++){if(t[o].value===r){t[o].selected=!0,n&&(t[o].defaultSelected=!0);return}e!==null||t[o].disabled||(e=t[o])}e!==null&&(e.selected=!0)}}function ix(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ct(91));return wn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Q2(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(ct(92));if(If(r)){if(1<r.length)throw Error(ct(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:jl(r)}}function CE(t,e){var r=jl(e.value),n=jl(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),n!=null&&(t.defaultValue=""+n)}function J2(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function ME(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function sx(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?ME(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var qg,RE=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,n,o){MSApp.execUnsafeLocalFunction(function(){return t(e,r,n,o)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(qg=qg||document.createElement("div"),qg.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=qg.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function tp(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var Nf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ck=["Webkit","ms","Moz","O"];Object.keys(Nf).forEach(function(t){Ck.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Nf[e]=Nf[t]})});function kE(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||Nf.hasOwnProperty(t)&&Nf[t]?(""+e).trim():e+"px"}function DE(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var n=r.indexOf("--")===0,o=kE(r,e[r],n);r==="float"&&(r="cssFloat"),n?t.setProperty(r,o):t[r]=o}}var Mk=wn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ox(t,e){if(e){if(Mk[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ct(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ct(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ct(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ct(62))}}function ax(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var lx=null;function $b(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var cx=null,Nh=null,Lh=null;function eT(t){if(t=kp(t)){if(typeof cx!="function")throw Error(ct(280));var e=t.stateNode;e&&(e=hy(e),cx(t.stateNode,t.type,e))}}function OE(t){Nh?Lh?Lh.push(t):Lh=[t]:Nh=t}function FE(){if(Nh){var t=Nh,e=Lh;if(Lh=Nh=null,eT(t),e)for(t=0;t<e.length;t++)eT(e[t])}}function NE(t,e){return t(e)}function LE(){}var jv=!1;function zE(t,e,r){if(jv)return t(e,r);jv=!0;try{return NE(t,e,r)}finally{jv=!1,(Nh!==null||Lh!==null)&&(LE(),FE())}}function rp(t,e){var r=t.stateNode;if(r===null)return null;var n=hy(r);if(n===null)return null;r=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(ct(231,e,typeof r));return r}var ux=!1;if(Fa)try{var gf={};Object.defineProperty(gf,"passive",{get:function(){ux=!0}}),window.addEventListener("test",gf,gf),window.removeEventListener("test",gf,gf)}catch{ux=!1}function Rk(t,e,r,n,o,c,d,a,y){var S=Array.prototype.slice.call(arguments,3);try{e.apply(r,S)}catch(E){this.onError(E)}}var Lf=!1,Ym=null,Gm=!1,hx=null,kk={onError:function(t){Lf=!0,Ym=t}};function Dk(t,e,r,n,o,c,d,a,y){Lf=!1,Ym=null,Rk.apply(kk,arguments)}function Ok(t,e,r,n,o,c,d,a,y){if(Dk.apply(this,arguments),Lf){if(Lf){var S=Ym;Lf=!1,Ym=null}else throw Error(ct(198));Gm||(Gm=!0,hx=S)}}function su(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function BE(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function tT(t){if(su(t)!==t)throw Error(ct(188))}function Fk(t){var e=t.alternate;if(!e){if(e=su(t),e===null)throw Error(ct(188));return e!==t?null:t}for(var r=t,n=e;;){var o=r.return;if(o===null)break;var c=o.alternate;if(c===null){if(n=o.return,n!==null){r=n;continue}break}if(o.child===c.child){for(c=o.child;c;){if(c===r)return tT(o),t;if(c===n)return tT(o),e;c=c.sibling}throw Error(ct(188))}if(r.return!==n.return)r=o,n=c;else{for(var d=!1,a=o.child;a;){if(a===r){d=!0,r=o,n=c;break}if(a===n){d=!0,n=o,r=c;break}a=a.sibling}if(!d){for(a=c.child;a;){if(a===r){d=!0,r=c,n=o;break}if(a===n){d=!0,n=c,r=o;break}a=a.sibling}if(!d)throw Error(ct(189))}}if(r.alternate!==n)throw Error(ct(190))}if(r.tag!==3)throw Error(ct(188));return r.stateNode.current===r?t:e}function UE(t){return t=Fk(t),t!==null?VE(t):null}function VE(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=VE(t);if(e!==null)return e;t=t.sibling}return null}var jE=Ns.unstable_scheduleCallback,rT=Ns.unstable_cancelCallback,Nk=Ns.unstable_shouldYield,Lk=Ns.unstable_requestPaint,Nn=Ns.unstable_now,zk=Ns.unstable_getCurrentPriorityLevel,Wb=Ns.unstable_ImmediatePriority,$E=Ns.unstable_UserBlockingPriority,Km=Ns.unstable_NormalPriority,Bk=Ns.unstable_LowPriority,WE=Ns.unstable_IdlePriority,ay=null,Qo=null;function Uk(t){if(Qo&&typeof Qo.onCommitFiberRoot=="function")try{Qo.onCommitFiberRoot(ay,t,void 0,(t.current.flags&128)===128)}catch{}}var Eo=Math.clz32?Math.clz32:$k,Vk=Math.log,jk=Math.LN2;function $k(t){return t>>>=0,t===0?32:31-(Vk(t)/jk|0)|0}var Yg=64,Gg=4194304;function Pf(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Qm(t,e){var r=t.pendingLanes;if(r===0)return 0;var n=0,o=t.suspendedLanes,c=t.pingedLanes,d=r&268435455;if(d!==0){var a=d&~o;a!==0?n=Pf(a):(c&=d,c!==0&&(n=Pf(c)))}else d=r&~o,d!==0?n=Pf(d):c!==0&&(n=Pf(c));if(n===0)return 0;if(e!==0&&e!==n&&!(e&o)&&(o=n&-n,c=e&-e,o>=c||o===16&&(c&4194240)!==0))return e;if(n&4&&(n|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)r=31-Eo(e),o=1<<r,n|=t[r],e&=~o;return n}function Wk(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Hk(t,e){for(var r=t.suspendedLanes,n=t.pingedLanes,o=t.expirationTimes,c=t.pendingLanes;0<c;){var d=31-Eo(c),a=1<<d,y=o[d];y===-1?(!(a&r)||a&n)&&(o[d]=Wk(a,e)):y<=e&&(t.expiredLanes|=a),c&=~a}}function dx(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function HE(){var t=Yg;return Yg<<=1,!(Yg&4194240)&&(Yg=64),t}function $v(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function Mp(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Eo(e),t[e]=r}function Xk(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<r;){var o=31-Eo(r),c=1<<o;e[o]=0,n[o]=-1,t[o]=-1,r&=~c}}function Hb(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var n=31-Eo(r),o=1<<n;o&e|t[n]&e&&(t[n]|=e),r&=~o}}var Hr=0;function XE(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var ZE,Xb,qE,YE,GE,fx=!1,Kg=[],kl=null,Dl=null,Ol=null,np=new Map,ip=new Map,El=[],Zk="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function nT(t,e){switch(t){case"focusin":case"focusout":kl=null;break;case"dragenter":case"dragleave":Dl=null;break;case"mouseover":case"mouseout":Ol=null;break;case"pointerover":case"pointerout":np.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ip.delete(e.pointerId)}}function mf(t,e,r,n,o,c){return t===null||t.nativeEvent!==c?(t={blockedOn:e,domEventName:r,eventSystemFlags:n,nativeEvent:c,targetContainers:[o]},e!==null&&(e=kp(e),e!==null&&Xb(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,o!==null&&e.indexOf(o)===-1&&e.push(o),t)}function qk(t,e,r,n,o){switch(e){case"focusin":return kl=mf(kl,t,e,r,n,o),!0;case"dragenter":return Dl=mf(Dl,t,e,r,n,o),!0;case"mouseover":return Ol=mf(Ol,t,e,r,n,o),!0;case"pointerover":var c=o.pointerId;return np.set(c,mf(np.get(c)||null,t,e,r,n,o)),!0;case"gotpointercapture":return c=o.pointerId,ip.set(c,mf(ip.get(c)||null,t,e,r,n,o)),!0}return!1}function KE(t){var e=Nc(t.target);if(e!==null){var r=su(e);if(r!==null){if(e=r.tag,e===13){if(e=BE(r),e!==null){t.blockedOn=e,GE(t.priority,function(){qE(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Im(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=px(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var n=new r.constructor(r.type,r);lx=n,r.target.dispatchEvent(n),lx=null}else return e=kp(r),e!==null&&Xb(e),t.blockedOn=r,!1;e.shift()}return!0}function iT(t,e,r){Im(t)&&r.delete(e)}function Yk(){fx=!1,kl!==null&&Im(kl)&&(kl=null),Dl!==null&&Im(Dl)&&(Dl=null),Ol!==null&&Im(Ol)&&(Ol=null),np.forEach(iT),ip.forEach(iT)}function _f(t,e){t.blockedOn===e&&(t.blockedOn=null,fx||(fx=!0,Ns.unstable_scheduleCallback(Ns.unstable_NormalPriority,Yk)))}function sp(t){function e(o){return _f(o,t)}if(0<Kg.length){_f(Kg[0],t);for(var r=1;r<Kg.length;r++){var n=Kg[r];n.blockedOn===t&&(n.blockedOn=null)}}for(kl!==null&&_f(kl,t),Dl!==null&&_f(Dl,t),Ol!==null&&_f(Ol,t),np.forEach(e),ip.forEach(e),r=0;r<El.length;r++)n=El[r],n.blockedOn===t&&(n.blockedOn=null);for(;0<El.length&&(r=El[0],r.blockedOn===null);)KE(r),r.blockedOn===null&&El.shift()}var zh=Ua.ReactCurrentBatchConfig,Jm=!0;function Gk(t,e,r,n){var o=Hr,c=zh.transition;zh.transition=null;try{Hr=1,Zb(t,e,r,n)}finally{Hr=o,zh.transition=c}}function Kk(t,e,r,n){var o=Hr,c=zh.transition;zh.transition=null;try{Hr=4,Zb(t,e,r,n)}finally{Hr=o,zh.transition=c}}function Zb(t,e,r,n){if(Jm){var o=px(t,e,r,n);if(o===null)Jv(t,e,n,e_,r),nT(t,n);else if(qk(o,t,e,r,n))n.stopPropagation();else if(nT(t,n),e&4&&-1<Zk.indexOf(t)){for(;o!==null;){var c=kp(o);if(c!==null&&ZE(c),c=px(t,e,r,n),c===null&&Jv(t,e,n,e_,r),c===o)break;o=c}o!==null&&n.stopPropagation()}else Jv(t,e,n,null,r)}}var e_=null;function px(t,e,r,n){if(e_=null,t=$b(n),t=Nc(t),t!==null)if(e=su(t),e===null)t=null;else if(r=e.tag,r===13){if(t=BE(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return e_=t,null}function QE(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(zk()){case Wb:return 1;case $E:return 4;case Km:case Bk:return 16;case WE:return 536870912;default:return 16}default:return 16}}var Il=null,qb=null,Pm=null;function JE(){if(Pm)return Pm;var t,e=qb,r=e.length,n,o="value"in Il?Il.value:Il.textContent,c=o.length;for(t=0;t<r&&e[t]===o[t];t++);var d=r-t;for(n=1;n<=d&&e[r-n]===o[c-n];n++);return Pm=o.slice(t,1<n?1-n:void 0)}function Cm(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Qg(){return!0}function sT(){return!1}function zs(t){function e(r,n,o,c,d){this._reactName=r,this._targetInst=o,this.type=n,this.nativeEvent=c,this.target=d,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(r=t[a],this[a]=r?r(c):c[a]);return this.isDefaultPrevented=(c.defaultPrevented!=null?c.defaultPrevented:c.returnValue===!1)?Qg:sT,this.isPropagationStopped=sT,this}return wn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Qg)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Qg)},persist:function(){},isPersistent:Qg}),e}var id={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Yb=zs(id),Rp=wn({},id,{view:0,detail:0}),Qk=zs(Rp),Wv,Hv,yf,ly=wn({},Rp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Gb,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==yf&&(yf&&t.type==="mousemove"?(Wv=t.screenX-yf.screenX,Hv=t.screenY-yf.screenY):Hv=Wv=0,yf=t),Wv)},movementY:function(t){return"movementY"in t?t.movementY:Hv}}),oT=zs(ly),Jk=wn({},ly,{dataTransfer:0}),e4=zs(Jk),t4=wn({},Rp,{relatedTarget:0}),Xv=zs(t4),r4=wn({},id,{animationName:0,elapsedTime:0,pseudoElement:0}),n4=zs(r4),i4=wn({},id,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),s4=zs(i4),o4=wn({},id,{data:0}),aT=zs(o4),a4={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},l4={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},c4={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function u4(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=c4[t])?!!e[t]:!1}function Gb(){return u4}var h4=wn({},Rp,{key:function(t){if(t.key){var e=a4[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Cm(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?l4[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Gb,charCode:function(t){return t.type==="keypress"?Cm(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Cm(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),d4=zs(h4),f4=wn({},ly,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lT=zs(f4),p4=wn({},Rp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Gb}),g4=zs(p4),m4=wn({},id,{propertyName:0,elapsedTime:0,pseudoElement:0}),_4=zs(m4),y4=wn({},ly,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),v4=zs(y4),x4=[9,13,27,32],Kb=Fa&&"CompositionEvent"in window,zf=null;Fa&&"documentMode"in document&&(zf=document.documentMode);var b4=Fa&&"TextEvent"in window&&!zf,eA=Fa&&(!Kb||zf&&8<zf&&11>=zf),cT=" ",uT=!1;function tA(t,e){switch(t){case"keyup":return x4.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rA(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var yh=!1;function w4(t,e){switch(t){case"compositionend":return rA(e);case"keypress":return e.which!==32?null:(uT=!0,cT);case"textInput":return t=e.data,t===cT&&uT?null:t;default:return null}}function T4(t,e){if(yh)return t==="compositionend"||!Kb&&tA(t,e)?(t=JE(),Pm=qb=Il=null,yh=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return eA&&e.locale!=="ko"?null:e.data;default:return null}}var S4={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hT(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!S4[t.type]:e==="textarea"}function nA(t,e,r,n){OE(n),e=t_(e,"onChange"),0<e.length&&(r=new Yb("onChange","change",null,r,n),t.push({event:r,listeners:e}))}var Bf=null,op=null;function E4(t){pA(t,0)}function cy(t){var e=bh(t);if(IE(e))return t}function A4(t,e){if(t==="change")return e}var iA=!1;if(Fa){var Zv;if(Fa){var qv="oninput"in document;if(!qv){var dT=document.createElement("div");dT.setAttribute("oninput","return;"),qv=typeof dT.oninput=="function"}Zv=qv}else Zv=!1;iA=Zv&&(!document.documentMode||9<document.documentMode)}function fT(){Bf&&(Bf.detachEvent("onpropertychange",sA),op=Bf=null)}function sA(t){if(t.propertyName==="value"&&cy(op)){var e=[];nA(e,op,t,$b(t)),zE(E4,e)}}function I4(t,e,r){t==="focusin"?(fT(),Bf=e,op=r,Bf.attachEvent("onpropertychange",sA)):t==="focusout"&&fT()}function P4(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return cy(op)}function C4(t,e){if(t==="click")return cy(e)}function M4(t,e){if(t==="input"||t==="change")return cy(e)}function R4(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Io=typeof Object.is=="function"?Object.is:R4;function ap(t,e){if(Io(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var o=r[n];if(!G0.call(e,o)||!Io(t[o],e[o]))return!1}return!0}function pT(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function gT(t,e){var r=pT(t);t=0;for(var n;r;){if(r.nodeType===3){if(n=t+r.textContent.length,t<=e&&n>=e)return{node:r,offset:e-t};t=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=pT(r)}}function oA(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?oA(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function aA(){for(var t=window,e=qm();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=qm(t.document)}return e}function Qb(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function k4(t){var e=aA(),r=t.focusedElem,n=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&oA(r.ownerDocument.documentElement,r)){if(n!==null&&Qb(r)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var o=r.textContent.length,c=Math.min(n.start,o);n=n.end===void 0?c:Math.min(n.end,o),!t.extend&&c>n&&(o=n,n=c,c=o),o=gT(r,c);var d=gT(r,n);o&&d&&(t.rangeCount!==1||t.anchorNode!==o.node||t.anchorOffset!==o.offset||t.focusNode!==d.node||t.focusOffset!==d.offset)&&(e=e.createRange(),e.setStart(o.node,o.offset),t.removeAllRanges(),c>n?(t.addRange(e),t.extend(d.node,d.offset)):(e.setEnd(d.node,d.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var D4=Fa&&"documentMode"in document&&11>=document.documentMode,vh=null,gx=null,Uf=null,mx=!1;function mT(t,e,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;mx||vh==null||vh!==qm(n)||(n=vh,"selectionStart"in n&&Qb(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Uf&&ap(Uf,n)||(Uf=n,n=t_(gx,"onSelect"),0<n.length&&(e=new Yb("onSelect","select",null,e,r),t.push({event:e,listeners:n}),e.target=vh)))}function Jg(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var xh={animationend:Jg("Animation","AnimationEnd"),animationiteration:Jg("Animation","AnimationIteration"),animationstart:Jg("Animation","AnimationStart"),transitionend:Jg("Transition","TransitionEnd")},Yv={},lA={};Fa&&(lA=document.createElement("div").style,"AnimationEvent"in window||(delete xh.animationend.animation,delete xh.animationiteration.animation,delete xh.animationstart.animation),"TransitionEvent"in window||delete xh.transitionend.transition);function uy(t){if(Yv[t])return Yv[t];if(!xh[t])return t;var e=xh[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in lA)return Yv[t]=e[r];return t}var cA=uy("animationend"),uA=uy("animationiteration"),hA=uy("animationstart"),dA=uy("transitionend"),fA=new Map,_T="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Hl(t,e){fA.set(t,e),iu(e,[t])}for(var Gv=0;Gv<_T.length;Gv++){var Kv=_T[Gv],O4=Kv.toLowerCase(),F4=Kv[0].toUpperCase()+Kv.slice(1);Hl(O4,"on"+F4)}Hl(cA,"onAnimationEnd");Hl(uA,"onAnimationIteration");Hl(hA,"onAnimationStart");Hl("dblclick","onDoubleClick");Hl("focusin","onFocus");Hl("focusout","onBlur");Hl(dA,"onTransitionEnd");$h("onMouseEnter",["mouseout","mouseover"]);$h("onMouseLeave",["mouseout","mouseover"]);$h("onPointerEnter",["pointerout","pointerover"]);$h("onPointerLeave",["pointerout","pointerover"]);iu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));iu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));iu("onBeforeInput",["compositionend","keypress","textInput","paste"]);iu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));iu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));iu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Cf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),N4=new Set("cancel close invalid load scroll toggle".split(" ").concat(Cf));function yT(t,e,r){var n=t.type||"unknown-event";t.currentTarget=r,Ok(n,e,void 0,t),t.currentTarget=null}function pA(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var n=t[r],o=n.event;n=n.listeners;e:{var c=void 0;if(e)for(var d=n.length-1;0<=d;d--){var a=n[d],y=a.instance,S=a.currentTarget;if(a=a.listener,y!==c&&o.isPropagationStopped())break e;yT(o,a,S),c=y}else for(d=0;d<n.length;d++){if(a=n[d],y=a.instance,S=a.currentTarget,a=a.listener,y!==c&&o.isPropagationStopped())break e;yT(o,a,S),c=y}}}if(Gm)throw t=hx,Gm=!1,hx=null,t}function ln(t,e){var r=e[bx];r===void 0&&(r=e[bx]=new Set);var n=t+"__bubble";r.has(n)||(gA(e,t,2,!1),r.add(n))}function Qv(t,e,r){var n=0;e&&(n|=4),gA(r,t,n,e)}var em="_reactListening"+Math.random().toString(36).slice(2);function lp(t){if(!t[em]){t[em]=!0,wE.forEach(function(r){r!=="selectionchange"&&(N4.has(r)||Qv(r,!1,t),Qv(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[em]||(e[em]=!0,Qv("selectionchange",!1,e))}}function gA(t,e,r,n){switch(QE(e)){case 1:var o=Gk;break;case 4:o=Kk;break;default:o=Zb}r=o.bind(null,e,r,t),o=void 0,!ux||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(o=!0),n?o!==void 0?t.addEventListener(e,r,{capture:!0,passive:o}):t.addEventListener(e,r,!0):o!==void 0?t.addEventListener(e,r,{passive:o}):t.addEventListener(e,r,!1)}function Jv(t,e,r,n,o){var c=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var d=n.tag;if(d===3||d===4){var a=n.stateNode.containerInfo;if(a===o||a.nodeType===8&&a.parentNode===o)break;if(d===4)for(d=n.return;d!==null;){var y=d.tag;if((y===3||y===4)&&(y=d.stateNode.containerInfo,y===o||y.nodeType===8&&y.parentNode===o))return;d=d.return}for(;a!==null;){if(d=Nc(a),d===null)return;if(y=d.tag,y===5||y===6){n=c=d;continue e}a=a.parentNode}}n=n.return}zE(function(){var S=c,E=$b(r),M=[];e:{var F=fA.get(t);if(F!==void 0){var N=Yb,G=t;switch(t){case"keypress":if(Cm(r)===0)break e;case"keydown":case"keyup":N=d4;break;case"focusin":G="focus",N=Xv;break;case"focusout":G="blur",N=Xv;break;case"beforeblur":case"afterblur":N=Xv;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":N=oT;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":N=e4;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":N=g4;break;case cA:case uA:case hA:N=n4;break;case dA:N=_4;break;case"scroll":N=Qk;break;case"wheel":N=v4;break;case"copy":case"cut":case"paste":N=s4;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":N=lT}var re=(e&4)!==0,me=!re&&t==="scroll",Y=re?F!==null?F+"Capture":null:F;re=[];for(var q=S,Z;q!==null;){Z=q;var le=Z.stateNode;if(Z.tag===5&&le!==null&&(Z=le,Y!==null&&(le=rp(q,Y),le!=null&&re.push(cp(q,le,Z)))),me)break;q=q.return}0<re.length&&(F=new N(F,G,null,r,E),M.push({event:F,listeners:re}))}}if(!(e&7)){e:{if(F=t==="mouseover"||t==="pointerover",N=t==="mouseout"||t==="pointerout",F&&r!==lx&&(G=r.relatedTarget||r.fromElement)&&(Nc(G)||G[Na]))break e;if((N||F)&&(F=E.window===E?E:(F=E.ownerDocument)?F.defaultView||F.parentWindow:window,N?(G=r.relatedTarget||r.toElement,N=S,G=G?Nc(G):null,G!==null&&(me=su(G),G!==me||G.tag!==5&&G.tag!==6)&&(G=null)):(N=null,G=S),N!==G)){if(re=oT,le="onMouseLeave",Y="onMouseEnter",q="mouse",(t==="pointerout"||t==="pointerover")&&(re=lT,le="onPointerLeave",Y="onPointerEnter",q="pointer"),me=N==null?F:bh(N),Z=G==null?F:bh(G),F=new re(le,q+"leave",N,r,E),F.target=me,F.relatedTarget=Z,le=null,Nc(E)===S&&(re=new re(Y,q+"enter",G,r,E),re.target=Z,re.relatedTarget=me,le=re),me=le,N&&G)t:{for(re=N,Y=G,q=0,Z=re;Z;Z=ah(Z))q++;for(Z=0,le=Y;le;le=ah(le))Z++;for(;0<q-Z;)re=ah(re),q--;for(;0<Z-q;)Y=ah(Y),Z--;for(;q--;){if(re===Y||Y!==null&&re===Y.alternate)break t;re=ah(re),Y=ah(Y)}re=null}else re=null;N!==null&&vT(M,F,N,re,!1),G!==null&&me!==null&&vT(M,me,G,re,!0)}}e:{if(F=S?bh(S):window,N=F.nodeName&&F.nodeName.toLowerCase(),N==="select"||N==="input"&&F.type==="file")var Ae=A4;else if(hT(F))if(iA)Ae=M4;else{Ae=P4;var we=I4}else(N=F.nodeName)&&N.toLowerCase()==="input"&&(F.type==="checkbox"||F.type==="radio")&&(Ae=C4);if(Ae&&(Ae=Ae(t,S))){nA(M,Ae,r,E);break e}we&&we(t,F,S),t==="focusout"&&(we=F._wrapperState)&&we.controlled&&F.type==="number"&&nx(F,"number",F.value)}switch(we=S?bh(S):window,t){case"focusin":(hT(we)||we.contentEditable==="true")&&(vh=we,gx=S,Uf=null);break;case"focusout":Uf=gx=vh=null;break;case"mousedown":mx=!0;break;case"contextmenu":case"mouseup":case"dragend":mx=!1,mT(M,r,E);break;case"selectionchange":if(D4)break;case"keydown":case"keyup":mT(M,r,E)}var je;if(Kb)e:{switch(t){case"compositionstart":var Ue="onCompositionStart";break e;case"compositionend":Ue="onCompositionEnd";break e;case"compositionupdate":Ue="onCompositionUpdate";break e}Ue=void 0}else yh?tA(t,r)&&(Ue="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(Ue="onCompositionStart");Ue&&(eA&&r.locale!=="ko"&&(yh||Ue!=="onCompositionStart"?Ue==="onCompositionEnd"&&yh&&(je=JE()):(Il=E,qb="value"in Il?Il.value:Il.textContent,yh=!0)),we=t_(S,Ue),0<we.length&&(Ue=new aT(Ue,t,null,r,E),M.push({event:Ue,listeners:we}),je?Ue.data=je:(je=rA(r),je!==null&&(Ue.data=je)))),(je=b4?w4(t,r):T4(t,r))&&(S=t_(S,"onBeforeInput"),0<S.length&&(E=new aT("onBeforeInput","beforeinput",null,r,E),M.push({event:E,listeners:S}),E.data=je))}pA(M,e)})}function cp(t,e,r){return{instance:t,listener:e,currentTarget:r}}function t_(t,e){for(var r=e+"Capture",n=[];t!==null;){var o=t,c=o.stateNode;o.tag===5&&c!==null&&(o=c,c=rp(t,r),c!=null&&n.unshift(cp(t,c,o)),c=rp(t,e),c!=null&&n.push(cp(t,c,o))),t=t.return}return n}function ah(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function vT(t,e,r,n,o){for(var c=e._reactName,d=[];r!==null&&r!==n;){var a=r,y=a.alternate,S=a.stateNode;if(y!==null&&y===n)break;a.tag===5&&S!==null&&(a=S,o?(y=rp(r,c),y!=null&&d.unshift(cp(r,y,a))):o||(y=rp(r,c),y!=null&&d.push(cp(r,y,a)))),r=r.return}d.length!==0&&t.push({event:e,listeners:d})}var L4=/\r\n?/g,z4=/\u0000|\uFFFD/g;function xT(t){return(typeof t=="string"?t:""+t).replace(L4,`
`).replace(z4,"")}function tm(t,e,r){if(e=xT(e),xT(t)!==e&&r)throw Error(ct(425))}function r_(){}var _x=null,yx=null;function vx(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var xx=typeof setTimeout=="function"?setTimeout:void 0,B4=typeof clearTimeout=="function"?clearTimeout:void 0,bT=typeof Promise=="function"?Promise:void 0,U4=typeof queueMicrotask=="function"?queueMicrotask:typeof bT<"u"?function(t){return bT.resolve(null).then(t).catch(V4)}:xx;function V4(t){setTimeout(function(){throw t})}function e0(t,e){var r=e,n=0;do{var o=r.nextSibling;if(t.removeChild(r),o&&o.nodeType===8)if(r=o.data,r==="/$"){if(n===0){t.removeChild(o),sp(e);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=o}while(r);sp(e)}function Fl(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function wT(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var sd=Math.random().toString(36).slice(2),qo="__reactFiber$"+sd,up="__reactProps$"+sd,Na="__reactContainer$"+sd,bx="__reactEvents$"+sd,j4="__reactListeners$"+sd,$4="__reactHandles$"+sd;function Nc(t){var e=t[qo];if(e)return e;for(var r=t.parentNode;r;){if(e=r[Na]||r[qo]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=wT(t);t!==null;){if(r=t[qo])return r;t=wT(t)}return e}t=r,r=t.parentNode}return null}function kp(t){return t=t[qo]||t[Na],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function bh(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ct(33))}function hy(t){return t[up]||null}var wx=[],wh=-1;function Xl(t){return{current:t}}function cn(t){0>wh||(t.current=wx[wh],wx[wh]=null,wh--)}function nn(t,e){wh++,wx[wh]=t.current,t.current=e}var $l={},Bi=Xl($l),us=Xl(!1),Yc=$l;function Wh(t,e){var r=t.type.contextTypes;if(!r)return $l;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var o={},c;for(c in r)o[c]=e[c];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=o),o}function hs(t){return t=t.childContextTypes,t!=null}function n_(){cn(us),cn(Bi)}function TT(t,e,r){if(Bi.current!==$l)throw Error(ct(168));nn(Bi,e),nn(us,r)}function mA(t,e,r){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var o in n)if(!(o in e))throw Error(ct(108,Ik(t)||"Unknown",o));return wn({},r,n)}function i_(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||$l,Yc=Bi.current,nn(Bi,t),nn(us,us.current),!0}function ST(t,e,r){var n=t.stateNode;if(!n)throw Error(ct(169));r?(t=mA(t,e,Yc),n.__reactInternalMemoizedMergedChildContext=t,cn(us),cn(Bi),nn(Bi,t)):cn(us),nn(us,r)}var Ia=null,dy=!1,t0=!1;function _A(t){Ia===null?Ia=[t]:Ia.push(t)}function W4(t){dy=!0,_A(t)}function Zl(){if(!t0&&Ia!==null){t0=!0;var t=0,e=Hr;try{var r=Ia;for(Hr=1;t<r.length;t++){var n=r[t];do n=n(!0);while(n!==null)}Ia=null,dy=!1}catch(o){throw Ia!==null&&(Ia=Ia.slice(t+1)),jE(Wb,Zl),o}finally{Hr=e,t0=!1}}return null}var Th=[],Sh=0,s_=null,o_=0,Xs=[],Zs=0,Gc=null,Ra=1,ka="";function Dc(t,e){Th[Sh++]=o_,Th[Sh++]=s_,s_=t,o_=e}function yA(t,e,r){Xs[Zs++]=Ra,Xs[Zs++]=ka,Xs[Zs++]=Gc,Gc=t;var n=Ra;t=ka;var o=32-Eo(n)-1;n&=~(1<<o),r+=1;var c=32-Eo(e)+o;if(30<c){var d=o-o%5;c=(n&(1<<d)-1).toString(32),n>>=d,o-=d,Ra=1<<32-Eo(e)+o|r<<o|n,ka=c+t}else Ra=1<<c|r<<o|n,ka=t}function Jb(t){t.return!==null&&(Dc(t,1),yA(t,1,0))}function e1(t){for(;t===s_;)s_=Th[--Sh],Th[Sh]=null,o_=Th[--Sh],Th[Sh]=null;for(;t===Gc;)Gc=Xs[--Zs],Xs[Zs]=null,ka=Xs[--Zs],Xs[Zs]=null,Ra=Xs[--Zs],Xs[Zs]=null}var Fs=null,Ds=null,fn=!1,wo=null;function vA(t,e){var r=qs(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function ET(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Fs=t,Ds=Fl(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Fs=t,Ds=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=Gc!==null?{id:Ra,overflow:ka}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=qs(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,Fs=t,Ds=null,!0):!1;default:return!1}}function Tx(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Sx(t){if(fn){var e=Ds;if(e){var r=e;if(!ET(t,e)){if(Tx(t))throw Error(ct(418));e=Fl(r.nextSibling);var n=Fs;e&&ET(t,e)?vA(n,r):(t.flags=t.flags&-4097|2,fn=!1,Fs=t)}}else{if(Tx(t))throw Error(ct(418));t.flags=t.flags&-4097|2,fn=!1,Fs=t}}}function AT(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Fs=t}function rm(t){if(t!==Fs)return!1;if(!fn)return AT(t),fn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!vx(t.type,t.memoizedProps)),e&&(e=Ds)){if(Tx(t))throw xA(),Error(ct(418));for(;e;)vA(t,e),e=Fl(e.nextSibling)}if(AT(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ct(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){Ds=Fl(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}Ds=null}}else Ds=Fs?Fl(t.stateNode.nextSibling):null;return!0}function xA(){for(var t=Ds;t;)t=Fl(t.nextSibling)}function Hh(){Ds=Fs=null,fn=!1}function t1(t){wo===null?wo=[t]:wo.push(t)}var H4=Ua.ReactCurrentBatchConfig;function vf(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(ct(309));var n=r.stateNode}if(!n)throw Error(ct(147,t));var o=n,c=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===c?e.ref:(e=function(d){var a=o.refs;d===null?delete a[c]:a[c]=d},e._stringRef=c,e)}if(typeof t!="string")throw Error(ct(284));if(!r._owner)throw Error(ct(290,t))}return t}function nm(t,e){throw t=Object.prototype.toString.call(e),Error(ct(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function IT(t){var e=t._init;return e(t._payload)}function bA(t){function e(Y,q){if(t){var Z=Y.deletions;Z===null?(Y.deletions=[q],Y.flags|=16):Z.push(q)}}function r(Y,q){if(!t)return null;for(;q!==null;)e(Y,q),q=q.sibling;return null}function n(Y,q){for(Y=new Map;q!==null;)q.key!==null?Y.set(q.key,q):Y.set(q.index,q),q=q.sibling;return Y}function o(Y,q){return Y=Bl(Y,q),Y.index=0,Y.sibling=null,Y}function c(Y,q,Z){return Y.index=Z,t?(Z=Y.alternate,Z!==null?(Z=Z.index,Z<q?(Y.flags|=2,q):Z):(Y.flags|=2,q)):(Y.flags|=1048576,q)}function d(Y){return t&&Y.alternate===null&&(Y.flags|=2),Y}function a(Y,q,Z,le){return q===null||q.tag!==6?(q=l0(Z,Y.mode,le),q.return=Y,q):(q=o(q,Z),q.return=Y,q)}function y(Y,q,Z,le){var Ae=Z.type;return Ae===_h?E(Y,q,Z.props.children,le,Z.key):q!==null&&(q.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===xl&&IT(Ae)===q.type)?(le=o(q,Z.props),le.ref=vf(Y,q,Z),le.return=Y,le):(le=Nm(Z.type,Z.key,Z.props,null,Y.mode,le),le.ref=vf(Y,q,Z),le.return=Y,le)}function S(Y,q,Z,le){return q===null||q.tag!==4||q.stateNode.containerInfo!==Z.containerInfo||q.stateNode.implementation!==Z.implementation?(q=c0(Z,Y.mode,le),q.return=Y,q):(q=o(q,Z.children||[]),q.return=Y,q)}function E(Y,q,Z,le,Ae){return q===null||q.tag!==7?(q=$c(Z,Y.mode,le,Ae),q.return=Y,q):(q=o(q,Z),q.return=Y,q)}function M(Y,q,Z){if(typeof q=="string"&&q!==""||typeof q=="number")return q=l0(""+q,Y.mode,Z),q.return=Y,q;if(typeof q=="object"&&q!==null){switch(q.$$typeof){case Xg:return Z=Nm(q.type,q.key,q.props,null,Y.mode,Z),Z.ref=vf(Y,null,q),Z.return=Y,Z;case mh:return q=c0(q,Y.mode,Z),q.return=Y,q;case xl:var le=q._init;return M(Y,le(q._payload),Z)}if(If(q)||pf(q))return q=$c(q,Y.mode,Z,null),q.return=Y,q;nm(Y,q)}return null}function F(Y,q,Z,le){var Ae=q!==null?q.key:null;if(typeof Z=="string"&&Z!==""||typeof Z=="number")return Ae!==null?null:a(Y,q,""+Z,le);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case Xg:return Z.key===Ae?y(Y,q,Z,le):null;case mh:return Z.key===Ae?S(Y,q,Z,le):null;case xl:return Ae=Z._init,F(Y,q,Ae(Z._payload),le)}if(If(Z)||pf(Z))return Ae!==null?null:E(Y,q,Z,le,null);nm(Y,Z)}return null}function N(Y,q,Z,le,Ae){if(typeof le=="string"&&le!==""||typeof le=="number")return Y=Y.get(Z)||null,a(q,Y,""+le,Ae);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case Xg:return Y=Y.get(le.key===null?Z:le.key)||null,y(q,Y,le,Ae);case mh:return Y=Y.get(le.key===null?Z:le.key)||null,S(q,Y,le,Ae);case xl:var we=le._init;return N(Y,q,Z,we(le._payload),Ae)}if(If(le)||pf(le))return Y=Y.get(Z)||null,E(q,Y,le,Ae,null);nm(q,le)}return null}function G(Y,q,Z,le){for(var Ae=null,we=null,je=q,Ue=q=0,Ze=null;je!==null&&Ue<Z.length;Ue++){je.index>Ue?(Ze=je,je=null):Ze=je.sibling;var qe=F(Y,je,Z[Ue],le);if(qe===null){je===null&&(je=Ze);break}t&&je&&qe.alternate===null&&e(Y,je),q=c(qe,q,Ue),we===null?Ae=qe:we.sibling=qe,we=qe,je=Ze}if(Ue===Z.length)return r(Y,je),fn&&Dc(Y,Ue),Ae;if(je===null){for(;Ue<Z.length;Ue++)je=M(Y,Z[Ue],le),je!==null&&(q=c(je,q,Ue),we===null?Ae=je:we.sibling=je,we=je);return fn&&Dc(Y,Ue),Ae}for(je=n(Y,je);Ue<Z.length;Ue++)Ze=N(je,Y,Ue,Z[Ue],le),Ze!==null&&(t&&Ze.alternate!==null&&je.delete(Ze.key===null?Ue:Ze.key),q=c(Ze,q,Ue),we===null?Ae=Ze:we.sibling=Ze,we=Ze);return t&&je.forEach(function(Ke){return e(Y,Ke)}),fn&&Dc(Y,Ue),Ae}function re(Y,q,Z,le){var Ae=pf(Z);if(typeof Ae!="function")throw Error(ct(150));if(Z=Ae.call(Z),Z==null)throw Error(ct(151));for(var we=Ae=null,je=q,Ue=q=0,Ze=null,qe=Z.next();je!==null&&!qe.done;Ue++,qe=Z.next()){je.index>Ue?(Ze=je,je=null):Ze=je.sibling;var Ke=F(Y,je,qe.value,le);if(Ke===null){je===null&&(je=Ze);break}t&&je&&Ke.alternate===null&&e(Y,je),q=c(Ke,q,Ue),we===null?Ae=Ke:we.sibling=Ke,we=Ke,je=Ze}if(qe.done)return r(Y,je),fn&&Dc(Y,Ue),Ae;if(je===null){for(;!qe.done;Ue++,qe=Z.next())qe=M(Y,qe.value,le),qe!==null&&(q=c(qe,q,Ue),we===null?Ae=qe:we.sibling=qe,we=qe);return fn&&Dc(Y,Ue),Ae}for(je=n(Y,je);!qe.done;Ue++,qe=Z.next())qe=N(je,Y,Ue,qe.value,le),qe!==null&&(t&&qe.alternate!==null&&je.delete(qe.key===null?Ue:qe.key),q=c(qe,q,Ue),we===null?Ae=qe:we.sibling=qe,we=qe);return t&&je.forEach(function(ht){return e(Y,ht)}),fn&&Dc(Y,Ue),Ae}function me(Y,q,Z,le){if(typeof Z=="object"&&Z!==null&&Z.type===_h&&Z.key===null&&(Z=Z.props.children),typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case Xg:e:{for(var Ae=Z.key,we=q;we!==null;){if(we.key===Ae){if(Ae=Z.type,Ae===_h){if(we.tag===7){r(Y,we.sibling),q=o(we,Z.props.children),q.return=Y,Y=q;break e}}else if(we.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===xl&&IT(Ae)===we.type){r(Y,we.sibling),q=o(we,Z.props),q.ref=vf(Y,we,Z),q.return=Y,Y=q;break e}r(Y,we);break}else e(Y,we);we=we.sibling}Z.type===_h?(q=$c(Z.props.children,Y.mode,le,Z.key),q.return=Y,Y=q):(le=Nm(Z.type,Z.key,Z.props,null,Y.mode,le),le.ref=vf(Y,q,Z),le.return=Y,Y=le)}return d(Y);case mh:e:{for(we=Z.key;q!==null;){if(q.key===we)if(q.tag===4&&q.stateNode.containerInfo===Z.containerInfo&&q.stateNode.implementation===Z.implementation){r(Y,q.sibling),q=o(q,Z.children||[]),q.return=Y,Y=q;break e}else{r(Y,q);break}else e(Y,q);q=q.sibling}q=c0(Z,Y.mode,le),q.return=Y,Y=q}return d(Y);case xl:return we=Z._init,me(Y,q,we(Z._payload),le)}if(If(Z))return G(Y,q,Z,le);if(pf(Z))return re(Y,q,Z,le);nm(Y,Z)}return typeof Z=="string"&&Z!==""||typeof Z=="number"?(Z=""+Z,q!==null&&q.tag===6?(r(Y,q.sibling),q=o(q,Z),q.return=Y,Y=q):(r(Y,q),q=l0(Z,Y.mode,le),q.return=Y,Y=q),d(Y)):r(Y,q)}return me}var Xh=bA(!0),wA=bA(!1),a_=Xl(null),l_=null,Eh=null,r1=null;function n1(){r1=Eh=l_=null}function i1(t){var e=a_.current;cn(a_),t._currentValue=e}function Ex(t,e,r){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===r)break;t=t.return}}function Bh(t,e){l_=t,r1=Eh=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(cs=!0),t.firstContext=null)}function Js(t){var e=t._currentValue;if(r1!==t)if(t={context:t,memoizedValue:e,next:null},Eh===null){if(l_===null)throw Error(ct(308));Eh=t,l_.dependencies={lanes:0,firstContext:t}}else Eh=Eh.next=t;return e}var Lc=null;function s1(t){Lc===null?Lc=[t]:Lc.push(t)}function TA(t,e,r,n){var o=e.interleaved;return o===null?(r.next=r,s1(e)):(r.next=o.next,o.next=r),e.interleaved=r,La(t,n)}function La(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var bl=!1;function o1(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function SA(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Oa(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Nl(t,e,r){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,Cr&2){var o=n.pending;return o===null?e.next=e:(e.next=o.next,o.next=e),n.pending=e,La(t,r)}return o=n.interleaved,o===null?(e.next=e,s1(n)):(e.next=o.next,o.next=e),n.interleaved=e,La(t,r)}function Mm(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,Hb(t,r)}}function PT(t,e){var r=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var o=null,c=null;if(r=r.firstBaseUpdate,r!==null){do{var d={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};c===null?o=c=d:c=c.next=d,r=r.next}while(r!==null);c===null?o=c=e:c=c.next=e}else o=c=e;r={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:c,shared:n.shared,effects:n.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function c_(t,e,r,n){var o=t.updateQueue;bl=!1;var c=o.firstBaseUpdate,d=o.lastBaseUpdate,a=o.shared.pending;if(a!==null){o.shared.pending=null;var y=a,S=y.next;y.next=null,d===null?c=S:d.next=S,d=y;var E=t.alternate;E!==null&&(E=E.updateQueue,a=E.lastBaseUpdate,a!==d&&(a===null?E.firstBaseUpdate=S:a.next=S,E.lastBaseUpdate=y))}if(c!==null){var M=o.baseState;d=0,E=S=y=null,a=c;do{var F=a.lane,N=a.eventTime;if((n&F)===F){E!==null&&(E=E.next={eventTime:N,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var G=t,re=a;switch(F=e,N=r,re.tag){case 1:if(G=re.payload,typeof G=="function"){M=G.call(N,M,F);break e}M=G;break e;case 3:G.flags=G.flags&-65537|128;case 0:if(G=re.payload,F=typeof G=="function"?G.call(N,M,F):G,F==null)break e;M=wn({},M,F);break e;case 2:bl=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,F=o.effects,F===null?o.effects=[a]:F.push(a))}else N={eventTime:N,lane:F,tag:a.tag,payload:a.payload,callback:a.callback,next:null},E===null?(S=E=N,y=M):E=E.next=N,d|=F;if(a=a.next,a===null){if(a=o.shared.pending,a===null)break;F=a,a=F.next,F.next=null,o.lastBaseUpdate=F,o.shared.pending=null}}while(!0);if(E===null&&(y=M),o.baseState=y,o.firstBaseUpdate=S,o.lastBaseUpdate=E,e=o.shared.interleaved,e!==null){o=e;do d|=o.lane,o=o.next;while(o!==e)}else c===null&&(o.shared.lanes=0);Qc|=d,t.lanes=d,t.memoizedState=M}}function CT(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],o=n.callback;if(o!==null){if(n.callback=null,n=r,typeof o!="function")throw Error(ct(191,o));o.call(n)}}}var Dp={},Jo=Xl(Dp),hp=Xl(Dp),dp=Xl(Dp);function zc(t){if(t===Dp)throw Error(ct(174));return t}function a1(t,e){switch(nn(dp,e),nn(hp,t),nn(Jo,Dp),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:sx(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=sx(e,t)}cn(Jo),nn(Jo,e)}function Zh(){cn(Jo),cn(hp),cn(dp)}function EA(t){zc(dp.current);var e=zc(Jo.current),r=sx(e,t.type);e!==r&&(nn(hp,t),nn(Jo,r))}function l1(t){hp.current===t&&(cn(Jo),cn(hp))}var xn=Xl(0);function u_(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var r0=[];function c1(){for(var t=0;t<r0.length;t++)r0[t]._workInProgressVersionPrimary=null;r0.length=0}var Rm=Ua.ReactCurrentDispatcher,n0=Ua.ReactCurrentBatchConfig,Kc=0,bn=null,ti=null,hi=null,h_=!1,Vf=!1,fp=0,X4=0;function Di(){throw Error(ct(321))}function u1(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!Io(t[r],e[r]))return!1;return!0}function h1(t,e,r,n,o,c){if(Kc=c,bn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Rm.current=t===null||t.memoizedState===null?G4:K4,t=r(n,o),Vf){c=0;do{if(Vf=!1,fp=0,25<=c)throw Error(ct(301));c+=1,hi=ti=null,e.updateQueue=null,Rm.current=Q4,t=r(n,o)}while(Vf)}if(Rm.current=d_,e=ti!==null&&ti.next!==null,Kc=0,hi=ti=bn=null,h_=!1,e)throw Error(ct(300));return t}function d1(){var t=fp!==0;return fp=0,t}function Xo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return hi===null?bn.memoizedState=hi=t:hi=hi.next=t,hi}function eo(){if(ti===null){var t=bn.alternate;t=t!==null?t.memoizedState:null}else t=ti.next;var e=hi===null?bn.memoizedState:hi.next;if(e!==null)hi=e,ti=t;else{if(t===null)throw Error(ct(310));ti=t,t={memoizedState:ti.memoizedState,baseState:ti.baseState,baseQueue:ti.baseQueue,queue:ti.queue,next:null},hi===null?bn.memoizedState=hi=t:hi=hi.next=t}return hi}function pp(t,e){return typeof e=="function"?e(t):e}function i0(t){var e=eo(),r=e.queue;if(r===null)throw Error(ct(311));r.lastRenderedReducer=t;var n=ti,o=n.baseQueue,c=r.pending;if(c!==null){if(o!==null){var d=o.next;o.next=c.next,c.next=d}n.baseQueue=o=c,r.pending=null}if(o!==null){c=o.next,n=n.baseState;var a=d=null,y=null,S=c;do{var E=S.lane;if((Kc&E)===E)y!==null&&(y=y.next={lane:0,action:S.action,hasEagerState:S.hasEagerState,eagerState:S.eagerState,next:null}),n=S.hasEagerState?S.eagerState:t(n,S.action);else{var M={lane:E,action:S.action,hasEagerState:S.hasEagerState,eagerState:S.eagerState,next:null};y===null?(a=y=M,d=n):y=y.next=M,bn.lanes|=E,Qc|=E}S=S.next}while(S!==null&&S!==c);y===null?d=n:y.next=a,Io(n,e.memoizedState)||(cs=!0),e.memoizedState=n,e.baseState=d,e.baseQueue=y,r.lastRenderedState=n}if(t=r.interleaved,t!==null){o=t;do c=o.lane,bn.lanes|=c,Qc|=c,o=o.next;while(o!==t)}else o===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function s0(t){var e=eo(),r=e.queue;if(r===null)throw Error(ct(311));r.lastRenderedReducer=t;var n=r.dispatch,o=r.pending,c=e.memoizedState;if(o!==null){r.pending=null;var d=o=o.next;do c=t(c,d.action),d=d.next;while(d!==o);Io(c,e.memoizedState)||(cs=!0),e.memoizedState=c,e.baseQueue===null&&(e.baseState=c),r.lastRenderedState=c}return[c,n]}function AA(){}function IA(t,e){var r=bn,n=eo(),o=e(),c=!Io(n.memoizedState,o);if(c&&(n.memoizedState=o,cs=!0),n=n.queue,f1(MA.bind(null,r,n,t),[t]),n.getSnapshot!==e||c||hi!==null&&hi.memoizedState.tag&1){if(r.flags|=2048,gp(9,CA.bind(null,r,n,o,e),void 0,null),di===null)throw Error(ct(349));Kc&30||PA(r,e,o)}return o}function PA(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=bn.updateQueue,e===null?(e={lastEffect:null,stores:null},bn.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function CA(t,e,r,n){e.value=r,e.getSnapshot=n,RA(e)&&kA(t)}function MA(t,e,r){return r(function(){RA(e)&&kA(t)})}function RA(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!Io(t,r)}catch{return!0}}function kA(t){var e=La(t,1);e!==null&&Ao(e,t,1,-1)}function MT(t){var e=Xo();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:pp,lastRenderedState:t},e.queue=t,t=t.dispatch=Y4.bind(null,bn,t),[e.memoizedState,t]}function gp(t,e,r,n){return t={tag:t,create:e,destroy:r,deps:n,next:null},e=bn.updateQueue,e===null?(e={lastEffect:null,stores:null},bn.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(n=r.next,r.next=t,t.next=n,e.lastEffect=t)),t}function DA(){return eo().memoizedState}function km(t,e,r,n){var o=Xo();bn.flags|=t,o.memoizedState=gp(1|e,r,void 0,n===void 0?null:n)}function fy(t,e,r,n){var o=eo();n=n===void 0?null:n;var c=void 0;if(ti!==null){var d=ti.memoizedState;if(c=d.destroy,n!==null&&u1(n,d.deps)){o.memoizedState=gp(e,r,c,n);return}}bn.flags|=t,o.memoizedState=gp(1|e,r,c,n)}function RT(t,e){return km(8390656,8,t,e)}function f1(t,e){return fy(2048,8,t,e)}function OA(t,e){return fy(4,2,t,e)}function FA(t,e){return fy(4,4,t,e)}function NA(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function LA(t,e,r){return r=r!=null?r.concat([t]):null,fy(4,4,NA.bind(null,e,t),r)}function p1(){}function zA(t,e){var r=eo();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&u1(e,n[1])?n[0]:(r.memoizedState=[t,e],t)}function BA(t,e){var r=eo();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&u1(e,n[1])?n[0]:(t=t(),r.memoizedState=[t,e],t)}function UA(t,e,r){return Kc&21?(Io(r,e)||(r=HE(),bn.lanes|=r,Qc|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,cs=!0),t.memoizedState=r)}function Z4(t,e){var r=Hr;Hr=r!==0&&4>r?r:4,t(!0);var n=n0.transition;n0.transition={};try{t(!1),e()}finally{Hr=r,n0.transition=n}}function VA(){return eo().memoizedState}function q4(t,e,r){var n=zl(t);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},jA(t))$A(e,r);else if(r=TA(t,e,r,n),r!==null){var o=Qi();Ao(r,t,n,o),WA(r,e,n)}}function Y4(t,e,r){var n=zl(t),o={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(jA(t))$A(e,o);else{var c=t.alternate;if(t.lanes===0&&(c===null||c.lanes===0)&&(c=e.lastRenderedReducer,c!==null))try{var d=e.lastRenderedState,a=c(d,r);if(o.hasEagerState=!0,o.eagerState=a,Io(a,d)){var y=e.interleaved;y===null?(o.next=o,s1(e)):(o.next=y.next,y.next=o),e.interleaved=o;return}}catch{}finally{}r=TA(t,e,o,n),r!==null&&(o=Qi(),Ao(r,t,n,o),WA(r,e,n))}}function jA(t){var e=t.alternate;return t===bn||e!==null&&e===bn}function $A(t,e){Vf=h_=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function WA(t,e,r){if(r&4194240){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,Hb(t,r)}}var d_={readContext:Js,useCallback:Di,useContext:Di,useEffect:Di,useImperativeHandle:Di,useInsertionEffect:Di,useLayoutEffect:Di,useMemo:Di,useReducer:Di,useRef:Di,useState:Di,useDebugValue:Di,useDeferredValue:Di,useTransition:Di,useMutableSource:Di,useSyncExternalStore:Di,useId:Di,unstable_isNewReconciler:!1},G4={readContext:Js,useCallback:function(t,e){return Xo().memoizedState=[t,e===void 0?null:e],t},useContext:Js,useEffect:RT,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,km(4194308,4,NA.bind(null,e,t),r)},useLayoutEffect:function(t,e){return km(4194308,4,t,e)},useInsertionEffect:function(t,e){return km(4,2,t,e)},useMemo:function(t,e){var r=Xo();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var n=Xo();return e=r!==void 0?r(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=q4.bind(null,bn,t),[n.memoizedState,t]},useRef:function(t){var e=Xo();return t={current:t},e.memoizedState=t},useState:MT,useDebugValue:p1,useDeferredValue:function(t){return Xo().memoizedState=t},useTransition:function(){var t=MT(!1),e=t[0];return t=Z4.bind(null,t[1]),Xo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var n=bn,o=Xo();if(fn){if(r===void 0)throw Error(ct(407));r=r()}else{if(r=e(),di===null)throw Error(ct(349));Kc&30||PA(n,e,r)}o.memoizedState=r;var c={value:r,getSnapshot:e};return o.queue=c,RT(MA.bind(null,n,c,t),[t]),n.flags|=2048,gp(9,CA.bind(null,n,c,r,e),void 0,null),r},useId:function(){var t=Xo(),e=di.identifierPrefix;if(fn){var r=ka,n=Ra;r=(n&~(1<<32-Eo(n)-1)).toString(32)+r,e=":"+e+"R"+r,r=fp++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=X4++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},K4={readContext:Js,useCallback:zA,useContext:Js,useEffect:f1,useImperativeHandle:LA,useInsertionEffect:OA,useLayoutEffect:FA,useMemo:BA,useReducer:i0,useRef:DA,useState:function(){return i0(pp)},useDebugValue:p1,useDeferredValue:function(t){var e=eo();return UA(e,ti.memoizedState,t)},useTransition:function(){var t=i0(pp)[0],e=eo().memoizedState;return[t,e]},useMutableSource:AA,useSyncExternalStore:IA,useId:VA,unstable_isNewReconciler:!1},Q4={readContext:Js,useCallback:zA,useContext:Js,useEffect:f1,useImperativeHandle:LA,useInsertionEffect:OA,useLayoutEffect:FA,useMemo:BA,useReducer:s0,useRef:DA,useState:function(){return s0(pp)},useDebugValue:p1,useDeferredValue:function(t){var e=eo();return ti===null?e.memoizedState=t:UA(e,ti.memoizedState,t)},useTransition:function(){var t=s0(pp)[0],e=eo().memoizedState;return[t,e]},useMutableSource:AA,useSyncExternalStore:IA,useId:VA,unstable_isNewReconciler:!1};function xo(t,e){if(t&&t.defaultProps){e=wn({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}function Ax(t,e,r,n){e=t.memoizedState,r=r(n,e),r=r==null?e:wn({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var py={isMounted:function(t){return(t=t._reactInternals)?su(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var n=Qi(),o=zl(t),c=Oa(n,o);c.payload=e,r!=null&&(c.callback=r),e=Nl(t,c,o),e!==null&&(Ao(e,t,o,n),Mm(e,t,o))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var n=Qi(),o=zl(t),c=Oa(n,o);c.tag=1,c.payload=e,r!=null&&(c.callback=r),e=Nl(t,c,o),e!==null&&(Ao(e,t,o,n),Mm(e,t,o))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=Qi(),n=zl(t),o=Oa(r,n);o.tag=2,e!=null&&(o.callback=e),e=Nl(t,o,n),e!==null&&(Ao(e,t,n,r),Mm(e,t,n))}};function kT(t,e,r,n,o,c,d){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,c,d):e.prototype&&e.prototype.isPureReactComponent?!ap(r,n)||!ap(o,c):!0}function HA(t,e,r){var n=!1,o=$l,c=e.contextType;return typeof c=="object"&&c!==null?c=Js(c):(o=hs(e)?Yc:Bi.current,n=e.contextTypes,c=(n=n!=null)?Wh(t,o):$l),e=new e(r,c),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=py,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=c),e}function DT(t,e,r,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,n),e.state!==t&&py.enqueueReplaceState(e,e.state,null)}function Ix(t,e,r,n){var o=t.stateNode;o.props=r,o.state=t.memoizedState,o.refs={},o1(t);var c=e.contextType;typeof c=="object"&&c!==null?o.context=Js(c):(c=hs(e)?Yc:Bi.current,o.context=Wh(t,c)),o.state=t.memoizedState,c=e.getDerivedStateFromProps,typeof c=="function"&&(Ax(t,e,c,r),o.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(e=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),e!==o.state&&py.enqueueReplaceState(o,o.state,null),c_(t,r,o,n),o.state=t.memoizedState),typeof o.componentDidMount=="function"&&(t.flags|=4194308)}function qh(t,e){try{var r="",n=e;do r+=Ak(n),n=n.return;while(n);var o=r}catch(c){o=`
Error generating stack: `+c.message+`
`+c.stack}return{value:t,source:e,stack:o,digest:null}}function o0(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function Px(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var J4=typeof WeakMap=="function"?WeakMap:Map;function XA(t,e,r){r=Oa(-1,r),r.tag=3,r.payload={element:null};var n=e.value;return r.callback=function(){p_||(p_=!0,zx=n),Px(t,e)},r}function ZA(t,e,r){r=Oa(-1,r),r.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var o=e.value;r.payload=function(){return n(o)},r.callback=function(){Px(t,e)}}var c=t.stateNode;return c!==null&&typeof c.componentDidCatch=="function"&&(r.callback=function(){Px(t,e),typeof n!="function"&&(Ll===null?Ll=new Set([this]):Ll.add(this));var d=e.stack;this.componentDidCatch(e.value,{componentStack:d!==null?d:""})}),r}function OT(t,e,r){var n=t.pingCache;if(n===null){n=t.pingCache=new J4;var o=new Set;n.set(e,o)}else o=n.get(e),o===void 0&&(o=new Set,n.set(e,o));o.has(r)||(o.add(r),t=fD.bind(null,t,e,r),e.then(t,t))}function FT(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function NT(t,e,r,n,o){return t.mode&1?(t.flags|=65536,t.lanes=o,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=Oa(-1,1),e.tag=2,Nl(r,e,1))),r.lanes|=1),t)}var eD=Ua.ReactCurrentOwner,cs=!1;function Gi(t,e,r,n){e.child=t===null?wA(e,null,r,n):Xh(e,t.child,r,n)}function LT(t,e,r,n,o){r=r.render;var c=e.ref;return Bh(e,o),n=h1(t,e,r,n,c,o),r=d1(),t!==null&&!cs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,za(t,e,o)):(fn&&r&&Jb(e),e.flags|=1,Gi(t,e,n,o),e.child)}function zT(t,e,r,n,o){if(t===null){var c=r.type;return typeof c=="function"&&!w1(c)&&c.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=c,qA(t,e,c,n,o)):(t=Nm(r.type,null,n,e,e.mode,o),t.ref=e.ref,t.return=e,e.child=t)}if(c=t.child,!(t.lanes&o)){var d=c.memoizedProps;if(r=r.compare,r=r!==null?r:ap,r(d,n)&&t.ref===e.ref)return za(t,e,o)}return e.flags|=1,t=Bl(c,n),t.ref=e.ref,t.return=e,e.child=t}function qA(t,e,r,n,o){if(t!==null){var c=t.memoizedProps;if(ap(c,n)&&t.ref===e.ref)if(cs=!1,e.pendingProps=n=c,(t.lanes&o)!==0)t.flags&131072&&(cs=!0);else return e.lanes=t.lanes,za(t,e,o)}return Cx(t,e,r,n,o)}function YA(t,e,r){var n=e.pendingProps,o=n.children,c=t!==null?t.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},nn(Ih,Cs),Cs|=r;else{if(!(r&1073741824))return t=c!==null?c.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,nn(Ih,Cs),Cs|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=c!==null?c.baseLanes:r,nn(Ih,Cs),Cs|=n}else c!==null?(n=c.baseLanes|r,e.memoizedState=null):n=r,nn(Ih,Cs),Cs|=n;return Gi(t,e,o,r),e.child}function GA(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function Cx(t,e,r,n,o){var c=hs(r)?Yc:Bi.current;return c=Wh(e,c),Bh(e,o),r=h1(t,e,r,n,c,o),n=d1(),t!==null&&!cs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,za(t,e,o)):(fn&&n&&Jb(e),e.flags|=1,Gi(t,e,r,o),e.child)}function BT(t,e,r,n,o){if(hs(r)){var c=!0;i_(e)}else c=!1;if(Bh(e,o),e.stateNode===null)Dm(t,e),HA(e,r,n),Ix(e,r,n,o),n=!0;else if(t===null){var d=e.stateNode,a=e.memoizedProps;d.props=a;var y=d.context,S=r.contextType;typeof S=="object"&&S!==null?S=Js(S):(S=hs(r)?Yc:Bi.current,S=Wh(e,S));var E=r.getDerivedStateFromProps,M=typeof E=="function"||typeof d.getSnapshotBeforeUpdate=="function";M||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(a!==n||y!==S)&&DT(e,d,n,S),bl=!1;var F=e.memoizedState;d.state=F,c_(e,n,d,o),y=e.memoizedState,a!==n||F!==y||us.current||bl?(typeof E=="function"&&(Ax(e,r,E,n),y=e.memoizedState),(a=bl||kT(e,r,a,n,F,y,S))?(M||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(e.flags|=4194308)):(typeof d.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=y),d.props=n,d.state=y,d.context=S,n=a):(typeof d.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{d=e.stateNode,SA(t,e),a=e.memoizedProps,S=e.type===e.elementType?a:xo(e.type,a),d.props=S,M=e.pendingProps,F=d.context,y=r.contextType,typeof y=="object"&&y!==null?y=Js(y):(y=hs(r)?Yc:Bi.current,y=Wh(e,y));var N=r.getDerivedStateFromProps;(E=typeof N=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(a!==M||F!==y)&&DT(e,d,n,y),bl=!1,F=e.memoizedState,d.state=F,c_(e,n,d,o);var G=e.memoizedState;a!==M||F!==G||us.current||bl?(typeof N=="function"&&(Ax(e,r,N,n),G=e.memoizedState),(S=bl||kT(e,r,S,n,F,G,y)||!1)?(E||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(n,G,y),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(n,G,y)),typeof d.componentDidUpdate=="function"&&(e.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof d.componentDidUpdate!="function"||a===t.memoizedProps&&F===t.memoizedState||(e.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&F===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=G),d.props=n,d.state=G,d.context=y,n=S):(typeof d.componentDidUpdate!="function"||a===t.memoizedProps&&F===t.memoizedState||(e.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&F===t.memoizedState||(e.flags|=1024),n=!1)}return Mx(t,e,r,n,c,o)}function Mx(t,e,r,n,o,c){GA(t,e);var d=(e.flags&128)!==0;if(!n&&!d)return o&&ST(e,r,!1),za(t,e,c);n=e.stateNode,eD.current=e;var a=d&&typeof r.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&d?(e.child=Xh(e,t.child,null,c),e.child=Xh(e,null,a,c)):Gi(t,e,a,c),e.memoizedState=n.state,o&&ST(e,r,!0),e.child}function KA(t){var e=t.stateNode;e.pendingContext?TT(t,e.pendingContext,e.pendingContext!==e.context):e.context&&TT(t,e.context,!1),a1(t,e.containerInfo)}function UT(t,e,r,n,o){return Hh(),t1(o),e.flags|=256,Gi(t,e,r,n),e.child}var Rx={dehydrated:null,treeContext:null,retryLane:0};function kx(t){return{baseLanes:t,cachePool:null,transitions:null}}function QA(t,e,r){var n=e.pendingProps,o=xn.current,c=!1,d=(e.flags&128)!==0,a;if((a=d)||(a=t!==null&&t.memoizedState===null?!1:(o&2)!==0),a?(c=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(o|=1),nn(xn,o&1),t===null)return Sx(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(d=n.children,t=n.fallback,c?(n=e.mode,c=e.child,d={mode:"hidden",children:d},!(n&1)&&c!==null?(c.childLanes=0,c.pendingProps=d):c=_y(d,n,0,null),t=$c(t,n,r,null),c.return=e,t.return=e,c.sibling=t,e.child=c,e.child.memoizedState=kx(r),e.memoizedState=Rx,t):g1(e,d));if(o=t.memoizedState,o!==null&&(a=o.dehydrated,a!==null))return tD(t,e,d,n,a,o,r);if(c){c=n.fallback,d=e.mode,o=t.child,a=o.sibling;var y={mode:"hidden",children:n.children};return!(d&1)&&e.child!==o?(n=e.child,n.childLanes=0,n.pendingProps=y,e.deletions=null):(n=Bl(o,y),n.subtreeFlags=o.subtreeFlags&14680064),a!==null?c=Bl(a,c):(c=$c(c,d,r,null),c.flags|=2),c.return=e,n.return=e,n.sibling=c,e.child=n,n=c,c=e.child,d=t.child.memoizedState,d=d===null?kx(r):{baseLanes:d.baseLanes|r,cachePool:null,transitions:d.transitions},c.memoizedState=d,c.childLanes=t.childLanes&~r,e.memoizedState=Rx,n}return c=t.child,t=c.sibling,n=Bl(c,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=r),n.return=e,n.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=n,e.memoizedState=null,n}function g1(t,e){return e=_y({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function im(t,e,r,n){return n!==null&&t1(n),Xh(e,t.child,null,r),t=g1(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function tD(t,e,r,n,o,c,d){if(r)return e.flags&256?(e.flags&=-257,n=o0(Error(ct(422))),im(t,e,d,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(c=n.fallback,o=e.mode,n=_y({mode:"visible",children:n.children},o,0,null),c=$c(c,o,d,null),c.flags|=2,n.return=e,c.return=e,n.sibling=c,e.child=n,e.mode&1&&Xh(e,t.child,null,d),e.child.memoizedState=kx(d),e.memoizedState=Rx,c);if(!(e.mode&1))return im(t,e,d,null);if(o.data==="$!"){if(n=o.nextSibling&&o.nextSibling.dataset,n)var a=n.dgst;return n=a,c=Error(ct(419)),n=o0(c,n,void 0),im(t,e,d,n)}if(a=(d&t.childLanes)!==0,cs||a){if(n=di,n!==null){switch(d&-d){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(n.suspendedLanes|d)?0:o,o!==0&&o!==c.retryLane&&(c.retryLane=o,La(t,o),Ao(n,t,o,-1))}return b1(),n=o0(Error(ct(421))),im(t,e,d,n)}return o.data==="$?"?(e.flags|=128,e.child=t.child,e=pD.bind(null,t),o._reactRetry=e,null):(t=c.treeContext,Ds=Fl(o.nextSibling),Fs=e,fn=!0,wo=null,t!==null&&(Xs[Zs++]=Ra,Xs[Zs++]=ka,Xs[Zs++]=Gc,Ra=t.id,ka=t.overflow,Gc=e),e=g1(e,n.children),e.flags|=4096,e)}function VT(t,e,r){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),Ex(t.return,e,r)}function a0(t,e,r,n,o){var c=t.memoizedState;c===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:o}:(c.isBackwards=e,c.rendering=null,c.renderingStartTime=0,c.last=n,c.tail=r,c.tailMode=o)}function JA(t,e,r){var n=e.pendingProps,o=n.revealOrder,c=n.tail;if(Gi(t,e,n.children,r),n=xn.current,n&2)n=n&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&VT(t,r,e);else if(t.tag===19)VT(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(nn(xn,n),!(e.mode&1))e.memoizedState=null;else switch(o){case"forwards":for(r=e.child,o=null;r!==null;)t=r.alternate,t!==null&&u_(t)===null&&(o=r),r=r.sibling;r=o,r===null?(o=e.child,e.child=null):(o=r.sibling,r.sibling=null),a0(e,!1,o,r,c);break;case"backwards":for(r=null,o=e.child,e.child=null;o!==null;){if(t=o.alternate,t!==null&&u_(t)===null){e.child=o;break}t=o.sibling,o.sibling=r,r=o,o=t}a0(e,!0,r,null,c);break;case"together":a0(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Dm(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function za(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),Qc|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ct(153));if(e.child!==null){for(t=e.child,r=Bl(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=Bl(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function rD(t,e,r){switch(e.tag){case 3:KA(e),Hh();break;case 5:EA(e);break;case 1:hs(e.type)&&i_(e);break;case 4:a1(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,o=e.memoizedProps.value;nn(a_,n._currentValue),n._currentValue=o;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(nn(xn,xn.current&1),e.flags|=128,null):r&e.child.childLanes?QA(t,e,r):(nn(xn,xn.current&1),t=za(t,e,r),t!==null?t.sibling:null);nn(xn,xn.current&1);break;case 19:if(n=(r&e.childLanes)!==0,t.flags&128){if(n)return JA(t,e,r);e.flags|=128}if(o=e.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),nn(xn,xn.current),n)break;return null;case 22:case 23:return e.lanes=0,YA(t,e,r)}return za(t,e,r)}var eI,Dx,tI,rI;eI=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};Dx=function(){};tI=function(t,e,r,n){var o=t.memoizedProps;if(o!==n){t=e.stateNode,zc(Jo.current);var c=null;switch(r){case"input":o=tx(t,o),n=tx(t,n),c=[];break;case"select":o=wn({},o,{value:void 0}),n=wn({},n,{value:void 0}),c=[];break;case"textarea":o=ix(t,o),n=ix(t,n),c=[];break;default:typeof o.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=r_)}ox(r,n);var d;r=null;for(S in o)if(!n.hasOwnProperty(S)&&o.hasOwnProperty(S)&&o[S]!=null)if(S==="style"){var a=o[S];for(d in a)a.hasOwnProperty(d)&&(r||(r={}),r[d]="")}else S!=="dangerouslySetInnerHTML"&&S!=="children"&&S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&S!=="autoFocus"&&(ep.hasOwnProperty(S)?c||(c=[]):(c=c||[]).push(S,null));for(S in n){var y=n[S];if(a=o!=null?o[S]:void 0,n.hasOwnProperty(S)&&y!==a&&(y!=null||a!=null))if(S==="style")if(a){for(d in a)!a.hasOwnProperty(d)||y&&y.hasOwnProperty(d)||(r||(r={}),r[d]="");for(d in y)y.hasOwnProperty(d)&&a[d]!==y[d]&&(r||(r={}),r[d]=y[d])}else r||(c||(c=[]),c.push(S,r)),r=y;else S==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,a=a?a.__html:void 0,y!=null&&a!==y&&(c=c||[]).push(S,y)):S==="children"?typeof y!="string"&&typeof y!="number"||(c=c||[]).push(S,""+y):S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&(ep.hasOwnProperty(S)?(y!=null&&S==="onScroll"&&ln("scroll",t),c||a===y||(c=[])):(c=c||[]).push(S,y))}r&&(c=c||[]).push("style",r);var S=c;(e.updateQueue=S)&&(e.flags|=4)}};rI=function(t,e,r,n){r!==n&&(e.flags|=4)};function xf(t,e){if(!fn)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function Oi(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,n=0;if(e)for(var o=t.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags&14680064,n|=o.flags&14680064,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=n,t.childLanes=r,e}function nD(t,e,r){var n=e.pendingProps;switch(e1(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Oi(e),null;case 1:return hs(e.type)&&n_(),Oi(e),null;case 3:return n=e.stateNode,Zh(),cn(us),cn(Bi),c1(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(rm(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,wo!==null&&(Vx(wo),wo=null))),Dx(t,e),Oi(e),null;case 5:l1(e);var o=zc(dp.current);if(r=e.type,t!==null&&e.stateNode!=null)tI(t,e,r,n,o),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(ct(166));return Oi(e),null}if(t=zc(Jo.current),rm(e)){n=e.stateNode,r=e.type;var c=e.memoizedProps;switch(n[qo]=e,n[up]=c,t=(e.mode&1)!==0,r){case"dialog":ln("cancel",n),ln("close",n);break;case"iframe":case"object":case"embed":ln("load",n);break;case"video":case"audio":for(o=0;o<Cf.length;o++)ln(Cf[o],n);break;case"source":ln("error",n);break;case"img":case"image":case"link":ln("error",n),ln("load",n);break;case"details":ln("toggle",n);break;case"input":G2(n,c),ln("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!c.multiple},ln("invalid",n);break;case"textarea":Q2(n,c),ln("invalid",n)}ox(r,c),o=null;for(var d in c)if(c.hasOwnProperty(d)){var a=c[d];d==="children"?typeof a=="string"?n.textContent!==a&&(c.suppressHydrationWarning!==!0&&tm(n.textContent,a,t),o=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(c.suppressHydrationWarning!==!0&&tm(n.textContent,a,t),o=["children",""+a]):ep.hasOwnProperty(d)&&a!=null&&d==="onScroll"&&ln("scroll",n)}switch(r){case"input":Zg(n),K2(n,c,!0);break;case"textarea":Zg(n),J2(n);break;case"select":case"option":break;default:typeof c.onClick=="function"&&(n.onclick=r_)}n=o,e.updateQueue=n,n!==null&&(e.flags|=4)}else{d=o.nodeType===9?o:o.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=ME(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=d.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=d.createElement(r,{is:n.is}):(t=d.createElement(r),r==="select"&&(d=t,n.multiple?d.multiple=!0:n.size&&(d.size=n.size))):t=d.createElementNS(t,r),t[qo]=e,t[up]=n,eI(t,e,!1,!1),e.stateNode=t;e:{switch(d=ax(r,n),r){case"dialog":ln("cancel",t),ln("close",t),o=n;break;case"iframe":case"object":case"embed":ln("load",t),o=n;break;case"video":case"audio":for(o=0;o<Cf.length;o++)ln(Cf[o],t);o=n;break;case"source":ln("error",t),o=n;break;case"img":case"image":case"link":ln("error",t),ln("load",t),o=n;break;case"details":ln("toggle",t),o=n;break;case"input":G2(t,n),o=tx(t,n),ln("invalid",t);break;case"option":o=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},o=wn({},n,{value:void 0}),ln("invalid",t);break;case"textarea":Q2(t,n),o=ix(t,n),ln("invalid",t);break;default:o=n}ox(r,o),a=o;for(c in a)if(a.hasOwnProperty(c)){var y=a[c];c==="style"?DE(t,y):c==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,y!=null&&RE(t,y)):c==="children"?typeof y=="string"?(r!=="textarea"||y!=="")&&tp(t,y):typeof y=="number"&&tp(t,""+y):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(ep.hasOwnProperty(c)?y!=null&&c==="onScroll"&&ln("scroll",t):y!=null&&Bb(t,c,y,d))}switch(r){case"input":Zg(t),K2(t,n,!1);break;case"textarea":Zg(t),J2(t);break;case"option":n.value!=null&&t.setAttribute("value",""+jl(n.value));break;case"select":t.multiple=!!n.multiple,c=n.value,c!=null?Fh(t,!!n.multiple,c,!1):n.defaultValue!=null&&Fh(t,!!n.multiple,n.defaultValue,!0);break;default:typeof o.onClick=="function"&&(t.onclick=r_)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Oi(e),null;case 6:if(t&&e.stateNode!=null)rI(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(ct(166));if(r=zc(dp.current),zc(Jo.current),rm(e)){if(n=e.stateNode,r=e.memoizedProps,n[qo]=e,(c=n.nodeValue!==r)&&(t=Fs,t!==null))switch(t.tag){case 3:tm(n.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&tm(n.nodeValue,r,(t.mode&1)!==0)}c&&(e.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[qo]=e,e.stateNode=n}return Oi(e),null;case 13:if(cn(xn),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(fn&&Ds!==null&&e.mode&1&&!(e.flags&128))xA(),Hh(),e.flags|=98560,c=!1;else if(c=rm(e),n!==null&&n.dehydrated!==null){if(t===null){if(!c)throw Error(ct(318));if(c=e.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(ct(317));c[qo]=e}else Hh(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Oi(e),c=!1}else wo!==null&&(Vx(wo),wo=null),c=!0;if(!c)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(t===null||xn.current&1?ni===0&&(ni=3):b1())),e.updateQueue!==null&&(e.flags|=4),Oi(e),null);case 4:return Zh(),Dx(t,e),t===null&&lp(e.stateNode.containerInfo),Oi(e),null;case 10:return i1(e.type._context),Oi(e),null;case 17:return hs(e.type)&&n_(),Oi(e),null;case 19:if(cn(xn),c=e.memoizedState,c===null)return Oi(e),null;if(n=(e.flags&128)!==0,d=c.rendering,d===null)if(n)xf(c,!1);else{if(ni!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(d=u_(t),d!==null){for(e.flags|=128,xf(c,!1),n=d.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=r,r=e.child;r!==null;)c=r,t=n,c.flags&=14680066,d=c.alternate,d===null?(c.childLanes=0,c.lanes=t,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=d.childLanes,c.lanes=d.lanes,c.child=d.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=d.memoizedProps,c.memoizedState=d.memoizedState,c.updateQueue=d.updateQueue,c.type=d.type,t=d.dependencies,c.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return nn(xn,xn.current&1|2),e.child}t=t.sibling}c.tail!==null&&Nn()>Yh&&(e.flags|=128,n=!0,xf(c,!1),e.lanes=4194304)}else{if(!n)if(t=u_(d),t!==null){if(e.flags|=128,n=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),xf(c,!0),c.tail===null&&c.tailMode==="hidden"&&!d.alternate&&!fn)return Oi(e),null}else 2*Nn()-c.renderingStartTime>Yh&&r!==1073741824&&(e.flags|=128,n=!0,xf(c,!1),e.lanes=4194304);c.isBackwards?(d.sibling=e.child,e.child=d):(r=c.last,r!==null?r.sibling=d:e.child=d,c.last=d)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=Nn(),e.sibling=null,r=xn.current,nn(xn,n?r&1|2:r&1),e):(Oi(e),null);case 22:case 23:return x1(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Cs&1073741824&&(Oi(e),e.subtreeFlags&6&&(e.flags|=8192)):Oi(e),null;case 24:return null;case 25:return null}throw Error(ct(156,e.tag))}function iD(t,e){switch(e1(e),e.tag){case 1:return hs(e.type)&&n_(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Zh(),cn(us),cn(Bi),c1(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return l1(e),null;case 13:if(cn(xn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ct(340));Hh()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return cn(xn),null;case 4:return Zh(),null;case 10:return i1(e.type._context),null;case 22:case 23:return x1(),null;case 24:return null;default:return null}}var sm=!1,zi=!1,sD=typeof WeakSet=="function"?WeakSet:Set,It=null;function Ah(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Rn(t,e,n)}else r.current=null}function Ox(t,e,r){try{r()}catch(n){Rn(t,e,n)}}var jT=!1;function oD(t,e){if(_x=Jm,t=aA(),Qb(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var o=n.anchorOffset,c=n.focusNode;n=n.focusOffset;try{r.nodeType,c.nodeType}catch{r=null;break e}var d=0,a=-1,y=-1,S=0,E=0,M=t,F=null;t:for(;;){for(var N;M!==r||o!==0&&M.nodeType!==3||(a=d+o),M!==c||n!==0&&M.nodeType!==3||(y=d+n),M.nodeType===3&&(d+=M.nodeValue.length),(N=M.firstChild)!==null;)F=M,M=N;for(;;){if(M===t)break t;if(F===r&&++S===o&&(a=d),F===c&&++E===n&&(y=d),(N=M.nextSibling)!==null)break;M=F,F=M.parentNode}M=N}r=a===-1||y===-1?null:{start:a,end:y}}else r=null}r=r||{start:0,end:0}}else r=null;for(yx={focusedElem:t,selectionRange:r},Jm=!1,It=e;It!==null;)if(e=It,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,It=t;else for(;It!==null;){e=It;try{var G=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(G!==null){var re=G.memoizedProps,me=G.memoizedState,Y=e.stateNode,q=Y.getSnapshotBeforeUpdate(e.elementType===e.type?re:xo(e.type,re),me);Y.__reactInternalSnapshotBeforeUpdate=q}break;case 3:var Z=e.stateNode.containerInfo;Z.nodeType===1?Z.textContent="":Z.nodeType===9&&Z.documentElement&&Z.removeChild(Z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ct(163))}}catch(le){Rn(e,e.return,le)}if(t=e.sibling,t!==null){t.return=e.return,It=t;break}It=e.return}return G=jT,jT=!1,G}function jf(t,e,r){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var o=n=n.next;do{if((o.tag&t)===t){var c=o.destroy;o.destroy=void 0,c!==void 0&&Ox(e,r,c)}o=o.next}while(o!==n)}}function gy(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var n=r.create;r.destroy=n()}r=r.next}while(r!==e)}}function Fx(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function nI(t){var e=t.alternate;e!==null&&(t.alternate=null,nI(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[qo],delete e[up],delete e[bx],delete e[j4],delete e[$4])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function iI(t){return t.tag===5||t.tag===3||t.tag===4}function $T(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||iI(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Nx(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=r_));else if(n!==4&&(t=t.child,t!==null))for(Nx(t,e,r),t=t.sibling;t!==null;)Nx(t,e,r),t=t.sibling}function Lx(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(Lx(t,e,r),t=t.sibling;t!==null;)Lx(t,e,r),t=t.sibling}var Ti=null,bo=!1;function gl(t,e,r){for(r=r.child;r!==null;)sI(t,e,r),r=r.sibling}function sI(t,e,r){if(Qo&&typeof Qo.onCommitFiberUnmount=="function")try{Qo.onCommitFiberUnmount(ay,r)}catch{}switch(r.tag){case 5:zi||Ah(r,e);case 6:var n=Ti,o=bo;Ti=null,gl(t,e,r),Ti=n,bo=o,Ti!==null&&(bo?(t=Ti,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):Ti.removeChild(r.stateNode));break;case 18:Ti!==null&&(bo?(t=Ti,r=r.stateNode,t.nodeType===8?e0(t.parentNode,r):t.nodeType===1&&e0(t,r),sp(t)):e0(Ti,r.stateNode));break;case 4:n=Ti,o=bo,Ti=r.stateNode.containerInfo,bo=!0,gl(t,e,r),Ti=n,bo=o;break;case 0:case 11:case 14:case 15:if(!zi&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){o=n=n.next;do{var c=o,d=c.destroy;c=c.tag,d!==void 0&&(c&2||c&4)&&Ox(r,e,d),o=o.next}while(o!==n)}gl(t,e,r);break;case 1:if(!zi&&(Ah(r,e),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(a){Rn(r,e,a)}gl(t,e,r);break;case 21:gl(t,e,r);break;case 22:r.mode&1?(zi=(n=zi)||r.memoizedState!==null,gl(t,e,r),zi=n):gl(t,e,r);break;default:gl(t,e,r)}}function WT(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new sD),e.forEach(function(n){var o=gD.bind(null,t,n);r.has(n)||(r.add(n),n.then(o,o))})}}function mo(t,e){var r=e.deletions;if(r!==null)for(var n=0;n<r.length;n++){var o=r[n];try{var c=t,d=e,a=d;e:for(;a!==null;){switch(a.tag){case 5:Ti=a.stateNode,bo=!1;break e;case 3:Ti=a.stateNode.containerInfo,bo=!0;break e;case 4:Ti=a.stateNode.containerInfo,bo=!0;break e}a=a.return}if(Ti===null)throw Error(ct(160));sI(c,d,o),Ti=null,bo=!1;var y=o.alternate;y!==null&&(y.return=null),o.return=null}catch(S){Rn(o,e,S)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)oI(e,t),e=e.sibling}function oI(t,e){var r=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(mo(e,t),$o(t),n&4){try{jf(3,t,t.return),gy(3,t)}catch(re){Rn(t,t.return,re)}try{jf(5,t,t.return)}catch(re){Rn(t,t.return,re)}}break;case 1:mo(e,t),$o(t),n&512&&r!==null&&Ah(r,r.return);break;case 5:if(mo(e,t),$o(t),n&512&&r!==null&&Ah(r,r.return),t.flags&32){var o=t.stateNode;try{tp(o,"")}catch(re){Rn(t,t.return,re)}}if(n&4&&(o=t.stateNode,o!=null)){var c=t.memoizedProps,d=r!==null?r.memoizedProps:c,a=t.type,y=t.updateQueue;if(t.updateQueue=null,y!==null)try{a==="input"&&c.type==="radio"&&c.name!=null&&PE(o,c),ax(a,d);var S=ax(a,c);for(d=0;d<y.length;d+=2){var E=y[d],M=y[d+1];E==="style"?DE(o,M):E==="dangerouslySetInnerHTML"?RE(o,M):E==="children"?tp(o,M):Bb(o,E,M,S)}switch(a){case"input":rx(o,c);break;case"textarea":CE(o,c);break;case"select":var F=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!c.multiple;var N=c.value;N!=null?Fh(o,!!c.multiple,N,!1):F!==!!c.multiple&&(c.defaultValue!=null?Fh(o,!!c.multiple,c.defaultValue,!0):Fh(o,!!c.multiple,c.multiple?[]:"",!1))}o[up]=c}catch(re){Rn(t,t.return,re)}}break;case 6:if(mo(e,t),$o(t),n&4){if(t.stateNode===null)throw Error(ct(162));o=t.stateNode,c=t.memoizedProps;try{o.nodeValue=c}catch(re){Rn(t,t.return,re)}}break;case 3:if(mo(e,t),$o(t),n&4&&r!==null&&r.memoizedState.isDehydrated)try{sp(e.containerInfo)}catch(re){Rn(t,t.return,re)}break;case 4:mo(e,t),$o(t);break;case 13:mo(e,t),$o(t),o=t.child,o.flags&8192&&(c=o.memoizedState!==null,o.stateNode.isHidden=c,!c||o.alternate!==null&&o.alternate.memoizedState!==null||(y1=Nn())),n&4&&WT(t);break;case 22:if(E=r!==null&&r.memoizedState!==null,t.mode&1?(zi=(S=zi)||E,mo(e,t),zi=S):mo(e,t),$o(t),n&8192){if(S=t.memoizedState!==null,(t.stateNode.isHidden=S)&&!E&&t.mode&1)for(It=t,E=t.child;E!==null;){for(M=It=E;It!==null;){switch(F=It,N=F.child,F.tag){case 0:case 11:case 14:case 15:jf(4,F,F.return);break;case 1:Ah(F,F.return);var G=F.stateNode;if(typeof G.componentWillUnmount=="function"){n=F,r=F.return;try{e=n,G.props=e.memoizedProps,G.state=e.memoizedState,G.componentWillUnmount()}catch(re){Rn(n,r,re)}}break;case 5:Ah(F,F.return);break;case 22:if(F.memoizedState!==null){XT(M);continue}}N!==null?(N.return=F,It=N):XT(M)}E=E.sibling}e:for(E=null,M=t;;){if(M.tag===5){if(E===null){E=M;try{o=M.stateNode,S?(c=o.style,typeof c.setProperty=="function"?c.setProperty("display","none","important"):c.display="none"):(a=M.stateNode,y=M.memoizedProps.style,d=y!=null&&y.hasOwnProperty("display")?y.display:null,a.style.display=kE("display",d))}catch(re){Rn(t,t.return,re)}}}else if(M.tag===6){if(E===null)try{M.stateNode.nodeValue=S?"":M.memoizedProps}catch(re){Rn(t,t.return,re)}}else if((M.tag!==22&&M.tag!==23||M.memoizedState===null||M===t)&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===t)break e;for(;M.sibling===null;){if(M.return===null||M.return===t)break e;E===M&&(E=null),M=M.return}E===M&&(E=null),M.sibling.return=M.return,M=M.sibling}}break;case 19:mo(e,t),$o(t),n&4&&WT(t);break;case 21:break;default:mo(e,t),$o(t)}}function $o(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(iI(r)){var n=r;break e}r=r.return}throw Error(ct(160))}switch(n.tag){case 5:var o=n.stateNode;n.flags&32&&(tp(o,""),n.flags&=-33);var c=$T(t);Lx(t,c,o);break;case 3:case 4:var d=n.stateNode.containerInfo,a=$T(t);Nx(t,a,d);break;default:throw Error(ct(161))}}catch(y){Rn(t,t.return,y)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function aD(t,e,r){It=t,aI(t)}function aI(t,e,r){for(var n=(t.mode&1)!==0;It!==null;){var o=It,c=o.child;if(o.tag===22&&n){var d=o.memoizedState!==null||sm;if(!d){var a=o.alternate,y=a!==null&&a.memoizedState!==null||zi;a=sm;var S=zi;if(sm=d,(zi=y)&&!S)for(It=o;It!==null;)d=It,y=d.child,d.tag===22&&d.memoizedState!==null?ZT(o):y!==null?(y.return=d,It=y):ZT(o);for(;c!==null;)It=c,aI(c),c=c.sibling;It=o,sm=a,zi=S}HT(t)}else o.subtreeFlags&8772&&c!==null?(c.return=o,It=c):HT(t)}}function HT(t){for(;It!==null;){var e=It;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:zi||gy(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!zi)if(r===null)n.componentDidMount();else{var o=e.elementType===e.type?r.memoizedProps:xo(e.type,r.memoizedProps);n.componentDidUpdate(o,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var c=e.updateQueue;c!==null&&CT(e,c,n);break;case 3:var d=e.updateQueue;if(d!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}CT(e,d,r)}break;case 5:var a=e.stateNode;if(r===null&&e.flags&4){r=a;var y=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":y.autoFocus&&r.focus();break;case"img":y.src&&(r.src=y.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var S=e.alternate;if(S!==null){var E=S.memoizedState;if(E!==null){var M=E.dehydrated;M!==null&&sp(M)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ct(163))}zi||e.flags&512&&Fx(e)}catch(F){Rn(e,e.return,F)}}if(e===t){It=null;break}if(r=e.sibling,r!==null){r.return=e.return,It=r;break}It=e.return}}function XT(t){for(;It!==null;){var e=It;if(e===t){It=null;break}var r=e.sibling;if(r!==null){r.return=e.return,It=r;break}It=e.return}}function ZT(t){for(;It!==null;){var e=It;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{gy(4,e)}catch(y){Rn(e,r,y)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var o=e.return;try{n.componentDidMount()}catch(y){Rn(e,o,y)}}var c=e.return;try{Fx(e)}catch(y){Rn(e,c,y)}break;case 5:var d=e.return;try{Fx(e)}catch(y){Rn(e,d,y)}}}catch(y){Rn(e,e.return,y)}if(e===t){It=null;break}var a=e.sibling;if(a!==null){a.return=e.return,It=a;break}It=e.return}}var lD=Math.ceil,f_=Ua.ReactCurrentDispatcher,m1=Ua.ReactCurrentOwner,Ys=Ua.ReactCurrentBatchConfig,Cr=0,di=null,Zn=null,Si=0,Cs=0,Ih=Xl(0),ni=0,mp=null,Qc=0,my=0,_1=0,$f=null,ls=null,y1=0,Yh=1/0,Aa=null,p_=!1,zx=null,Ll=null,om=!1,Pl=null,g_=0,Wf=0,Bx=null,Om=-1,Fm=0;function Qi(){return Cr&6?Nn():Om!==-1?Om:Om=Nn()}function zl(t){return t.mode&1?Cr&2&&Si!==0?Si&-Si:H4.transition!==null?(Fm===0&&(Fm=HE()),Fm):(t=Hr,t!==0||(t=window.event,t=t===void 0?16:QE(t.type)),t):1}function Ao(t,e,r,n){if(50<Wf)throw Wf=0,Bx=null,Error(ct(185));Mp(t,r,n),(!(Cr&2)||t!==di)&&(t===di&&(!(Cr&2)&&(my|=r),ni===4&&Al(t,Si)),ds(t,n),r===1&&Cr===0&&!(e.mode&1)&&(Yh=Nn()+500,dy&&Zl()))}function ds(t,e){var r=t.callbackNode;Hk(t,e);var n=Qm(t,t===di?Si:0);if(n===0)r!==null&&rT(r),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(r!=null&&rT(r),e===1)t.tag===0?W4(qT.bind(null,t)):_A(qT.bind(null,t)),U4(function(){!(Cr&6)&&Zl()}),r=null;else{switch(XE(n)){case 1:r=Wb;break;case 4:r=$E;break;case 16:r=Km;break;case 536870912:r=WE;break;default:r=Km}r=gI(r,lI.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function lI(t,e){if(Om=-1,Fm=0,Cr&6)throw Error(ct(327));var r=t.callbackNode;if(Uh()&&t.callbackNode!==r)return null;var n=Qm(t,t===di?Si:0);if(n===0)return null;if(n&30||n&t.expiredLanes||e)e=m_(t,n);else{e=n;var o=Cr;Cr|=2;var c=uI();(di!==t||Si!==e)&&(Aa=null,Yh=Nn()+500,jc(t,e));do try{hD();break}catch(a){cI(t,a)}while(!0);n1(),f_.current=c,Cr=o,Zn!==null?e=0:(di=null,Si=0,e=ni)}if(e!==0){if(e===2&&(o=dx(t),o!==0&&(n=o,e=Ux(t,o))),e===1)throw r=mp,jc(t,0),Al(t,n),ds(t,Nn()),r;if(e===6)Al(t,n);else{if(o=t.current.alternate,!(n&30)&&!cD(o)&&(e=m_(t,n),e===2&&(c=dx(t),c!==0&&(n=c,e=Ux(t,c))),e===1))throw r=mp,jc(t,0),Al(t,n),ds(t,Nn()),r;switch(t.finishedWork=o,t.finishedLanes=n,e){case 0:case 1:throw Error(ct(345));case 2:Oc(t,ls,Aa);break;case 3:if(Al(t,n),(n&130023424)===n&&(e=y1+500-Nn(),10<e)){if(Qm(t,0)!==0)break;if(o=t.suspendedLanes,(o&n)!==n){Qi(),t.pingedLanes|=t.suspendedLanes&o;break}t.timeoutHandle=xx(Oc.bind(null,t,ls,Aa),e);break}Oc(t,ls,Aa);break;case 4:if(Al(t,n),(n&4194240)===n)break;for(e=t.eventTimes,o=-1;0<n;){var d=31-Eo(n);c=1<<d,d=e[d],d>o&&(o=d),n&=~c}if(n=o,n=Nn()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*lD(n/1960))-n,10<n){t.timeoutHandle=xx(Oc.bind(null,t,ls,Aa),n);break}Oc(t,ls,Aa);break;case 5:Oc(t,ls,Aa);break;default:throw Error(ct(329))}}}return ds(t,Nn()),t.callbackNode===r?lI.bind(null,t):null}function Ux(t,e){var r=$f;return t.current.memoizedState.isDehydrated&&(jc(t,e).flags|=256),t=m_(t,e),t!==2&&(e=ls,ls=r,e!==null&&Vx(e)),t}function Vx(t){ls===null?ls=t:ls.push.apply(ls,t)}function cD(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var o=r[n],c=o.getSnapshot;o=o.value;try{if(!Io(c(),o))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Al(t,e){for(e&=~_1,e&=~my,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-Eo(e),n=1<<r;t[r]=-1,e&=~n}}function qT(t){if(Cr&6)throw Error(ct(327));Uh();var e=Qm(t,0);if(!(e&1))return ds(t,Nn()),null;var r=m_(t,e);if(t.tag!==0&&r===2){var n=dx(t);n!==0&&(e=n,r=Ux(t,n))}if(r===1)throw r=mp,jc(t,0),Al(t,e),ds(t,Nn()),r;if(r===6)throw Error(ct(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Oc(t,ls,Aa),ds(t,Nn()),null}function v1(t,e){var r=Cr;Cr|=1;try{return t(e)}finally{Cr=r,Cr===0&&(Yh=Nn()+500,dy&&Zl())}}function Jc(t){Pl!==null&&Pl.tag===0&&!(Cr&6)&&Uh();var e=Cr;Cr|=1;var r=Ys.transition,n=Hr;try{if(Ys.transition=null,Hr=1,t)return t()}finally{Hr=n,Ys.transition=r,Cr=e,!(Cr&6)&&Zl()}}function x1(){Cs=Ih.current,cn(Ih)}function jc(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,B4(r)),Zn!==null)for(r=Zn.return;r!==null;){var n=r;switch(e1(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&n_();break;case 3:Zh(),cn(us),cn(Bi),c1();break;case 5:l1(n);break;case 4:Zh();break;case 13:cn(xn);break;case 19:cn(xn);break;case 10:i1(n.type._context);break;case 22:case 23:x1()}r=r.return}if(di=t,Zn=t=Bl(t.current,null),Si=Cs=e,ni=0,mp=null,_1=my=Qc=0,ls=$f=null,Lc!==null){for(e=0;e<Lc.length;e++)if(r=Lc[e],n=r.interleaved,n!==null){r.interleaved=null;var o=n.next,c=r.pending;if(c!==null){var d=c.next;c.next=o,n.next=d}r.pending=n}Lc=null}return t}function cI(t,e){do{var r=Zn;try{if(n1(),Rm.current=d_,h_){for(var n=bn.memoizedState;n!==null;){var o=n.queue;o!==null&&(o.pending=null),n=n.next}h_=!1}if(Kc=0,hi=ti=bn=null,Vf=!1,fp=0,m1.current=null,r===null||r.return===null){ni=1,mp=e,Zn=null;break}e:{var c=t,d=r.return,a=r,y=e;if(e=Si,a.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){var S=y,E=a,M=E.tag;if(!(E.mode&1)&&(M===0||M===11||M===15)){var F=E.alternate;F?(E.updateQueue=F.updateQueue,E.memoizedState=F.memoizedState,E.lanes=F.lanes):(E.updateQueue=null,E.memoizedState=null)}var N=FT(d);if(N!==null){N.flags&=-257,NT(N,d,a,c,e),N.mode&1&&OT(c,S,e),e=N,y=S;var G=e.updateQueue;if(G===null){var re=new Set;re.add(y),e.updateQueue=re}else G.add(y);break e}else{if(!(e&1)){OT(c,S,e),b1();break e}y=Error(ct(426))}}else if(fn&&a.mode&1){var me=FT(d);if(me!==null){!(me.flags&65536)&&(me.flags|=256),NT(me,d,a,c,e),t1(qh(y,a));break e}}c=y=qh(y,a),ni!==4&&(ni=2),$f===null?$f=[c]:$f.push(c),c=d;do{switch(c.tag){case 3:c.flags|=65536,e&=-e,c.lanes|=e;var Y=XA(c,y,e);PT(c,Y);break e;case 1:a=y;var q=c.type,Z=c.stateNode;if(!(c.flags&128)&&(typeof q.getDerivedStateFromError=="function"||Z!==null&&typeof Z.componentDidCatch=="function"&&(Ll===null||!Ll.has(Z)))){c.flags|=65536,e&=-e,c.lanes|=e;var le=ZA(c,a,e);PT(c,le);break e}}c=c.return}while(c!==null)}dI(r)}catch(Ae){e=Ae,Zn===r&&r!==null&&(Zn=r=r.return);continue}break}while(!0)}function uI(){var t=f_.current;return f_.current=d_,t===null?d_:t}function b1(){(ni===0||ni===3||ni===2)&&(ni=4),di===null||!(Qc&268435455)&&!(my&268435455)||Al(di,Si)}function m_(t,e){var r=Cr;Cr|=2;var n=uI();(di!==t||Si!==e)&&(Aa=null,jc(t,e));do try{uD();break}catch(o){cI(t,o)}while(!0);if(n1(),Cr=r,f_.current=n,Zn!==null)throw Error(ct(261));return di=null,Si=0,ni}function uD(){for(;Zn!==null;)hI(Zn)}function hD(){for(;Zn!==null&&!Nk();)hI(Zn)}function hI(t){var e=pI(t.alternate,t,Cs);t.memoizedProps=t.pendingProps,e===null?dI(t):Zn=e,m1.current=null}function dI(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=iD(r,e),r!==null){r.flags&=32767,Zn=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ni=6,Zn=null;return}}else if(r=nD(r,e,Cs),r!==null){Zn=r;return}if(e=e.sibling,e!==null){Zn=e;return}Zn=e=t}while(e!==null);ni===0&&(ni=5)}function Oc(t,e,r){var n=Hr,o=Ys.transition;try{Ys.transition=null,Hr=1,dD(t,e,r,n)}finally{Ys.transition=o,Hr=n}return null}function dD(t,e,r,n){do Uh();while(Pl!==null);if(Cr&6)throw Error(ct(327));r=t.finishedWork;var o=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(ct(177));t.callbackNode=null,t.callbackPriority=0;var c=r.lanes|r.childLanes;if(Xk(t,c),t===di&&(Zn=di=null,Si=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||om||(om=!0,gI(Km,function(){return Uh(),null})),c=(r.flags&15990)!==0,r.subtreeFlags&15990||c){c=Ys.transition,Ys.transition=null;var d=Hr;Hr=1;var a=Cr;Cr|=4,m1.current=null,oD(t,r),oI(r,t),k4(yx),Jm=!!_x,yx=_x=null,t.current=r,aD(r),Lk(),Cr=a,Hr=d,Ys.transition=c}else t.current=r;if(om&&(om=!1,Pl=t,g_=o),c=t.pendingLanes,c===0&&(Ll=null),Uk(r.stateNode),ds(t,Nn()),e!==null)for(n=t.onRecoverableError,r=0;r<e.length;r++)o=e[r],n(o.value,{componentStack:o.stack,digest:o.digest});if(p_)throw p_=!1,t=zx,zx=null,t;return g_&1&&t.tag!==0&&Uh(),c=t.pendingLanes,c&1?t===Bx?Wf++:(Wf=0,Bx=t):Wf=0,Zl(),null}function Uh(){if(Pl!==null){var t=XE(g_),e=Ys.transition,r=Hr;try{if(Ys.transition=null,Hr=16>t?16:t,Pl===null)var n=!1;else{if(t=Pl,Pl=null,g_=0,Cr&6)throw Error(ct(331));var o=Cr;for(Cr|=4,It=t.current;It!==null;){var c=It,d=c.child;if(It.flags&16){var a=c.deletions;if(a!==null){for(var y=0;y<a.length;y++){var S=a[y];for(It=S;It!==null;){var E=It;switch(E.tag){case 0:case 11:case 15:jf(8,E,c)}var M=E.child;if(M!==null)M.return=E,It=M;else for(;It!==null;){E=It;var F=E.sibling,N=E.return;if(nI(E),E===S){It=null;break}if(F!==null){F.return=N,It=F;break}It=N}}}var G=c.alternate;if(G!==null){var re=G.child;if(re!==null){G.child=null;do{var me=re.sibling;re.sibling=null,re=me}while(re!==null)}}It=c}}if(c.subtreeFlags&2064&&d!==null)d.return=c,It=d;else e:for(;It!==null;){if(c=It,c.flags&2048)switch(c.tag){case 0:case 11:case 15:jf(9,c,c.return)}var Y=c.sibling;if(Y!==null){Y.return=c.return,It=Y;break e}It=c.return}}var q=t.current;for(It=q;It!==null;){d=It;var Z=d.child;if(d.subtreeFlags&2064&&Z!==null)Z.return=d,It=Z;else e:for(d=q;It!==null;){if(a=It,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:gy(9,a)}}catch(Ae){Rn(a,a.return,Ae)}if(a===d){It=null;break e}var le=a.sibling;if(le!==null){le.return=a.return,It=le;break e}It=a.return}}if(Cr=o,Zl(),Qo&&typeof Qo.onPostCommitFiberRoot=="function")try{Qo.onPostCommitFiberRoot(ay,t)}catch{}n=!0}return n}finally{Hr=r,Ys.transition=e}}return!1}function YT(t,e,r){e=qh(r,e),e=XA(t,e,1),t=Nl(t,e,1),e=Qi(),t!==null&&(Mp(t,1,e),ds(t,e))}function Rn(t,e,r){if(t.tag===3)YT(t,t,r);else for(;e!==null;){if(e.tag===3){YT(e,t,r);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Ll===null||!Ll.has(n))){t=qh(r,t),t=ZA(e,t,1),e=Nl(e,t,1),t=Qi(),e!==null&&(Mp(e,1,t),ds(e,t));break}}e=e.return}}function fD(t,e,r){var n=t.pingCache;n!==null&&n.delete(e),e=Qi(),t.pingedLanes|=t.suspendedLanes&r,di===t&&(Si&r)===r&&(ni===4||ni===3&&(Si&130023424)===Si&&500>Nn()-y1?jc(t,0):_1|=r),ds(t,e)}function fI(t,e){e===0&&(t.mode&1?(e=Gg,Gg<<=1,!(Gg&130023424)&&(Gg=4194304)):e=1);var r=Qi();t=La(t,e),t!==null&&(Mp(t,e,r),ds(t,r))}function pD(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),fI(t,r)}function gD(t,e){var r=0;switch(t.tag){case 13:var n=t.stateNode,o=t.memoizedState;o!==null&&(r=o.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(ct(314))}n!==null&&n.delete(e),fI(t,r)}var pI;pI=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||us.current)cs=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return cs=!1,rD(t,e,r);cs=!!(t.flags&131072)}else cs=!1,fn&&e.flags&1048576&&yA(e,o_,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Dm(t,e),t=e.pendingProps;var o=Wh(e,Bi.current);Bh(e,r),o=h1(null,e,n,t,o,r);var c=d1();return e.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,hs(n)?(c=!0,i_(e)):c=!1,e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o1(e),o.updater=py,e.stateNode=o,o._reactInternals=e,Ix(e,n,t,r),e=Mx(null,e,n,!0,c,r)):(e.tag=0,fn&&c&&Jb(e),Gi(null,e,o,r),e=e.child),e;case 16:n=e.elementType;e:{switch(Dm(t,e),t=e.pendingProps,o=n._init,n=o(n._payload),e.type=n,o=e.tag=_D(n),t=xo(n,t),o){case 0:e=Cx(null,e,n,t,r);break e;case 1:e=BT(null,e,n,t,r);break e;case 11:e=LT(null,e,n,t,r);break e;case 14:e=zT(null,e,n,xo(n.type,t),r);break e}throw Error(ct(306,n,""))}return e;case 0:return n=e.type,o=e.pendingProps,o=e.elementType===n?o:xo(n,o),Cx(t,e,n,o,r);case 1:return n=e.type,o=e.pendingProps,o=e.elementType===n?o:xo(n,o),BT(t,e,n,o,r);case 3:e:{if(KA(e),t===null)throw Error(ct(387));n=e.pendingProps,c=e.memoizedState,o=c.element,SA(t,e),c_(e,n,null,r);var d=e.memoizedState;if(n=d.element,c.isDehydrated)if(c={element:n,isDehydrated:!1,cache:d.cache,pendingSuspenseBoundaries:d.pendingSuspenseBoundaries,transitions:d.transitions},e.updateQueue.baseState=c,e.memoizedState=c,e.flags&256){o=qh(Error(ct(423)),e),e=UT(t,e,n,r,o);break e}else if(n!==o){o=qh(Error(ct(424)),e),e=UT(t,e,n,r,o);break e}else for(Ds=Fl(e.stateNode.containerInfo.firstChild),Fs=e,fn=!0,wo=null,r=wA(e,null,n,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Hh(),n===o){e=za(t,e,r);break e}Gi(t,e,n,r)}e=e.child}return e;case 5:return EA(e),t===null&&Sx(e),n=e.type,o=e.pendingProps,c=t!==null?t.memoizedProps:null,d=o.children,vx(n,o)?d=null:c!==null&&vx(n,c)&&(e.flags|=32),GA(t,e),Gi(t,e,d,r),e.child;case 6:return t===null&&Sx(e),null;case 13:return QA(t,e,r);case 4:return a1(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=Xh(e,null,n,r):Gi(t,e,n,r),e.child;case 11:return n=e.type,o=e.pendingProps,o=e.elementType===n?o:xo(n,o),LT(t,e,n,o,r);case 7:return Gi(t,e,e.pendingProps,r),e.child;case 8:return Gi(t,e,e.pendingProps.children,r),e.child;case 12:return Gi(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(n=e.type._context,o=e.pendingProps,c=e.memoizedProps,d=o.value,nn(a_,n._currentValue),n._currentValue=d,c!==null)if(Io(c.value,d)){if(c.children===o.children&&!us.current){e=za(t,e,r);break e}}else for(c=e.child,c!==null&&(c.return=e);c!==null;){var a=c.dependencies;if(a!==null){d=c.child;for(var y=a.firstContext;y!==null;){if(y.context===n){if(c.tag===1){y=Oa(-1,r&-r),y.tag=2;var S=c.updateQueue;if(S!==null){S=S.shared;var E=S.pending;E===null?y.next=y:(y.next=E.next,E.next=y),S.pending=y}}c.lanes|=r,y=c.alternate,y!==null&&(y.lanes|=r),Ex(c.return,r,e),a.lanes|=r;break}y=y.next}}else if(c.tag===10)d=c.type===e.type?null:c.child;else if(c.tag===18){if(d=c.return,d===null)throw Error(ct(341));d.lanes|=r,a=d.alternate,a!==null&&(a.lanes|=r),Ex(d,r,e),d=c.sibling}else d=c.child;if(d!==null)d.return=c;else for(d=c;d!==null;){if(d===e){d=null;break}if(c=d.sibling,c!==null){c.return=d.return,d=c;break}d=d.return}c=d}Gi(t,e,o.children,r),e=e.child}return e;case 9:return o=e.type,n=e.pendingProps.children,Bh(e,r),o=Js(o),n=n(o),e.flags|=1,Gi(t,e,n,r),e.child;case 14:return n=e.type,o=xo(n,e.pendingProps),o=xo(n.type,o),zT(t,e,n,o,r);case 15:return qA(t,e,e.type,e.pendingProps,r);case 17:return n=e.type,o=e.pendingProps,o=e.elementType===n?o:xo(n,o),Dm(t,e),e.tag=1,hs(n)?(t=!0,i_(e)):t=!1,Bh(e,r),HA(e,n,o),Ix(e,n,o,r),Mx(null,e,n,!0,t,r);case 19:return JA(t,e,r);case 22:return YA(t,e,r)}throw Error(ct(156,e.tag))};function gI(t,e){return jE(t,e)}function mD(t,e,r,n){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qs(t,e,r,n){return new mD(t,e,r,n)}function w1(t){return t=t.prototype,!(!t||!t.isReactComponent)}function _D(t){if(typeof t=="function")return w1(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Vb)return 11;if(t===jb)return 14}return 2}function Bl(t,e){var r=t.alternate;return r===null?(r=qs(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function Nm(t,e,r,n,o,c){var d=2;if(n=t,typeof t=="function")w1(t)&&(d=1);else if(typeof t=="string")d=5;else e:switch(t){case _h:return $c(r.children,o,c,e);case Ub:d=8,o|=8;break;case K0:return t=qs(12,r,e,o|2),t.elementType=K0,t.lanes=c,t;case Q0:return t=qs(13,r,e,o),t.elementType=Q0,t.lanes=c,t;case J0:return t=qs(19,r,e,o),t.elementType=J0,t.lanes=c,t;case EE:return _y(r,o,c,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case TE:d=10;break e;case SE:d=9;break e;case Vb:d=11;break e;case jb:d=14;break e;case xl:d=16,n=null;break e}throw Error(ct(130,t==null?t:typeof t,""))}return e=qs(d,r,e,o),e.elementType=t,e.type=n,e.lanes=c,e}function $c(t,e,r,n){return t=qs(7,t,n,e),t.lanes=r,t}function _y(t,e,r,n){return t=qs(22,t,n,e),t.elementType=EE,t.lanes=r,t.stateNode={isHidden:!1},t}function l0(t,e,r){return t=qs(6,t,null,e),t.lanes=r,t}function c0(t,e,r){return e=qs(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function yD(t,e,r,n,o){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=$v(0),this.expirationTimes=$v(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$v(0),this.identifierPrefix=n,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function T1(t,e,r,n,o,c,d,a,y){return t=new yD(t,e,r,a,y),e===1?(e=1,c===!0&&(e|=8)):e=0,c=qs(3,null,null,e),t.current=c,c.stateNode=t,c.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},o1(c),t}function vD(t,e,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:mh,key:n==null?null:""+n,children:t,containerInfo:e,implementation:r}}function mI(t){if(!t)return $l;t=t._reactInternals;e:{if(su(t)!==t||t.tag!==1)throw Error(ct(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(hs(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ct(171))}if(t.tag===1){var r=t.type;if(hs(r))return mA(t,r,e)}return e}function _I(t,e,r,n,o,c,d,a,y){return t=T1(r,n,!0,t,o,c,d,a,y),t.context=mI(null),r=t.current,n=Qi(),o=zl(r),c=Oa(n,o),c.callback=e??null,Nl(r,c,o),t.current.lanes=o,Mp(t,o,n),ds(t,n),t}function yy(t,e,r,n){var o=e.current,c=Qi(),d=zl(o);return r=mI(r),e.context===null?e.context=r:e.pendingContext=r,e=Oa(c,d),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=Nl(o,e,d),t!==null&&(Ao(t,o,d,c),Mm(t,o,d)),d}function __(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function GT(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function S1(t,e){GT(t,e),(t=t.alternate)&&GT(t,e)}function xD(){return null}var yI=typeof reportError=="function"?reportError:function(t){console.error(t)};function E1(t){this._internalRoot=t}vy.prototype.render=E1.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ct(409));yy(t,e,null,null)};vy.prototype.unmount=E1.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Jc(function(){yy(null,t,null,null)}),e[Na]=null}};function vy(t){this._internalRoot=t}vy.prototype.unstable_scheduleHydration=function(t){if(t){var e=YE();t={blockedOn:null,target:t,priority:e};for(var r=0;r<El.length&&e!==0&&e<El[r].priority;r++);El.splice(r,0,t),r===0&&KE(t)}};function A1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function xy(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function KT(){}function bD(t,e,r,n,o){if(o){if(typeof n=="function"){var c=n;n=function(){var S=__(d);c.call(S)}}var d=_I(e,n,t,0,null,!1,!1,"",KT);return t._reactRootContainer=d,t[Na]=d.current,lp(t.nodeType===8?t.parentNode:t),Jc(),d}for(;o=t.lastChild;)t.removeChild(o);if(typeof n=="function"){var a=n;n=function(){var S=__(y);a.call(S)}}var y=T1(t,0,!1,null,null,!1,!1,"",KT);return t._reactRootContainer=y,t[Na]=y.current,lp(t.nodeType===8?t.parentNode:t),Jc(function(){yy(e,y,r,n)}),y}function by(t,e,r,n,o){var c=r._reactRootContainer;if(c){var d=c;if(typeof o=="function"){var a=o;o=function(){var y=__(d);a.call(y)}}yy(e,d,t,o)}else d=bD(r,e,t,o,n);return __(d)}ZE=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=Pf(e.pendingLanes);r!==0&&(Hb(e,r|1),ds(e,Nn()),!(Cr&6)&&(Yh=Nn()+500,Zl()))}break;case 13:Jc(function(){var n=La(t,1);if(n!==null){var o=Qi();Ao(n,t,1,o)}}),S1(t,1)}};Xb=function(t){if(t.tag===13){var e=La(t,134217728);if(e!==null){var r=Qi();Ao(e,t,134217728,r)}S1(t,134217728)}};qE=function(t){if(t.tag===13){var e=zl(t),r=La(t,e);if(r!==null){var n=Qi();Ao(r,t,e,n)}S1(t,e)}};YE=function(){return Hr};GE=function(t,e){var r=Hr;try{return Hr=t,e()}finally{Hr=r}};cx=function(t,e,r){switch(e){case"input":if(rx(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var n=r[e];if(n!==t&&n.form===t.form){var o=hy(n);if(!o)throw Error(ct(90));IE(n),rx(n,o)}}}break;case"textarea":CE(t,r);break;case"select":e=r.value,e!=null&&Fh(t,!!r.multiple,e,!1)}};NE=v1;LE=Jc;var wD={usingClientEntryPoint:!1,Events:[kp,bh,hy,OE,FE,v1]},bf={findFiberByHostInstance:Nc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},TD={bundleType:bf.bundleType,version:bf.version,rendererPackageName:bf.rendererPackageName,rendererConfig:bf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=UE(t),t===null?null:t.stateNode},findFiberByHostInstance:bf.findFiberByHostInstance||xD,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var am=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!am.isDisabled&&am.supportsFiber)try{ay=am.inject(TD),Qo=am}catch{}}Ls.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=wD;Ls.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!A1(e))throw Error(ct(200));return vD(t,e,null,r)};Ls.createRoot=function(t,e){if(!A1(t))throw Error(ct(299));var r=!1,n="",o=yI;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(o=e.onRecoverableError)),e=T1(t,1,!1,null,null,r,!1,n,o),t[Na]=e.current,lp(t.nodeType===8?t.parentNode:t),new E1(e)};Ls.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ct(188)):(t=Object.keys(t).join(","),Error(ct(268,t)));return t=UE(e),t=t===null?null:t.stateNode,t};Ls.flushSync=function(t){return Jc(t)};Ls.hydrate=function(t,e,r){if(!xy(e))throw Error(ct(200));return by(null,t,e,!0,r)};Ls.hydrateRoot=function(t,e,r){if(!A1(t))throw Error(ct(405));var n=r!=null&&r.hydratedSources||null,o=!1,c="",d=yI;if(r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onRecoverableError!==void 0&&(d=r.onRecoverableError)),e=_I(e,null,t,1,r??null,o,!1,c,d),t[Na]=e.current,lp(t),n)for(t=0;t<n.length;t++)r=n[t],o=r._getVersion,o=o(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,o]:e.mutableSourceEagerHydrationData.push(r,o);return new vy(e)};Ls.render=function(t,e,r){if(!xy(e))throw Error(ct(200));return by(null,t,e,!1,r)};Ls.unmountComponentAtNode=function(t){if(!xy(t))throw Error(ct(40));return t._reactRootContainer?(Jc(function(){by(null,null,t,!1,function(){t._reactRootContainer=null,t[Na]=null})}),!0):!1};Ls.unstable_batchedUpdates=v1;Ls.unstable_renderSubtreeIntoContainer=function(t,e,r,n){if(!xy(r))throw Error(ct(200));if(t==null||t._reactInternals===void 0)throw Error(ct(38));return by(t,e,r,!1,n)};Ls.version="18.3.1-next-f1338f8080-20240426";function vI(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(vI)}catch(t){console.error(t)}}vI(),vE.exports=Ls;var SD=vE.exports,xI,QT=SD;xI=QT.createRoot,QT.hydrateRoot;var bI={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.7.1/LICENSE.txt
 */(function(t,e){(function(r,n){t.exports=n()})(KR,function(){var r={},n={};function o(d,a,y){if(n[d]=y,d==="index"){var S="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",E={};return n.shared(E),n.index(r,E),typeof window<"u"&&r.setWorkerUrl(window.URL.createObjectURL(new Blob([S],{type:"text/javascript"}))),r}}o("shared",["exports"],function(d){function a(u,s,l,f){return new(l||(l=Promise))(function(g,x){function b(C){try{A(f.next(C))}catch(R){x(R)}}function T(C){try{A(f.throw(C))}catch(R){x(R)}}function A(C){var R;C.done?g(C.value):(R=C.value,R instanceof l?R:new l(function(O){O(R)})).then(b,T)}A((f=f.apply(u,s||[])).next())})}function y(u,s){this.x=u,this.y=s}function S(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var E,M;typeof SuppressedError=="function"&&SuppressedError,y.prototype={clone(){return new y(this.x,this.y)},add(u){return this.clone()._add(u)},sub(u){return this.clone()._sub(u)},multByPoint(u){return this.clone()._multByPoint(u)},divByPoint(u){return this.clone()._divByPoint(u)},mult(u){return this.clone()._mult(u)},div(u){return this.clone()._div(u)},rotate(u){return this.clone()._rotate(u)},rotateAround(u,s){return this.clone()._rotateAround(u,s)},matMult(u){return this.clone()._matMult(u)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(u){return this.x===u.x&&this.y===u.y},dist(u){return Math.sqrt(this.distSqr(u))},distSqr(u){const s=u.x-this.x,l=u.y-this.y;return s*s+l*l},angle(){return Math.atan2(this.y,this.x)},angleTo(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith(u){return this.angleWithSep(u.x,u.y)},angleWithSep(u,s){return Math.atan2(this.x*s-this.y*u,this.x*u+this.y*s)},_matMult(u){const s=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=s,this},_add(u){return this.x+=u.x,this.y+=u.y,this},_sub(u){return this.x-=u.x,this.y-=u.y,this},_mult(u){return this.x*=u,this.y*=u,this},_div(u){return this.x/=u,this.y/=u,this},_multByPoint(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint(u){return this.x/=u.x,this.y/=u.y,this},_unit(){return this._div(this.mag()),this},_perp(){const u=this.y;return this.y=this.x,this.x=-u,this},_rotate(u){const s=Math.cos(u),l=Math.sin(u),f=l*this.x+s*this.y;return this.x=s*this.x-l*this.y,this.y=f,this},_rotateAround(u,s){const l=Math.cos(u),f=Math.sin(u),g=s.y+f*(this.x-s.x)+l*(this.y-s.y);return this.x=s.x+l*(this.x-s.x)-f*(this.y-s.y),this.y=g,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:y},y.convert=function(u){if(u instanceof y)return u;if(Array.isArray(u))return new y(+u[0],+u[1]);if(u.x!==void 0&&u.y!==void 0)return new y(+u.x,+u.y);throw new Error("Expected [x, y] or {x, y} point format")};var F=function(){if(M)return E;function u(s,l,f,g){this.cx=3*s,this.bx=3*(f-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(g-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=l,this.p2x=f,this.p2y=g}return M=1,E=u,u.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,l){if(l===void 0&&(l=1e-6),s<0)return 0;if(s>1)return 1;for(var f=s,g=0;g<8;g++){var x=this.sampleCurveX(f)-s;if(Math.abs(x)<l)return f;var b=this.sampleCurveDerivativeX(f);if(Math.abs(b)<1e-6)break;f-=x/b}var T=0,A=1;for(f=s,g=0;g<20&&(x=this.sampleCurveX(f),!(Math.abs(x-s)<l));g++)s>x?T=f:A=f,f=.5*(A-T)+T;return f},solve:function(s,l){return this.sampleCurveY(this.solveCurveX(s,l))}},E}(),N=S(F);let G,re;function me(){return G==null&&(G=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),G}function Y(){if(re==null&&(re=!1,me())){const s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let f=0;f<5*5;f++){const g=4*f;s.fillStyle=`rgb(${g},${g+1},${g+2})`,s.fillRect(f%5,Math.floor(f/5),1,1)}const l=s.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&l[f]!==f){re=!0;break}}}return re||!1}var q=1e-6,Z=typeof Float32Array<"u"?Float32Array:Array;function le(){var u=new Z(9);return Z!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function Ae(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function we(){var u=new Z(3);return Z!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function je(u){var s=u[0],l=u[1],f=u[2];return Math.sqrt(s*s+l*l+f*f)}function Ue(u,s,l){var f=new Z(3);return f[0]=u,f[1]=s,f[2]=l,f}function Ze(u,s,l){return u[0]=s[0]+l[0],u[1]=s[1]+l[1],u[2]=s[2]+l[2],u}function qe(u,s,l){return u[0]=s[0]*l,u[1]=s[1]*l,u[2]=s[2]*l,u}function Ke(u,s,l){var f=s[0],g=s[1],x=s[2],b=l[0],T=l[1],A=l[2];return u[0]=g*A-x*T,u[1]=x*b-f*A,u[2]=f*T-g*b,u}var ht,Pt=je;function xt(u,s,l){var f=s[0],g=s[1],x=s[2],b=s[3];return u[0]=l[0]*f+l[4]*g+l[8]*x+l[12]*b,u[1]=l[1]*f+l[5]*g+l[9]*x+l[13]*b,u[2]=l[2]*f+l[6]*g+l[10]*x+l[14]*b,u[3]=l[3]*f+l[7]*g+l[11]*x+l[15]*b,u}function Zt(){var u=new Z(4);return Z!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function Ot(u,s,l,f){var g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",x=Math.PI/360;s*=x,f*=x,l*=x;var b=Math.sin(s),T=Math.cos(s),A=Math.sin(l),C=Math.cos(l),R=Math.sin(f),O=Math.cos(f);switch(g){case"xyz":u[0]=b*C*O+T*A*R,u[1]=T*A*O-b*C*R,u[2]=T*C*R+b*A*O,u[3]=T*C*O-b*A*R;break;case"xzy":u[0]=b*C*O-T*A*R,u[1]=T*A*O-b*C*R,u[2]=T*C*R+b*A*O,u[3]=T*C*O+b*A*R;break;case"yxz":u[0]=b*C*O+T*A*R,u[1]=T*A*O-b*C*R,u[2]=T*C*R-b*A*O,u[3]=T*C*O+b*A*R;break;case"yzx":u[0]=b*C*O+T*A*R,u[1]=T*A*O+b*C*R,u[2]=T*C*R-b*A*O,u[3]=T*C*O-b*A*R;break;case"zxy":u[0]=b*C*O-T*A*R,u[1]=T*A*O+b*C*R,u[2]=T*C*R+b*A*O,u[3]=T*C*O-b*A*R;break;case"zyx":u[0]=b*C*O-T*A*R,u[1]=T*A*O+b*C*R,u[2]=T*C*R-b*A*O,u[3]=T*C*O+b*A*R;break;default:throw new Error("Unknown angle order "+g)}return u}function $t(){var u=new Z(2);return Z!=Float32Array&&(u[0]=0,u[1]=0),u}function Je(u,s){var l=new Z(2);return l[0]=u,l[1]=s,l}we(),ht=new Z(4),Z!=Float32Array&&(ht[0]=0,ht[1]=0,ht[2]=0,ht[3]=0),we(),Ue(1,0,0),Ue(0,1,0),Zt(),Zt(),le(),$t();const Qe=8192;function gt(u,s,l){return s*(Qe/(u.tileSize*Math.pow(2,l-u.tileID.overscaledZ)))}function dt(u,s){return(u%s+s)%s}function yt(u,s,l){return u*(1-l)+s*l}function _r(u){if(u<=0)return 0;if(u>=1)return 1;const s=u*u,l=s*u;return 4*(u<.5?l:3*(u-s)+l-.75)}function lr(u,s,l,f){const g=new N(u,s,l,f);return x=>g.solve(x)}const bt=lr(.25,.1,.25,1);function mt(u,s,l){return Math.min(l,Math.max(s,u))}function nr(u,s,l){const f=l-s,g=((u-s)%f+f)%f+s;return g===s?l:g}function Wt(u,...s){for(const l of s)for(const f in l)u[f]=l[f];return u}let fr=1;function vr(u,s,l){const f={};for(const g in u)f[g]=s.call(this,u[g],g,u);return f}function en(u,s,l){const f={};for(const g in u)s.call(this,u[g],g,u)&&(f[g]=u[g]);return f}function pr(u){return Array.isArray(u)?u.map(pr):typeof u=="object"&&u?vr(u,pr):u}const er={};function Ft(u){er[u]||(typeof console<"u"&&console.warn(u),er[u]=!0)}function Qt(u,s,l){return(l.y-u.y)*(s.x-u.x)>(s.y-u.y)*(l.x-u.x)}function xr(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let tr=null;function Jt(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const sr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ht(u,s,l,f,g){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const x=new VideoFrame(u,{timestamp:0});try{const b=x==null?void 0:x.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);const T=b.startsWith("BGR"),A=new Uint8ClampedArray(f*g*4);if(yield x.copyTo(A,function(C,R,O,B,V){const j=4*Math.max(-R,0),X=(Math.max(0,O)-O)*B*4+j,J=4*B,oe=Math.max(0,R),Se=Math.max(0,O);return{rect:{x:oe,y:Se,width:Math.min(C.width,R+B)-oe,height:Math.min(C.height,O+V)-Se},layout:[{offset:X,stride:J}]}}(u,s,l,f,g)),T)for(let C=0;C<A.length;C+=4){const R=A[C];A[C]=A[C+2],A[C+2]=R}return A}finally{x.close()}})}let ir,yr;function Er(u,s,l,f){return u.addEventListener(s,l,f),{unsubscribe:()=>{u.removeEventListener(s,l,f)}}}function dr(u){return u*Math.PI/180}function gr(u){return u/Math.PI*180}const Nr={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Mr={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Qr="AbortError";function ve(){return new Error(Qr)}const $={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function H(u){return $.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const K="global-dispatcher";class se extends Error{constructor(s,l,f,g){super(`AJAXError: ${l} (${s}): ${f}`),this.status=s,this.statusText=l,this.url=f,this.body=g}}const pe=()=>xr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,be=function(u,s){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){const f=H(u.url);if(f)return f(u,s);if(xr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:K},s)}if(!(/^file:/.test(l=u.url)||/^file:/.test(pe())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,g){return a(this,void 0,void 0,function*(){const x=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:pe(),signal:g.signal});let b,T;f.type!=="json"||x.headers.has("Accept")||x.headers.set("Accept","application/json");try{b=yield fetch(x)}catch(C){throw new se(0,C.message,f.url,new Blob)}if(!b.ok){const C=yield b.blob();throw new se(b.status,b.statusText,f.url,C)}T=f.type==="arrayBuffer"||f.type==="image"?b.arrayBuffer():f.type==="json"?b.json():b.text();const A=yield T;if(g.signal.aborted)throw ve();return{data:A,cacheControl:b.headers.get("Cache-Control"),expires:b.headers.get("Expires")}})}(u,s);if(xr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:K},s)}var l;return function(f,g){return new Promise((x,b)=>{var T;const A=new XMLHttpRequest;A.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(A.responseType="arraybuffer");for(const C in f.headers)A.setRequestHeader(C,f.headers[C]);f.type==="json"&&(A.responseType="text",!((T=f.headers)===null||T===void 0)&&T.Accept||A.setRequestHeader("Accept","application/json")),A.withCredentials=f.credentials==="include",A.onerror=()=>{b(new Error(A.statusText))},A.onload=()=>{if(!g.signal.aborted)if((A.status>=200&&A.status<300||A.status===0)&&A.response!==null){let C=A.response;if(f.type==="json")try{C=JSON.parse(A.response)}catch(R){return void b(R)}x({data:C,cacheControl:A.getResponseHeader("Cache-Control"),expires:A.getResponseHeader("Expires")})}else{const C=new Blob([A.response],{type:A.getResponseHeader("Content-Type")});b(new se(A.status,A.statusText,f.url,C))}},g.signal.addEventListener("abort",()=>{A.abort(),b(ve())}),A.send(f.body)})}(u,s)};function Ie(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const s=new URL(u),l=window.location;return s.protocol===l.protocol&&s.host===l.host}function xe(u,s,l){l[u]&&l[u].indexOf(s)!==-1||(l[u]=l[u]||[],l[u].push(s))}function ze(u,s,l){if(l&&l[u]){const f=l[u].indexOf(s);f!==-1&&l[u].splice(f,1)}}class We{constructor(s,l={}){Wt(this,l),this.type=s}}class Ve extends We{constructor(s,l={}){super("error",Wt({error:s},l))}}class ft{on(s,l){return this._listeners=this._listeners||{},xe(s,l,this._listeners),{unsubscribe:()=>{this.off(s,l)}}}off(s,l){return ze(s,l,this._listeners),ze(s,l,this._oneTimeListeners),this}once(s,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},xe(s,l,this._oneTimeListeners),this):new Promise(f=>this.once(s,f))}fire(s,l){typeof s=="string"&&(s=new We(s,l||{}));const f=s.type;if(this.listens(f)){s.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of g)T.call(this,s);const x=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of x)ze(f,T,this._oneTimeListeners),T.call(this,s);const b=this._eventedParent;b&&(Wt(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(s))}else s instanceof Ve&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,l){return this._eventedParent=s,this._eventedParentData=l,this}}var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const kt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Bt(u,s){const l={};for(const f in u)f!=="ref"&&(l[f]=u[f]);return kt.forEach(f=>{f in s&&(l[f]=s[f])}),l}function _t(u,s){if(Array.isArray(u)){if(!Array.isArray(s)||u.length!==s.length)return!1;for(let l=0;l<u.length;l++)if(!_t(u[l],s[l]))return!1;return!0}if(typeof u=="object"&&u!==null&&s!==null){if(typeof s!="object"||Object.keys(u).length!==Object.keys(s).length)return!1;for(const l in u)if(!_t(u[l],s[l]))return!1;return!0}return u===s}function Mt(u,s){u.push(s)}function Gt(u,s,l){Mt(l,{command:"addSource",args:[u,s[u]]})}function wr(u,s,l){Mt(s,{command:"removeSource",args:[u]}),l[u]=!0}function Rr(u,s,l,f){wr(u,l,f),Gt(u,s,l)}function it(u,s,l){let f;for(f in u[l])if(Object.prototype.hasOwnProperty.call(u[l],f)&&f!=="data"&&!_t(u[l][f],s[l][f]))return!1;for(f in s[l])if(Object.prototype.hasOwnProperty.call(s[l],f)&&f!=="data"&&!_t(u[l][f],s[l][f]))return!1;return!0}function Dt(u,s,l,f,g,x){u=u||{},s=s||{};for(const b in u)Object.prototype.hasOwnProperty.call(u,b)&&(_t(u[b],s[b])||l.push({command:x,args:[f,b,s[b],g]}));for(const b in s)Object.prototype.hasOwnProperty.call(s,b)&&!Object.prototype.hasOwnProperty.call(u,b)&&(_t(u[b],s[b])||l.push({command:x,args:[f,b,s[b],g]}))}function Ut(u){return u.id}function kr(u,s){return u[s.id]=s,u}class $e{constructor(s,l,f,g){this.message=(s?`${s}: `:"")+f,g&&(this.identifier=g),l!=null&&l.__line__&&(this.line=l.__line__)}}function un(u,...s){for(const l of s)for(const f in l)u[f]=l[f];return u}class Dr extends Error{constructor(s,l){super(l),this.message=l,this.key=s}}class Ai{constructor(s,l=[]){this.parent=s,this.bindings={};for(const[f,g]of l)this.bindings[f]=g}concat(s){return new Ai(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const ts={kind:"null"},rt={kind:"number"},Vt={kind:"string"},At={kind:"boolean"},Or={kind:"color"},Ii={kind:"projectionDefinition"},fi={kind:"object"},Ct={kind:"value"},_n={kind:"collator"},Pr={kind:"formatted"},rs={kind:"padding"},Pi={kind:"colorArray"},Bs={kind:"numberArray"},Xr={kind:"resolvedImage"},Mo={kind:"variableAnchorOffsetCollection"};function Tn(u,s){return{kind:"array",itemType:u,N:s}}function Tr(u){if(u.kind==="array"){const s=Tr(u.itemType);return typeof u.N=="number"?`array<${s}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${s}>`}return u.kind}const Va=[ts,rt,Vt,At,Or,Ii,Pr,fi,Tn(Ct),rs,Bs,Pi,Xr,Mo];function no(u,s){if(s.kind==="error")return null;if(u.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!no(u.itemType,s.itemType))&&(typeof u.N!="number"||u.N===s.N))return null}else{if(u.kind===s.kind)return null;if(u.kind==="value"){for(const l of Va)if(!no(l,s))return null}}return`Expected ${Tr(u)} but found ${Tr(s)} instead.`}function fs(u,s){return s.some(l=>l.kind===u.kind)}function ii(u,s){return s.some(l=>l==="null"?u===null:l==="array"?Array.isArray(u):l==="object"?u&&!Array.isArray(u)&&typeof u=="object":l===typeof u)}function ns(u,s){return u.kind==="array"&&s.kind==="array"?u.itemType.kind===s.itemType.kind&&typeof u.N=="number":u.kind===s.kind}const ta=.96422,ja=.82521,$a=4/29,Vi=6/29,Wa=3*Vi*Vi,ql=Vi*Vi*Vi,ra=Math.PI/180,Ha=180/Math.PI;function io(u){return(u%=360)<0&&(u+=360),u}function Us([u,s,l,f]){let g,x;const b=Yl((.2225045*(u=na(u))+.7168786*(s=na(s))+.0606169*(l=na(l)))/1);u===s&&s===l?g=x=b:(g=Yl((.4360747*u+.3850649*s+.1430804*l)/ta),x=Yl((.0139322*u+.0971045*s+.7141733*l)/ja));const T=116*b-16;return[T<0?0:T,500*(g-b),200*(b-x),f]}function na(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Yl(u){return u>ql?Math.pow(u,1/3):u/Wa+$a}function Ro([u,s,l,f]){let g=(u+16)/116,x=isNaN(s)?g:g+s/500,b=isNaN(l)?g:g-l/200;return g=1*Kl(g),x=ta*Kl(x),b=ja*Kl(b),[Gl(3.1338561*x-1.6168667*g-.4906146*b),Gl(-.9787684*x+1.9161415*g+.033454*b),Gl(.0719453*x-.2289914*g+1.4052427*b),f]}function Gl(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function Kl(u){return u>Vi?u*u*u:Wa*(u-$a)}const cd=Object.hasOwn||function(u,s){return Object.prototype.hasOwnProperty.call(u,s)};function ko(u,s){return cd(u,s)?u[s]:void 0}function ia(u){return parseInt(u.padEnd(2,u),16)/255}function ji(u,s){return rr(s?u/100:u,0,1)}function rr(u,s,l){return Math.min(Math.max(s,u),l)}function sa(u){return!u.some(Number.isNaN)}const Do={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function so(u,s,l){return u+l*(s-u)}function oa(u,s,l){return u.map((f,g)=>so(f,s[g],l))}class or{constructor(s,l,f,g=1,x=!0){this.r=s,this.g=l,this.b=f,this.a=g,x||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[s,l,f,g]))}static parse(s){if(s instanceof or)return s;if(typeof s!="string")return;const l=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=ko(Do,f);if(g){const[b,T,A]=g;return[b/255,T/255,A/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const b=f.length<6?1:2;let T=1;return[ia(f.slice(T,T+=b)),ia(f.slice(T,T+=b)),ia(f.slice(T,T+=b)),ia(f.slice(T,T+b)||"ff")]}if(f.startsWith("rgb")){const b=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[T,A,C,R,O,B,V,j,X,J,oe,Se]=b,fe=[R||" ",V||" ",J].join("");if(fe==="  "||fe==="  /"||fe===",,"||fe===",,,"){const _e=[C,B,X].join(""),Oe=_e==="%%%"?100:_e===""?255:0;if(Oe){const Be=[rr(+A/Oe,0,1),rr(+O/Oe,0,1),rr(+j/Oe,0,1),oe?ji(+oe,Se):1];if(sa(Be))return Be}}return}}const x=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[b,T,A,C,R,O,B,V,j]=x,X=[A||" ",R||" ",B].join("");if(X==="  "||X==="  /"||X===",,"||X===",,,"){const J=[+T,rr(+C,0,100),rr(+O,0,100),V?ji(+V,j):1];if(sa(J))return function([oe,Se,fe,_e]){function Oe(Be){const Ye=(Be+oe/30)%12,ut=Se*Math.min(fe,1-fe);return fe-ut*Math.max(-1,Math.min(Ye-3,9-Ye,1))}return oe=io(oe),Se/=100,fe/=100,[Oe(0),Oe(8),Oe(4),_e]}(J)}}}(s);return l?new or(...l,!1):void 0}get rgb(){const{r:s,g:l,b:f,a:g}=this,x=g||1/0;return this.overwriteGetter("rgb",[s/x,l/x,f/x,g])}get hcl(){return this.overwriteGetter("hcl",function(s){const[l,f,g,x]=Us(s),b=Math.sqrt(f*f+g*g);return[Math.round(1e4*b)?io(Math.atan2(g,f)*Ha):NaN,b,l,x]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Us(this.rgb))}overwriteGetter(s,l){return Object.defineProperty(this,s,{value:l}),l}toString(){const[s,l,f,g]=this.rgb;return`rgba(${[s,l,f].map(x=>Math.round(255*x)).join(",")},${g})`}static interpolate(s,l,f,g="rgb"){switch(g){case"rgb":{const[x,b,T,A]=oa(s.rgb,l.rgb,f);return new or(x,b,T,A,!1)}case"hcl":{const[x,b,T,A]=s.hcl,[C,R,O,B]=l.hcl;let V,j;if(isNaN(x)||isNaN(C))isNaN(x)?isNaN(C)?V=NaN:(V=C,T!==1&&T!==0||(j=R)):(V=x,O!==1&&O!==0||(j=b));else{let fe=C-x;C>x&&fe>180?fe-=360:C<x&&x-C>180&&(fe+=360),V=x+f*fe}const[X,J,oe,Se]=function([fe,_e,Oe,Be]){return fe=isNaN(fe)?0:fe*ra,Ro([Oe,Math.cos(fe)*_e,Math.sin(fe)*_e,Be])}([V,j??so(b,R,f),so(T,O,f),so(A,B,f)]);return new or(X,J,oe,Se,!1)}case"lab":{const[x,b,T,A]=Ro(oa(s.lab,l.lab,f));return new or(x,b,T,A,!1)}}}}or.black=new or(0,0,0,1),or.white=new or(1,1,1,1),or.transparent=new or(0,0,0,0),or.red=new or(1,0,0,1);class aa{constructor(s,l,f){this.sensitivity=s?l?"variant":"case":l?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,l){return this.collator.compare(s,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const cu=["bottom","center","top"];class uu{constructor(s,l,f,g,x,b){this.text=s,this.image=l,this.scale=f,this.fontStack=g,this.textColor=x,this.verticalAlign=b}}class pi{constructor(s){this.sections=s}static fromString(s){return new pi([new uu(s,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof pi?s:pi.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class Ln{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Ln)return s;if(typeof s=="number")return new Ln([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const l of s)if(typeof l!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new Ln(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,l,f){return new Ln(oa(s.values,l.values,f))}}class gi{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof gi)return s;if(typeof s=="number")return new gi([s]);if(Array.isArray(s)){for(const l of s)if(typeof l!="number")return;return new gi(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,l,f){return new gi(oa(s.values,l.values,f))}}class Sn{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Sn)return s;if(typeof s=="string"){const f=or.parse(s);return f?new Sn([f]):void 0}if(!Array.isArray(s))return;const l=[];for(const f of s){if(typeof f!="string")return;const g=or.parse(f);if(!g)return;l.push(g)}return new Sn(l)}toString(){return JSON.stringify(this.values)}static interpolate(s,l,f,g="rgb"){const x=[];if(s.values.length!=l.values.length)throw new Error(`colorArray: Arrays have mismatched length (${s.values.length} vs. ${l.values.length}), cannot interpolate.`);for(let b=0;b<s.values.length;b++)x.push(or.interpolate(s.values[b],l.values[b],f,g));return new Sn(x)}}class Vr extends Error{constructor(s){super(s),this.name="RuntimeError"}toJSON(){return this.message}}const Bp=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class mi{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof mi)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let l=0;l<s.length;l+=2){const f=s[l],g=s[l+1];if(typeof f!="string"||!Bp.has(f)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new mi(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,l,f){const g=s.values,x=l.values;if(g.length!==x.length)throw new Vr(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${l.toString()}`);const b=[];for(let T=0;T<g.length;T+=2){if(g[T]!==x[T])throw new Vr(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${g[T]}, to[${T}]: ${x[T]}`);b.push(g[T]);const[A,C]=g[T+1],[R,O]=x[T+1];b.push([so(A,R,f),so(C,O,f)])}return new mi(b)}}class $i{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new $i({name:s,available:!1}):null}}class si{constructor(s,l,f){this.from=s,this.to=l,this.transition=f}static interpolate(s,l,f){return new si(s,l,f)}static parse(s){return s instanceof si?s:Array.isArray(s)&&s.length===3&&typeof s[0]=="string"&&typeof s[1]=="string"&&typeof s[2]=="number"?new si(s[0],s[1],s[2]):typeof s=="object"&&typeof s.from=="string"&&typeof s.to=="string"&&typeof s.transition=="number"?new si(s.from,s.to,s.transition):typeof s=="string"?new si(s,s,1):void 0}}function Zr(u,s,l,f){return typeof u=="number"&&u>=0&&u<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof l=="number"&&l>=0&&l<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[u,s,l,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[u,s,l,f]:[u,s,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function la(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof si||u instanceof or||u instanceof aa||u instanceof pi||u instanceof Ln||u instanceof gi||u instanceof Sn||u instanceof mi||u instanceof $i)return!0;if(Array.isArray(u)){for(const s of u)if(!la(s))return!1;return!0}if(typeof u=="object"){for(const s in u)if(!la(u[s]))return!1;return!0}return!1}function Lt(u){if(u===null)return ts;if(typeof u=="string")return Vt;if(typeof u=="boolean")return At;if(typeof u=="number")return rt;if(u instanceof or)return Or;if(u instanceof si)return Ii;if(u instanceof aa)return _n;if(u instanceof pi)return Pr;if(u instanceof Ln)return rs;if(u instanceof gi)return Bs;if(u instanceof Sn)return Pi;if(u instanceof mi)return Mo;if(u instanceof $i)return Xr;if(Array.isArray(u)){const s=u.length;let l;for(const f of u){const g=Lt(f);if(l){if(l===g)continue;l=Ct;break}l=g}return Tn(l||Ct,s)}return fi}function qt(u){const s=typeof u;return u===null?"":s==="string"||s==="number"||s==="boolean"?String(u):u instanceof or||u instanceof si||u instanceof pi||u instanceof Ln||u instanceof gi||u instanceof Sn||u instanceof mi||u instanceof $i?u.toString():JSON.stringify(u)}class oo{constructor(s,l){this.type=s,this.value=l}static parse(s,l){if(s.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!la(s[1]))return l.error("invalid value");const f=s[1];let g=Lt(f);const x=l.expectedType;return g.kind!=="array"||g.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(g=x),new oo(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const mr={string:Vt,number:rt,boolean:At,object:fi};class Wi{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");let f,g=1;const x=s[0];if(x==="array"){let T,A;if(s.length>2){const C=s[1];if(typeof C!="string"||!(C in mr)||C==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);T=mr[C],g++}else T=Ct;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return l.error('The length argument to "array" must be a positive integer literal',2);A=s[2],g++}f=Tn(T,A)}else{if(!mr[x])throw new Error(`Types doesn't contain name = ${x}`);f=mr[x]}const b=[];for(;g<s.length;g++){const T=l.parse(s[g],g,Ct);if(!T)return null;b.push(T)}return new Wi(f,b)}evaluate(s){for(let l=0;l<this.args.length;l++){const f=this.args[l].evaluate(s);if(!no(this.type,Lt(f)))return f;if(l===this.args.length-1)throw new Vr(`Expected value to be of type ${Tr(this.type)}, but found ${Tr(Lt(f))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Vs={"to-boolean":At,"to-color":Or,"to-number":rt,"to-string":Vt};class js{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");const f=s[0];if(!Vs[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&s.length!==2)return l.error("Expected one argument.");const g=Vs[f],x=[];for(let b=1;b<s.length;b++){const T=l.parse(s[b],b,Ct);if(!T)return null;x.push(T)}return new js(g,x)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let l,f;for(const g of this.args){if(l=g.evaluate(s),f=null,l instanceof or)return l;if(typeof l=="string"){const x=s.parseColor(l);if(x)return x}else if(Array.isArray(l)&&(f=l.length<3||l.length>4?`Invalid rgba value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Zr(l[0],l[1],l[2],l[3]),!f))return new or(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Vr(f||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const f of this.args){l=f.evaluate(s);const g=Ln.parse(l);if(g)return g}throw new Vr(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"numberArray":{let l;for(const f of this.args){l=f.evaluate(s);const g=gi.parse(l);if(g)return g}throw new Vr(`Could not parse numberArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"colorArray":{let l;for(const f of this.args){l=f.evaluate(s);const g=Sn.parse(l);if(g)return g}throw new Vr(`Could not parse colorArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const f of this.args){l=f.evaluate(s);const g=mi.parse(l);if(g)return g}throw new Vr(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const f of this.args){if(l=f.evaluate(s),l===null)return 0;const g=Number(l);if(!isNaN(g))return g}throw new Vr(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return pi.fromString(qt(this.args[0].evaluate(s)));case"resolvedImage":return $i.fromString(qt(this.args[0].evaluate(s)));case"projectionDefinition":return this.args[0].evaluate(s);default:return qt(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const hu=["Unknown","Point","LineString","Polygon"];class ud{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?hu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let l=this._parseColorCache.get(s);return l||(l=or.parse(s),this._parseColorCache.set(s,l)),l}}class Xa{constructor(s,l,f=[],g,x=new Ai,b=[]){this.registry=s,this.path=f,this.key=f.map(T=>`[${T}]`).join(""),this.scope=x,this.errors=b,this.expectedType=g,this._isConstant=l}parse(s,l,f,g,x={}){return l?this.concat(l,f,g)._parse(s,x):this._parse(s,x)}_parse(s,l){function f(g,x,b){return b==="assert"?new Wi(x,[g]):b==="coerce"?new js(x,[g]):g}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=s[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[g];if(x){let b=x.parse(s,this);if(!b)return null;if(this.expectedType){const T=this.expectedType,A=b.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||A.kind!=="value"){if(T.kind==="projectionDefinition"&&["string","array"].includes(A.kind)||["color","formatted","resolvedImage"].includes(T.kind)&&["value","string"].includes(A.kind)||["padding","numberArray"].includes(T.kind)&&["value","number","array"].includes(A.kind)||T.kind==="colorArray"&&["value","string","array"].includes(A.kind)||T.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(A.kind))b=f(b,T,l.typeAnnotation||"coerce");else if(this.checkSubtype(T,A))return null}else b=f(b,T,l.typeAnnotation||"assert")}if(!(b instanceof oo)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const T=new ud;try{b=new oo(b.type,b.evaluate(T))}catch(A){return this.error(A.message),null}}return b}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,l,f){const g=typeof s=="number"?this.path.concat(s):this.path,x=f?this.scope.concat(f):this.scope;return new Xa(this.registry,this._isConstant,g,l||null,x,this.errors)}error(s,...l){const f=`${this.key}${l.map(g=>`[${g}]`).join("")}`;this.errors.push(new Dr(f,s))}checkSubtype(s,l){const f=no(s,l);return f&&this.error(f),f}}class Ql{constructor(s,l){this.type=l.type,this.bindings=[].concat(s),this.result=l}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const l of this.bindings)s(l[1]);s(this.result)}static parse(s,l){if(s.length<4)return l.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const f=[];for(let x=1;x<s.length-1;x+=2){const b=s[x];if(typeof b!="string")return l.error(`Expected string, but found ${typeof b} instead.`,x);if(/[^a-zA-Z0-9_]/.test(b))return l.error("Variable names must contain only alphanumeric characters or '_'.",x);const T=l.parse(s[x+1],x+1);if(!T)return null;f.push([b,T])}const g=l.parse(s[s.length-1],s.length-1,l.expectedType,f);return g?new Ql(f,g):null}outputDefined(){return this.result.outputDefined()}}class du{constructor(s,l){this.type=l.type,this.name=s,this.boundExpression=l}static parse(s,l){if(s.length!==2||typeof s[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const f=s[1];return l.scope.has(f)?new du(f,l.scope.get(f)):l.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class fu{constructor(s,l,f){this.type=s,this.index=l,this.input=f}static parse(s,l){if(s.length!==3)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=l.parse(s[1],1,rt),g=l.parse(s[2],2,Tn(l.expectedType||Ct));return f&&g?new fu(g.type.itemType,f,g):null}evaluate(s){const l=this.index.evaluate(s),f=this.input.evaluate(s);if(l<0)throw new Vr(`Array index out of bounds: ${l} < 0.`);if(l>=f.length)throw new Vr(`Array index out of bounds: ${l} > ${f.length-1}.`);if(l!==Math.floor(l))throw new Vr(`Array index must be an integer, but found ${l} instead.`);return f[l]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class pu{constructor(s,l){this.type=At,this.needle=s,this.haystack=l}static parse(s,l){if(s.length!==3)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=l.parse(s[1],1,Ct),g=l.parse(s[2],2,Ct);return f&&g?fs(f.type,[At,Vt,rt,ts,Ct])?new pu(f,g):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(f.type)} instead`):null}evaluate(s){const l=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!f)return!1;if(!ii(l,["boolean","string","number","null"]))throw new Vr(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(Lt(l))} instead.`);if(!ii(f,["string","array"]))throw new Vr(`Expected second argument to be of type array or string, but found ${Tr(Lt(f))} instead.`);return f.indexOf(l)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class ps{constructor(s,l,f){this.type=rt,this.needle=s,this.haystack=l,this.fromIndex=f}static parse(s,l){if(s.length<=2||s.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=l.parse(s[1],1,Ct),g=l.parse(s[2],2,Ct);if(!f||!g)return null;if(!fs(f.type,[At,Vt,rt,ts,Ct]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(f.type)} instead`);if(s.length===4){const x=l.parse(s[3],3,rt);return x?new ps(f,g,x):null}return new ps(f,g)}evaluate(s){const l=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!ii(l,["boolean","string","number","null"]))throw new Vr(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(Lt(l))} instead.`);let g;if(this.fromIndex&&(g=this.fromIndex.evaluate(s)),ii(f,["string"])){const x=f.indexOf(l,g);return x===-1?-1:[...f.slice(0,x)].length}if(ii(f,["array"]))return f.indexOf(l,g);throw new Vr(`Expected second argument to be of type array or string, but found ${Tr(Lt(f))} instead.`)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class zn{constructor(s,l,f,g,x,b){this.inputType=s,this.type=l,this.input=f,this.cases=g,this.outputs=x,this.otherwise=b}static parse(s,l){if(s.length<5)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return l.error("Expected an even number of arguments.");let f,g;l.expectedType&&l.expectedType.kind!=="value"&&(g=l.expectedType);const x={},b=[];for(let C=2;C<s.length-1;C+=2){let R=s[C];const O=s[C+1];Array.isArray(R)||(R=[R]);const B=l.concat(C);if(R.length===0)return B.error("Expected at least one branch label.");for(const j of R){if(typeof j!="number"&&typeof j!="string")return B.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return B.error("Numeric branch labels must be integer values.");if(f){if(B.checkSubtype(f,Lt(j)))return null}else f=Lt(j);if(x[String(j)]!==void 0)return B.error("Branch labels must be unique.");x[String(j)]=b.length}const V=l.parse(O,C,g);if(!V)return null;g=g||V.type,b.push(V)}const T=l.parse(s[1],1,Ct);if(!T)return null;const A=l.parse(s[s.length-1],s.length-1,g);return A?T.type.kind!=="value"&&l.concat(1).checkSubtype(f,T.type)?null:new zn(f,g,T,x,b,A):null}evaluate(s){const l=this.input.evaluate(s);return(Lt(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class Za{constructor(s,l,f){this.type=s,this.branches=l,this.otherwise=f}static parse(s,l){if(s.length<4)return l.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return l.error("Expected an odd number of arguments.");let f;l.expectedType&&l.expectedType.kind!=="value"&&(f=l.expectedType);const g=[];for(let b=1;b<s.length-1;b+=2){const T=l.parse(s[b],b,At);if(!T)return null;const A=l.parse(s[b+1],b+1,f);if(!A)return null;g.push([T,A]),f=f||A.type}const x=l.parse(s[s.length-1],s.length-1,f);if(!x)return null;if(!f)throw new Error("Can't infer output type");return new Za(f,g,x)}evaluate(s){for(const[l,f]of this.branches)if(l.evaluate(s))return f.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[l,f]of this.branches)s(l),s(f);s(this.otherwise)}outputDefined(){return this.branches.every(([s,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class Jl{constructor(s,l,f,g){this.type=s,this.input=l,this.beginIndex=f,this.endIndex=g}static parse(s,l){if(s.length<=2||s.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=l.parse(s[1],1,Ct),g=l.parse(s[2],2,rt);if(!f||!g)return null;if(!fs(f.type,[Tn(Ct),Vt,Ct]))return l.error(`Expected first argument to be of type array or string, but found ${Tr(f.type)} instead`);if(s.length===4){const x=l.parse(s[3],3,rt);return x?new Jl(f.type,f,g,x):null}return new Jl(f.type,f,g)}evaluate(s){const l=this.input.evaluate(s),f=this.beginIndex.evaluate(s);let g;if(this.endIndex&&(g=this.endIndex.evaluate(s)),ii(l,["string"]))return[...l].slice(f,g).join("");if(ii(l,["array"]))return l.slice(f,g);throw new Vr(`Expected first argument to be of type array or string, but found ${Tr(Lt(l))} instead.`)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function ca(u,s){const l=u.length-1;let f,g,x=0,b=l,T=0;for(;x<=b;)if(T=Math.floor((x+b)/2),f=u[T],g=u[T+1],f<=s){if(T===l||s<g)return T;x=T+1}else{if(!(f>s))throw new Vr("Input is not a number.");b=T-1}return 0}class hn{constructor(s,l,f){this.type=s,this.input=l,this.labels=[],this.outputs=[];for(const[g,x]of f)this.labels.push(g),this.outputs.push(x)}static parse(s,l){if(s.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return l.error("Expected an even number of arguments.");const f=l.parse(s[1],1,rt);if(!f)return null;const g=[];let x=null;l.expectedType&&l.expectedType.kind!=="value"&&(x=l.expectedType);for(let b=1;b<s.length;b+=2){const T=b===1?-1/0:s[b],A=s[b+1],C=b,R=b+1;if(typeof T!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(g.length&&g[g.length-1][0]>=T)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const O=l.parse(A,R,x);if(!O)return null;x=x||O.type,g.push([T,O])}return new hn(x,f,g)}evaluate(s){const l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(s);const g=this.input.evaluate(s);if(g<=l[0])return f[0].evaluate(s);const x=l.length;return g>=l[x-1]?f[x-1].evaluate(s):f[ca(l,g)].evaluate(s)}eachChild(s){s(this.input);for(const l of this.outputs)s(l)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Up(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var ec,hd,Py=function(){if(hd)return ec;function u(s,l,f,g){this.cx=3*s,this.bx=3*(f-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(g-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=l,this.p2x=f,this.p2y=g}return hd=1,ec=u,u.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,l){if(l===void 0&&(l=1e-6),s<0)return 0;if(s>1)return 1;for(var f=s,g=0;g<8;g++){var x=this.sampleCurveX(f)-s;if(Math.abs(x)<l)return f;var b=this.sampleCurveDerivativeX(f);if(Math.abs(b)<1e-6)break;f-=x/b}var T=0,A=1;for(f=s,g=0;g<20&&(x=this.sampleCurveX(f),!(Math.abs(x-s)<l));g++)s>x?T=f:A=f,f=.5*(A-T)+T;return f},solve:function(s,l){return this.sampleCurveY(this.solveCurveX(s,l))}},ec}(),qa=Up(Py);class Yn{constructor(s,l,f,g,x){this.type=s,this.operator=l,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[b,T]of x)this.labels.push(b),this.outputs.push(T)}static interpolationFactor(s,l,f,g){let x=0;if(s.name==="exponential")x=tc(l,s.base,f,g);else if(s.name==="linear")x=tc(l,1,f,g);else if(s.name==="cubic-bezier"){const b=s.controlPoints;x=new qa(b[0],b[1],b[2],b[3]).solve(tc(l,1,f,g))}return x}static parse(s,l){let[f,g,x,...b]=s;if(!Array.isArray(g)||g.length===0)return l.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const C=g[1];if(typeof C!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:C}}else{if(g[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const C=g.slice(1);if(C.length!==4||C.some(R=>typeof R!="number"||R<0||R>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:C}}}if(s.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(x=l.parse(x,2,rt),!x)return null;const T=[];let A=null;f!=="interpolate-hcl"&&f!=="interpolate-lab"||l.expectedType==Pi?l.expectedType&&l.expectedType.kind!=="value"&&(A=l.expectedType):A=Or;for(let C=0;C<b.length;C+=2){const R=b[C],O=b[C+1],B=C+3,V=C+4;if(typeof R!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(T.length&&T[T.length-1][0]>=R)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const j=l.parse(O,V,A);if(!j)return null;A=A||j.type,T.push([R,j])}return ns(A,rt)||ns(A,Ii)||ns(A,Or)||ns(A,rs)||ns(A,Bs)||ns(A,Pi)||ns(A,Mo)||ns(A,Tn(rt))?new Yn(A,f,g,x,T):l.error(`Type ${Tr(A)} is not interpolatable.`)}evaluate(s){const l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(s);const g=this.input.evaluate(s);if(g<=l[0])return f[0].evaluate(s);const x=l.length;if(g>=l[x-1])return f[x-1].evaluate(s);const b=ca(l,g),T=Yn.interpolationFactor(this.interpolation,g,l[b],l[b+1]),A=f[b].evaluate(s),C=f[b+1].evaluate(s);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return so(A,C,T);case"color":return or.interpolate(A,C,T);case"padding":return Ln.interpolate(A,C,T);case"colorArray":return Sn.interpolate(A,C,T);case"numberArray":return gi.interpolate(A,C,T);case"variableAnchorOffsetCollection":return mi.interpolate(A,C,T);case"array":return oa(A,C,T);case"projectionDefinition":return si.interpolate(A,C,T)}case"interpolate-hcl":switch(this.type.kind){case"color":return or.interpolate(A,C,T,"hcl");case"colorArray":return Sn.interpolate(A,C,T,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return or.interpolate(A,C,T,"lab");case"colorArray":return Sn.interpolate(A,C,T,"lab")}}}eachChild(s){s(this.input);for(const l of this.outputs)s(l)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function tc(u,s,l,f){const g=f-l,x=u-l;return g===0?0:s===1?x/g:(Math.pow(s,x)-1)/(Math.pow(s,g)-1)}const $s={color:or.interpolate,number:so,padding:Ln.interpolate,numberArray:gi.interpolate,colorArray:Sn.interpolate,variableAnchorOffsetCollection:mi.interpolate,array:oa};class rc{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");let f=null;const g=l.expectedType;g&&g.kind!=="value"&&(f=g);const x=[];for(const T of s.slice(1)){const A=l.parse(T,1+x.length,f,void 0,{typeAnnotation:"omit"});if(!A)return null;f=f||A.type,x.push(A)}if(!f)throw new Error("No output type");const b=g&&x.some(T=>no(g,T.type));return new rc(b?Ct:f,x)}evaluate(s){let l,f=null,g=0;for(const x of this.args)if(g++,f=x.evaluate(s),f&&f instanceof $i&&!f.available&&(l||(l=f.name),f=null,g===this.args.length&&(f=l)),f!==null)break;return f}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}function nc(u,s){return u==="=="||u==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function ic(u,s,l,f){return f.compare(s,l)===0}function oi(u,s,l){const f=u!=="=="&&u!=="!=";return class wI{constructor(x,b,T){this.type=At,this.lhs=x,this.rhs=b,this.collator=T,this.hasUntypedArgument=x.type.kind==="value"||b.type.kind==="value"}static parse(x,b){if(x.length!==3&&x.length!==4)return b.error("Expected two or three arguments.");const T=x[0];let A=b.parse(x[1],1,Ct);if(!A)return null;if(!nc(T,A.type))return b.concat(1).error(`"${T}" comparisons are not supported for type '${Tr(A.type)}'.`);let C=b.parse(x[2],2,Ct);if(!C)return null;if(!nc(T,C.type))return b.concat(2).error(`"${T}" comparisons are not supported for type '${Tr(C.type)}'.`);if(A.type.kind!==C.type.kind&&A.type.kind!=="value"&&C.type.kind!=="value")return b.error(`Cannot compare types '${Tr(A.type)}' and '${Tr(C.type)}'.`);f&&(A.type.kind==="value"&&C.type.kind!=="value"?A=new Wi(C.type,[A]):A.type.kind!=="value"&&C.type.kind==="value"&&(C=new Wi(A.type,[C])));let R=null;if(x.length===4){if(A.type.kind!=="string"&&C.type.kind!=="string"&&A.type.kind!=="value"&&C.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(R=b.parse(x[3],3,_n),!R)return null}return new wI(A,C,R)}evaluate(x){const b=this.lhs.evaluate(x),T=this.rhs.evaluate(x);if(f&&this.hasUntypedArgument){const A=Lt(b),C=Lt(T);if(A.kind!==C.kind||A.kind!=="string"&&A.kind!=="number")throw new Vr(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${A.kind}, ${C.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const A=Lt(b),C=Lt(T);if(A.kind!=="string"||C.kind!=="string")return s(x,b,T)}return this.collator?l(x,b,T,this.collator.evaluate(x)):s(x,b,T)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const Vp=oi("==",function(u,s,l){return s===l},ic),gu=oi("!=",function(u,s,l){return s!==l},function(u,s,l,f){return!ic(0,s,l,f)}),Cy=oi("<",function(u,s,l){return s<l},function(u,s,l,f){return f.compare(s,l)<0}),dd=oi(">",function(u,s,l){return s>l},function(u,s,l,f){return f.compare(s,l)>0}),My=oi("<=",function(u,s,l){return s<=l},function(u,s,l,f){return f.compare(s,l)<=0}),Ry=oi(">=",function(u,s,l){return s>=l},function(u,s,l,f){return f.compare(s,l)>=0});class mu{constructor(s,l,f){this.type=_n,this.locale=f,this.caseSensitive=s,this.diacriticSensitive=l}static parse(s,l){if(s.length!==2)return l.error("Expected one argument.");const f=s[1];if(typeof f!="object"||Array.isArray(f))return l.error("Collator options argument must be an object.");const g=l.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,At);if(!g)return null;const x=l.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,At);if(!x)return null;let b=null;return f.locale&&(b=l.parse(f.locale,1,Vt),!b)?null:new mu(g,x,b)}evaluate(s){return new aa(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}class fd{constructor(s,l,f,g,x){this.type=Vt,this.number=s,this.locale=l,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=x}static parse(s,l){if(s.length!==3)return l.error("Expected two arguments.");const f=l.parse(s[1],1,rt);if(!f)return null;const g=s[2];if(typeof g!="object"||Array.isArray(g))return l.error("NumberFormat options argument must be an object.");let x=null;if(g.locale&&(x=l.parse(g.locale,1,Vt),!x))return null;let b=null;if(g.currency&&(b=l.parse(g.currency,1,Vt),!b))return null;let T=null;if(g["min-fraction-digits"]&&(T=l.parse(g["min-fraction-digits"],1,rt),!T))return null;let A=null;return g["max-fraction-digits"]&&(A=l.parse(g["max-fraction-digits"],1,rt),!A)?null:new fd(f,x,b,T,A)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class ua{constructor(s){this.type=Pr,this.sections=s}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");const f=s[1];if(!Array.isArray(f)&&typeof f=="object")return l.error("First argument must be an image or text section.");const g=[];let x=!1;for(let b=1;b<=s.length-1;++b){const T=s[b];if(x&&typeof T=="object"&&!Array.isArray(T)){x=!1;let A=null;if(T["font-scale"]&&(A=l.parse(T["font-scale"],1,rt),!A))return null;let C=null;if(T["text-font"]&&(C=l.parse(T["text-font"],1,Tn(Vt)),!C))return null;let R=null;if(T["text-color"]&&(R=l.parse(T["text-color"],1,Or),!R))return null;let O=null;if(T["vertical-align"]){if(typeof T["vertical-align"]=="string"&&!cu.includes(T["vertical-align"]))return l.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${T["vertical-align"]}' instead.`);if(O=l.parse(T["vertical-align"],1,Vt),!O)return null}const B=g[g.length-1];B.scale=A,B.font=C,B.textColor=R,B.verticalAlign=O}else{const A=l.parse(s[b],1,Ct);if(!A)return null;const C=A.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,g.push({content:A,scale:null,font:null,textColor:null,verticalAlign:null})}}return new ua(g)}evaluate(s){return new pi(this.sections.map(l=>{const f=l.content.evaluate(s);return Lt(f)===Xr?new uu("",f,null,null,null,l.verticalAlign?l.verticalAlign.evaluate(s):null):new uu(qt(f),null,l.scale?l.scale.evaluate(s):null,l.font?l.font.evaluate(s).join(","):null,l.textColor?l.textColor.evaluate(s):null,l.verticalAlign?l.verticalAlign.evaluate(s):null)}))}eachChild(s){for(const l of this.sections)s(l.content),l.scale&&s(l.scale),l.font&&s(l.font),l.textColor&&s(l.textColor),l.verticalAlign&&s(l.verticalAlign)}outputDefined(){return!1}}class pd{constructor(s){this.type=Xr,this.input=s}static parse(s,l){if(s.length!==2)return l.error("Expected two arguments.");const f=l.parse(s[1],1,Vt);return f?new pd(f):l.error("No image name provided.")}evaluate(s){const l=this.input.evaluate(s),f=$i.fromString(l);return f&&s.availableImages&&(f.available=s.availableImages.indexOf(l)>-1),f}eachChild(s){s(this.input)}outputDefined(){return!1}}class _u{constructor(s){this.type=rt,this.input=s}static parse(s,l){if(s.length!==2)return l.error(`Expected 1 argument, but found ${s.length-1} instead.`);const f=l.parse(s[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Tr(f.type)} instead.`):new _u(f):null}evaluate(s){const l=this.input.evaluate(s);if(typeof l=="string")return[...l].length;if(Array.isArray(l))return l.length;throw new Vr(`Expected value to be of type string or array, but found ${Tr(Lt(l))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const gs=8192;function ky(u,s){const l=(180+u[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,g=Math.pow(2,s.z);return[Math.round(l*g*gs),Math.round(f*g*gs)]}function yu(u,s){const l=Math.pow(2,s.z);return[(g=(u[0]/gs+s.x)/l,360*g-180),(f=(u[1]/gs+s.y)/l,360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90)];var f,g}function sc(u,s){u[0]=Math.min(u[0],s[0]),u[1]=Math.min(u[1],s[1]),u[2]=Math.max(u[2],s[0]),u[3]=Math.max(u[3],s[1])}function oc(u,s){return!(u[0]<=s[0]||u[2]>=s[2]||u[1]<=s[1]||u[3]>=s[3])}function Dy(u,s,l){const f=u[0]-s[0],g=u[1]-s[1],x=u[0]-l[0],b=u[1]-l[1];return f*b-x*g==0&&f*x<=0&&g*b<=0}function vu(u,s,l,f){return(g=[f[0]-l[0],f[1]-l[1]])[0]*(x=[s[0]-u[0],s[1]-u[1]])[1]-g[1]*x[0]!=0&&!(!$p(u,s,l,f)||!$p(l,f,u,s));var g,x}function Oy(u,s,l){for(const f of l)for(let g=0;g<f.length-1;++g)if(vu(u,s,f[g],f[g+1]))return!0;return!1}function ha(u,s,l=!1){let f=!1;for(const T of s)for(let A=0;A<T.length-1;A++){if(Dy(u,T[A],T[A+1]))return l;(x=T[A])[1]>(g=u)[1]!=(b=T[A+1])[1]>g[1]&&g[0]<(b[0]-x[0])*(g[1]-x[1])/(b[1]-x[1])+x[0]&&(f=!f)}var g,x,b;return f}function jp(u,s){for(const l of s)if(ha(u,l))return!0;return!1}function gd(u,s){for(const l of u)if(!ha(l,s))return!1;for(let l=0;l<u.length-1;++l)if(Oy(u[l],u[l+1],s))return!1;return!0}function Fy(u,s){for(const l of s)if(gd(u,l))return!0;return!1}function $p(u,s,l,f){const g=f[0]-l[0],x=f[1]-l[1],b=(u[0]-l[0])*x-g*(u[1]-l[1]),T=(s[0]-l[0])*x-g*(s[1]-l[1]);return b>0&&T<0||b<0&&T>0}function md(u,s,l){const f=[];for(let g=0;g<u.length;g++){const x=[];for(let b=0;b<u[g].length;b++){const T=ky(u[g][b],l);sc(s,T),x.push(T)}f.push(x)}return f}function Wp(u,s,l){const f=[];for(let g=0;g<u.length;g++){const x=md(u[g],s,l);f.push(x)}return f}function xu(u,s,l,f){if(u[0]<l[0]||u[0]>l[2]){const g=.5*f;let x=u[0]-l[0]>g?-f:l[0]-u[0]>g?f:0;x===0&&(x=u[0]-l[2]>g?-f:l[2]-u[0]>g?f:0),u[0]+=x}sc(s,u)}function Hp(u,s,l,f){const g=Math.pow(2,f.z)*gs,x=[f.x*gs,f.y*gs],b=[];for(const T of u)for(const A of T){const C=[A.x+x[0],A.y+x[1]];xu(C,s,l,g),b.push(C)}return b}function Xp(u,s,l,f){const g=Math.pow(2,f.z)*gs,x=[f.x*gs,f.y*gs],b=[];for(const A of u){const C=[];for(const R of A){const O=[R.x+x[0],R.y+x[1]];sc(s,O),C.push(O)}b.push(C)}if(s[2]-s[0]<=g/2){(T=s)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const A of b)for(const C of A)xu(C,s,l,g)}var T;return b}class da{constructor(s,l){this.type=At,this.geojson=s,this.geometries=l}static parse(s,l){if(s.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(la(s[1])){const f=s[1];if(f.type==="FeatureCollection"){const g=[];for(const x of f.features){const{type:b,coordinates:T}=x.geometry;b==="Polygon"&&g.push(T),b==="MultiPolygon"&&g.push(...T)}if(g.length)return new da(f,{type:"MultiPolygon",coordinates:g})}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new da(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new da(f,f)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(l,f){const g=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(f.type==="Polygon"){const T=md(f.coordinates,x,b),A=Hp(l.geometry(),g,x,b);if(!oc(g,x))return!1;for(const C of A)if(!ha(C,T))return!1}if(f.type==="MultiPolygon"){const T=Wp(f.coordinates,x,b),A=Hp(l.geometry(),g,x,b);if(!oc(g,x))return!1;for(const C of A)if(!jp(C,T))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(l,f){const g=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(f.type==="Polygon"){const T=md(f.coordinates,x,b),A=Xp(l.geometry(),g,x,b);if(!oc(g,x))return!1;for(const C of A)if(!gd(C,T))return!1}if(f.type==="MultiPolygon"){const T=Wp(f.coordinates,x,b),A=Xp(l.geometry(),g,x,b);if(!oc(g,x))return!1;for(const C of A)if(!Fy(C,T))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let _d=class{constructor(u=[],s=(l,f)=>l<f?-1:l>f?1:0){if(this.data=u,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(u){this.data.push(u),this._up(this.length++)}pop(){if(this.length===0)return;const u=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:s,compare:l}=this,f=s[u];for(;u>0;){const g=u-1>>1,x=s[g];if(l(f,x)>=0)break;s[u]=x,u=g}s[u]=f}_down(u){const{data:s,compare:l}=this,f=this.length>>1,g=s[u];for(;u<f;){let x=1+(u<<1);const b=x+1;if(b<this.length&&l(s[b],s[x])<0&&(x=b),l(s[x],g)>=0)break;s[u]=s[x],u=x}s[u]=g}};function yd(u,s,l=0,f=u.length-1,g=Ny){for(;f>l;){if(f-l>600){const A=f-l+1,C=s-l+1,R=Math.log(A),O=.5*Math.exp(2*R/3),B=.5*Math.sqrt(R*O*(A-O)/A)*(C-A/2<0?-1:1);yd(u,s,Math.max(l,Math.floor(s-C*O/A+B)),Math.min(f,Math.floor(s+(A-C)*O/A+B)),g)}const x=u[s];let b=l,T=f;for(ac(u,l,s),g(u[f],x)>0&&ac(u,l,f);b<T;){for(ac(u,b,T),b++,T--;g(u[b],x)<0;)b++;for(;g(u[T],x)>0;)T--}g(u[l],x)===0?ac(u,l,T):(T++,ac(u,T,f)),T<=s&&(l=T+1),s<=T&&(f=T-1)}}function ac(u,s,l){const f=u[s];u[s]=u[l],u[l]=f}function Ny(u,s){return u<s?-1:u>s?1:0}function lc(u,s){if(u.length<=1)return[u];const l=[];let f,g;for(const x of u){const b=Ly(x);b!==0&&(x.area=Math.abs(b),g===void 0&&(g=b<0),g===b<0?(f&&l.push(f),f=[x]):f.push(x))}if(f&&l.push(f),s>1)for(let x=0;x<l.length;x++)l[x].length<=s||(yd(l[x],s,1,l[x].length-1,Zp),l[x]=l[x].slice(0,s));return l}function Zp(u,s){return s.area-u.area}function Ly(u){let s=0;for(let l,f,g=0,x=u.length,b=x-1;g<x;b=g++)l=u[g],f=u[b],s+=(f.x-l.x)*(l.y+f.y);return s}const qp=1/298.257223563,Yp=qp*(2-qp),vd=Math.PI/180;class xd{constructor(s){const l=6378.137*vd*1e3,f=Math.cos(s*vd),g=1/(1-Yp*(1-f*f)),x=Math.sqrt(g);this.kx=l*x*f,this.ky=l*x*g*(1-Yp)}distance(s,l){const f=this.wrap(s[0]-l[0])*this.kx,g=(s[1]-l[1])*this.ky;return Math.sqrt(f*f+g*g)}pointOnLine(s,l){let f,g,x,b,T=1/0;for(let A=0;A<s.length-1;A++){let C=s[A][0],R=s[A][1],O=this.wrap(s[A+1][0]-C)*this.kx,B=(s[A+1][1]-R)*this.ky,V=0;O===0&&B===0||(V=(this.wrap(l[0]-C)*this.kx*O+(l[1]-R)*this.ky*B)/(O*O+B*B),V>1?(C=s[A+1][0],R=s[A+1][1]):V>0&&(C+=O/this.kx*V,R+=B/this.ky*V)),O=this.wrap(l[0]-C)*this.kx,B=(l[1]-R)*this.ky;const j=O*O+B*B;j<T&&(T=j,f=C,g=R,x=A,b=V)}return{point:[f,g],index:x,t:Math.max(0,Math.min(1,b))}}wrap(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}}function Gp(u,s){return s[0]-u[0]}function bu(u){return u[1]-u[0]+1}function ao(u,s){return u[1]>=u[0]&&u[1]<s}function Sr(u,s){if(u[0]>u[1])return[null,null];const l=bu(u);if(s){if(l===2)return[u,null];const g=Math.floor(l/2);return[[u[0],u[0]+g],[u[0]+g,u[1]]]}if(l===1)return[u,null];const f=Math.floor(l/2)-1;return[[u[0],u[0]+f],[u[0]+f+1,u[1]]]}function bd(u,s){if(!ao(s,u.length))return[1/0,1/0,-1/0,-1/0];const l=[1/0,1/0,-1/0,-1/0];for(let f=s[0];f<=s[1];++f)sc(l,u[f]);return l}function wd(u){const s=[1/0,1/0,-1/0,-1/0];for(const l of u)for(const f of l)sc(s,f);return s}function Kp(u){return u[0]!==-1/0&&u[1]!==-1/0&&u[2]!==1/0&&u[3]!==1/0}function Td(u,s,l){if(!Kp(u)||!Kp(s))return NaN;let f=0,g=0;return u[2]<s[0]&&(f=s[0]-u[2]),u[0]>s[2]&&(f=u[0]-s[2]),u[1]>s[3]&&(g=u[1]-s[3]),u[3]<s[1]&&(g=s[1]-u[3]),l.distance([0,0],[f,g])}function fa(u,s,l){const f=l.pointOnLine(s,u);return l.distance(u,f.point)}function Sd(u,s,l,f,g){const x=Math.min(fa(u,[l,f],g),fa(s,[l,f],g)),b=Math.min(fa(l,[u,s],g),fa(f,[u,s],g));return Math.min(x,b)}function zy(u,s,l,f,g){if(!ao(s,u.length)||!ao(f,l.length))return 1/0;let x=1/0;for(let b=s[0];b<s[1];++b){const T=u[b],A=u[b+1];for(let C=f[0];C<f[1];++C){const R=l[C],O=l[C+1];if(vu(T,A,R,O))return 0;x=Math.min(x,Sd(T,A,R,O,g))}}return x}function By(u,s,l,f,g){if(!ao(s,u.length)||!ao(f,l.length))return NaN;let x=1/0;for(let b=s[0];b<=s[1];++b)for(let T=f[0];T<=f[1];++T)if(x=Math.min(x,g.distance(u[b],l[T])),x===0)return x;return x}function Uy(u,s,l){if(ha(u,s,!0))return 0;let f=1/0;for(const g of s){const x=g[0],b=g[g.length-1];if(x!==b&&(f=Math.min(f,fa(u,[b,x],l)),f===0))return f;const T=l.pointOnLine(g,u);if(f=Math.min(f,l.distance(u,T.point)),f===0)return f}return f}function Vy(u,s,l,f){if(!ao(s,u.length))return NaN;for(let x=s[0];x<=s[1];++x)if(ha(u[x],l,!0))return 0;let g=1/0;for(let x=s[0];x<s[1];++x){const b=u[x],T=u[x+1];for(const A of l)for(let C=0,R=A.length,O=R-1;C<R;O=C++){const B=A[O],V=A[C];if(vu(b,T,B,V))return 0;g=Math.min(g,Sd(b,T,B,V,f))}}return g}function Qp(u,s){for(const l of u)for(const f of l)if(ha(f,s,!0))return!0;return!1}function jy(u,s,l,f=1/0){const g=wd(u),x=wd(s);if(f!==1/0&&Td(g,x,l)>=f)return f;if(oc(g,x)){if(Qp(u,s))return 0}else if(Qp(s,u))return 0;let b=1/0;for(const T of u)for(let A=0,C=T.length,R=C-1;A<C;R=A++){const O=T[R],B=T[A];for(const V of s)for(let j=0,X=V.length,J=X-1;j<X;J=j++){const oe=V[J],Se=V[j];if(vu(O,B,oe,Se))return 0;b=Math.min(b,Sd(O,B,oe,Se,l))}}return b}function Jp(u,s,l,f,g,x){if(!x)return;const b=Td(bd(f,x),g,l);b<s&&u.push([b,x,[0,0]])}function wu(u,s,l,f,g,x,b){if(!x||!b)return;const T=Td(bd(f,x),bd(g,b),l);T<s&&u.push([T,x,b])}function Tu(u,s,l,f,g=1/0){let x=Math.min(f.distance(u[0],l[0][0]),g);if(x===0)return x;const b=new _d([[0,[0,u.length-1],[0,0]]],Gp),T=wd(l);for(;b.length>0;){const A=b.pop();if(A[0]>=x)continue;const C=A[1],R=s?50:100;if(bu(C)<=R){if(!ao(C,u.length))return NaN;if(s){const O=Vy(u,C,l,f);if(isNaN(O)||O===0)return O;x=Math.min(x,O)}else for(let O=C[0];O<=C[1];++O){const B=Uy(u[O],l,f);if(x=Math.min(x,B),x===0)return 0}}else{const O=Sr(C,s);Jp(b,x,f,u,T,O[0]),Jp(b,x,f,u,T,O[1])}}return x}function Su(u,s,l,f,g,x=1/0){let b=Math.min(x,g.distance(u[0],l[0]));if(b===0)return b;const T=new _d([[0,[0,u.length-1],[0,l.length-1]]],Gp);for(;T.length>0;){const A=T.pop();if(A[0]>=b)continue;const C=A[1],R=A[2],O=s?50:100,B=f?50:100;if(bu(C)<=O&&bu(R)<=B){if(!ao(C,u.length)&&ao(R,l.length))return NaN;let V;if(s&&f)V=zy(u,C,l,R,g),b=Math.min(b,V);else if(s&&!f){const j=u.slice(C[0],C[1]+1);for(let X=R[0];X<=R[1];++X)if(V=fa(l[X],j,g),b=Math.min(b,V),b===0)return b}else if(!s&&f){const j=l.slice(R[0],R[1]+1);for(let X=C[0];X<=C[1];++X)if(V=fa(u[X],j,g),b=Math.min(b,V),b===0)return b}else V=By(u,C,l,R,g),b=Math.min(b,V)}else{const V=Sr(C,s),j=Sr(R,f);wu(T,b,g,u,l,V[0],j[0]),wu(T,b,g,u,l,V[0],j[1]),wu(T,b,g,u,l,V[1],j[0]),wu(T,b,g,u,l,V[1],j[1])}}return b}function Ed(u){return u.type==="MultiPolygon"?u.coordinates.map(s=>({type:"Polygon",coordinates:s})):u.type==="MultiLineString"?u.coordinates.map(s=>({type:"LineString",coordinates:s})):u.type==="MultiPoint"?u.coordinates.map(s=>({type:"Point",coordinates:s})):[u]}class pa{constructor(s,l){this.type=rt,this.geojson=s,this.geometries=l}static parse(s,l){if(s.length!==2)return l.error(`'distance' expression requires exactly one argument, but found ${s.length-1} instead.`);if(la(s[1])){const f=s[1];if(f.type==="FeatureCollection")return new pa(f,f.features.map(g=>Ed(g.geometry)).flat());if(f.type==="Feature")return new pa(f,Ed(f.geometry));if("type"in f&&"coordinates"in f)return new pa(f,Ed(f))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(l,f){const g=l.geometry(),x=g.flat().map(A=>yu([A.x,A.y],l.canonical));if(g.length===0)return NaN;const b=new xd(x[0][1]);let T=1/0;for(const A of f){switch(A.type){case"Point":T=Math.min(T,Su(x,!1,[A.coordinates],!1,b,T));break;case"LineString":T=Math.min(T,Su(x,!1,A.coordinates,!0,b,T));break;case"Polygon":T=Math.min(T,Tu(x,!1,A.coordinates,b,T))}if(T===0)return T}return T}(s,this.geometries);if(s.geometryType()==="LineString")return function(l,f){const g=l.geometry(),x=g.flat().map(A=>yu([A.x,A.y],l.canonical));if(g.length===0)return NaN;const b=new xd(x[0][1]);let T=1/0;for(const A of f){switch(A.type){case"Point":T=Math.min(T,Su(x,!0,[A.coordinates],!1,b,T));break;case"LineString":T=Math.min(T,Su(x,!0,A.coordinates,!0,b,T));break;case"Polygon":T=Math.min(T,Tu(x,!0,A.coordinates,b,T))}if(T===0)return T}return T}(s,this.geometries);if(s.geometryType()==="Polygon")return function(l,f){const g=l.geometry();if(g.length===0||g[0].length===0)return NaN;const x=lc(g,0).map(A=>A.map(C=>C.map(R=>yu([R.x,R.y],l.canonical)))),b=new xd(x[0][0][0][1]);let T=1/0;for(const A of f)for(const C of x){switch(A.type){case"Point":T=Math.min(T,Tu([A.coordinates],!1,C,b,T));break;case"LineString":T=Math.min(T,Tu(A.coordinates,!0,C,b,T));break;case"Polygon":T=Math.min(T,jy(C,A.coordinates,b,T))}if(T===0)return T}return T}(s,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class cc{constructor(s){this.type=Ct,this.key=s}static parse(s,l){if(s.length!==2)return l.error(`Expected 1 argument, but found ${s.length-1} instead.`);const f=s[1];return f==null?l.error("Global state property must be defined."):typeof f!="string"?l.error(`Global state property must be string, but found ${typeof s[1]} instead.`):new cc(f)}evaluate(s){var l;const f=(l=s.globals)===null||l===void 0?void 0:l.globalState;return f&&Object.keys(f).length!==0?ko(f,this.key):null}eachChild(){}outputDefined(){return!1}}const Ya={"==":Vp,"!=":gu,">":dd,"<":Cy,">=":Ry,"<=":My,array:Wi,at:fu,boolean:Wi,case:Za,coalesce:rc,collator:mu,format:ua,image:pd,in:pu,"index-of":ps,interpolate:Yn,"interpolate-hcl":Yn,"interpolate-lab":Yn,length:_u,let:Ql,literal:oo,match:zn,number:Wi,"number-format":fd,object:Wi,slice:Jl,step:hn,string:Wi,"to-boolean":js,"to-color":js,"to-number":js,"to-string":js,var:du,within:da,distance:pa,"global-state":cc};class is{constructor(s,l,f,g){this.name=s,this.type=l,this._evaluate=f,this.args=g}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,l){const f=s[0],g=is.definitions[f];if(!g)return l.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(g)?g[0]:g.type,b=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=b.filter(([C])=>!Array.isArray(C)||C.length===s.length-1);let A=null;for(const[C,R]of T){A=new Xa(l.registry,Eu,l.path,null,l.scope);const O=[];let B=!1;for(let V=1;V<s.length;V++){const j=s[V],X=Array.isArray(C)?C[V-1]:C.type,J=A.parse(j,1+O.length,X);if(!J){B=!0;break}O.push(J)}if(!B)if(Array.isArray(C)&&C.length!==O.length)A.error(`Expected ${C.length} arguments, but found ${O.length} instead.`);else{for(let V=0;V<O.length;V++){const j=Array.isArray(C)?C[V]:C.type,X=O[V];A.concat(V+1).checkSubtype(j,X.type)}if(A.errors.length===0)return new is(f,x,R,O)}}if(T.length===1)l.errors.push(...A.errors);else{const C=(T.length?T:b).map(([O])=>{return B=O,Array.isArray(B)?`(${B.map(Tr).join(", ")})`:`(${Tr(B.type)}...)`;var B}).join(" | "),R=[];for(let O=1;O<s.length;O++){const B=l.parse(s[O],1+R.length);if(!B)return null;R.push(Tr(B.type))}l.error(`Expected arguments of type ${C}, but found (${R.join(", ")}) instead.`)}return null}static register(s,l){is.definitions=l;for(const f in l)s[f]=is}}function eg(u,[s,l,f,g]){s=s.evaluate(u),l=l.evaluate(u),f=f.evaluate(u);const x=g?g.evaluate(u):1,b=Zr(s,l,f,x);if(b)throw new Vr(b);return new or(s/255,l/255,f/255,x,!1)}function tg(u,s){return u in s}function Ad(u,s){const l=s[u];return l===void 0?null:l}function ga(u){return{type:u}}function Eu(u){if(u instanceof du)return Eu(u.boundExpression);if(u instanceof is&&u.name==="error"||u instanceof mu||u instanceof da||u instanceof pa||u instanceof cc)return!1;const s=u instanceof js||u instanceof Wi;let l=!0;return u.eachChild(f=>{l=s?l&&Eu(f):l&&f instanceof oo}),!!l&&Au(u)&&Iu(u,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Au(u){if(u instanceof is&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof da||u instanceof pa)return!1;let s=!0;return u.eachChild(l=>{s&&!Au(l)&&(s=!1)}),s}function uc(u){if(u instanceof is&&u.name==="feature-state")return!1;let s=!0;return u.eachChild(l=>{s&&!uc(l)&&(s=!1)}),s}function Iu(u,s){if(u instanceof is&&s.indexOf(u.name)>=0)return!1;let l=!0;return u.eachChild(f=>{l&&!Iu(f,s)&&(l=!1)}),l}function rg(u){return{result:"success",value:u}}function Ga(u){return{result:"error",value:u}}function Oo(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function ng(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function Id(u){return!!u.expression&&u.expression.interpolated}function cr(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function hc(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)&&Lt(u)===fi}function $y(u){return u}function ig(u,s){const l=u.stops&&typeof u.stops[0][0]=="object",f=l||!(l||u.property!==void 0),g=u.type||(Id(s)?"exponential":"interval"),x=function(R){switch(R.type){case"color":return or.parse;case"padding":return Ln.parse;case"numberArray":return gi.parse;case"colorArray":return Sn.parse;default:return null}}(s);if(x&&((u=un({},u)).stops&&(u.stops=u.stops.map(R=>[R[0],x(R[1])])),u.default=x(u.default?u.default:s.default)),u.colorSpace&&(b=u.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var b;const T=function(R){switch(R){case"exponential":return og;case"interval":return Wy;case"categorical":return sg;case"identity":return Hy;default:throw new Error(`Unknown function type "${R}"`)}}(g);let A,C;if(g==="categorical"){A=Object.create(null);for(const R of u.stops)A[R[0]]=R[1];C=typeof u.stops[0][0]}if(l){const R={},O=[];for(let j=0;j<u.stops.length;j++){const X=u.stops[j],J=X[0].zoom;R[J]===void 0&&(R[J]={zoom:J,type:u.type,property:u.property,default:u.default,stops:[]},O.push(J)),R[J].stops.push([X[0].value,X[1]])}const B=[];for(const j of O)B.push([R[j].zoom,ig(R[j],s)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:Yn.interpolationFactor.bind(void 0,V),zoomStops:B.map(j=>j[0]),evaluate:({zoom:j},X)=>og({stops:B,base:u.base},s,j).evaluate(j,X)}}if(f){const R=g==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:Yn.interpolationFactor.bind(void 0,R),zoomStops:u.stops.map(O=>O[0]),evaluate:({zoom:O})=>T(u,s,O,A,C)}}return{kind:"source",evaluate(R,O){const B=O&&O.properties?O.properties[u.property]:void 0;return B===void 0?Fo(u.default,s.default):T(u,s,B,A,C)}}}function Fo(u,s,l){return u!==void 0?u:s!==void 0?s:l!==void 0?l:void 0}function sg(u,s,l,f,g){return Fo(typeof l===g?f[l]:void 0,u.default,s.default)}function Wy(u,s,l){if(cr(l)!=="number")return Fo(u.default,s.default);const f=u.stops.length;if(f===1||l<=u.stops[0][0])return u.stops[0][1];if(l>=u.stops[f-1][0])return u.stops[f-1][1];const g=ca(u.stops.map(x=>x[0]),l);return u.stops[g][1]}function og(u,s,l){const f=u.base!==void 0?u.base:1;if(cr(l)!=="number")return Fo(u.default,s.default);const g=u.stops.length;if(g===1||l<=u.stops[0][0])return u.stops[0][1];if(l>=u.stops[g-1][0])return u.stops[g-1][1];const x=ca(u.stops.map(R=>R[0]),l),b=function(R,O,B,V){const j=V-B,X=R-B;return j===0?0:O===1?X/j:(Math.pow(O,X)-1)/(Math.pow(O,j)-1)}(l,f,u.stops[x][0],u.stops[x+1][0]),T=u.stops[x][1],A=u.stops[x+1][1],C=$s[s.type]||$y;return typeof T.evaluate=="function"?{evaluate(...R){const O=T.evaluate.apply(void 0,R),B=A.evaluate.apply(void 0,R);if(O!==void 0&&B!==void 0)return C(O,B,b,u.colorSpace)}}:C(T,A,b,u.colorSpace)}function Hy(u,s,l){switch(s.type){case"color":l=or.parse(l);break;case"formatted":l=pi.fromString(l.toString());break;case"resolvedImage":l=$i.fromString(l.toString());break;case"padding":l=Ln.parse(l);break;case"colorArray":l=Sn.parse(l);break;case"numberArray":l=gi.parse(l);break;default:cr(l)===s.type||s.type==="enum"&&s.values[l]||(l=void 0)}return Fo(l,u.default,s.default)}is.register(Ya,{error:[{kind:"error"},[Vt],(u,[s])=>{throw new Vr(s.evaluate(u))}],typeof:[Vt,[Ct],(u,[s])=>Tr(Lt(s.evaluate(u)))],"to-rgba":[Tn(rt,4),[Or],(u,[s])=>{const[l,f,g,x]=s.evaluate(u).rgb;return[255*l,255*f,255*g,x]}],rgb:[Or,[rt,rt,rt],eg],rgba:[Or,[rt,rt,rt,rt],eg],has:{type:At,overloads:[[[Vt],(u,[s])=>tg(s.evaluate(u),u.properties())],[[Vt,fi],(u,[s,l])=>tg(s.evaluate(u),l.evaluate(u))]]},get:{type:Ct,overloads:[[[Vt],(u,[s])=>Ad(s.evaluate(u),u.properties())],[[Vt,fi],(u,[s,l])=>Ad(s.evaluate(u),l.evaluate(u))]]},"feature-state":[Ct,[Vt],(u,[s])=>Ad(s.evaluate(u),u.featureState||{})],properties:[fi,[],u=>u.properties()],"geometry-type":[Vt,[],u=>u.geometryType()],id:[Ct,[],u=>u.id()],zoom:[rt,[],u=>u.globals.zoom],"heatmap-density":[rt,[],u=>u.globals.heatmapDensity||0],elevation:[rt,[],u=>u.globals.elevation||0],"line-progress":[rt,[],u=>u.globals.lineProgress||0],accumulated:[Ct,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[rt,ga(rt),(u,s)=>{let l=0;for(const f of s)l+=f.evaluate(u);return l}],"*":[rt,ga(rt),(u,s)=>{let l=1;for(const f of s)l*=f.evaluate(u);return l}],"-":{type:rt,overloads:[[[rt,rt],(u,[s,l])=>s.evaluate(u)-l.evaluate(u)],[[rt],(u,[s])=>-s.evaluate(u)]]},"/":[rt,[rt,rt],(u,[s,l])=>s.evaluate(u)/l.evaluate(u)],"%":[rt,[rt,rt],(u,[s,l])=>s.evaluate(u)%l.evaluate(u)],ln2:[rt,[],()=>Math.LN2],pi:[rt,[],()=>Math.PI],e:[rt,[],()=>Math.E],"^":[rt,[rt,rt],(u,[s,l])=>Math.pow(s.evaluate(u),l.evaluate(u))],sqrt:[rt,[rt],(u,[s])=>Math.sqrt(s.evaluate(u))],log10:[rt,[rt],(u,[s])=>Math.log(s.evaluate(u))/Math.LN10],ln:[rt,[rt],(u,[s])=>Math.log(s.evaluate(u))],log2:[rt,[rt],(u,[s])=>Math.log(s.evaluate(u))/Math.LN2],sin:[rt,[rt],(u,[s])=>Math.sin(s.evaluate(u))],cos:[rt,[rt],(u,[s])=>Math.cos(s.evaluate(u))],tan:[rt,[rt],(u,[s])=>Math.tan(s.evaluate(u))],asin:[rt,[rt],(u,[s])=>Math.asin(s.evaluate(u))],acos:[rt,[rt],(u,[s])=>Math.acos(s.evaluate(u))],atan:[rt,[rt],(u,[s])=>Math.atan(s.evaluate(u))],min:[rt,ga(rt),(u,s)=>Math.min(...s.map(l=>l.evaluate(u)))],max:[rt,ga(rt),(u,s)=>Math.max(...s.map(l=>l.evaluate(u)))],abs:[rt,[rt],(u,[s])=>Math.abs(s.evaluate(u))],round:[rt,[rt],(u,[s])=>{const l=s.evaluate(u);return l<0?-Math.round(-l):Math.round(l)}],floor:[rt,[rt],(u,[s])=>Math.floor(s.evaluate(u))],ceil:[rt,[rt],(u,[s])=>Math.ceil(s.evaluate(u))],"filter-==":[At,[Vt,Ct],(u,[s,l])=>u.properties()[s.value]===l.value],"filter-id-==":[At,[Ct],(u,[s])=>u.id()===s.value],"filter-type-==":[At,[Vt],(u,[s])=>u.geometryType()===s.value],"filter-<":[At,[Vt,Ct],(u,[s,l])=>{const f=u.properties()[s.value],g=l.value;return typeof f==typeof g&&f<g}],"filter-id-<":[At,[Ct],(u,[s])=>{const l=u.id(),f=s.value;return typeof l==typeof f&&l<f}],"filter->":[At,[Vt,Ct],(u,[s,l])=>{const f=u.properties()[s.value],g=l.value;return typeof f==typeof g&&f>g}],"filter-id->":[At,[Ct],(u,[s])=>{const l=u.id(),f=s.value;return typeof l==typeof f&&l>f}],"filter-<=":[At,[Vt,Ct],(u,[s,l])=>{const f=u.properties()[s.value],g=l.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[At,[Ct],(u,[s])=>{const l=u.id(),f=s.value;return typeof l==typeof f&&l<=f}],"filter->=":[At,[Vt,Ct],(u,[s,l])=>{const f=u.properties()[s.value],g=l.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[At,[Ct],(u,[s])=>{const l=u.id(),f=s.value;return typeof l==typeof f&&l>=f}],"filter-has":[At,[Ct],(u,[s])=>s.value in u.properties()],"filter-has-id":[At,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[At,[Tn(Vt)],(u,[s])=>s.value.indexOf(u.geometryType())>=0],"filter-id-in":[At,[Tn(Ct)],(u,[s])=>s.value.indexOf(u.id())>=0],"filter-in-small":[At,[Vt,Tn(Ct)],(u,[s,l])=>l.value.indexOf(u.properties()[s.value])>=0],"filter-in-large":[At,[Vt,Tn(Ct)],(u,[s,l])=>function(f,g,x,b){for(;x<=b;){const T=x+b>>1;if(g[T]===f)return!0;g[T]>f?b=T-1:x=T+1}return!1}(u.properties()[s.value],l.value,0,l.value.length-1)],all:{type:At,overloads:[[[At,At],(u,[s,l])=>s.evaluate(u)&&l.evaluate(u)],[ga(At),(u,s)=>{for(const l of s)if(!l.evaluate(u))return!1;return!0}]]},any:{type:At,overloads:[[[At,At],(u,[s,l])=>s.evaluate(u)||l.evaluate(u)],[ga(At),(u,s)=>{for(const l of s)if(l.evaluate(u))return!0;return!1}]]},"!":[At,[At],(u,[s])=>!s.evaluate(u)],"is-supported-script":[At,[Vt],(u,[s])=>{const l=u.globals&&u.globals.isSupportedScript;return!l||l(s.evaluate(u))}],upcase:[Vt,[Vt],(u,[s])=>s.evaluate(u).toUpperCase()],downcase:[Vt,[Vt],(u,[s])=>s.evaluate(u).toLowerCase()],concat:[Vt,ga(Ct),(u,s)=>s.map(l=>qt(l.evaluate(u))).join("")],"resolved-locale":[Vt,[_n],(u,[s])=>s.evaluate(u).resolvedLocale()]});class Pd{constructor(s,l){this.expression=s,this._warningHistory={},this._evaluator=new ud,this._defaultValue=l?function(f){if(f.type==="color"&&hc(f.default))return new or(0,0,0,0);switch(f.type){case"color":return or.parse(f.default)||null;case"padding":return Ln.parse(f.default)||null;case"numberArray":return gi.parse(f.default)||null;case"colorArray":return Sn.parse(f.default)||null;case"variableAnchorOffsetCollection":return mi.parse(f.default)||null;case"projectionDefinition":return si.parse(f.default)||null;default:return f.default===void 0?null:f.default}}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(s,l,f,g,x,b){return this._evaluator.globals=s,this._evaluator.feature=l,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(s,l,f,g,x,b){this._evaluator.globals=s,this._evaluator.feature=l||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Vr(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Pu(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in Ya}function dc(u,s){const l=new Xa(Ya,Eu,[],s?function(g){const x={color:Or,string:Vt,number:rt,enum:Vt,boolean:At,formatted:Pr,padding:rs,numberArray:Bs,colorArray:Pi,projectionDefinition:Ii,resolvedImage:Xr,variableAnchorOffsetCollection:Mo};return g.type==="array"?Tn(x[g.value]||Ct,g.length):x[g.type]}(s):void 0),f=l.parse(u,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?rg(new Pd(f,s)):Ga(l.errors)}class fc{constructor(s,l){this.kind=s,this._styleExpression=l,this.isStateDependent=s!=="constant"&&!uc(l.expression),this.globalStateRefs=mc(l.expression)}evaluateWithoutErrorHandling(s,l,f,g,x,b){return this._styleExpression.evaluateWithoutErrorHandling(s,l,f,g,x,b)}evaluate(s,l,f,g,x,b){return this._styleExpression.evaluate(s,l,f,g,x,b)}}class Cd{constructor(s,l,f,g){this.kind=s,this.zoomStops=f,this._styleExpression=l,this.isStateDependent=s!=="camera"&&!uc(l.expression),this.globalStateRefs=mc(l.expression),this.interpolationType=g}evaluateWithoutErrorHandling(s,l,f,g,x,b){return this._styleExpression.evaluateWithoutErrorHandling(s,l,f,g,x,b)}evaluate(s,l,f,g,x,b){return this._styleExpression.evaluate(s,l,f,g,x,b)}interpolationFactor(s,l,f){return this.interpolationType?Yn.interpolationFactor(this.interpolationType,s,l,f):0}}function ag(u,s){const l=dc(u,s);if(l.result==="error")return l;const f=l.value.expression,g=Au(f);if(!g&&!Oo(s))return Ga([new Dr("","data expressions not supported")]);const x=Iu(f,["zoom"]);if(!x&&!ng(s))return Ga([new Dr("","zoom expressions not supported")]);const b=gc(f);return b||x?b instanceof Dr?Ga([b]):b instanceof Yn&&!Id(s)?Ga([new Dr("",'"interpolate" expressions cannot be used with this property')]):rg(b?new Cd(g?"camera":"composite",l.value,b.labels,b instanceof Yn?b.interpolation:void 0):new fc(g?"constant":"source",l.value)):Ga([new Dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class pc{constructor(s,l){this._parameters=s,this._specification=l,un(this,ig(this._parameters,this._specification))}static deserialize(s){return new pc(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function gc(u){let s=null;if(u instanceof Ql)s=gc(u.result);else if(u instanceof rc){for(const l of u.args)if(s=gc(l),s)break}else(u instanceof hn||u instanceof Yn)&&u.input instanceof is&&u.input.name==="zoom"&&(s=u);return s instanceof Dr||u.eachChild(l=>{const f=gc(l);f instanceof Dr?s=f:!s&&f?s=new Dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&f&&s!==f&&(s=new Dr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function mc(u,s=new Set){return u instanceof cc&&s.add(u.key),u.eachChild(l=>{mc(l,s)}),s}function Cu(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const s of u.slice(1))if(!Cu(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const Md={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ma(u){if(u==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Cu(u)||(u=_a(u));const s=dc(u,Md);if(s.result==="error")throw new Error(s.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,f,g)=>s.value.evaluate(l,f,{},g),needGeometry:Mu(u),getGlobalStateRefs:()=>mc(s.value.expression)}}function Rd(u,s){return u<s?-1:u>s?1:0}function Mu(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let s=1;s<u.length;s++)if(Mu(u[s]))return!0;return!1}function _a(u){if(!u)return!0;const s=u[0];return u.length<=1?s!=="any":s==="=="?kd(u[1],u[2],"=="):s==="!="?Ru(kd(u[1],u[2],"==")):s==="<"||s===">"||s==="<="||s===">="?kd(u[1],u[2],s):s==="any"?(l=u.slice(1),["any"].concat(l.map(_a))):s==="all"?["all"].concat(u.slice(1).map(_a)):s==="none"?["all"].concat(u.slice(1).map(_a).map(Ru)):s==="in"?lg(u[1],u.slice(2)):s==="!in"?Ru(lg(u[1],u.slice(2))):s==="has"?cg(u[1]):s!=="!has"||Ru(cg(u[1]));var l}function kd(u,s,l){switch(u){case"$type":return[`filter-type-${l}`,s];case"$id":return[`filter-id-${l}`,s];default:return[`filter-${l}`,u,s]}}function lg(u,s){if(s.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(l=>typeof l!=typeof s[0])?["filter-in-large",u,["literal",s.sort(Rd)]]:["filter-in-small",u,["literal",s]]}}function cg(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Ru(u){return["!",u]}function Dd(u){const s=typeof u;if(s==="number"||s==="boolean"||s==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let g="[";for(const x of u)g+=`${Dd(x)},`;return`${g}]`}const l=Object.keys(u).sort();let f="{";for(let g=0;g<l.length;g++)f+=`${JSON.stringify(l[g])}:${Dd(u[l[g]])},`;return`${f}}`}function Xy(u){let s="";for(const l of kt)s+=`/${Dd(u[l])}`;return s}function Od(u){const s=u.value;return s?[new $e(u.key,s,"constants have been deprecated as of v8")]:[]}function sn(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function Ws(u){if(Array.isArray(u))return u.map(Ws);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const s={};for(const l in u)s[l]=Ws(u[l]);return s}return sn(u)}function ss(u){const s=u.key,l=u.value,f=u.valueSpec||{},g=u.objectElementValidators||{},x=u.style,b=u.styleSpec,T=u.validateSpec;let A=[];const C=cr(l);if(C!=="object")return[new $e(s,l,`object expected, ${C} found`)];for(const R in l){const O=R.split(".")[0],B=ko(f,O)||f["*"];let V;if(ko(g,O))V=g[O];else if(ko(f,O))V=T;else if(g["*"])V=g["*"];else{if(!f["*"]){A.push(new $e(s,l[R],`unknown property "${R}"`));continue}V=T}A=A.concat(V({key:(s&&`${s}.`)+R,value:l[R],valueSpec:B,style:x,styleSpec:b,object:l,objectKey:R,validateSpec:T},l))}for(const R in f)g[R]||f[R].required&&f[R].default===void 0&&l[R]===void 0&&A.push(new $e(s,l,`missing required property "${R}"`));return A}function ku(u){const s=u.value,l=u.valueSpec,f=u.style,g=u.styleSpec,x=u.key,b=u.arrayElementValidator||u.validateSpec;if(cr(s)!=="array")return[new $e(x,s,`array expected, ${cr(s)} found`)];if(l.length&&s.length!==l.length)return[new $e(x,s,`array length ${l.length} expected, length ${s.length} found`)];if(l["min-length"]&&s.length<l["min-length"])return[new $e(x,s,`array length at least ${l["min-length"]} expected, length ${s.length} found`)];let T={type:l.value,values:l.values};g.$version<7&&(T.function=l.function),cr(l.value)==="object"&&(T=l.value);let A=[];for(let C=0;C<s.length;C++)A=A.concat(b({array:s,arrayIndex:C,value:s[C],valueSpec:T,validateSpec:u.validateSpec,style:f,styleSpec:g,key:`${x}[${C}]`}));return A}function _c(u){const s=u.key,l=u.value,f=u.valueSpec;let g=cr(l);return g==="number"&&l!=l&&(g="NaN"),g!=="number"?[new $e(s,l,`number expected, ${g} found`)]:"minimum"in f&&l<f.minimum?[new $e(s,l,`${l} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&l>f.maximum?[new $e(s,l,`${l} is greater than the maximum value ${f.maximum}`)]:[]}function ug(u){const s=u.valueSpec,l=sn(u.value.type);let f,g,x,b={};const T=l!=="categorical"&&u.value.property===void 0,A=!T,C=cr(u.value.stops)==="array"&&cr(u.value.stops[0])==="array"&&cr(u.value.stops[0][0])==="object",R=ss({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(V){if(l==="identity")return[new $e(V.key,V.value,'identity function may not have a "stops" property')];let j=[];const X=V.value;return j=j.concat(ku({key:V.key,value:X,valueSpec:V.valueSpec,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:O})),cr(X)==="array"&&X.length===0&&j.push(new $e(V.key,X,"array must have at least one stop")),j},default:function(V){return V.validateSpec({key:V.key,value:V.value,valueSpec:s,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec})}}});return l==="identity"&&T&&R.push(new $e(u.key,u.value,'missing required property "property"')),l==="identity"||u.value.stops||R.push(new $e(u.key,u.value,'missing required property "stops"')),l==="exponential"&&u.valueSpec.expression&&!Id(u.valueSpec)&&R.push(new $e(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(A&&!Oo(u.valueSpec)?R.push(new $e(u.key,u.value,"property functions not supported")):T&&!ng(u.valueSpec)&&R.push(new $e(u.key,u.value,"zoom functions not supported"))),l!=="categorical"&&!C||u.value.property!==void 0||R.push(new $e(u.key,u.value,'"property" property is required')),R;function O(V){let j=[];const X=V.value,J=V.key;if(cr(X)!=="array")return[new $e(J,X,`array expected, ${cr(X)} found`)];if(X.length!==2)return[new $e(J,X,`array length 2 expected, length ${X.length} found`)];if(C){if(cr(X[0])!=="object")return[new $e(J,X,`object expected, ${cr(X[0])} found`)];if(X[0].zoom===void 0)return[new $e(J,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new $e(J,X,"object stop key must have value")];if(x&&x>sn(X[0].zoom))return[new $e(J,X[0].zoom,"stop zoom values must appear in ascending order")];sn(X[0].zoom)!==x&&(x=sn(X[0].zoom),g=void 0,b={}),j=j.concat(ss({key:`${J}[0]`,value:X[0],valueSpec:{zoom:{}},validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:_c,value:B}}))}else j=j.concat(B({key:`${J}[0]`,value:X[0],validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec},X));return Pu(Ws(X[1]))?j.concat([new $e(`${J}[1]`,X[1],"expressions are not allowed in function stops.")]):j.concat(V.validateSpec({key:`${J}[1]`,value:X[1],valueSpec:s,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec}))}function B(V,j){const X=cr(V.value),J=sn(V.value),oe=V.value!==null?V.value:j;if(f){if(X!==f)return[new $e(V.key,oe,`${X} stop domain type must match previous stop domain type ${f}`)]}else f=X;if(X!=="number"&&X!=="string"&&X!=="boolean")return[new $e(V.key,oe,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&l!=="categorical"){let Se=`number expected, ${X} found`;return Oo(s)&&l===void 0&&(Se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $e(V.key,oe,Se)]}return l!=="categorical"||X!=="number"||isFinite(J)&&Math.floor(J)===J?l!=="categorical"&&X==="number"&&g!==void 0&&J<g?[new $e(V.key,oe,"stop domain values must appear in ascending order")]:(g=J,l==="categorical"&&J in b?[new $e(V.key,oe,"stop domain values must be unique")]:(b[J]=!0,[])):[new $e(V.key,oe,`integer expected, found ${J}`)]}}function ya(u){const s=(u.expressionContext==="property"?ag:dc)(Ws(u.value),u.valueSpec);if(s.result==="error")return s.value.map(f=>new $e(`${u.key}${f.key}`,u.value,f.message));const l=s.value.expression||s.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!l.outputDefined())return[new $e(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!uc(l))return[new $e(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!uc(l))return[new $e(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!Iu(l,["zoom","feature-state"]))return[new $e(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!Au(l))return[new $e(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Du(u){const s=u.key,l=u.value,f=cr(l);return f!=="string"?[new $e(s,l,`color expected, ${f} found`)]:or.parse(String(l))?[]:[new $e(s,l,`color expected, "${l}" found`)]}function lo(u){const s=u.key,l=u.value,f=u.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(sn(l))===-1&&g.push(new $e(s,l,`expected one of [${f.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(f.values).indexOf(sn(l))===-1&&g.push(new $e(s,l,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(l)} found`)),g}function Fd(u){return Cu(Ws(u.value))?ya(un({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):hg(u)}function hg(u){const s=u.value,l=u.key;if(cr(s)!=="array")return[new $e(l,s,`array expected, ${cr(s)} found`)];const f=u.styleSpec;let g,x=[];if(s.length<1)return[new $e(l,s,"filter array must have at least 1 element")];switch(x=x.concat(lo({key:`${l}[0]`,value:s[0],valueSpec:f.filter_operator,style:u.style,styleSpec:u.styleSpec})),sn(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&sn(s[1])==="$type"&&x.push(new $e(l,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&x.push(new $e(l,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(g=cr(s[1]),g!=="string"&&x.push(new $e(`${l}[1]`,s[1],`string expected, ${g} found`)));for(let b=2;b<s.length;b++)g=cr(s[b]),sn(s[1])==="$type"?x=x.concat(lo({key:`${l}[${b}]`,value:s[b],valueSpec:f.geometry_type,style:u.style,styleSpec:u.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&x.push(new $e(`${l}[${b}]`,s[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<s.length;b++)x=x.concat(hg({key:`${l}[${b}]`,value:s[b],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":g=cr(s[1]),s.length!==2?x.push(new $e(l,s,`filter array for "${s[0]}" operator must have 2 elements`)):g!=="string"&&x.push(new $e(`${l}[1]`,s[1],`string expected, ${g} found`))}return x}function dg(u,s){const l=u.key,f=u.validateSpec,g=u.style,x=u.styleSpec,b=u.value,T=u.objectKey,A=x[`${s}_${u.layerType}`];if(!A)return[];const C=T.match(/^(.*)-transition$/);if(s==="paint"&&C&&A[C[1]]&&A[C[1]].transition)return f({key:l,value:b,valueSpec:x.transition,style:g,styleSpec:x});const R=u.valueSpec||A[T];if(!R)return[new $e(l,b,`unknown property "${T}"`)];let O;if(cr(b)==="string"&&Oo(R)&&!R.tokens&&(O=/^{([^}]+)}$/.exec(b)))return[new $e(l,b,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const B=[];return u.layerType==="symbol"&&(T==="text-field"&&g&&!g.glyphs&&B.push(new $e(l,b,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&hc(Ws(b))&&sn(b.type)==="identity"&&B.push(new $e(l,b,'"text-font" does not support identity functions'))),B.concat(f({key:u.key,value:b,valueSpec:R,style:g,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:T}))}function fg(u){return dg(u,"paint")}function pg(u){return dg(u,"layout")}function gg(u){let s=[];const l=u.value,f=u.key,g=u.style,x=u.styleSpec;if(cr(l)!=="object")return[new $e(f,l,`object expected, ${cr(l)} found`)];l.type||l.ref||s.push(new $e(f,l,'either "type" or "ref" is required'));let b=sn(l.type);const T=sn(l.ref);if(l.id){const A=sn(l.id);for(let C=0;C<u.arrayIndex;C++){const R=g.layers[C];sn(R.id)===A&&s.push(new $e(f,l.id,`duplicate layer id "${l.id}", previously used at line ${R.id.__line__}`))}}if("ref"in l){let A;["type","source","source-layer","filter","layout"].forEach(C=>{C in l&&s.push(new $e(f,l[C],`"${C}" is prohibited for ref layers`))}),g.layers.forEach(C=>{sn(C.id)===T&&(A=C)}),A?A.ref?s.push(new $e(f,l.ref,"ref cannot reference another ref layer")):b=sn(A.type):s.push(new $e(f,l.ref,`ref layer "${T}" not found`))}else if(b!=="background")if(l.source){const A=g.sources&&g.sources[l.source],C=A&&sn(A.type);A?C==="vector"&&b==="raster"?s.push(new $e(f,l.source,`layer "${l.id}" requires a raster source`)):C!=="raster-dem"&&b==="hillshade"||C!=="raster-dem"&&b==="color-relief"?s.push(new $e(f,l.source,`layer "${l.id}" requires a raster-dem source`)):C==="raster"&&b!=="raster"?s.push(new $e(f,l.source,`layer "${l.id}" requires a vector source`)):C!=="vector"||l["source-layer"]?C==="raster-dem"&&b!=="hillshade"&&b!=="color-relief"?s.push(new $e(f,l.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):b!=="line"||!l.paint||!l.paint["line-gradient"]||C==="geojson"&&A.lineMetrics||s.push(new $e(f,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new $e(f,l,`layer "${l.id}" must specify a "source-layer"`)):s.push(new $e(f,l.source,`source "${l.source}" not found`))}else s.push(new $e(f,l,'missing required property "source"'));return s=s.concat(ss({key:f,value:l,valueSpec:x.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${f}.type`,value:l.type,valueSpec:x.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:l,objectKey:"type"}),filter:Fd,layout:A=>ss({layer:l,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":C=>pg(un({layerType:b},C))}}),paint:A=>ss({layer:l,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":C=>fg(un({layerType:b},C))}})}})),s}function ms(u){const s=u.value,l=u.key,f=cr(s);return f!=="string"?[new $e(l,s,`string expected, ${f} found`)]:[]}const Ka={promoteId:function({key:u,value:s}){if(cr(s)==="string")return ms({key:u,value:s});{const l=[];for(const f in s)l.push(...ms({key:`${u}.${f}`,value:s[f]}));return l}}};function Ci(u){const s=u.value,l=u.key,f=u.styleSpec,g=u.style,x=u.validateSpec;if(!s.type)return[new $e(l,s,'"type" is required')];const b=sn(s.type);let T;switch(b){case"vector":case"raster":return T=ss({key:l,value:s,valueSpec:f[`source_${b.replace("-","_")}`],style:u.style,styleSpec:f,objectElementValidators:Ka,validateSpec:x}),T;case"raster-dem":return T=function(A){var C;const R=(C=A.sourceName)!==null&&C!==void 0?C:"",O=A.value,B=A.styleSpec,V=B.source_raster_dem,j=A.style;let X=[];const J=cr(O);if(O===void 0)return X;if(J!=="object")return X.push(new $e("source_raster_dem",O,`object expected, ${J} found`)),X;const oe=sn(O.encoding)==="custom",Se=["redFactor","greenFactor","blueFactor","baseShift"],fe=A.value.encoding?`"${A.value.encoding}"`:"Default";for(const _e in O)!oe&&Se.includes(_e)?X.push(new $e(_e,O[_e],`In "${R}": "${_e}" is only valid when "encoding" is set to "custom". ${fe} encoding found`)):V[_e]?X=X.concat(A.validateSpec({key:_e,value:O[_e],valueSpec:V[_e],validateSpec:A.validateSpec,style:j,styleSpec:B})):X.push(new $e(_e,O[_e],`unknown property "${_e}"`));return X}({sourceName:l,value:s,style:u.style,styleSpec:f,validateSpec:x}),T;case"geojson":if(T=ss({key:l,value:s,valueSpec:f.source_geojson,style:g,styleSpec:f,validateSpec:x,objectElementValidators:Ka}),s.cluster)for(const A in s.clusterProperties){const[C,R]=s.clusterProperties[A],O=typeof C=="string"?[C,["accumulated"],["get",A]]:C;T.push(...ya({key:`${l}.${A}.map`,value:R,expressionContext:"cluster-map"})),T.push(...ya({key:`${l}.${A}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return T;case"video":return ss({key:l,value:s,valueSpec:f.source_video,style:g,validateSpec:x,styleSpec:f});case"image":return ss({key:l,value:s,valueSpec:f.source_image,style:g,validateSpec:x,styleSpec:f});case"canvas":return[new $e(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return lo({key:`${l}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Qa(u){const s=u.value,l=u.styleSpec,f=l.light,g=u.style;let x=[];const b=cr(s);if(s===void 0)return x;if(b!=="object")return x=x.concat([new $e("light",s,`object expected, ${b} found`)]),x;for(const T in s){const A=T.match(/^(.*)-transition$/);x=x.concat(A&&f[A[1]]&&f[A[1]].transition?u.validateSpec({key:T,value:s[T],valueSpec:l.transition,validateSpec:u.validateSpec,style:g,styleSpec:l}):f[T]?u.validateSpec({key:T,value:s[T],valueSpec:f[T],validateSpec:u.validateSpec,style:g,styleSpec:l}):[new $e(T,s[T],`unknown property "${T}"`)])}return x}function Nd(u){const s=u.value,l=u.styleSpec,f=l.sky,g=u.style,x=cr(s);if(s===void 0)return[];if(x!=="object")return[new $e("sky",s,`object expected, ${x} found`)];let b=[];for(const T in s)b=b.concat(f[T]?u.validateSpec({key:T,value:s[T],valueSpec:f[T],style:g,styleSpec:l}):[new $e(T,s[T],`unknown property "${T}"`)]);return b}function mg(u){const s=u.value,l=u.styleSpec,f=l.terrain,g=u.style;let x=[];const b=cr(s);if(s===void 0)return x;if(b!=="object")return x=x.concat([new $e("terrain",s,`object expected, ${b} found`)]),x;for(const T in s)x=x.concat(f[T]?u.validateSpec({key:T,value:s[T],valueSpec:f[T],validateSpec:u.validateSpec,style:g,styleSpec:l}):[new $e(T,s[T],`unknown property "${T}"`)]);return x}function _g(u){let s=[];const l=u.value,f=u.key;if(Array.isArray(l)){const g=[],x=[];for(const b in l)l[b].id&&g.includes(l[b].id)&&s.push(new $e(f,l,`all the sprites' ids must be unique, but ${l[b].id} is duplicated`)),g.push(l[b].id),l[b].url&&x.includes(l[b].url)&&s.push(new $e(f,l,`all the sprites' URLs must be unique, but ${l[b].url} is duplicated`)),x.push(l[b].url),s=s.concat(ss({key:`${f}[${b}]`,value:l[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return s}return ms({key:f,value:l})}function Ja(u){return s=u.value,s&&s.constructor===Object?[]:[new $e(u.key,u.value,`object expected, ${cr(u.value)} found`)];var s}const Ld={"*":()=>[],array:ku,boolean:function(u){const s=u.value,l=u.key,f=cr(s);return f!=="boolean"?[new $e(l,s,`boolean expected, ${f} found`)]:[]},number:_c,color:Du,constants:Od,enum:lo,filter:Fd,function:ug,layer:gg,object:ss,source:Ci,light:Qa,sky:Nd,terrain:mg,projection:function(u){const s=u.value,l=u.styleSpec,f=l.projection,g=u.style,x=cr(s);if(s===void 0)return[];if(x!=="object")return[new $e("projection",s,`object expected, ${x} found`)];let b=[];for(const T in s)b=b.concat(f[T]?u.validateSpec({key:T,value:s[T],valueSpec:f[T],style:g,styleSpec:l}):[new $e(T,s[T],`unknown property "${T}"`)]);return b},projectionDefinition:function(u){const s=u.key;let l=u.value;l=l instanceof String?l.valueOf():l;const f=cr(l);return f!=="array"||function(g){return Array.isArray(g)&&g.length===3&&typeof g[0]=="string"&&typeof g[1]=="string"&&typeof g[2]=="number"}(l)||function(g){return!!["interpolate","step","literal"].includes(g[0])}(l)?["array","string"].includes(f)?[]:[new $e(s,l,`projection expected, invalid type "${f}" found`)]:[new $e(s,l,`projection expected, invalid array ${JSON.stringify(l)} found`)]},string:ms,formatted:function(u){return ms(u).length===0?[]:ya(u)},resolvedImage:function(u){return ms(u).length===0?[]:ya(u)},padding:function(u){const s=u.key,l=u.value;if(cr(l)==="array"){if(l.length<1||l.length>4)return[new $e(s,l,`padding requires 1 to 4 values; ${l.length} values found`)];const f={type:"number"};let g=[];for(let x=0;x<l.length;x++)g=g.concat(u.validateSpec({key:`${s}[${x}]`,value:l[x],validateSpec:u.validateSpec,valueSpec:f}));return g}return _c({key:s,value:l,valueSpec:{}})},numberArray:function(u){const s=u.key,l=u.value;if(cr(l)==="array"){const f={type:"number"};if(l.length<1)return[new $e(s,l,"array length at least 1 expected, length 0 found")];let g=[];for(let x=0;x<l.length;x++)g=g.concat(u.validateSpec({key:`${s}[${x}]`,value:l[x],validateSpec:u.validateSpec,valueSpec:f}));return g}return _c({key:s,value:l,valueSpec:{}})},colorArray:function(u){const s=u.key,l=u.value;if(cr(l)==="array"){if(l.length<1)return[new $e(s,l,"array length at least 1 expected, length 0 found")];let f=[];for(let g=0;g<l.length;g++)f=f.concat(Du({key:`${s}[${g}]`,value:l[g]}));return f}return Du({key:s,value:l})},variableAnchorOffsetCollection:function(u){const s=u.key,l=u.value,f=cr(l),g=u.styleSpec;if(f!=="array"||l.length<1||l.length%2!=0)return[new $e(s,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let x=[];for(let b=0;b<l.length;b+=2)x=x.concat(lo({key:`${s}[${b}]`,value:l[b],valueSpec:g.layout_symbol["text-anchor"]})),x=x.concat(ku({key:`${s}[${b+1}]`,value:l[b+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:g}));return x},sprite:_g,state:Ja};function el(u){const s=u.value,l=u.valueSpec,f=u.styleSpec;return u.validateSpec=el,l.expression&&hc(sn(s))?ug(u):l.expression&&Pu(Ws(s))?ya(u):l.type&&Ld[l.type]?Ld[l.type](u):ss(un({},u,{valueSpec:l.type?f[l.type]:l}))}function yg(u){const s=u.value,l=u.key,f=ms(u);return f.length||(s.indexOf("{fontstack}")===-1&&f.push(new $e(l,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&f.push(new $e(l,s,'"glyphs" url must include a "{range}" token'))),f}function Mi(u,s=Te){let l=[];return l=l.concat(el({key:"",value:u,valueSpec:s.$root,styleSpec:s,style:u,validateSpec:el,objectElementValidators:{glyphs:yg,"*":()=>[]}})),u.constants&&(l=l.concat(Od({key:"constants",value:u.constants}))),tl(l)}function _s(u){return function(s){return u({...s,validateSpec:el})}}function tl(u){return[].concat(u).sort((s,l)=>s.line-l.line)}function ys(u){return function(...s){return tl(u.apply(this,s))}}Mi.source=ys(_s(Ci)),Mi.sprite=ys(_s(_g)),Mi.glyphs=ys(_s(yg)),Mi.light=ys(_s(Qa)),Mi.sky=ys(_s(Nd)),Mi.terrain=ys(_s(mg)),Mi.state=ys(_s(Ja)),Mi.layer=ys(_s(gg)),Mi.filter=ys(_s(Fd)),Mi.paintProperty=ys(_s(fg)),Mi.layoutProperty=ys(_s(pg));const rl=Mi,Zy=rl.light,yc=rl.sky,qy=rl.paintProperty,Yy=rl.layoutProperty;function vc(u,s){let l=!1;if(s&&s.length)for(const f of s)u.fire(new Ve(new Error(f.message))),l=!0;return l}class xc{constructor(s,l,f){const g=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const b=new Int32Array(this.arrayBuffer);s=b[0],this.d=(l=b[1])+2*(f=b[2]);for(let A=0;A<this.d*this.d;A++){const C=b[3+A],R=b[3+A+1];g.push(C===R?null:b.subarray(C,R))}const T=b[3+g.length+1];this.keys=b.subarray(b[3+g.length],T),this.bboxes=b.subarray(T),this.insert=this._insertReadonly}else{this.d=l+2*f;for(let b=0;b<this.d*this.d;b++)g.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=s,this.padding=f,this.scale=l/s,this.uid=0;const x=f/l*s;this.min=-x,this.max=s+x}insert(s,l,f,g,x){this._forEachCell(l,f,g,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,l,f,g,x,b){this.cells[x].push(b)}query(s,l,f,g,x){const b=this.min,T=this.max;if(s<=b&&l<=b&&T<=f&&T<=g&&!x)return Array.prototype.slice.call(this.keys);{const A=[];return this._forEachCell(s,l,f,g,this._queryCell,A,{},x),A}}_queryCell(s,l,f,g,x,b,T,A){const C=this.cells[x];if(C!==null){const R=this.keys,O=this.bboxes;for(let B=0;B<C.length;B++){const V=C[B];if(T[V]===void 0){const j=4*V;(A?A(O[j+0],O[j+1],O[j+2],O[j+3]):s<=O[j+2]&&l<=O[j+3]&&f>=O[j+0]&&g>=O[j+1])?(T[V]=!0,b.push(R[V])):T[V]=!1}}}}_forEachCell(s,l,f,g,x,b,T,A){const C=this._convertToCellCoord(s),R=this._convertToCellCoord(l),O=this._convertToCellCoord(f),B=this._convertToCellCoord(g);for(let V=C;V<=O;V++)for(let j=R;j<=B;j++){const X=this.d*j+V;if((!A||A(this._convertFromCellCoord(V),this._convertFromCellCoord(j),this._convertFromCellCoord(V+1),this._convertFromCellCoord(j+1)))&&x.call(this,s,l,f,g,X,b,T,A))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,l=3+this.cells.length+1+1;let f=0;for(let b=0;b<this.cells.length;b++)f+=this.cells[b].length;const g=new Int32Array(l+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let x=l;for(let b=0;b<s.length;b++){const T=s[b];g[3+b]=x,g.set(T,x),x+=T.length}return g[3+s.length]=x,g.set(this.keys,x),x+=this.keys.length,g[3+s.length+1]=x,g.set(this.bboxes,x),x+=this.bboxes.length,g.buffer}static serialize(s,l){const f=s.toArrayBuffer();return l&&l.push(f),{buffer:f}}static deserialize(s){return new xc(s.buffer)}}const vs={};function pt(u,s,l={}){if(vs[u])throw new Error(`${u} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:u,writeable:!1}),vs[u]={klass:s,omit:l.omit||[],shallow:l.shallow||[]}}pt("Object",Object),pt("Set",Set),pt("TransferableGridIndex",xc),pt("Color",or),pt("Error",Error),pt("AJAXError",se),pt("ResolvedImage",$i),pt("StylePropertyFunction",pc),pt("StyleExpression",Pd,{omit:["_evaluator"]}),pt("ZoomDependentExpression",Cd),pt("ZoomConstantExpression",fc),pt("CompoundExpression",is,{omit:["_evaluate"]});for(const u in Ya)Ya[u]._classRegistryKey||pt(`Expression_${u}`,Ya[u]);function zd(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function Ou(u){return u.$name||u.constructor._classRegistryKey}function Bd(u){return!function(s){if(s===null||typeof s!="object")return!1;const l=Ou(s);return!(!l||l==="Object")}(u)&&(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||zd(u)||Jt(u)||ArrayBuffer.isView(u)||u instanceof ImageData)}function nl(u,s){if(Bd(u))return(zd(u)||Jt(u))&&s&&s.push(u),ArrayBuffer.isView(u)&&s&&s.push(u.buffer),u instanceof ImageData&&s&&s.push(u.data.buffer),u;if(Array.isArray(u)){const x=[];for(const b of u)x.push(nl(b,s));return x}if(typeof u!="object")throw new Error("can't serialize object of type "+typeof u);const l=Ou(u);if(!l)throw new Error(`can't serialize object of unregistered class ${u.constructor.name}`);if(!vs[l])throw new Error(`${l} is not registered.`);const{klass:f}=vs[l],g=f.serialize?f.serialize(u,s):{};if(f.serialize){if(s&&g===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in u){if(!u.hasOwnProperty(x)||vs[l].omit.indexOf(x)>=0)continue;const b=u[x];g[x]=vs[l].shallow.indexOf(x)>=0?b:nl(b,s)}u instanceof Error&&(g.message=u.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(g.$name=l),g}function va(u){if(Bd(u))return u;if(Array.isArray(u))return u.map(va);if(typeof u!="object")throw new Error("can't deserialize object of type "+typeof u);const s=Ou(u)||"Object";if(!vs[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:l}=vs[s];if(!l)throw new Error(`can't deserialize unregistered class ${s}`);if(l.deserialize)return l.deserialize(u);const f=Object.create(l.prototype);for(const g of Object.keys(u)){if(g==="$name")continue;const x=u[g];f[g]=vs[s].shallow.indexOf(g)>=0?x:va(x)}return f}class Fu{constructor(){this.first=!0}update(s,l){const f=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=l),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=f,!0))}}const ur={"Latin-1 Supplement":u=>u>=128&&u<=255,"Hangul Jamo":u=>u>=4352&&u<=4607,Khmer:u=>u>=6016&&u<=6143,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Kanbun:u=>u>=12688&&u<=12703,"CJK Strokes":u=>u>=12736&&u<=12783,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Hangul Syllables":u=>u>=44032&&u<=55215,"Private Use Area":u=>u>=57344&&u<=63743,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function Nu(u){for(const s of u)if(Vd(s.charCodeAt(0)))return!0;return!1}function Gy(u){for(const s of u)if(!vg(s.charCodeAt(0)))return!1;return!0}function Lu(u){const s=u.map(l=>{try{return new RegExp(`\\p{sc=${l}}`,"u").source}catch{return null}}).filter(l=>l);return new RegExp(s.join("|"),"u")}const Ky=Lu(["Arab","Dupl","Mong","Ougr","Syrc"]);function vg(u){return!Ky.test(String.fromCodePoint(u))}const Ud=Lu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Vd(u){return!(u!==746&&u!==747&&(u<4352||!(ur["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||ur["CJK Compatibility"](u)||ur["CJK Strokes"](u)||!(!ur["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||ur["Enclosed CJK Letters and Months"](u)||ur["Ideographic Description Characters"](u)||ur.Kanbun(u)||ur.Katakana(u)&&u!==12540||!(!ur["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!ur["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||ur["Vertical Forms"](u)||ur["Yijing Hexagram Symbols"](u)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(u))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(u))||Ud.test(String.fromCodePoint(u)))))}function xg(u){return!(Vd(u)||function(s){return!!(ur["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||ur["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||ur["Letterlike Symbols"](s)||ur["Number Forms"](s)||ur["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||ur["Control Pictures"](s)&&s!==9251||ur["Optical Character Recognition"](s)||ur["Enclosed Alphanumerics"](s)||ur["Geometric Shapes"](s)||ur["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||ur["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||ur["CJK Symbols and Punctuation"](s)||ur.Katakana(s)||ur["Private Use Area"](s)||ur["CJK Compatibility Forms"](s)||ur["Small Form Variants"](s)||ur["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(u))}const bg=Lu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function jd(u){return bg.test(String.fromCodePoint(u))}function wg(u,s){return!(!s&&jd(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||ur.Khmer(u))}function Tg(u){for(const s of u)if(jd(s.charCodeAt(0)))return!0;return!1}const xs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){if(xs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(u,s){return a(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(u.pluginStatus!=="loading")return this.setState(u),u;const l=u.pluginURL,f=new Promise(x=>{this.loadScriptResolve=x});s(l);const g=new Promise(x=>setTimeout(()=>x(),this.TIMEOUT));if(yield Promise.race([f,g]),this.isParsed()){const x={pluginStatus:"loaded",pluginURL:l};return this.setState(x),x}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${l}`)})}};class jr{constructor(s,l){this.zoom=s,l?(this.now=l.now||0,this.fadeDuration=l.fadeDuration||0,this.zoomHistory=l.zoomHistory||new Fu,this.transition=l.transition||{},this.globalState=l.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Fu,this.transition={},this.globalState={})}isSupportedScript(s){return function(l,f){for(const g of l)if(!wg(g.charCodeAt(0),f))return!1;return!0}(s,xs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,l=s-Math.floor(s),f=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*l}}}class il{constructor(s,l){this.property=s,this.value=l,this.expression=function(f,g){if(hc(f))return new pc(f,g);if(Pu(f)){const x=ag(f,g);if(x.result==="error")throw new Error(x.value.map(b=>`${b.key}: ${b.message}`).join(", "));return x.value}{let x=f;return g.type==="color"&&typeof f=="string"?x=or.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?g.type!=="numberArray"||typeof f!="number"&&!Array.isArray(f)?g.type!=="colorArray"||typeof f!="string"&&!Array.isArray(f)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(f)?x=mi.parse(f):g.type==="projectionDefinition"&&typeof f=="string"&&(x=si.parse(f)):x=Sn.parse(f):x=gi.parse(f):x=Ln.parse(f),{globalStateRefs:new Set,kind:"constant",evaluate:()=>x}}}(l===void 0?s.specification.default:l,s.specification),this._evaluate=this.expression.evaluate}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(s,l,f){return this.property.possiblyEvaluate(this,s,l,f)}setGlobalState(s){this.expression.evaluate=(l,f,g,x,b,T)=>(l.globalState=s,this._evaluate.call(this.expression,l,f,g,x,b,T))}}class $d{constructor(s){this.property=s,this.value=new il(s,void 0)}transitioned(s,l){return new Wd(this.property,this.value,l,Wt({},s.transition,this.transition),s.now)}untransitioned(){return new Wd(this.property,this.value,null,{},0)}}class Sg{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return pr(this._values[s].value.value)}setValue(s,l){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new $d(this._values[s].property)),this._values[s].value=new il(this._values[s].property,l===null?void 0:pr(l))}getTransition(s){return pr(this._values[s].transition)}setTransition(s,l){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new $d(this._values[s].property)),this._values[s].transition=pr(l)||void 0}serialize(){const s={};for(const l of Object.keys(this._values)){const f=this.getValue(l);f!==void 0&&(s[l]=f);const g=this.getTransition(l);g!==void 0&&(s[`${l}-transition`]=g)}return s}transitioned(s,l){const f=new Hd(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(s,l._values[g]);return f}untransitioned(){const s=new Hd(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].untransitioned();return s}}class Wd{constructor(s,l,f,g,x){this.property=s,this.value=l,this.begin=x+g.delay||0,this.end=this.begin+g.duration||0,s.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(s,l,f){const g=s.now||0,x=this.value.possiblyEvaluate(s,l,f),b=this.prior;if(b){if(g>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(g<this.begin)return b.possiblyEvaluate(s,l,f);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(s,l,f),x,_r(T))}}return x}}class Hd{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,l,f){const g=new zu(this._properties);for(const x of Object.keys(this._values))g._values[x]=this._values[x].possiblyEvaluate(s,l,f);return g}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class Eg{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues),this._globalState={}}hasValue(s){return this._values[s].value!==void 0}getValue(s){return pr(this._values[s].value)}setValue(s,l){this._values[s]=new il(this._values[s].property,l===null?void 0:pr(l)),this._values[s].setGlobalState(this._globalState)}serialize(){const s={};for(const l of Object.keys(this._values)){const f=this.getValue(l);f!==void 0&&(s[l]=f)}return s}possiblyEvaluate(s,l,f){const g=new zu(this._properties);for(const x of Object.keys(this._values))g._values[x]=this._values[x].possiblyEvaluate(s,l,f);return g}setGlobalState(s){this._globalState=s;for(const l of Object.values(this._values))l.setGlobalState(s)}}class Hs{constructor(s,l,f){this.property=s,this.value=l,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,l,f,g){return this.property.evaluate(this.value,this.parameters,s,l,f,g)}}class zu{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class St{constructor(s){this.specification=s}possiblyEvaluate(s,l){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(l)}interpolate(s,l,f){const g=$s[this.specification.type];return g?g(s,l,f):s}}class Nt{constructor(s,l){this.specification=s,this.overrides=l}possiblyEvaluate(s,l,f,g){return new Hs(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(l,null,{},f,g)}:s.expression,l)}interpolate(s,l,f){if(s.value.kind!=="constant"||l.value.kind!=="constant")return s;if(s.value.value===void 0||l.value.value===void 0)return new Hs(this,{kind:"constant",value:void 0},s.parameters);const g=$s[this.specification.type];if(g){const x=g(s.value.value,l.value.value,f);return new Hs(this,{kind:"constant",value:x},s.parameters)}return s}evaluate(s,l,f,g,x,b){return s.kind==="constant"?s.value:s.evaluate(l,f,g,x,b)}}class Bu extends Nt{possiblyEvaluate(s,l,f,g){if(s.value===void 0)return new Hs(this,{kind:"constant",value:void 0},l);if(s.expression.kind==="constant"){const x=s.expression.evaluate(l,null,{},f,g),b=s.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,T=this._calculate(b,b,b,l);return new Hs(this,{kind:"constant",value:T},l)}if(s.expression.kind==="camera"){const x=this._calculate(s.expression.evaluate({zoom:l.zoom-1}),s.expression.evaluate({zoom:l.zoom}),s.expression.evaluate({zoom:l.zoom+1}),l);return new Hs(this,{kind:"constant",value:x},l)}return new Hs(this,s.expression,l)}evaluate(s,l,f,g,x,b){if(s.kind==="source"){const T=s.evaluate(l,f,g,x,b);return this._calculate(T,T,T,l)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(l.zoom)-1},f,g),s.evaluate({zoom:Math.floor(l.zoom)},f,g),s.evaluate({zoom:Math.floor(l.zoom)+1},f,g),l):s.value}_calculate(s,l,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:s,to:l}:{from:f,to:l}}interpolate(s){return s}}class No{constructor(s){this.specification=s}possiblyEvaluate(s,l,f,g){if(s.value!==void 0){if(s.expression.kind==="constant"){const x=s.expression.evaluate(l,null,{},f,g);return this._calculate(x,x,x,l)}return this._calculate(s.expression.evaluate(new jr(Math.floor(l.zoom-1),l)),s.expression.evaluate(new jr(Math.floor(l.zoom),l)),s.expression.evaluate(new jr(Math.floor(l.zoom+1),l)),l)}}_calculate(s,l,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:s,to:l}:{from:f,to:l}}interpolate(s){return s}}class Uu{constructor(s){this.specification=s}possiblyEvaluate(s,l,f,g){return!!s.expression.evaluate(l,null,{},f,g)}interpolate(){return!1}}class _i{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in s){const f=s[l];f.specification.overridable&&this.overridableProperties.push(l);const g=this.defaultPropertyValues[l]=new il(f,void 0),x=this.defaultTransitionablePropertyValues[l]=new $d(f);this.defaultTransitioningPropertyValues[l]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=g.possiblyEvaluate({})}}}pt("DataDrivenProperty",Nt),pt("DataConstantProperty",St),pt("CrossFadedDataDrivenProperty",Bu),pt("CrossFadedProperty",No),pt("ColorRampProperty",Uu);const Ag="-transition";class os extends ft{constructor(s,l){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,this._globalState={},s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter,this._featureFilter=ma(s.filter)),l.layout&&(this._unevaluatedLayout=new Eg(l.layout)),l.paint)){this._transitionablePaint=new Sg(l.paint);for(const f in s.paint)this.setPaintProperty(f,s.paint[f],{validate:!1});for(const f in s.layout)this.setLayoutProperty(f,s.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new zu(l.paint)}}setFilter(s){this.filter=s,this._featureFilter=ma(s)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}getLayoutAffectingGlobalStateRefs(){const s=new Set;if(this._unevaluatedLayout)for(const l in this._unevaluatedLayout._values){const f=this._unevaluatedLayout._values[l];for(const g of f.getGlobalStateRefs())s.add(g)}for(const l of this._featureFilter.getGlobalStateRefs())s.add(l);return s}getPaintAffectingGlobalStateRefs(){var s;const l=new globalThis.Map;if(this._transitionablePaint)for(const f in this._transitionablePaint._values){const g=this._transitionablePaint._values[f].value;for(const x of g.getGlobalStateRefs()){const b=(s=l.get(x))!==null&&s!==void 0?s:[];b.push({name:f,value:g.value}),l.set(x,b)}}return l}setLayoutProperty(s,l,f={}){l!=null&&this._validate(Yy,`layers.${this.id}.layout.${s}`,s,l,f)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,l):this.visibility=l)}getPaintProperty(s){return s.endsWith(Ag)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,l,f={}){if(l!=null&&this._validate(qy,`layers.${this.id}.paint.${s}`,s,l,f))return!1;if(s.endsWith(Ag))return this._transitionablePaint.setTransition(s.slice(0,-11),l||void 0),!1;{const g=this._transitionablePaint._values[s],x=g.property.specification["property-type"]==="cross-faded-data-driven",b=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(s,l),this._handleSpecialPaintPropertyUpdate(s);const A=this._transitionablePaint._values[s].value;return A.isDataDriven()||b||x||this._handleOverridablePaintPropertyUpdate(s,T,A)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,l,f){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,l){s.globalState=this._globalState,s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,l)}setGlobalState(s){this._globalState=s,this._unevaluatedLayout&&this._unevaluatedLayout.setGlobalState(s)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),en(s,(l,f)=>!(l===void 0||f==="layout"&&!Object.keys(l).length||f==="paint"&&!Object.keys(l).length))}_validate(s,l,f,g,x={}){return(!x||x.validate!==!1)&&vc(this,s.call(rl,{key:l,layerType:this.type,objectKey:f,value:g,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const l=this.paint.get(s);if(l instanceof Hs&&Oo(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const Qy={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class bc{constructor(s,l){this._structArray=s,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Lr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,l){return s._trim(),l&&(s.isTransferred=!0,l.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const l=Object.create(this.prototype);return l.arrayBuffer=s.arrayBuffer,l.length=s.length,l.capacity=s.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function dn(u,s=1){let l=0,f=0;return{members:u.map(g=>{const x=Qy[g.type].BYTES_PER_ELEMENT,b=l=Vu(l,Math.max(s,x)),T=g.components||1;return f=Math.max(f,x),l+=x*T,{name:g.name,type:g.type,components:T,offset:b}}),size:Vu(l,Math.max(f,s)),alignment:s}}function Vu(u,s){return Math.ceil(u/s)*s}class sl extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l){const f=this.length;return this.resize(f+1),this.emplace(f,s,l)}emplace(s,l,f){const g=2*s;return this.int16[g+0]=l,this.int16[g+1]=f,s}}sl.prototype.bytesPerElement=4,pt("StructArrayLayout2i4",sl);class ol extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,s,l,f)}emplace(s,l,f,g){const x=3*s;return this.int16[x+0]=l,this.int16[x+1]=f,this.int16[x+2]=g,s}}ol.prototype.bytesPerElement=6,pt("StructArrayLayout3i6",ol);class Xd extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,s,l,f,g)}emplace(s,l,f,g,x){const b=4*s;return this.int16[b+0]=l,this.int16[b+1]=f,this.int16[b+2]=g,this.int16[b+3]=x,s}}Xd.prototype.bytesPerElement=8,pt("StructArrayLayout4i8",Xd);class al extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,g,x,b){const T=this.length;return this.resize(T+1),this.emplace(T,s,l,f,g,x,b)}emplace(s,l,f,g,x,b,T){const A=6*s;return this.int16[A+0]=l,this.int16[A+1]=f,this.int16[A+2]=g,this.int16[A+3]=x,this.int16[A+4]=b,this.int16[A+5]=T,s}}al.prototype.bytesPerElement=12,pt("StructArrayLayout2i4i12",al);class xa extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,g,x,b){const T=this.length;return this.resize(T+1),this.emplace(T,s,l,f,g,x,b)}emplace(s,l,f,g,x,b,T){const A=4*s,C=8*s;return this.int16[A+0]=l,this.int16[A+1]=f,this.uint8[C+4]=g,this.uint8[C+5]=x,this.uint8[C+6]=b,this.uint8[C+7]=T,s}}xa.prototype.bytesPerElement=8,pt("StructArrayLayout2i4ub8",xa);class wc extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l){const f=this.length;return this.resize(f+1),this.emplace(f,s,l)}emplace(s,l,f){const g=2*s;return this.float32[g+0]=l,this.float32[g+1]=f,s}}wc.prototype.bytesPerElement=8,pt("StructArrayLayout2f8",wc);class ju extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,f,g,x,b,T,A,C,R){const O=this.length;return this.resize(O+1),this.emplace(O,s,l,f,g,x,b,T,A,C,R)}emplace(s,l,f,g,x,b,T,A,C,R,O){const B=10*s;return this.uint16[B+0]=l,this.uint16[B+1]=f,this.uint16[B+2]=g,this.uint16[B+3]=x,this.uint16[B+4]=b,this.uint16[B+5]=T,this.uint16[B+6]=A,this.uint16[B+7]=C,this.uint16[B+8]=R,this.uint16[B+9]=O,s}}ju.prototype.bytesPerElement=20,pt("StructArrayLayout10ui20",ju);class ba extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,f,g,x,b,T,A,C,R,O,B){const V=this.length;return this.resize(V+1),this.emplace(V,s,l,f,g,x,b,T,A,C,R,O,B)}emplace(s,l,f,g,x,b,T,A,C,R,O,B,V){const j=12*s;return this.int16[j+0]=l,this.int16[j+1]=f,this.int16[j+2]=g,this.int16[j+3]=x,this.uint16[j+4]=b,this.uint16[j+5]=T,this.uint16[j+6]=A,this.uint16[j+7]=C,this.int16[j+8]=R,this.int16[j+9]=O,this.int16[j+10]=B,this.int16[j+11]=V,s}}ba.prototype.bytesPerElement=24,pt("StructArrayLayout4i4ui4i24",ba);class Zd extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,s,l,f)}emplace(s,l,f,g){const x=3*s;return this.float32[x+0]=l,this.float32[x+1]=f,this.float32[x+2]=g,s}}Zd.prototype.bytesPerElement=12,pt("StructArrayLayout3f12",Zd);class qd extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.uint32[1*s+0]=l,s}}qd.prototype.bytesPerElement=4,pt("StructArrayLayout1ul4",qd);class $u extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,f,g,x,b,T,A,C){const R=this.length;return this.resize(R+1),this.emplace(R,s,l,f,g,x,b,T,A,C)}emplace(s,l,f,g,x,b,T,A,C,R){const O=10*s,B=5*s;return this.int16[O+0]=l,this.int16[O+1]=f,this.int16[O+2]=g,this.int16[O+3]=x,this.int16[O+4]=b,this.int16[O+5]=T,this.uint32[B+3]=A,this.uint16[O+8]=C,this.uint16[O+9]=R,s}}$u.prototype.bytesPerElement=20,pt("StructArrayLayout6i1ul2ui20",$u);class Yd extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,g,x,b){const T=this.length;return this.resize(T+1),this.emplace(T,s,l,f,g,x,b)}emplace(s,l,f,g,x,b,T){const A=6*s;return this.int16[A+0]=l,this.int16[A+1]=f,this.int16[A+2]=g,this.int16[A+3]=x,this.int16[A+4]=b,this.int16[A+5]=T,s}}Yd.prototype.bytesPerElement=12,pt("StructArrayLayout2i2i2i12",Yd);class _ extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,s,l,f,g,x)}emplace(s,l,f,g,x,b){const T=4*s,A=8*s;return this.float32[T+0]=l,this.float32[T+1]=f,this.float32[T+2]=g,this.int16[A+6]=x,this.int16[A+7]=b,s}}_.prototype.bytesPerElement=16,pt("StructArrayLayout2f1f2i16",_);class i extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,f,g,x,b){const T=this.length;return this.resize(T+1),this.emplace(T,s,l,f,g,x,b)}emplace(s,l,f,g,x,b,T){const A=16*s,C=4*s,R=8*s;return this.uint8[A+0]=l,this.uint8[A+1]=f,this.float32[C+1]=g,this.float32[C+2]=x,this.int16[R+6]=b,this.int16[R+7]=T,s}}i.prototype.bytesPerElement=16,pt("StructArrayLayout2ub2f2i16",i);class h extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,s,l,f)}emplace(s,l,f,g){const x=3*s;return this.uint16[x+0]=l,this.uint16[x+1]=f,this.uint16[x+2]=g,s}}h.prototype.bytesPerElement=6,pt("StructArrayLayout3ui6",h);class p extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,g,x,b,T,A,C,R,O,B,V,j,X,J,oe){const Se=this.length;return this.resize(Se+1),this.emplace(Se,s,l,f,g,x,b,T,A,C,R,O,B,V,j,X,J,oe)}emplace(s,l,f,g,x,b,T,A,C,R,O,B,V,j,X,J,oe,Se){const fe=24*s,_e=12*s,Oe=48*s;return this.int16[fe+0]=l,this.int16[fe+1]=f,this.uint16[fe+2]=g,this.uint16[fe+3]=x,this.uint32[_e+2]=b,this.uint32[_e+3]=T,this.uint32[_e+4]=A,this.uint16[fe+10]=C,this.uint16[fe+11]=R,this.uint16[fe+12]=O,this.float32[_e+7]=B,this.float32[_e+8]=V,this.uint8[Oe+36]=j,this.uint8[Oe+37]=X,this.uint8[Oe+38]=J,this.uint32[_e+10]=oe,this.int16[fe+22]=Se,s}}p.prototype.bytesPerElement=48,pt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",p);class m extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,g,x,b,T,A,C,R,O,B,V,j,X,J,oe,Se,fe,_e,Oe,Be,Ye,ut,tt,ot,Et,st){const at=this.length;return this.resize(at+1),this.emplace(at,s,l,f,g,x,b,T,A,C,R,O,B,V,j,X,J,oe,Se,fe,_e,Oe,Be,Ye,ut,tt,ot,Et,st)}emplace(s,l,f,g,x,b,T,A,C,R,O,B,V,j,X,J,oe,Se,fe,_e,Oe,Be,Ye,ut,tt,ot,Et,st,at){const He=32*s,zt=16*s;return this.int16[He+0]=l,this.int16[He+1]=f,this.int16[He+2]=g,this.int16[He+3]=x,this.int16[He+4]=b,this.int16[He+5]=T,this.int16[He+6]=A,this.int16[He+7]=C,this.uint16[He+8]=R,this.uint16[He+9]=O,this.uint16[He+10]=B,this.uint16[He+11]=V,this.uint16[He+12]=j,this.uint16[He+13]=X,this.uint16[He+14]=J,this.uint16[He+15]=oe,this.uint16[He+16]=Se,this.uint16[He+17]=fe,this.uint16[He+18]=_e,this.uint16[He+19]=Oe,this.uint16[He+20]=Be,this.uint16[He+21]=Ye,this.uint16[He+22]=ut,this.uint32[zt+12]=tt,this.float32[zt+13]=ot,this.float32[zt+14]=Et,this.uint16[He+30]=st,this.uint16[He+31]=at,s}}m.prototype.bytesPerElement=64,pt("StructArrayLayout8i15ui1ul2f2ui64",m);class v extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.float32[1*s+0]=l,s}}v.prototype.bytesPerElement=4,pt("StructArrayLayout1f4",v);class w extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,s,l,f)}emplace(s,l,f,g){const x=3*s;return this.uint16[6*s+0]=l,this.float32[x+1]=f,this.float32[x+2]=g,s}}w.prototype.bytesPerElement=12,pt("StructArrayLayout1ui2f12",w);class I extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,s,l,f)}emplace(s,l,f,g){const x=4*s;return this.uint32[2*s+0]=l,this.uint16[x+2]=f,this.uint16[x+3]=g,s}}I.prototype.bytesPerElement=8,pt("StructArrayLayout1ul2ui8",I);class P extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l){const f=this.length;return this.resize(f+1),this.emplace(f,s,l)}emplace(s,l,f){const g=2*s;return this.uint16[g+0]=l,this.uint16[g+1]=f,s}}P.prototype.bytesPerElement=4,pt("StructArrayLayout2ui4",P);class k extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.uint16[1*s+0]=l,s}}k.prototype.bytesPerElement=2,pt("StructArrayLayout1ui2",k);class D extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,s,l,f,g)}emplace(s,l,f,g,x){const b=4*s;return this.float32[b+0]=l,this.float32[b+1]=f,this.float32[b+2]=g,this.float32[b+3]=x,s}}D.prototype.bytesPerElement=16,pt("StructArrayLayout4f16",D);class z extends bc{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new y(this.anchorPointX,this.anchorPointY)}}z.prototype.size=20;class L extends $u{get(s){return new z(this,s)}}pt("CollisionBoxArray",L);class U extends bc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}U.prototype.size=48;class W extends p{get(s){return new U(this,s)}}pt("PlacedSymbolArray",W);class te extends bc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}te.prototype.size=64;class ee extends m{get(s){return new te(this,s)}}pt("SymbolInstanceArray",ee);class ne extends v{getoffsetX(s){return this.float32[1*s+0]}}pt("GlyphOffsetArray",ne);class ae extends ol{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}pt("SymbolLineVertexArray",ae);class de extends bc{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}de.prototype.size=12;class ue extends w{get(s){return new de(this,s)}}pt("TextAnchorOffsetArray",ue);class ge extends bc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ge.prototype.size=8;class ye extends I{get(s){return new ge(this,s)}}pt("FeatureIndexArray",ye);class he extends sl{}class Ee extends sl{}class Le extends sl{}class ke extends al{}class De extends xa{}class Ne extends wc{}class et extends ju{}class nt extends ba{}class Xe extends Zd{}class wt extends qd{}class Kt extends Yd{}class Ar extends i{}class zr extends h{}class Fr extends P{}const tn=dn([{name:"a_pos",components:2,type:"Int16"}],4),{members:on}=tn;class Yt{constructor(s=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=s}prepareSegment(s,l,f,g){const x=this.segments[this.segments.length-1];return s>Yt.MAX_VERTEX_ARRAY_LENGTH&&Ft(`Max vertices per segment is ${Yt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Yt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!x||x.vertexLength+s>Yt.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==g?this.createNewSegment(l,f,g):x}createNewSegment(s,l,f){const g={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0,vaos:{}};return f!==void 0&&(g.sortKey=f),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(g),g}getOrCreateLatestSegment(s,l,f){return this.prepareSegment(0,s,l,f)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const s of this.segments)for(const l in s.vaos)s.vaos[l].destroy()}static simpleSegment(s,l,f,g){return new Yt([{vertexOffset:s,primitiveOffset:l,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function Br(u,s){return 256*(u=mt(Math.floor(u),0,255))+mt(Math.floor(s),0,255)}Yt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pt("SegmentVector",Yt);const En=dn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var kn,Bn,yi,bs={exports:{}},Lo={exports:{}},zo={exports:{}},ll=function(){if(yi)return bs.exports;yi=1;var u=(kn||(kn=1,Lo.exports=function(l,f){var g,x,b,T,A,C,R,O;for(x=l.length-(g=3&l.length),b=f,A=3432918353,C=461845907,O=0;O<x;)R=255&l.charCodeAt(O)|(255&l.charCodeAt(++O))<<8|(255&l.charCodeAt(++O))<<16|(255&l.charCodeAt(++O))<<24,++O,b=27492+(65535&(T=5*(65535&(b=(b^=R=(65535&(R=(R=(65535&R)*A+(((R>>>16)*A&65535)<<16)&4294967295)<<15|R>>>17))*C+(((R>>>16)*C&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(R=0,g){case 3:R^=(255&l.charCodeAt(O+2))<<16;case 2:R^=(255&l.charCodeAt(O+1))<<8;case 1:b^=R=(65535&(R=(R=(65535&(R^=255&l.charCodeAt(O)))*A+(((R>>>16)*A&65535)<<16)&4294967295)<<15|R>>>17))*C+(((R>>>16)*C&65535)<<16)&4294967295}return b^=l.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),Lo.exports),s=(Bn||(Bn=1,zo.exports=function(l,f){for(var g,x=l.length,b=f^x,T=0;x>=4;)g=1540483477*(65535&(g=255&l.charCodeAt(T)|(255&l.charCodeAt(++T))<<8|(255&l.charCodeAt(++T))<<16|(255&l.charCodeAt(++T))<<24))+((1540483477*(g>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),x-=4,++T;switch(x){case 3:b^=(255&l.charCodeAt(T+2))<<16;case 2:b^=(255&l.charCodeAt(T+1))<<8;case 1:b=1540483477*(65535&(b^=255&l.charCodeAt(T)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),zo.exports);return bs.exports=u,bs.exports.murmur3=u,bs.exports.murmur2=s,bs.exports}(),cl=S(ll);class wa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,l,f,g){this.ids.push(Ta(s)),this.positions.push(l,f,g)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=Ta(s);let f=0,g=this.ids.length-1;for(;f<g;){const b=f+g>>1;this.ids[b]>=l?g=b:f=b+1}const x=[];for(;this.ids[f]===l;)x.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return x}static serialize(s,l){const f=new Float64Array(s.ids),g=new Uint32Array(s.positions);return Ri(f,g,0,f.length-1),l&&l.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(s){const l=new wa;return l.ids=s.ids,l.positions=s.positions,l.indexed=!0,l}}function Ta(u){const s=+u;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:cl(String(u))}function Ri(u,s,l,f){for(;l<f;){const g=u[l+f>>1];let x=l-1,b=f+1;for(;;){do x++;while(u[x]<g);do b--;while(u[b]>g);if(x>=b)break;ws(u,x,b),ws(s,3*x,3*b),ws(s,3*x+1,3*b+1),ws(s,3*x+2,3*b+2)}b-l<f-b?(Ri(u,s,l,b),l=b+1):(Ri(u,s,b+1,f),f=b)}}function ws(u,s,l){const f=u[s];u[s]=u[l],u[l]=f}pt("FeaturePositionMap",wa);class vi{constructor(s,l){this.gl=s.gl,this.location=l}}class Bo extends vi{constructor(s,l){super(s,l),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class An extends vi{constructor(s,l){super(s,l),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class Dn extends vi{constructor(s,l){super(s,l),this.current=or.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const as=new Float32Array(16);function In(u){return[Br(255*u.r,255*u.g),Br(255*u.b,255*u.a)]}class Tc{constructor(s,l,f){this.value=s,this.uniformNames=l.map(g=>`u_${g}`),this.type=f}setUniform(s,l,f){s.set(f.constantOr(this.value))}getBinding(s,l,f){return this.type==="color"?new Dn(s,l):new Bo(s,l)}}class ul{constructor(s,l){this.uniformNames=l.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=s.tlbr}setUniform(s,l,f,g){const x=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&s.set(x)}getBinding(s,l,f){return f.substr(0,9)==="u_pattern"?new An(s,l):new Bo(s,l)}}class co{constructor(s,l,f,g){this.expression=s,this.type=f,this.maxValue=0,this.paintVertexAttributes=l.map(x=>({name:`a_${x}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(s,l,f){const g=this.paintVertexArray.length,x=this.expression.evaluate(new jr(0,f),l,{},f.canonical,[],f.formattedSection);this.paintVertexArray.resize(s),this._setPaintValue(g,s,x)}updatePaintArray(s,l,f,g,x){const b=this.expression.evaluate(new jr(0,x),f,g);this._setPaintValue(s,l,b)}_setPaintValue(s,l,f){if(this.type==="color"){const g=In(f);for(let x=s;x<l;x++)this.paintVertexArray.emplace(x,g[0],g[1])}else{for(let g=s;g<l;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ts{constructor(s,l,f,g,x,b){this.expression=s,this.uniformNames=l.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=l.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(s,l,f){const g=this.expression.evaluate(new jr(this.zoom,f),l,{},f.canonical,[],f.formattedSection),x=this.expression.evaluate(new jr(this.zoom+1,f),l,{},f.canonical,[],f.formattedSection),b=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(b,s,g,x)}updatePaintArray(s,l,f,g,x){const b=this.expression.evaluate(new jr(this.zoom,x),f,g),T=this.expression.evaluate(new jr(this.zoom+1,x),f,g);this._setPaintValue(s,l,b,T)}_setPaintValue(s,l,f,g){if(this.type==="color"){const x=In(f),b=In(g);for(let T=s;T<l;T++)this.paintVertexArray.emplace(T,x[0],x[1],b[0],b[1])}else{for(let x=s;x<l;x++)this.paintVertexArray.emplace(x,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,l){const f=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,g=mt(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);s.set(g)}getBinding(s,l,f){return new Bo(s,l)}}class Uo{constructor(s,l,f,g,x,b){this.expression=s,this.type=l,this.useIntegerZoom=f,this.zoom=g,this.layerId=b,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(s,l,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(g,s,l.patterns&&l.patterns[this.layerId],f.imagePositions)}updatePaintArray(s,l,f,g,x){this._setPaintValues(s,l,f.patterns&&f.patterns[this.layerId],x.imagePositions)}_setPaintValues(s,l,f,g){if(!g||!f)return;const{min:x,mid:b,max:T}=f,A=g[x],C=g[b],R=g[T];if(A&&C&&R)for(let O=s;O<l;O++)this.zoomInPaintVertexArray.emplace(O,C.tl[0],C.tl[1],C.br[0],C.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],C.pixelRatio,A.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,C.tl[0],C.tl[1],C.br[0],C.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],C.pixelRatio,R.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,En.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,En.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ig{constructor(s,l,f){this.binders={},this._buffers=[];const g=[];for(const x in s.paint._values){if(!f(x))continue;const b=s.paint.get(x);if(!(b instanceof Hs&&Oo(b.property.specification)))continue;const T=Pg(x,s.type),A=b.value,C=b.property.specification.type,R=b.property.useIntegerZoom,O=b.property.specification["property-type"],B=O==="cross-faded"||O==="cross-faded-data-driven";if(A.kind==="constant")this.binders[x]=B?new ul(A.value,T):new Tc(A.value,T,C),g.push(`/u_${x}`);else if(A.kind==="source"||B){const V=Gd(x,C,"source");this.binders[x]=B?new Uo(A,C,R,l,V,s.id):new co(A,T,C,V),g.push(`/a_${x}`)}else{const V=Gd(x,C,"composite");this.binders[x]=new Ts(A,T,C,R,l,V),g.push(`/z_${x}`)}}this.cacheKey=g.sort().join("")}getMaxValue(s){const l=this.binders[s];return l instanceof co||l instanceof Ts?l.maxValue:0}populatePaintArrays(s,l,f){for(const g in this.binders){const x=this.binders[g];(x instanceof co||x instanceof Ts||x instanceof Uo)&&x.populatePaintArray(s,l,f)}}setConstantPatternPositions(s,l){for(const f in this.binders){const g=this.binders[f];g instanceof ul&&g.setConstantPatternPositions(s,l)}}updatePaintArrays(s,l,f,g,x){let b=!1;for(const T in s){const A=l.getPositions(T);for(const C of A){const R=f.feature(C.index);for(const O in this.binders){const B=this.binders[O];if((B instanceof co||B instanceof Ts||B instanceof Uo)&&B.expression.isStateDependent===!0){const V=g.paint.get(O);B.expression=V.value,B.updatePaintArray(C.start,C.end,R,s[T],x),b=!0}}}}return b}defines(){const s=[];for(const l in this.binders){const f=this.binders[l];(f instanceof Tc||f instanceof ul)&&s.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return s}getBinderAttributes(){const s=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof co||f instanceof Ts)for(let g=0;g<f.paintVertexAttributes.length;g++)s.push(f.paintVertexAttributes[g].name);else if(f instanceof Uo)for(let g=0;g<En.members.length;g++)s.push(En.members[g].name)}return s}getBinderUniforms(){const s=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof Tc||f instanceof ul||f instanceof Ts)for(const g of f.uniformNames)s.push(g)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,l){const f=[];for(const g in this.binders){const x=this.binders[g];if(x instanceof Tc||x instanceof ul||x instanceof Ts){for(const b of x.uniformNames)if(l[b]){const T=x.getBinding(s,l[b],b);f.push({name:b,property:g,binding:T})}}}return f}setUniforms(s,l,f,g){for(const{name:x,property:b,binding:T}of l)this.binders[b].setUniform(T,g,f.get(b),x)}updatePaintBuffers(s){this._buffers=[];for(const l in this.binders){const f=this.binders[l];if(s&&f instanceof Uo){const g=s.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof co||f instanceof Ts)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(s){for(const l in this.binders){const f=this.binders[l];(f instanceof co||f instanceof Ts||f instanceof Uo)&&f.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const l=this.binders[s];(l instanceof co||l instanceof Ts||l instanceof Uo)&&l.destroy()}}}class Hi{constructor(s,l,f=()=>!0){this.programConfigurations={};for(const g of s)this.programConfigurations[g.id]=new Ig(g,l,f);this.needsUpload=!1,this._featureMap=new wa,this._bufferOffset=0}populatePaintArrays(s,l,f,g){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(s,l,g);l.id!==void 0&&this._featureMap.add(l.id,f,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,l,f,g){for(const x of f)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(s,this._featureMap,l,x,g)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function Pg(u,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${s}-`,"").replace(/-/g,"_")]}function Gd(u,s,l){const f={color:{source:wc,composite:D},number:{source:v,composite:wc}},g=function(x){return{"line-pattern":{source:et,composite:et},"fill-pattern":{source:et,composite:et},"fill-extrusion-pattern":{source:et,composite:et}}[x]}(u);return g&&g[l]||f[s][l]}pt("ConstantBinder",Tc),pt("CrossFadedConstantBinder",ul),pt("SourceExpressionBinder",co),pt("CrossFadedCompositeBinder",Uo),pt("CompositeExpressionBinder",Ts),pt("ProgramConfiguration",Ig,{omit:["_buffers"]}),pt("ProgramConfigurationSet",Hi);const Wu=Math.pow(2,14)-1,Hu=-Wu-1;function Vo(u){const s=Qe/u.extent,l=u.loadGeometry();for(let f=0;f<l.length;f++){const g=l[f];for(let x=0;x<g.length;x++){const b=g[x],T=Math.round(b.x*s),A=Math.round(b.y*s);b.x=mt(T,Hu,Wu),b.y=mt(A,Hu,Wu),(T<b.x||T>b.x+1||A<b.y||A>b.y+1)&&Ft("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function uo(u,s){return{type:u.type,id:u.id,properties:u.properties,geometry:s?Vo(u):[]}}const uw=-32768;function tM(u,s,l,f,g){u.emplaceBack(uw+8*s+f,uw+8*l+g)}class Jy{constructor(s){this.zoom=s.zoom,this.globalState=s.globalState,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new Ee,this.indexArray=new zr,this.segments=new Yt,this.programConfigurations=new Hi(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(s,l,f){const g=this.layers[0],x=[];let b=null,T=!1,A=g.type==="heatmap";if(g.type==="circle"){const R=g;b=R.layout.get("circle-sort-key"),T=!b.isConstant(),A=A||R.paint.get("circle-pitch-alignment")==="map"}const C=A?l.subdivisionGranularity.circle:1;for(const{feature:R,id:O,index:B,sourceLayerIndex:V}of s){const j=this.layers[0]._featureFilter.needGeometry,X=uo(R,j);if(!this.layers[0]._featureFilter.filter(new jr(this.zoom,{globalState:this.globalState}),X,f))continue;const J=T?b.evaluate(X,{},f):void 0,oe={id:O,properties:R.properties,type:R.type,sourceLayerIndex:V,index:B,geometry:j?X.geometry:Vo(R),patterns:{},sortKey:J};x.push(oe)}T&&x.sort((R,O)=>R.sortKey-O.sortKey);for(const R of x){const{geometry:O,index:B,sourceLayerIndex:V}=R,j=s[B].feature;this.addFeature(R,O,B,f,C),l.featureIndex.insert(j,O,B,V,this.index)}}update(s,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,{imagePositions:f,globalState:this.globalState})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,on),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,l,f,g,x=1){let b;switch(x){case 1:b=[0,7];break;case 3:b=[0,2,5,7];break;case 5:b=[0,1,3,4,6,7];break;case 7:b=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${x}; valid values are 1, 3, 5, 7.`)}const T=b.length;for(const A of l)for(const C of A){const R=C.x,O=C.y;if(R<0||R>=Qe||O<0||O>=Qe)continue;const B=this.segments.prepareSegment(T*T,this.layoutVertexArray,this.indexArray,s.sortKey),V=B.vertexLength;for(let j=0;j<T;j++)for(let X=0;X<T;X++)tM(this.layoutVertexArray,R,O,b[X],b[j]);for(let j=0;j<T-1;j++)for(let X=0;X<T-1;X++){const J=V+j*T+X,oe=V+(j+1)*T+X;this.indexArray.emplaceBack(J,oe+1,J+1),this.indexArray.emplaceBack(J,oe,oe+1)}B.vertexLength+=T*T,B.primitiveLength+=(T-1)*(T-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,{imagePositions:{},canonical:g,globalState:this.globalState})}}function hw(u,s){for(let l=0;l<u.length;l++)if(Xu(s,u[l]))return!0;for(let l=0;l<s.length;l++)if(Xu(u,s[l]))return!0;return!!ev(u,s)}function rM(u,s,l){return!!Xu(u,s)||!!tv(s,u,l)}function dw(u,s){if(u.length===1)return pw(s,u[0]);for(let l=0;l<s.length;l++){const f=s[l];for(let g=0;g<f.length;g++)if(Xu(u,f[g]))return!0}for(let l=0;l<u.length;l++)if(pw(s,u[l]))return!0;for(let l=0;l<s.length;l++)if(ev(u,s[l]))return!0;return!1}function nM(u,s,l){if(u.length>1){if(ev(u,s))return!0;for(let f=0;f<s.length;f++)if(tv(s[f],u,l))return!0}for(let f=0;f<u.length;f++)if(tv(u[f],s,l))return!0;return!1}function ev(u,s){if(u.length===0||s.length===0)return!1;for(let l=0;l<u.length-1;l++){const f=u[l],g=u[l+1];for(let x=0;x<s.length-1;x++)if(iM(f,g,s[x],s[x+1]))return!0}return!1}function iM(u,s,l,f){return Qt(u,l,f)!==Qt(s,l,f)&&Qt(u,s,l)!==Qt(u,s,f)}function tv(u,s,l){const f=l*l;if(s.length===1)return u.distSqr(s[0])<f;for(let g=1;g<s.length;g++)if(fw(u,s[g-1],s[g])<f)return!0;return!1}function fw(u,s,l){const f=s.distSqr(l);if(f===0)return u.distSqr(s);const g=((u.x-s.x)*(l.x-s.x)+(u.y-s.y)*(l.y-s.y))/f;return u.distSqr(g<0?s:g>1?l:l.sub(s)._mult(g)._add(s))}function pw(u,s){let l,f,g,x=!1;for(let b=0;b<u.length;b++){l=u[b];for(let T=0,A=l.length-1;T<l.length;A=T++)f=l[T],g=l[A],f.y>s.y!=g.y>s.y&&s.x<(g.x-f.x)*(s.y-f.y)/(g.y-f.y)+f.x&&(x=!x)}return x}function Xu(u,s){let l=!1;for(let f=0,g=u.length-1;f<u.length;g=f++){const x=u[f],b=u[g];x.y>s.y!=b.y>s.y&&s.x<(b.x-x.x)*(s.y-x.y)/(b.y-x.y)+x.x&&(l=!l)}return l}function sM(u,s,l){const f=l[0],g=l[2];if(u.x<f.x&&s.x<f.x||u.x>g.x&&s.x>g.x||u.y<f.y&&s.y<f.y||u.y>g.y&&s.y>g.y)return!1;const x=Qt(u,s,l[0]);return x!==Qt(u,s,l[1])||x!==Qt(u,s,l[2])||x!==Qt(u,s,l[3])}function Kd(u,s,l){const f=s.paint.get(u).value;return f.kind==="constant"?f.value:l.programConfigurations.get(s.id).getMaxValue(u)}function Cg(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Mg(u,s,l,f,g){if(!s[0]&&!s[1])return u;const x=y.convert(s)._mult(g);l==="viewport"&&x._rotate(-f);const b=[];for(let T=0;T<u.length;T++)b.push(u[T].sub(x));return b}let gw,mw;pt("CircleBucket",Jy,{omit:["layers"]});var oM={get paint(){return mw=mw||new _i({"circle-radius":new Nt(Te.paint_circle["circle-radius"]),"circle-color":new Nt(Te.paint_circle["circle-color"]),"circle-blur":new Nt(Te.paint_circle["circle-blur"]),"circle-opacity":new Nt(Te.paint_circle["circle-opacity"]),"circle-translate":new St(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new St(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new St(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new St(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Nt(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Nt(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Nt(Te.paint_circle["circle-stroke-opacity"])})},get layout(){return gw=gw||new _i({"circle-sort-key":new Nt(Te.layout_circle["circle-sort-key"])})}};class aM extends os{constructor(s){super(s,oM)}createBucket(s){return new Jy(s)}queryRadius(s){const l=s;return Kd("circle-radius",this,l)+Kd("circle-stroke-width",this,l)+Cg(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:f,geometry:g,transform:x,pixelsToTileUnits:b,unwrappedTileID:T,getElevation:A}){const C=Mg(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-x.bearingInRadians,b),R=this.paint.get("circle-radius").evaluate(l,f)+this.paint.get("circle-stroke-width").evaluate(l,f),O=this.paint.get("circle-pitch-alignment")==="map",B=O?C:function(j,X,J,oe){return j.map(Se=>_w(Se,X,J,oe))}(C,x,T,A),V=O?R*b:R;for(const j of g)for(const X of j){const J=O?X:_w(X,x,T,A);let oe=V;const Se=x.projectTileCoordinates(X.x,X.y,T,A).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?oe*=Se/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(oe*=x.cameraToCenterDistance/Se),rM(B,J,oe))return!0}return!1}}function _w(u,s,l,f){const g=s.projectTileCoordinates(u.x,u.y,l,f).point;return new y((.5*g.x+.5)*s.width,(.5*-g.y+.5)*s.height)}class yw extends Jy{}let vw;pt("HeatmapBucket",yw,{omit:["layers"]});var lM={get paint(){return vw=vw||new _i({"heatmap-radius":new Nt(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Nt(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new St(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Uu(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new St(Te.paint_heatmap["heatmap-opacity"])})}};function rv(u,{width:s,height:l},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==s*l*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${s*l*f}`)}else g=new Uint8Array(s*l*f);return u.width=s,u.height=l,u.data=g,u}function xw(u,{width:s,height:l},f){if(s===u.width&&l===u.height)return;const g=rv({},{width:s,height:l},f);nv(u,g,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,s),height:Math.min(u.height,l)},f),u.width=s,u.height=l,u.data=g.data}function nv(u,s,l,f,g,x){if(g.width===0||g.height===0)return s;if(g.width>u.width||g.height>u.height||l.x>u.width-g.width||l.y>u.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>s.width||g.height>s.height||f.x>s.width-g.width||f.y>s.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const b=u.data,T=s.data;if(b===T)throw new Error("srcData equals dstData, so image is already copied");for(let A=0;A<g.height;A++){const C=((l.y+A)*u.width+l.x)*x,R=((f.y+A)*s.width+f.x)*x;for(let O=0;O<g.width*x;O++)T[R+O]=b[C+O]}return s}class Qd{constructor(s,l){rv(this,s,1,l)}resize(s){xw(this,s,1)}clone(){return new Qd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,l,f,g,x){nv(s,l,f,g,x,1)}}class Xi{constructor(s,l){rv(this,s,4,l)}resize(s){xw(this,s,4)}replace(s,l){l?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new Xi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,l,f,g,x){nv(s,l,f,g,x,4)}setPixel(s,l,f){const g=4*(s*this.width+l);this.data[g+0]=Math.round(255*f.r/f.a),this.data[g+1]=Math.round(255*f.g/f.a),this.data[g+2]=Math.round(255*f.b/f.a),this.data[g+3]=Math.round(255*f.a)}}function bw(u){const s={},l=u.resolution||256,f=u.clips?u.clips.length:1,g=u.image||new Xi({width:l,height:f});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const x=(b,T,A)=>{s[u.evaluationKey]=A;const C=u.expression.evaluate(s);g.setPixel(b/4/l,T/4,C)};if(u.clips)for(let b=0,T=0;b<f;++b,T+=4*l)for(let A=0,C=0;A<l;A++,C+=4){const R=A/(l-1),{start:O,end:B}=u.clips[b];x(T,C,O*(1-R)+B*R)}else for(let b=0,T=0;b<l;b++,T+=4)x(0,T,b/(l-1));return g}pt("AlphaImage",Qd),pt("RGBAImage",Xi);const iv="big-fb";class cM extends os{createBucket(s){return new yw(s)}constructor(s){super(s,lM),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=bw({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(iv)&&this.heatmapFbos.delete(iv)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let ww;var uM={get paint(){return ww=ww||new _i({"hillshade-illumination-direction":new St(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new St(Te.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new St(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new St(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new St(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new St(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new St(Te.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new St(Te.paint_hillshade["hillshade-method"])})}};class hM extends os{constructor(s){super(s,uM),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let s=this.paint.get("hillshade-illumination-direction").values,l=this.paint.get("hillshade-illumination-altitude").values,f=this.paint.get("hillshade-highlight-color").values,g=this.paint.get("hillshade-shadow-color").values;const x=Math.max(s.length,l.length,f.length,g.length);s=s.concat(Array(x-s.length).fill(s.at(-1))),l=l.concat(Array(x-l.length).fill(l.at(-1))),f=f.concat(Array(x-f.length).fill(f.at(-1))),g=g.concat(Array(x-g.length).fill(g.at(-1)));const b=l.map(dr);return{directionRadians:s.map(dr),altitudeRadians:b,shadowColor:g,highlightColor:f}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Tw;var dM={get paint(){return Tw=Tw||new _i({"color-relief-opacity":new St(Te["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Uu(Te["paint_color-relief"]["color-relief-color"])})}};class sv{constructor(s,l,f,g){this.context=s,this.format=f,this.texture=s.gl.createTexture(),this.update(l,g)}update(s,l,f){const{width:g,height:x}=s,b=!(this.size&&this.size[0]===g&&this.size[1]===x||f),{context:T}=this,{gl:A}=T;if(this.useMipmap=!!(l&&l.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!l||l.premultiply!==!1)),b)this.size=[g,x],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||Jt(s)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,s):A.texImage2D(A.TEXTURE_2D,0,this.format,g,x,0,this.format,A.UNSIGNED_BYTE,s.data);else{const{x:C,y:R}=f||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||Jt(s)?A.texSubImage2D(A.TEXTURE_2D,0,C,R,A.RGBA,A.UNSIGNED_BYTE,s):A.texSubImage2D(A.TEXTURE_2D,0,C,R,g,x,A.RGBA,A.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D),T.pixelStoreUnpackFlipY.setDefault(),T.pixelStoreUnpack.setDefault(),T.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(s,l,f){const{context:g}=this,{gl:x}=g;x.bindTexture(x.TEXTURE_2D,this.texture),f!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=x.LINEAR),s!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,s),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,f||s),this.filter=s),l!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,l),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}class Sw{constructor(s,l,f,g=1,x=1,b=1,T=0){if(this.uid=s,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void Ft(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const A=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=x,this.blueFactor=b,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let C=0;C<A;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(A,C)]=this.data[this._idx(A-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,A)]=this.data[this._idx(C,A-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(A,-1)]=this.data[this._idx(A-1,0)],this.data[this._idx(-1,A)]=this.data[this._idx(0,A-1)],this.data[this._idx(A,A)]=this.data[this._idx(A-1,A-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let C=0;C<A;C++)for(let R=0;R<A;R++){const O=this.get(C,R);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(s,l){const f=new Uint8Array(this.data.buffer),g=4*this._idx(s,l);return this.unpack(f[g],f[g+1],f[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,l){if(s<-1||s>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(s+1)}unpack(s,l,f){return s*this.redFactor+l*this.greenFactor+f*this.blueFactor-this.baseShift}pack(s){return Ew(s,this.getUnpackVector())}getPixels(){return new Xi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,l,f){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let g=l*this.dim,x=l*this.dim+this.dim,b=f*this.dim,T=f*this.dim+this.dim;switch(l){case-1:g=x-1;break;case 1:x=g+1}switch(f){case-1:b=T-1;break;case 1:T=b+1}const A=-l*this.dim,C=-f*this.dim;for(let R=b;R<T;R++)for(let O=g;O<x;O++)this.data[this._idx(O,R)]=s.data[this._idx(O+A,R+C)]}}function Ew(u,s){const l=s[0],f=s[1],g=s[2],x=s[3],b=Math.min(l,f,g),T=Math.round((u+x)/b);return{r:Math.floor(T*b/l)%256,g:Math.floor(T*b/f)%256,b:Math.floor(T*b/g)%256}}pt("DEMData",Sw);class fM extends os{constructor(s){super(s,dM)}_createColorRamp(s){const l={elevationStops:[],colorStops:[]},f=this._transitionablePaint._values["color-relief-color"].value.expression;if(f instanceof fc&&f._styleExpression.expression instanceof Yn){this.colorRampExpression=f;const b=f._styleExpression.expression;l.elevationStops=b.labels,l.colorStops=[];for(const T of l.elevationStops)l.colorStops.push(b.evaluate({globals:{elevation:T}}))}if(l.elevationStops.length<1&&(l.elevationStops=[0],l.colorStops=[or.transparent]),l.elevationStops.length<2&&(l.elevationStops.push(l.elevationStops[0]+1),l.colorStops.push(l.colorStops[0])),l.elevationStops.length<=s)return l;const g={elevationStops:[],colorStops:[]},x=(l.elevationStops.length-1)/(s-1);for(let b=0;b<l.elevationStops.length-.5;b+=x)g.elevationStops.push(l.elevationStops[Math.round(b)]),g.colorStops.push(l.colorStops[Math.round(b)]);return Ft(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),g}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(s,l,f){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const g=this._createColorRamp(l),x=new Xi({width:g.colorStops.length,height:1}),b=new Xi({width:g.colorStops.length,height:1});for(let T=0;T<g.elevationStops.length;T++){const A=Ew(g.elevationStops[T],f);b.setPixel(0,T,new or(A.r/255,A.g/255,A.b/255,1)),x.setPixel(0,T,g.colorStops[T])}return this.colorRampTextures={elevationTexture:new sv(s,b,s.gl.RGBA),colorTexture:new sv(s,x,s.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const pM=dn([{name:"a_pos",components:2,type:"Int16"}],4),{members:gM}=pM;function ov(u,s,l){const f=l.patternDependencies;let g=!1;for(const x of s){const b=x.paint.get(`${u}-pattern`);b.isConstant()||(g=!0);const T=b.constantOr(null);T&&(g=!0,f[T.to]=!0,f[T.from]=!0)}return g}function av(u,s,l,f,g){const{zoom:x,globalState:b}=f,T=g.patternDependencies;for(const A of s){const C=A.paint.get(`${u}-pattern`).value;if(C.kind!=="constant"){let R=C.evaluate({zoom:x-1,globalState:b},l,{},g.availableImages),O=C.evaluate({zoom:x,globalState:b},l,{},g.availableImages),B=C.evaluate({zoom:x+1,globalState:b},l,{},g.availableImages);R=R&&R.name?R.name:R,O=O&&O.name?O.name:O,B=B&&B.name?B.name:B,T[R]=!0,T[O]=!0,T[B]=!0,l.patterns[A.id]={min:R,mid:O,max:B}}}return l}function Aw(u,s,l,f,g){let x;if(g===function(b,T,A,C){let R=0;for(let O=T,B=A-C;O<A;O+=C)R+=(b[B]-b[O])*(b[O+1]+b[B+1]),B=O;return R}(u,s,l,f)>0)for(let b=s;b<l;b+=f)x=Mw(b/f|0,u[b],u[b+1],x);else for(let b=l-f;b>=s;b-=f)x=Mw(b/f|0,u[b],u[b+1],x);return x&&Zu(x,x.next)&&(rf(x),x=x.next),x}function Sc(u,s){if(!u)return u;s||(s=u);let l,f=u;do if(l=!1,f.steiner||!Zu(f,f.next)&&yn(f.prev,f,f.next)!==0)f=f.next;else{if(rf(f),f=s=f.prev,f===f.next)break;l=!0}while(l||f!==s);return s}function Jd(u,s,l,f,g,x,b){if(!u)return;!b&&x&&function(A,C,R,O){let B=A;do B.z===0&&(B.z=lv(B.x,B.y,C,R,O)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==A);B.prevZ.nextZ=null,B.prevZ=null,function(V){let j,X=1;do{let J,oe=V;V=null;let Se=null;for(j=0;oe;){j++;let fe=oe,_e=0;for(let Be=0;Be<X&&(_e++,fe=fe.nextZ,fe);Be++);let Oe=X;for(;_e>0||Oe>0&&fe;)_e!==0&&(Oe===0||!fe||oe.z<=fe.z)?(J=oe,oe=oe.nextZ,_e--):(J=fe,fe=fe.nextZ,Oe--),Se?Se.nextZ=J:V=J,J.prevZ=Se,Se=J;oe=fe}Se.nextZ=null,X*=2}while(j>1)}(B)}(u,f,g,x);let T=u;for(;u.prev!==u.next;){const A=u.prev,C=u.next;if(x?_M(u,f,g,x):mM(u))s.push(A.i,u.i,C.i),rf(u),u=C.next,T=C.next;else if((u=C)===T){b?b===1?Jd(u=yM(Sc(u),s),s,l,f,g,x,2):b===2&&vM(u,s,l,f,g,x):Jd(Sc(u),s,l,f,g,x,1);break}}}function mM(u){const s=u.prev,l=u,f=u.next;if(yn(s,l,f)>=0)return!1;const g=s.x,x=l.x,b=f.x,T=s.y,A=l.y,C=f.y,R=Math.min(g,x,b),O=Math.min(T,A,C),B=Math.max(g,x,b),V=Math.max(T,A,C);let j=f.next;for(;j!==s;){if(j.x>=R&&j.x<=B&&j.y>=O&&j.y<=V&&ef(g,T,x,A,b,C,j.x,j.y)&&yn(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function _M(u,s,l,f){const g=u.prev,x=u,b=u.next;if(yn(g,x,b)>=0)return!1;const T=g.x,A=x.x,C=b.x,R=g.y,O=x.y,B=b.y,V=Math.min(T,A,C),j=Math.min(R,O,B),X=Math.max(T,A,C),J=Math.max(R,O,B),oe=lv(V,j,s,l,f),Se=lv(X,J,s,l,f);let fe=u.prevZ,_e=u.nextZ;for(;fe&&fe.z>=oe&&_e&&_e.z<=Se;){if(fe.x>=V&&fe.x<=X&&fe.y>=j&&fe.y<=J&&fe!==g&&fe!==b&&ef(T,R,A,O,C,B,fe.x,fe.y)&&yn(fe.prev,fe,fe.next)>=0||(fe=fe.prevZ,_e.x>=V&&_e.x<=X&&_e.y>=j&&_e.y<=J&&_e!==g&&_e!==b&&ef(T,R,A,O,C,B,_e.x,_e.y)&&yn(_e.prev,_e,_e.next)>=0))return!1;_e=_e.nextZ}for(;fe&&fe.z>=oe;){if(fe.x>=V&&fe.x<=X&&fe.y>=j&&fe.y<=J&&fe!==g&&fe!==b&&ef(T,R,A,O,C,B,fe.x,fe.y)&&yn(fe.prev,fe,fe.next)>=0)return!1;fe=fe.prevZ}for(;_e&&_e.z<=Se;){if(_e.x>=V&&_e.x<=X&&_e.y>=j&&_e.y<=J&&_e!==g&&_e!==b&&ef(T,R,A,O,C,B,_e.x,_e.y)&&yn(_e.prev,_e,_e.next)>=0)return!1;_e=_e.nextZ}return!0}function yM(u,s){let l=u;do{const f=l.prev,g=l.next.next;!Zu(f,g)&&Pw(f,l,l.next,g)&&tf(f,g)&&tf(g,f)&&(s.push(f.i,l.i,g.i),rf(l),rf(l.next),l=u=g),l=l.next}while(l!==u);return Sc(l)}function vM(u,s,l,f,g,x){let b=u;do{let T=b.next.next;for(;T!==b.prev;){if(b.i!==T.i&&SM(b,T)){let A=Cw(b,T);return b=Sc(b,b.next),A=Sc(A,A.next),Jd(b,s,l,f,g,x,0),void Jd(A,s,l,f,g,x,0)}T=T.next}b=b.next}while(b!==u)}function xM(u,s){let l=u.x-s.x;return l===0&&(l=u.y-s.y,l===0)&&(l=(u.next.y-u.y)/(u.next.x-u.x)-(s.next.y-s.y)/(s.next.x-s.x)),l}function bM(u,s){const l=function(g,x){let b=x;const T=g.x,A=g.y;let C,R=-1/0;if(Zu(g,b))return b;do{if(Zu(g,b.next))return b.next;if(A<=b.y&&A>=b.next.y&&b.next.y!==b.y){const X=b.x+(A-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(X<=T&&X>R&&(R=X,C=b.x<b.next.x?b:b.next,X===T))return C}b=b.next}while(b!==x);if(!C)return null;const O=C,B=C.x,V=C.y;let j=1/0;b=C;do{if(T>=b.x&&b.x>=B&&T!==b.x&&Iw(A<V?T:R,A,B,V,A<V?R:T,A,b.x,b.y)){const X=Math.abs(A-b.y)/(T-b.x);tf(b,g)&&(X<j||X===j&&(b.x>C.x||b.x===C.x&&wM(C,b)))&&(C=b,j=X)}b=b.next}while(b!==O);return C}(u,s);if(!l)return s;const f=Cw(l,u);return Sc(f,f.next),Sc(l,l.next)}function wM(u,s){return yn(u.prev,u,s.prev)<0&&yn(s.next,u,u.next)<0}function lv(u,s,l,f,g){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-l)*g|0)|u<<8))|u<<4))|u<<2))|u<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-f)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function TM(u){let s=u,l=u;do(s.x<l.x||s.x===l.x&&s.y<l.y)&&(l=s),s=s.next;while(s!==u);return l}function Iw(u,s,l,f,g,x,b,T){return(g-b)*(s-T)>=(u-b)*(x-T)&&(u-b)*(f-T)>=(l-b)*(s-T)&&(l-b)*(x-T)>=(g-b)*(f-T)}function ef(u,s,l,f,g,x,b,T){return!(u===b&&s===T)&&Iw(u,s,l,f,g,x,b,T)}function SM(u,s){return u.next.i!==s.i&&u.prev.i!==s.i&&!function(l,f){let g=l;do{if(g.i!==l.i&&g.next.i!==l.i&&g.i!==f.i&&g.next.i!==f.i&&Pw(g,g.next,l,f))return!0;g=g.next}while(g!==l);return!1}(u,s)&&(tf(u,s)&&tf(s,u)&&function(l,f){let g=l,x=!1;const b=(l.x+f.x)/2,T=(l.y+f.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&b<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(x=!x),g=g.next;while(g!==l);return x}(u,s)&&(yn(u.prev,u,s.prev)||yn(u,s.prev,s))||Zu(u,s)&&yn(u.prev,u,u.next)>0&&yn(s.prev,s,s.next)>0)}function yn(u,s,l){return(s.y-u.y)*(l.x-s.x)-(s.x-u.x)*(l.y-s.y)}function Zu(u,s){return u.x===s.x&&u.y===s.y}function Pw(u,s,l,f){const g=kg(yn(u,s,l)),x=kg(yn(u,s,f)),b=kg(yn(l,f,u)),T=kg(yn(l,f,s));return g!==x&&b!==T||!(g!==0||!Rg(u,l,s))||!(x!==0||!Rg(u,f,s))||!(b!==0||!Rg(l,u,f))||!(T!==0||!Rg(l,s,f))}function Rg(u,s,l){return s.x<=Math.max(u.x,l.x)&&s.x>=Math.min(u.x,l.x)&&s.y<=Math.max(u.y,l.y)&&s.y>=Math.min(u.y,l.y)}function kg(u){return u>0?1:u<0?-1:0}function tf(u,s){return yn(u.prev,u,u.next)<0?yn(u,s,u.next)>=0&&yn(u,u.prev,s)>=0:yn(u,s,u.prev)<0||yn(u,u.next,s)<0}function Cw(u,s){const l=cv(u.i,u.x,u.y),f=cv(s.i,s.x,s.y),g=u.next,x=s.prev;return u.next=s,s.prev=u,l.next=g,g.prev=l,f.next=l,l.prev=f,x.next=f,f.prev=x,f}function Mw(u,s,l,f){const g=cv(u,s,l);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function rf(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function cv(u,s,l){return{i:u,x:s,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class qu{constructor(s,l){if(l>s)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=s,this._minGranularity=l}getGranularityForZoomLevel(s){return Math.max(Math.floor(this._baseZoomGranularity/(1<<s)),this._minGranularity,1)}}class Dg{constructor(s){this.fill=s.fill,this.line=s.line,this.tile=s.tile,this.stencil=s.stencil,this.circle=s.circle}}Dg.noSubdivision=new Dg({fill:new qu(0,0),line:new qu(0,0),tile:new qu(0,0),stencil:new qu(0,0),circle:1}),pt("SubdivisionGranularityExpression",qu),pt("SubdivisionGranularitySetting",Dg);const Yu=-32768,nf=32767;class EM{constructor(s,l){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=s,this._granularityCellSize=Qe/s,this._canonical=l}_getKey(s,l){return(s+=32768)<<16|l+32768}_vertexToIndex(s,l){if(s<-32768||l<-32768||s>32767||l>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const f=0|Math.round(s),g=0|Math.round(l),x=this._getKey(f,g);if(this._vertexDictionary.has(x))return this._vertexDictionary.get(x);const b=this._vertexBuffer.length/2;return this._vertexDictionary.set(x,b),this._vertexBuffer.push(f,g),b}_subdivideTrianglesScanline(s){if(this._granularity<2)return function(g,x){const b=[];for(let T=0;T<x.length;T+=3){const A=x[T],C=x[T+1],R=x[T+2],O=g[2*A],B=g[2*A+1];(g[2*C]-O)*(g[2*R+1]-B)-(g[2*C+1]-B)*(g[2*R]-O)>0?(b.push(A),b.push(R),b.push(C)):(b.push(A),b.push(C),b.push(R))}return b}(this._vertexBuffer,s);const l=[],f=s.length;for(let g=0;g<f;g+=3){const x=[s[g+0],s[g+1],s[g+2]],b=[this._vertexBuffer[2*s[g+0]+0],this._vertexBuffer[2*s[g+0]+1],this._vertexBuffer[2*s[g+1]+0],this._vertexBuffer[2*s[g+1]+1],this._vertexBuffer[2*s[g+2]+0],this._vertexBuffer[2*s[g+2]+1]];let T=1/0,A=1/0,C=-1/0,R=-1/0;for(let X=0;X<3;X++){const J=b[2*X],oe=b[2*X+1];T=Math.min(T,J),C=Math.max(C,J),A=Math.min(A,oe),R=Math.max(R,oe)}if(T===C||A===R)continue;const O=Math.floor(T/this._granularityCellSize),B=Math.ceil(C/this._granularityCellSize),V=Math.floor(A/this._granularityCellSize),j=Math.ceil(R/this._granularityCellSize);if(O!==B||V!==j)for(let X=V;X<j;X++){const J=this._scanlineGenerateVertexRingForCellRow(X,b,x);AM(this._vertexBuffer,J,l)}else l.push(...x)}return l}_scanlineGenerateVertexRingForCellRow(s,l,f){const g=s*this._granularityCellSize,x=g+this._granularityCellSize,b=[];for(let T=0;T<3;T++){const A=l[2*T],C=l[2*T+1],R=l[2*(T+1)%6],O=l[(2*(T+1)+1)%6],B=l[2*(T+2)%6],V=l[(2*(T+2)+1)%6],j=R-A,X=O-C,J=j===0,oe=X===0,Se=(g-C)/X,fe=(x-C)/X,_e=Math.min(Se,fe),Oe=Math.max(Se,fe);if(!oe&&(_e>=1||Oe<=0)||oe&&(C<g||C>x)){O>=g&&O<=x&&b.push(f[(T+1)%3]);continue}!oe&&_e>0&&b.push(this._vertexToIndex(A+j*_e,C+X*_e));const Be=A+j*Math.max(_e,0),Ye=A+j*Math.min(Oe,1);J||this._generateIntraEdgeVertices(b,A,C,R,O,Be,Ye),!oe&&Oe<1&&b.push(this._vertexToIndex(A+j*Oe,C+X*Oe)),(oe||O>=g&&O<=x)&&b.push(f[(T+1)%3]),!oe&&(O<=g||O>=x)&&this._generateInterEdgeVertices(b,A,C,R,O,B,V,Ye,g,x)}return b}_generateIntraEdgeVertices(s,l,f,g,x,b,T){const A=g-l,C=x-f,R=C===0,O=R?Math.min(l,g):Math.min(b,T),B=R?Math.max(l,g):Math.max(b,T),V=Math.floor(O/this._granularityCellSize)+1,j=Math.ceil(B/this._granularityCellSize)-1;if(R?l<g:b<T)for(let X=V;X<=j;X++){const J=X*this._granularityCellSize;s.push(this._vertexToIndex(J,f+C*(J-l)/A))}else for(let X=j;X>=V;X--){const J=X*this._granularityCellSize;s.push(this._vertexToIndex(J,f+C*(J-l)/A))}}_generateInterEdgeVertices(s,l,f,g,x,b,T,A,C,R){const O=x-f,B=b-g,V=T-x,j=(C-x)/V,X=(R-x)/V,J=Math.min(j,X),oe=Math.max(j,X),Se=g+B*J;let fe=Math.floor(Math.min(Se,A)/this._granularityCellSize)+1,_e=Math.ceil(Math.max(Se,A)/this._granularityCellSize)-1,Oe=A<Se;const Be=V===0;if(Be&&(T===C||T===R))return;if(Be||J>=1||oe<=0){const ut=f-T,tt=b+(l-b)*Math.min((C-T)/ut,(R-T)/ut);fe=Math.floor(Math.min(tt,A)/this._granularityCellSize)+1,_e=Math.ceil(Math.max(tt,A)/this._granularityCellSize)-1,Oe=A<tt}const Ye=O>0?R:C;if(Oe)for(let ut=fe;ut<=_e;ut++)s.push(this._vertexToIndex(ut*this._granularityCellSize,Ye));else for(let ut=_e;ut>=fe;ut--)s.push(this._vertexToIndex(ut*this._granularityCellSize,Ye))}_generateOutline(s){const l=[];for(const f of s){const g=Ec(f,this._granularity,!0),x=this._pointArrayToIndices(g),b=[];for(let T=1;T<x.length;T++)b.push(x[T-1]),b.push(x[T]);l.push(b)}return l}_handlePoles(s){let l=!1,f=!1;this._canonical&&(this._canonical.y===0&&(l=!0),this._canonical.y===(1<<this._canonical.z)-1&&(f=!0)),(l||f)&&this._fillPoles(s,l,f)}_ensureNoPoleVertices(){const s=this._vertexBuffer;for(let l=0;l<s.length;l+=2){const f=s[l+1];f===Yu&&(s[l+1]=-32767),f===nf&&(s[l+1]=32766)}}_generatePoleQuad(s,l,f,g,x,b){g>x!=(b===Yu)?(s.push(l),s.push(f),s.push(this._vertexToIndex(g,b)),s.push(f),s.push(this._vertexToIndex(x,b)),s.push(this._vertexToIndex(g,b))):(s.push(f),s.push(l),s.push(this._vertexToIndex(g,b)),s.push(this._vertexToIndex(x,b)),s.push(f),s.push(this._vertexToIndex(g,b)))}_fillPoles(s,l,f){const g=this._vertexBuffer,x=Qe,b=s.length;for(let T=2;T<b;T+=3){const A=s[T-2],C=s[T-1],R=s[T],O=g[2*A],B=g[2*A+1],V=g[2*C],j=g[2*C+1],X=g[2*R],J=g[2*R+1];l&&(B===0&&j===0&&this._generatePoleQuad(s,A,C,O,V,Yu),j===0&&J===0&&this._generatePoleQuad(s,C,R,V,X,Yu),J===0&&B===0&&this._generatePoleQuad(s,R,A,X,O,Yu)),f&&(B===x&&j===x&&this._generatePoleQuad(s,A,C,O,V,nf),j===x&&J===x&&this._generatePoleQuad(s,C,R,V,X,nf),J===x&&B===x&&this._generatePoleQuad(s,R,A,X,O,nf))}}_initializeVertices(s){for(let l=0;l<s.length;l+=2)this._vertexToIndex(s[l],s[l+1])}subdividePolygonInternal(s,l){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:f,holeIndices:g}=function(T){const A=[],C=[];for(const R of T)if(R.length!==0){R!==T[0]&&A.push(C.length/2);for(let O=0;O<R.length;O++)C.push(R[O].x),C.push(R[O].y)}return{flattened:C,holeIndices:A}}(s);let x;this._initializeVertices(f);try{const T=function(C,R,O=2){const B=R&&R.length,V=B?R[0]*O:C.length;let j=Aw(C,0,V,O,!0);const X=[];if(!j||j.next===j.prev)return X;let J,oe,Se;if(B&&(j=function(fe,_e,Oe,Be){const Ye=[];for(let ut=0,tt=_e.length;ut<tt;ut++){const ot=Aw(fe,_e[ut]*Be,ut<tt-1?_e[ut+1]*Be:fe.length,Be,!1);ot===ot.next&&(ot.steiner=!0),Ye.push(TM(ot))}Ye.sort(xM);for(let ut=0;ut<Ye.length;ut++)Oe=bM(Ye[ut],Oe);return Oe}(C,R,j,O)),C.length>80*O){J=C[0],oe=C[1];let fe=J,_e=oe;for(let Oe=O;Oe<V;Oe+=O){const Be=C[Oe],Ye=C[Oe+1];Be<J&&(J=Be),Ye<oe&&(oe=Ye),Be>fe&&(fe=Be),Ye>_e&&(_e=Ye)}Se=Math.max(fe-J,_e-oe),Se=Se!==0?32767/Se:0}return Jd(j,X,O,J,oe,Se,0),X}(f,g),A=this._convertIndices(f,T);x=this._subdivideTrianglesScanline(A)}catch(T){console.error(T)}let b=[];return l&&(b=this._generateOutline(s)),this._ensureNoPoleVertices(),this._handlePoles(x),{verticesFlattened:this._vertexBuffer,indicesTriangles:x,indicesLineList:b}}_convertIndices(s,l){const f=[];for(let g=0;g<l.length;g++)f.push(this._vertexToIndex(s[2*l[g]],s[2*l[g]+1]));return f}_pointArrayToIndices(s){const l=[];for(let f=0;f<s.length;f++){const g=s[f];l.push(this._vertexToIndex(g.x,g.y))}return l}}function Rw(u,s,l,f=!0){return new EM(l,s).subdividePolygonInternal(u,f)}function Ec(u,s,l=!1){if(!u||u.length<1)return[];if(u.length<2)return[];const f=u[0],g=u[u.length-1],x=l&&(f.x!==g.x||f.y!==g.y);if(s<2)return x?[...u,u[0]]:[...u];const b=Math.floor(Qe/s),T=[];T.push(new y(u[0].x,u[0].y));const A=u.length,C=x?A:A-1;for(let R=0;R<C;R++){const O=u[R],B=R<A-1?u[R+1]:u[0],V=O.x,j=O.y,X=B.x,J=B.y,oe=V!==X,Se=j!==J;if(!oe&&!Se)continue;const fe=X-V,_e=J-j,Oe=Math.abs(fe),Be=Math.abs(_e);let Ye=V,ut=j;for(;;){const ot=fe>0?(Math.floor(Ye/b)+1)*b:(Math.ceil(Ye/b)-1)*b,Et=_e>0?(Math.floor(ut/b)+1)*b:(Math.ceil(ut/b)-1)*b,st=Math.abs(Ye-ot),at=Math.abs(ut-Et),He=Math.abs(Ye-X),zt=Math.abs(ut-J),jt=oe?st/Oe:Number.POSITIVE_INFINITY,Rt=Se?at/Be:Number.POSITIVE_INFINITY;if((He<=st||!oe)&&(zt<=at||!Se))break;if(jt<Rt&&oe||!Se){Ye=ot,ut+=_e*jt;const Tt=new y(Ye,Math.round(ut));T[T.length-1].x===Tt.x&&T[T.length-1].y===Tt.y||T.push(Tt)}else{Ye+=fe*Rt,ut=Et;const Tt=new y(Math.round(Ye),ut);T[T.length-1].x===Tt.x&&T[T.length-1].y===Tt.y||T.push(Tt)}}const tt=new y(X,J);T[T.length-1].x===tt.x&&T[T.length-1].y===tt.y||T.push(tt)}return T}function AM(u,s,l){if(s.length===0)throw new Error("Subdivision vertex ring is empty.");let f=0,g=u[2*s[0]];for(let A=1;A<s.length;A++){const C=u[2*s[A]];C<g&&(g=C,f=A)}const x=s.length;let b=f,T=(b+1)%x;for(;;){const A=b-1>=0?b-1:x-1,C=(T+1)%x,R=u[2*s[A]],O=u[2*s[C]],B=u[2*s[b]],V=u[2*s[b]+1],j=u[2*s[T]+1];let X=!1;if(R<O)X=!0;else if(R>O)X=!1;else{const J=j-V,oe=-(u[2*s[T]]-B),Se=V<j?1:-1;((R-B)*J+(u[2*s[A]+1]-V)*oe)*Se>((O-B)*J+(u[2*s[C]+1]-V)*oe)*Se&&(X=!0)}if(X){const J=s[A],oe=s[b],Se=s[T];J!==oe&&J!==Se&&oe!==Se&&l.push(Se,oe,J),b--,b<0&&(b=x-1)}else{const J=s[C],oe=s[b],Se=s[T];J!==oe&&J!==Se&&oe!==Se&&l.push(Se,oe,J),T++,T>=x&&(T=0)}if(A===C)break}}function kw(u,s,l,f,g,x,b,T,A){const C=g.length/2,R=b&&T&&A;if(C<Yt.MAX_VERTEX_ARRAY_LENGTH){const O=s.prepareSegment(C,l,f),B=O.vertexLength;for(let X=0;X<x.length;X+=3)f.emplaceBack(B+x[X],B+x[X+1],B+x[X+2]);let V,j;O.vertexLength+=C,O.primitiveLength+=x.length/3,R&&(j=b.prepareSegment(C,l,T),V=j.vertexLength,j.vertexLength+=C);for(let X=0;X<g.length;X+=2)u(g[X],g[X+1]);if(R)for(let X=0;X<A.length;X++){const J=A[X];for(let oe=1;oe<J.length;oe+=2)T.emplaceBack(V+J[oe-1],V+J[oe]);j.primitiveLength+=J.length/2}}else(function(O,B,V,j,X,J){const oe=[];for(let Be=0;Be<j.length/2;Be++)oe.push(-1);const Se={count:0};let fe=0,_e=O.getOrCreateLatestSegment(B,V),Oe=_e.vertexLength;for(let Be=2;Be<X.length;Be+=3){const Ye=X[Be-2],ut=X[Be-1],tt=X[Be];let ot=oe[Ye]<fe,Et=oe[ut]<fe,st=oe[tt]<fe;_e.vertexLength+((ot?1:0)+(Et?1:0)+(st?1:0))>Yt.MAX_VERTEX_ARRAY_LENGTH&&(_e=O.createNewSegment(B,V),fe=Se.count,ot=!0,Et=!0,st=!0,Oe=0);const at=sf(oe,j,J,Se,Ye,ot,_e),He=sf(oe,j,J,Se,ut,Et,_e),zt=sf(oe,j,J,Se,tt,st,_e);V.emplaceBack(Oe+at-fe,Oe+He-fe,Oe+zt-fe),_e.primitiveLength++}})(s,l,f,g,x,u),R&&function(O,B,V,j,X,J){const oe=[];for(let Be=0;Be<j.length/2;Be++)oe.push(-1);const Se={count:0};let fe=0,_e=O.getOrCreateLatestSegment(B,V),Oe=_e.vertexLength;for(let Be=0;Be<X.length;Be++){const Ye=X[Be];for(let ut=1;ut<X[Be].length;ut+=2){const tt=Ye[ut-1],ot=Ye[ut];let Et=oe[tt]<fe,st=oe[ot]<fe;_e.vertexLength+((Et?1:0)+(st?1:0))>Yt.MAX_VERTEX_ARRAY_LENGTH&&(_e=O.createNewSegment(B,V),fe=Se.count,Et=!0,st=!0,Oe=0);const at=sf(oe,j,J,Se,tt,Et,_e),He=sf(oe,j,J,Se,ot,st,_e);V.emplaceBack(Oe+at-fe,Oe+He-fe),_e.primitiveLength++}}}(b,l,T,g,A,u),s.forceNewSegmentOnNextPrepare(),b==null||b.forceNewSegmentOnNextPrepare()}function sf(u,s,l,f,g,x,b){if(x){const T=f.count;return l(s[2*g],s[2*g+1]),u[g]=f.count,f.count++,b.vertexLength++,T}return u[g]}class uv{constructor(s){this.zoom=s.zoom,this.globalState=s.globalState,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Le,this.indexArray=new zr,this.indexArray2=new Fr,this.programConfigurations=new Hi(s.layers,s.zoom),this.segments=new Yt,this.segments2=new Yt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(s,l,f){this.hasPattern=ov("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),x=!g.isConstant(),b=[];for(const{feature:T,id:A,index:C,sourceLayerIndex:R}of s){const O=this.layers[0]._featureFilter.needGeometry,B=uo(T,O);if(!this.layers[0]._featureFilter.filter(new jr(this.zoom,{globalState:this.globalState}),B,f))continue;const V=x?g.evaluate(B,{},f,l.availableImages):void 0,j={id:A,properties:T.properties,type:T.type,sourceLayerIndex:R,index:C,geometry:O?B.geometry:Vo(T),patterns:{},sortKey:V};b.push(j)}x&&b.sort((T,A)=>T.sortKey-A.sortKey);for(const T of b){const{geometry:A,index:C,sourceLayerIndex:R}=T;if(this.hasPattern){const O=av("fill",this.layers,T,{zoom:this.zoom,globalState:this.globalState},l);this.patternFeatures.push(O)}else this.addFeature(T,A,C,f,{},l.subdivisionGranularity);l.featureIndex.insert(s[C].feature,A,C,R,this.index)}}update(s,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,{imagePositions:f,globalState:this.globalState})}addFeatures(s,l,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,f,s.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,gM),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,l,f,g,x,b){for(const T of lc(l,500)){const A=Rw(T,g,b.fill.getGranularityForZoomLevel(g.z)),C=this.layoutVertexArray;kw((R,O)=>{C.emplaceBack(R,O)},this.segments,this.layoutVertexArray,this.indexArray,A.verticesFlattened,A.indicesTriangles,this.segments2,this.indexArray2,A.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,{imagePositions:x,canonical:g,globalState:this.globalState})}}let Dw,Ow;pt("FillBucket",uv,{omit:["layers","patternFeatures"]});var IM={get paint(){return Ow=Ow||new _i({"fill-antialias":new St(Te.paint_fill["fill-antialias"]),"fill-opacity":new Nt(Te.paint_fill["fill-opacity"]),"fill-color":new Nt(Te.paint_fill["fill-color"]),"fill-outline-color":new Nt(Te.paint_fill["fill-outline-color"]),"fill-translate":new St(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new St(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bu(Te.paint_fill["fill-pattern"])})},get layout(){return Dw=Dw||new _i({"fill-sort-key":new Nt(Te.layout_fill["fill-sort-key"])})}};class PM extends os{constructor(s){super(s,IM)}recalculate(s,l){super.recalculate(s,l);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new uv(s)}queryRadius(){return Cg(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:s,geometry:l,transform:f,pixelsToTileUnits:g}){return dw(Mg(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-f.bearingInRadians,g),l)}isTileClipped(){return!0}}const CM=dn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),MM=dn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:RM}=CM;class Gu{constructor(s,l,f,g,x){this.properties={},this.extent=f,this.type=0,this.id=void 0,this._pbf=s,this._geometry=-1,this._keys=g,this._values=x,s.readFields(kM,this,l)}loadGeometry(){const s=this._pbf;s.pos=this._geometry;const l=s.readVarint()+s.pos,f=[];let g,x=1,b=0,T=0,A=0;for(;s.pos<l;){if(b<=0){const C=s.readVarint();x=7&C,b=C>>3}if(b--,x===1||x===2)T+=s.readSVarint(),A+=s.readSVarint(),x===1&&(g&&f.push(g),g=[]),g&&g.push(new y(T,A));else{if(x!==7)throw new Error(`unknown command ${x}`);g&&g.push(g[0].clone())}}return g&&f.push(g),f}bbox(){const s=this._pbf;s.pos=this._geometry;const l=s.readVarint()+s.pos;let f=1,g=0,x=0,b=0,T=1/0,A=-1/0,C=1/0,R=-1/0;for(;s.pos<l;){if(g<=0){const O=s.readVarint();f=7&O,g=O>>3}if(g--,f===1||f===2)x+=s.readSVarint(),b+=s.readSVarint(),x<T&&(T=x),x>A&&(A=x),b<C&&(C=b),b>R&&(R=b);else if(f!==7)throw new Error(`unknown command ${f}`)}return[T,C,A,R]}toGeoJSON(s,l,f){const g=this.extent*Math.pow(2,f),x=this.extent*s,b=this.extent*l,T=this.loadGeometry();function A(B){return[360*(B.x+x)/g-180,360/Math.PI*Math.atan(Math.exp((1-2*(B.y+b)/g)*Math.PI))-90]}function C(B){return B.map(A)}let R;if(this.type===1){const B=[];for(const j of T)B.push(j[0]);const V=C(B);R=B.length===1?{type:"Point",coordinates:V[0]}:{type:"MultiPoint",coordinates:V}}else if(this.type===2){const B=T.map(C);R=B.length===1?{type:"LineString",coordinates:B[0]}:{type:"MultiLineString",coordinates:B}}else{if(this.type!==3)throw new Error("unknown feature type");{const B=function(j){const X=j.length;if(X<=1)return[j];const J=[];let oe,Se;for(let fe=0;fe<X;fe++){const _e=DM(j[fe]);_e!==0&&(Se===void 0&&(Se=_e<0),Se===_e<0?(oe&&J.push(oe),oe=[j[fe]]):oe&&oe.push(j[fe]))}return oe&&J.push(oe),J}(T),V=[];for(const j of B)V.push(j.map(C));R=V.length===1?{type:"Polygon",coordinates:V[0]}:{type:"MultiPolygon",coordinates:V}}}const O={type:"Feature",geometry:R,properties:this.properties};return this.id!=null&&(O.id=this.id),O}}function kM(u,s,l){u===1?s.id=l.readVarint():u===2?function(f,g){const x=f.readVarint()+f.pos;for(;f.pos<x;){const b=g._keys[f.readVarint()],T=g._values[f.readVarint()];g.properties[b]=T}}(l,s):u===3?s.type=l.readVarint():u===4&&(s._geometry=l.pos)}function DM(u){let s=0;for(let l,f,g=0,x=u.length,b=x-1;g<x;b=g++)l=u[g],f=u[b],s+=(f.x-l.x)*(l.y+f.y);return s}Gu.types=["Unknown","Point","LineString","Polygon"];class Fw{constructor(s,l){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(OM,this,l),this.length=this._features.length}feature(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];const l=this._pbf.readVarint()+this._pbf.pos;return new Gu(this._pbf,l,this.extent,this._keys,this._values)}}function OM(u,s,l){u===15?s.version=l.readVarint():u===1?s.name=l.readString():u===5?s.extent=l.readVarint():u===2?s._features.push(l.pos):u===3?s._keys.push(l.readString()):u===4&&s._values.push(function(f){let g=null;const x=f.readVarint()+f.pos;for(;f.pos<x;){const b=f.readVarint()>>3;g=b===1?f.readString():b===2?f.readFloat():b===3?f.readDouble():b===4?f.readVarint64():b===5?f.readVarint():b===6?f.readSVarint():b===7?f.readBoolean():null}if(g==null)throw new Error("unknown feature value");return g}(l))}class Nw{constructor(s,l){this.layers=s.readFields(FM,{},l)}}function FM(u,s,l){if(u===3){const f=new Fw(l,l.readVarint()+l.pos);f.length&&(s[f.name]=f)}}const hv=Math.pow(2,13);function of(u,s,l,f,g,x,b,T){u.emplaceBack(s,l,2*Math.floor(f*hv)+b,g*hv*2,x*hv*2,Math.round(T))}class dv{constructor(s){this.zoom=s.zoom,this.globalState=s.globalState,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new ke,this.centroidVertexArray=new he,this.indexArray=new zr,this.programConfigurations=new Hi(s.layers,s.zoom),this.segments=new Yt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(s,l,f){this.features=[],this.hasPattern=ov("fill-extrusion",this.layers,l);for(const{feature:g,id:x,index:b,sourceLayerIndex:T}of s){const A=this.layers[0]._featureFilter.needGeometry,C=uo(g,A);if(!this.layers[0]._featureFilter.filter(new jr(this.zoom,{globalState:this.globalState}),C,f))continue;const R={id:x,sourceLayerIndex:T,index:b,geometry:A?C.geometry:Vo(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(av("fill-extrusion",this.layers,R,{zoom:this.zoom,globalState:this.globalState},l)):this.addFeature(R,R.geometry,b,f,{},l.subdivisionGranularity),l.featureIndex.insert(g,R.geometry,b,T,this.index,!0)}}addFeatures(s,l,f){for(const g of this.features){const{geometry:x}=g;this.addFeature(g,x,g.index,l,f,s.subdivisionGranularity)}}update(s,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,{imagePositions:f,globalState:this.globalState})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,RM),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,MM.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,l,f,g,x,b){for(const T of lc(l,500)){const A={x:0,y:0,sampleCount:0},C=this.layoutVertexArray.length;this.processPolygon(A,g,s,T,b);const R=this.layoutVertexArray.length-C,O=Math.floor(A.x/A.sampleCount),B=Math.floor(A.y/A.sampleCount);for(let V=0;V<R;V++)this.centroidVertexArray.emplaceBack(O,B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,{imagePositions:x,canonical:g,globalState:this.globalState})}processPolygon(s,l,f,g,x){if(g.length<1||Lw(g[0]))return;for(const O of g)O.length!==0&&NM(s,O);const b={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},T=x.fill.getGranularityForZoomLevel(l.z),A=Gu.types[f.type]==="Polygon";for(const O of g){if(O.length===0||Lw(O))continue;const B=Ec(O,T,A);this._generateSideFaces(B,b)}if(!A)return;const C=Rw(g,l,T,!1),R=this.layoutVertexArray;kw((O,B)=>{of(R,O,B,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,C.verticesFlattened,C.indicesTriangles)}_generateSideFaces(s,l){let f=0;for(let g=1;g<s.length;g++){const x=s[g],b=s[g-1];if(LM(x,b))continue;l.segment.vertexLength+4>Yt.MAX_VERTEX_ARRAY_LENGTH&&(l.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const T=x.sub(b)._perp()._unit(),A=b.dist(x);f+A>32768&&(f=0),of(this.layoutVertexArray,x.x,x.y,T.x,T.y,0,0,f),of(this.layoutVertexArray,x.x,x.y,T.x,T.y,0,1,f),f+=A,of(this.layoutVertexArray,b.x,b.y,T.x,T.y,0,0,f),of(this.layoutVertexArray,b.x,b.y,T.x,T.y,0,1,f);const C=l.segment.vertexLength;this.indexArray.emplaceBack(C,C+2,C+1),this.indexArray.emplaceBack(C+1,C+2,C+3),l.segment.vertexLength+=4,l.segment.primitiveLength+=2}}}function NM(u,s){for(let l=0;l<s.length;l++){const f=s[l];l===s.length-1&&s[0].x===f.x&&s[0].y===f.y||(u.x+=f.x,u.y+=f.y,u.sampleCount++)}}function LM(u,s){return u.x===s.x&&(u.x<0||u.x>Qe)||u.y===s.y&&(u.y<0||u.y>Qe)}function Lw(u){return u.every(s=>s.x<0)||u.every(s=>s.x>Qe)||u.every(s=>s.y<0)||u.every(s=>s.y>Qe)}let zw;pt("FillExtrusionBucket",dv,{omit:["layers","features"]});var zM={get paint(){return zw=zw||new _i({"fill-extrusion-opacity":new St(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Nt(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new St(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new St(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bu(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Nt(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Nt(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new St(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class BM extends os{constructor(s){super(s,zM)}createBucket(s){return new dv(s)}queryRadius(){return Cg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:f,geometry:g,transform:x,pixelsToTileUnits:b,pixelPosMatrix:T}){const A=Mg(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-x.bearingInRadians,b),C=this.paint.get("fill-extrusion-height").evaluate(l,f),R=this.paint.get("fill-extrusion-base").evaluate(l,f),O=function(V,j){const X=[];for(const J of V){const oe=[J.x,J.y,0,1];xt(oe,oe,j),X.push(new y(oe[0]/oe[3],oe[1]/oe[3]))}return X}(A,T),B=function(V,j,X,J){const oe=[],Se=[],fe=J[8]*j,_e=J[9]*j,Oe=J[10]*j,Be=J[11]*j,Ye=J[8]*X,ut=J[9]*X,tt=J[10]*X,ot=J[11]*X;for(const Et of V){const st=[],at=[];for(const He of Et){const zt=He.x,jt=He.y,Rt=J[0]*zt+J[4]*jt+J[12],Tt=J[1]*zt+J[5]*jt+J[13],hr=J[2]*zt+J[6]*jt+J[14],an=J[3]*zt+J[7]*jt+J[15],On=hr+Oe,li=an+Be,Es=Rt+Ye,Zi=Tt+ut,Gn=hr+tt,rn=an+ot,Vn=new y((Rt+fe)/li,(Tt+_e)/li);Vn.z=On/li,st.push(Vn);const Kn=new y(Es/rn,Zi/rn);Kn.z=Gn/rn,at.push(Kn)}oe.push(st),Se.push(at)}return[oe,Se]}(g,R,C,T);return function(V,j,X){let J=1/0;dw(X,j)&&(J=Bw(X,j[0]));for(let oe=0;oe<j.length;oe++){const Se=j[oe],fe=V[oe];for(let _e=0;_e<Se.length-1;_e++){const Oe=Se[_e],Be=[Oe,Se[_e+1],fe[_e+1],fe[_e],Oe];hw(X,Be)&&(J=Math.min(J,Bw(X,Be)))}}return J!==1/0&&J}(B[0],B[1],O)}}function af(u,s){return u.x*s.x+u.y*s.y}function Bw(u,s){if(u.length===1){let l=0;const f=s[l++];let g;for(;!g||f.equals(g);)if(g=s[l++],!g)return 1/0;for(;l<s.length;l++){const x=s[l],b=u[0],T=g.sub(f),A=x.sub(f),C=b.sub(f),R=af(T,T),O=af(T,A),B=af(A,A),V=af(C,T),j=af(C,A),X=R*B-O*O,J=(B*V-O*j)/X,oe=(R*j-O*V)/X,Se=f.z*(1-J-oe)+g.z*J+x.z*oe;if(isFinite(Se))return Se}return 1/0}{let l=1/0;for(const f of s)l=Math.min(l,f.z);return l}}const UM=dn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:VM}=UM,jM=dn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:$M}=jM,WM=Math.cos(Math.PI/180*37.5),Uw=Math.pow(2,14)/.5;class fv{constructor(s){this.zoom=s.zoom,this.globalState=s.globalState,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new De,this.layoutVertexArray2=new Ne,this.indexArray=new zr,this.programConfigurations=new Hi(s.layers,s.zoom),this.segments=new Yt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(s,l,f){this.hasPattern=ov("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),x=!g.isConstant(),b=[];for(const{feature:T,id:A,index:C,sourceLayerIndex:R}of s){const O=this.layers[0]._featureFilter.needGeometry,B=uo(T,O);if(!this.layers[0]._featureFilter.filter(new jr(this.zoom,{globalState:this.globalState}),B,f))continue;const V=x?g.evaluate(B,{},f):void 0,j={id:A,properties:T.properties,type:T.type,sourceLayerIndex:R,index:C,geometry:O?B.geometry:Vo(T),patterns:{},sortKey:V};b.push(j)}x&&b.sort((T,A)=>T.sortKey-A.sortKey);for(const T of b){const{geometry:A,index:C,sourceLayerIndex:R}=T;if(this.hasPattern){const O=av("line",this.layers,T,{zoom:this.zoom,globalState:this.globalState},l);this.patternFeatures.push(O)}else this.addFeature(T,A,C,f,{},l.subdivisionGranularity);l.featureIndex.insert(s[C].feature,A,C,R,this.index)}}update(s,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,{imagePositions:f,globalState:this.globalState})}addFeatures(s,l,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,f,s.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,$M)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,VM),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,l,f,g,x,b){const T=this.layers[0].layout,A=T.get("line-join").evaluate(s,{}),C=T.get("line-cap"),R=T.get("line-miter-limit"),O=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const B of l)this.addLine(B,s,A,C,R,O,g,b);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,{imagePositions:x,canonical:g,globalState:this.globalState})}addLine(s,l,f,g,x,b,T,A){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,s=Ec(s,T?A.line.getGranularityForZoomLevel(T.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let fe=0;fe<s.length-1;fe++)this.totalDistance+=s[fe].dist(s[fe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C=Gu.types[l.type]==="Polygon";let R=s.length;for(;R>=2&&s[R-1].equals(s[R-2]);)R--;let O=0;for(;O<R-1&&s[O].equals(s[O+1]);)O++;if(R<(C?3:2))return;f==="bevel"&&(x=1.05);const B=this.overscaling<=16?122880/(512*this.overscaling):0,V=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let j,X,J,oe,Se;this.e1=this.e2=-1,C&&(j=s[R-2],Se=s[O].sub(j)._unit()._perp());for(let fe=O;fe<R;fe++){if(J=fe===R-1?C?s[O+1]:void 0:s[fe+1],J&&s[fe].equals(J))continue;Se&&(oe=Se),j&&(X=j),j=s[fe],Se=J?J.sub(j)._unit()._perp():oe,oe=oe||Se;let _e=oe.add(Se);_e.x===0&&_e.y===0||_e._unit();const Oe=oe.x*Se.x+oe.y*Se.y,Be=_e.x*Se.x+_e.y*Se.y,Ye=Be!==0?1/Be:1/0,ut=2*Math.sqrt(2-2*Be),tt=Be<WM&&X&&J,ot=oe.x*Se.y-oe.y*Se.x>0;if(tt&&fe>O){const at=j.dist(X);if(at>2*B){const He=j.sub(j.sub(X)._mult(B/at)._round());this.updateDistance(X,He),this.addCurrentVertex(He,oe,0,0,V),X=He}}const Et=X&&J;let st=Et?f:C?"butt":g;if(Et&&st==="round"&&(Ye<b?st="miter":Ye<=2&&(st="fakeround")),st==="miter"&&Ye>x&&(st="bevel"),st==="bevel"&&(Ye>2&&(st="flipbevel"),Ye<x&&(st="miter")),X&&this.updateDistance(X,j),st==="miter")_e._mult(Ye),this.addCurrentVertex(j,_e,0,0,V);else if(st==="flipbevel"){if(Ye>100)_e=Se.mult(-1);else{const at=Ye*oe.add(Se).mag()/oe.sub(Se).mag();_e._perp()._mult(at*(ot?-1:1))}this.addCurrentVertex(j,_e,0,0,V),this.addCurrentVertex(j,_e.mult(-1),0,0,V)}else if(st==="bevel"||st==="fakeround"){const at=-Math.sqrt(Ye*Ye-1),He=ot?at:0,zt=ot?0:at;if(X&&this.addCurrentVertex(j,oe,He,zt,V),st==="fakeround"){const jt=Math.round(180*ut/Math.PI/20);for(let Rt=1;Rt<jt;Rt++){let Tt=Rt/jt;if(Tt!==.5){const an=Tt-.5;Tt+=Tt*an*(Tt-1)*((1.0904+Oe*(Oe*(3.55645-1.43519*Oe)-3.2452))*an*an+(.848013+Oe*(.215638*Oe-1.06021)))}const hr=Se.sub(oe)._mult(Tt)._add(oe)._unit()._mult(ot?-1:1);this.addHalfVertex(j,hr.x,hr.y,!1,ot,0,V)}}J&&this.addCurrentVertex(j,Se,-He,-zt,V)}else if(st==="butt")this.addCurrentVertex(j,_e,0,0,V);else if(st==="square"){const at=X?1:-1;this.addCurrentVertex(j,_e,at,at,V)}else st==="round"&&(X&&(this.addCurrentVertex(j,oe,0,0,V),this.addCurrentVertex(j,oe,1,1,V,!0)),J&&(this.addCurrentVertex(j,Se,-1,-1,V,!0),this.addCurrentVertex(j,Se,0,0,V)));if(tt&&fe<R-1){const at=j.dist(J);if(at>2*B){const He=j.add(J.sub(j)._mult(B/at)._round());this.updateDistance(j,He),this.addCurrentVertex(He,Se,0,0,V),j=He}}}}addCurrentVertex(s,l,f,g,x,b=!1){const T=l.y*g-l.x,A=-l.y-l.x*g;this.addHalfVertex(s,l.x+l.y*f,l.y-l.x*f,b,!1,f,x),this.addHalfVertex(s,T,A,b,!0,-g,x),this.distance>Uw/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,l,f,g,x,b))}addHalfVertex({x:s,y:l},f,g,x,b,T,A){const C=.5*(this.lineClips?this.scaledDistance*(Uw-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(x?1:0),(l<<1)+(b?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,R,this.e2),A.primitiveLength++),b?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,l){this.distance+=s.dist(l),this.updateScaledDistance()}}let Vw,jw;pt("LineBucket",fv,{omit:["layers","patternFeatures"]});var $w={get paint(){return jw=jw||new _i({"line-opacity":new Nt(Te.paint_line["line-opacity"]),"line-color":new Nt(Te.paint_line["line-color"]),"line-translate":new St(Te.paint_line["line-translate"]),"line-translate-anchor":new St(Te.paint_line["line-translate-anchor"]),"line-width":new Nt(Te.paint_line["line-width"]),"line-gap-width":new Nt(Te.paint_line["line-gap-width"]),"line-offset":new Nt(Te.paint_line["line-offset"]),"line-blur":new Nt(Te.paint_line["line-blur"]),"line-dasharray":new No(Te.paint_line["line-dasharray"]),"line-pattern":new Bu(Te.paint_line["line-pattern"]),"line-gradient":new Uu(Te.paint_line["line-gradient"])})},get layout(){return Vw=Vw||new _i({"line-cap":new St(Te.layout_line["line-cap"]),"line-join":new Nt(Te.layout_line["line-join"]),"line-miter-limit":new St(Te.layout_line["line-miter-limit"]),"line-round-limit":new St(Te.layout_line["line-round-limit"]),"line-sort-key":new Nt(Te.layout_line["line-sort-key"])})}};class HM extends Nt{possiblyEvaluate(s,l){return l=new jr(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(s,l)}evaluate(s,l,f,g){return l=Wt({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(s,l,f,g)}}let Og;class XM extends os{constructor(s){super(s,$w),this.gradientVersion=0,Og||(Og=new HM($w.paint.properties["line-width"].specification),Og.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const l=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(l)&&l._styleExpression.expression instanceof hn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,l){super.recalculate(s,l),this.paint._values["line-floorwidth"]=Og.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new fv(s)}queryRadius(s){const l=s,f=Ww(Kd("line-width",this,l),Kd("line-gap-width",this,l)),g=Kd("line-offset",this,l);return f/2+Math.abs(g)+Cg(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:f,geometry:g,transform:x,pixelsToTileUnits:b}){const T=Mg(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-x.bearingInRadians,b),A=b/2*Ww(this.paint.get("line-width").evaluate(l,f),this.paint.get("line-gap-width").evaluate(l,f)),C=this.paint.get("line-offset").evaluate(l,f);return C&&(g=function(R,O){const B=[];for(let V=0;V<R.length;V++){const j=R[V],X=[];for(let J=0;J<j.length;J++){const oe=j[J-1],Se=j[J],fe=j[J+1],_e=J===0?new y(0,0):Se.sub(oe)._unit()._perp(),Oe=J===j.length-1?new y(0,0):fe.sub(Se)._unit()._perp(),Be=_e._add(Oe)._unit(),Ye=Be.x*Oe.x+Be.y*Oe.y;Ye!==0&&Be._mult(1/Ye),X.push(Be._mult(O)._add(Se))}B.push(X)}return B}(g,C*b)),function(R,O,B){for(let V=0;V<O.length;V++){const j=O[V];if(R.length>=3){for(let X=0;X<j.length;X++)if(Xu(R,j[X]))return!0}if(nM(R,j,B))return!0}return!1}(T,g,A)}isTileClipped(){return!0}}function Ww(u,s){return s>0?s+2*u:u}const ZM=dn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),qM=dn([{name:"a_projected_pos",components:3,type:"Float32"}],4);dn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const YM=dn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);dn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Hw=dn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),GM=dn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function KM(u,s,l){return u.sections.forEach(f=>{f.text=function(g,x,b){const T=x.layout.get("text-transform").evaluate(b,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),xs.applyArabicShaping&&(g=xs.applyArabicShaping(g)),g}(f.text,s,l)}),u}dn([{name:"triangle",components:3,type:"Uint16"}]),dn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),dn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),dn([{type:"Float32",name:"offsetX"}]),dn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),dn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const lf={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Un=24;const pv=4294967296,Xw=1/pv,Zw=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class gv{constructor(s=new Uint8Array(16)){this.buf=ArrayBuffer.isView(s)?s:new Uint8Array(s),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(s,l,f=this.length){for(;this.pos<f;){const g=this.readVarint(),x=g>>3,b=this.pos;this.type=7&g,s(x,l,this),this.pos===b&&this.skip(g)}return l}readMessage(s,l){return this.readFields(s,l,this.readVarint()+this.pos)}readFixed32(){const s=this.dataView.getUint32(this.pos,!0);return this.pos+=4,s}readSFixed32(){const s=this.dataView.getInt32(this.pos,!0);return this.pos+=4,s}readFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*pv;return this.pos+=8,s}readSFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*pv;return this.pos+=8,s}readFloat(){const s=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,s}readDouble(){const s=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,s}readVarint(s){const l=this.buf;let f,g;return g=l[this.pos++],f=127&g,g<128?f:(g=l[this.pos++],f|=(127&g)<<7,g<128?f:(g=l[this.pos++],f|=(127&g)<<14,g<128?f:(g=l[this.pos++],f|=(127&g)<<21,g<128?f:(g=l[this.pos],f|=(15&g)<<28,function(x,b,T){const A=T.buf;let C,R;if(R=A[T.pos++],C=(112&R)>>4,R<128||(R=A[T.pos++],C|=(127&R)<<3,R<128)||(R=A[T.pos++],C|=(127&R)<<10,R<128)||(R=A[T.pos++],C|=(127&R)<<17,R<128)||(R=A[T.pos++],C|=(127&R)<<24,R<128)||(R=A[T.pos++],C|=(1&R)<<31,R<128))return Ku(x,C,b);throw new Error("Expected varint not more than 10 bytes")}(f,s,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const s=this.readVarint();return s%2==1?(s+1)/-2:s/2}readBoolean(){return!!this.readVarint()}readString(){const s=this.readVarint()+this.pos,l=this.pos;return this.pos=s,s-l>=12&&Zw?Zw.decode(this.buf.subarray(l,s)):function(f,g,x){let b="",T=g;for(;T<x;){const A=f[T];let C,R,O,B=null,V=A>239?4:A>223?3:A>191?2:1;if(T+V>x)break;V===1?A<128&&(B=A):V===2?(C=f[T+1],(192&C)==128&&(B=(31&A)<<6|63&C,B<=127&&(B=null))):V===3?(C=f[T+1],R=f[T+2],(192&C)==128&&(192&R)==128&&(B=(15&A)<<12|(63&C)<<6|63&R,(B<=2047||B>=55296&&B<=57343)&&(B=null))):V===4&&(C=f[T+1],R=f[T+2],O=f[T+3],(192&C)==128&&(192&R)==128&&(192&O)==128&&(B=(15&A)<<18|(63&C)<<12|(63&R)<<6|63&O,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,V=1):B>65535&&(B-=65536,b+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),b+=String.fromCharCode(B),T+=V}return b}(this.buf,l,s)}readBytes(){const s=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,s);return this.pos=s,l}readPackedVarint(s=[],l){const f=this.readPackedEnd();for(;this.pos<f;)s.push(this.readVarint(l));return s}readPackedSVarint(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readSVarint());return s}readPackedBoolean(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readBoolean());return s}readPackedFloat(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readFloat());return s}readPackedDouble(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readDouble());return s}readPackedFixed32(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readFixed32());return s}readPackedSFixed32(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readSFixed32());return s}readPackedFixed64(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readFixed64());return s}readPackedSFixed64(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readSFixed64());return s}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(s){const l=7&s;if(l===0)for(;this.buf[this.pos++]>127;);else if(l===2)this.pos=this.readVarint()+this.pos;else if(l===5)this.pos+=4;else{if(l!==1)throw new Error(`Unimplemented type: ${l}`);this.pos+=8}}writeTag(s,l){this.writeVarint(s<<3|l)}realloc(s){let l=this.length||16;for(;l<this.pos+s;)l*=2;if(l!==this.length){const f=new Uint8Array(l);f.set(this.buf),this.buf=f,this.dataView=new DataView(f.buffer),this.length=l}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeSFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*Xw),!0),this.pos+=8}writeSFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*Xw),!0),this.pos+=8}writeVarint(s){(s=+s||0)>268435455||s<0?function(l,f){let g,x;if(l>=0?(g=l%4294967296|0,x=l/4294967296|0):(g=~(-l%4294967296),x=~(-l/4294967296),4294967295^g?g=g+1|0:(g=0,x=x+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(b,T,A){A.buf[A.pos++]=127&b|128,b>>>=7,A.buf[A.pos++]=127&b|128,b>>>=7,A.buf[A.pos++]=127&b|128,b>>>=7,A.buf[A.pos++]=127&b|128,A.buf[A.pos]=127&(b>>>=7)}(g,0,f),function(b,T){const A=(7&b)<<4;T.buf[T.pos++]|=A|((b>>>=3)?128:0),b&&(T.buf[T.pos++]=127&b|((b>>>=7)?128:0),b&&(T.buf[T.pos++]=127&b|((b>>>=7)?128:0),b&&(T.buf[T.pos++]=127&b|((b>>>=7)?128:0),b&&(T.buf[T.pos++]=127&b|((b>>>=7)?128:0),b&&(T.buf[T.pos++]=127&b)))))}(x,f)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))}writeSVarint(s){this.writeVarint(s<0?2*-s-1:2*s)}writeBoolean(s){this.writeVarint(+s)}writeString(s){s=String(s),this.realloc(4*s.length),this.pos++;const l=this.pos;this.pos=function(g,x,b){for(let T,A,C=0;C<x.length;C++){if(T=x.charCodeAt(C),T>55295&&T<57344){if(!A){T>56319||C+1===x.length?(g[b++]=239,g[b++]=191,g[b++]=189):A=T;continue}if(T<56320){g[b++]=239,g[b++]=191,g[b++]=189,A=T;continue}T=A-55296<<10|T-56320|65536,A=null}else A&&(g[b++]=239,g[b++]=191,g[b++]=189,A=null);T<128?g[b++]=T:(T<2048?g[b++]=T>>6|192:(T<65536?g[b++]=T>>12|224:(g[b++]=T>>18|240,g[b++]=T>>12&63|128),g[b++]=T>>6&63|128),g[b++]=63&T|128)}return b}(this.buf,s,this.pos);const f=this.pos-l;f>=128&&qw(l,f,this),this.pos=l-1,this.writeVarint(f),this.pos+=f}writeFloat(s){this.realloc(4),this.dataView.setFloat32(this.pos,s,!0),this.pos+=4}writeDouble(s){this.realloc(8),this.dataView.setFloat64(this.pos,s,!0),this.pos+=8}writeBytes(s){const l=s.length;this.writeVarint(l),this.realloc(l);for(let f=0;f<l;f++)this.buf[this.pos++]=s[f]}writeRawMessage(s,l){this.pos++;const f=this.pos;s(l,this);const g=this.pos-f;g>=128&&qw(f,g,this),this.pos=f-1,this.writeVarint(g),this.pos+=g}writeMessage(s,l,f){this.writeTag(s,2),this.writeRawMessage(l,f)}writePackedVarint(s,l){l.length&&this.writeMessage(s,QM,l)}writePackedSVarint(s,l){l.length&&this.writeMessage(s,JM,l)}writePackedBoolean(s,l){l.length&&this.writeMessage(s,rR,l)}writePackedFloat(s,l){l.length&&this.writeMessage(s,eR,l)}writePackedDouble(s,l){l.length&&this.writeMessage(s,tR,l)}writePackedFixed32(s,l){l.length&&this.writeMessage(s,nR,l)}writePackedSFixed32(s,l){l.length&&this.writeMessage(s,iR,l)}writePackedFixed64(s,l){l.length&&this.writeMessage(s,sR,l)}writePackedSFixed64(s,l){l.length&&this.writeMessage(s,oR,l)}writeBytesField(s,l){this.writeTag(s,2),this.writeBytes(l)}writeFixed32Field(s,l){this.writeTag(s,5),this.writeFixed32(l)}writeSFixed32Field(s,l){this.writeTag(s,5),this.writeSFixed32(l)}writeFixed64Field(s,l){this.writeTag(s,1),this.writeFixed64(l)}writeSFixed64Field(s,l){this.writeTag(s,1),this.writeSFixed64(l)}writeVarintField(s,l){this.writeTag(s,0),this.writeVarint(l)}writeSVarintField(s,l){this.writeTag(s,0),this.writeSVarint(l)}writeStringField(s,l){this.writeTag(s,2),this.writeString(l)}writeFloatField(s,l){this.writeTag(s,5),this.writeFloat(l)}writeDoubleField(s,l){this.writeTag(s,1),this.writeDouble(l)}writeBooleanField(s,l){this.writeVarintField(s,+l)}}function Ku(u,s,l){return l?4294967296*s+(u>>>0):4294967296*(s>>>0)+(u>>>0)}function qw(u,s,l){const f=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));l.realloc(f);for(let g=l.pos-1;g>=u;g--)l.buf[g+f]=l.buf[g]}function QM(u,s){for(let l=0;l<u.length;l++)s.writeVarint(u[l])}function JM(u,s){for(let l=0;l<u.length;l++)s.writeSVarint(u[l])}function eR(u,s){for(let l=0;l<u.length;l++)s.writeFloat(u[l])}function tR(u,s){for(let l=0;l<u.length;l++)s.writeDouble(u[l])}function rR(u,s){for(let l=0;l<u.length;l++)s.writeBoolean(u[l])}function nR(u,s){for(let l=0;l<u.length;l++)s.writeFixed32(u[l])}function iR(u,s){for(let l=0;l<u.length;l++)s.writeSFixed32(u[l])}function sR(u,s){for(let l=0;l<u.length;l++)s.writeFixed64(u[l])}function oR(u,s){for(let l=0;l<u.length;l++)s.writeSFixed64(u[l])}function aR(u,s,l){u===1&&l.readMessage(lR,s)}function lR(u,s,l){if(u===3){const{id:f,bitmap:g,width:x,height:b,left:T,top:A,advance:C}=l.readMessage(cR,{});s.push({id:f,bitmap:new Qd({width:x+6,height:b+6},g),metrics:{width:x,height:b,left:T,top:A,advance:C}})}}function cR(u,s,l){u===1?s.id=l.readVarint():u===2?s.bitmap=l.readBytes():u===3?s.width=l.readVarint():u===4?s.height=l.readVarint():u===5?s.left=l.readSVarint():u===6?s.top=l.readSVarint():u===7&&(s.advance=l.readVarint())}function Yw(u){let s=0,l=0;for(const b of u)s+=b.w*b.h,l=Math.max(l,b.w);u.sort((b,T)=>T.h-b.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),l),h:1/0}];let g=0,x=0;for(const b of u)for(let T=f.length-1;T>=0;T--){const A=f[T];if(!(b.w>A.w||b.h>A.h)){if(b.x=A.x,b.y=A.y,x=Math.max(x,b.y+b.h),g=Math.max(g,b.x+b.w),b.w===A.w&&b.h===A.h){const C=f.pop();C&&T<f.length&&(f[T]=C)}else b.h===A.h?(A.x+=b.w,A.w-=b.w):b.w===A.w?(A.y+=b.h,A.h-=b.h):(f.push({x:A.x+b.w,y:A.y,w:A.w-b.w,h:b.h}),A.y+=b.h,A.h-=b.h);break}}return{w:g,h:x,fill:s/(g*x)||0}}class mv{constructor(s,{pixelRatio:l,version:f,stretchX:g,stretchY:x,content:b,textFitWidth:T,textFitHeight:A}){this.paddedRect=s,this.pixelRatio=l,this.stretchX=g,this.stretchY=x,this.content=b,this.version=f,this.textFitWidth=T,this.textFitHeight=A}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Gw{constructor(s,l){const f={},g={};this.haveRenderCallbacks=[];const x=[];this.addImages(s,f,x),this.addImages(l,g,x);const{w:b,h:T}=Yw(x),A=new Xi({width:b||1,height:T||1});for(const C in s){const R=s[C],O=f[C].paddedRect;Xi.copy(R.data,A,{x:0,y:0},{x:O.x+1,y:O.y+1},R.data)}for(const C in l){const R=l[C],O=g[C].paddedRect,B=O.x+1,V=O.y+1,j=R.data.width,X=R.data.height;Xi.copy(R.data,A,{x:0,y:0},{x:B,y:V},R.data),Xi.copy(R.data,A,{x:0,y:X-1},{x:B,y:V-1},{width:j,height:1}),Xi.copy(R.data,A,{x:0,y:0},{x:B,y:V+X},{width:j,height:1}),Xi.copy(R.data,A,{x:j-1,y:0},{x:B-1,y:V},{width:1,height:X}),Xi.copy(R.data,A,{x:0,y:0},{x:B+j,y:V},{width:1,height:X})}this.image=A,this.iconPositions=f,this.patternPositions=g}addImages(s,l,f){for(const g in s){const x=s[g],b={x:0,y:0,w:x.data.width+2,h:x.data.height+2};f.push(b),l[g]=new mv(b,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(s,l){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in s.updatedImages)this.patchUpdatedImage(this.iconPositions[f],s.getImage(f),l),this.patchUpdatedImage(this.patternPositions[f],s.getImage(f),l)}patchUpdatedImage(s,l,f){if(!s||!l||s.version===l.version)return;s.version=l.version;const[g,x]=s.tl;f.update(l.data,void 0,{x:g,y:x})}}var hl;pt("ImagePosition",mv),pt("ImageAtlas",Gw),d.ao=void 0,(hl=d.ao||(d.ao={}))[hl.none=0]="none",hl[hl.horizontal=1]="horizontal",hl[hl.vertical=2]="vertical",hl[hl.horizontalOnly=3]="horizontalOnly";class cf{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(s,l,f){const g=new cf;return g.scale=s||1,g.fontStack=l,g.verticalAlign=f||"bottom",g}static forImage(s,l){const f=new cf;return f.imageName=s,f.verticalAlign=l||"bottom",f}}class Qu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,l){const f=new Qu;for(let g=0;g<s.sections.length;g++){const x=s.sections[g];x.image?f.addImageSection(x):f.addTextSection(x,l)}return f}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let l="";for(let f=0;f<s.length;f++){const g=s.charCodeAt(f+1)||null,x=s.charCodeAt(f-1)||null;l+=g&&xg(g)&&!lf[s[f+1]]||x&&xg(x)&&!lf[s[f-1]]||!lf[s[f]]?s[f]:lf[s[f]]}return l}(this.text)}trim(){let s=0;for(let f=0;f<this.text.length&&Ng[this.text.charCodeAt(f)];f++)s++;let l=this.text.length;for(let f=this.text.length-1;f>=0&&f>=s&&Ng[this.text.charCodeAt(f)];f--)l--;this.text=this.text.substring(s,l),this.sectionIndex=this.sectionIndex.slice(s,l)}substring(s,l){const f=new Qu;return f.text=this.text.substring(s,l),f.sectionIndex=this.sectionIndex.slice(s,l),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,l)=>Math.max(s,this.sections[l].scale),0)}getMaxImageSize(s){let l=0,f=0;for(let g=0;g<this.length();g++){const x=this.getSection(g);if(x.imageName){const b=s[x.imageName];if(!b)continue;const T=b.displaySize;l=Math.max(l,T[0]),f=Math.max(f,T[1])}}return{maxImageWidth:l,maxImageHeight:f}}addTextSection(s,l){this.text+=s.text,this.sections.push(cf.forText(s.scale,s.fontStack||l,s.verticalAlign));const f=this.sections.length-1;for(let g=0;g<s.text.length;++g)this.sectionIndex.push(f)}addImageSection(s){const l=s.image?s.image.name:"";if(l.length===0)return void Ft("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(cf.forImage(l,s.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Ft("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Fg(u,s,l,f,g,x,b,T,A,C,R,O,B,V,j){const X=Qu.fromFeature(u,g);let J;O===d.ao.vertical&&X.verticalizePunctuation();const{processBidirectionalText:oe,processStyledBidirectionalText:Se}=xs;if(oe&&X.sections.length===1){J=[];const Oe=oe(X.toString(),_v(X,C,x,s,f,V));for(const Be of Oe){const Ye=new Qu;Ye.text=Be,Ye.sections=X.sections;for(let ut=0;ut<Be.length;ut++)Ye.sectionIndex.push(0);J.push(Ye)}}else if(Se){J=[];const Oe=Se(X.text,X.sectionIndex,_v(X,C,x,s,f,V));for(const Be of Oe){const Ye=new Qu;Ye.text=Be[0],Ye.sectionIndex=Be[1],Ye.sections=X.sections,J.push(Ye)}}else J=function(Oe,Be){const Ye=[],ut=Oe.text;let tt=0;for(const ot of Be)Ye.push(Oe.substring(tt,ot)),tt=ot;return tt<ut.length&&Ye.push(Oe.substring(tt,ut.length)),Ye}(X,_v(X,C,x,s,f,V));const fe=[],_e={positionedLines:fe,text:X.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(Oe,Be,Ye,ut,tt,ot,Et,st,at,He,zt,jt){let Rt=0,Tt=0,hr=0,an=0;const On=st==="right"?1:st==="left"?0:.5,li=Un/jt;let Es=0;for(const rn of tt){rn.trim();const Vn=rn.getMaxScale(),Kn={positionedGlyphs:[],lineOffset:0};Oe.positionedLines[Es]=Kn;const Qn=Kn.positionedGlyphs;let ki=0;if(!rn.length()){Tt+=ot,++Es;continue}const As=fR(ut,rn,li);for(let qi=0;qi<rn.length();qi++){const Fn=rn.getSection(qi),$n=rn.getSectionIndex(qi),Wn=rn.getCharCode(qi),Pn=pR(at,zt,Wn);let qr;if(Fn.imageName){if(Oe.iconsInText=!0,Fn.scale=Fn.scale*li,qr=mR(Fn,Pn,Vn,As,ut),!qr)continue;ki=Math.max(ki,qr.imageOffset)}else if(qr=gR(Fn,Wn,Pn,As,Be,Ye),!qr)continue;const{rect:ho,metrics:rh,baselineOffset:fo}=qr;Qn.push({glyph:Wn,imageName:Fn.imageName,x:Rt,y:Tt+fo+-17,vertical:Pn,scale:Fn.scale,fontStack:Fn.fontStack,sectionIndex:$n,metrics:rh,rect:ho}),Pn?(Oe.verticalizable=!0,Rt+=(Fn.imageName?rh.advance:Un)*Fn.scale+He):Rt+=rh.advance*Fn.scale+He}Qn.length!==0&&(hr=Math.max(Rt-He,hr),_R(Qn,0,Qn.length-1,On)),Rt=0,Kn.lineOffset=Math.max(ki,(Vn-1)*Un);const jn=ot*Vn+ki;Tt+=jn,an=Math.max(jn,an),++Es}const{horizontalAlign:Zi,verticalAlign:Gn}=yv(Et);(function(rn,Vn,Kn,Qn,ki,As,jn,qi,Fn){const $n=(Vn-Kn)*ki;let Wn=0;Wn=As!==jn?-qi*Qn- -17:-Qn*Fn*jn+.5*jn;for(const Pn of rn)for(const qr of Pn.positionedGlyphs)qr.x+=$n,qr.y+=Wn})(Oe.positionedLines,On,Zi,Gn,hr,an,ot,Tt,tt.length),Oe.top+=-Gn*Tt,Oe.bottom=Oe.top+Tt,Oe.left+=-Zi*hr,Oe.right=Oe.left+hr}(_e,s,l,f,J,b,T,A,O,C,B,j),!function(Oe){for(const Be of Oe)if(Be.positionedGlyphs.length!==0)return!1;return!0}(fe)&&_e}const Ng={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},uR={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},hR={40:!0};function Kw(u,s,l,f,g,x){if(s.imageName){const b=f[s.imageName];return b?b.displaySize[0]*s.scale*Un/x+g:0}{const b=l[s.fontStack],T=b&&b[u];return T?T.metrics.advance*s.scale+g:0}}function Qw(u,s,l,f){const g=Math.pow(u-s,2);return f?u<s?g/2:2*g:g+Math.abs(l)*l}function dR(u,s,l){let f=0;return u===10&&(f-=1e4),l&&(f+=150),u!==40&&u!==65288||(f+=50),s!==41&&s!==65289||(f+=50),f}function Jw(u,s,l,f,g,x){let b=null,T=Qw(s,l,g,x);for(const A of f){const C=Qw(s-A.x,l,g,x)+A.badness;C<=T&&(b=A,T=C)}return{index:u,x:s,priorBreak:b,badness:T}}function e2(u){return u?e2(u.priorBreak).concat(u.index):[]}function _v(u,s,l,f,g,x){if(!u)return[];const b=[],T=function(O,B,V,j,X,J){let oe=0;for(let Se=0;Se<O.length();Se++){const fe=O.getSection(Se);oe+=Kw(O.getCharCode(Se),fe,j,X,B,J)}return oe/Math.max(1,Math.ceil(oe/V))}(u,s,l,f,g,x),A=u.text.indexOf("")>=0;let C=0;for(let O=0;O<u.length();O++){const B=u.getSection(O),V=u.getCharCode(O);if(Ng[V]||(C+=Kw(V,B,f,g,s,x)),O<u.length()-1){const j=!((R=V)<11904)&&(!!ur["CJK Compatibility Forms"](R)||!!ur["CJK Compatibility"](R)||!!ur["CJK Strokes"](R)||!!ur["CJK Symbols and Punctuation"](R)||!!ur["Enclosed CJK Letters and Months"](R)||!!ur["Halfwidth and Fullwidth Forms"](R)||!!ur["Ideographic Description Characters"](R)||!!ur["Vertical Forms"](R)||Ud.test(String.fromCodePoint(R)));(uR[V]||j||B.imageName||O!==u.length()-2&&hR[u.getCharCode(O+1)])&&b.push(Jw(O+1,C,T,b,dR(V,u.getCharCode(O+1),j&&A),!1))}}var R;return e2(Jw(u.length(),C,T,b,0,!0))}function yv(u){let s=.5,l=.5;switch(u){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:s,verticalAlign:l}}function fR(u,s,l){const f=s.getMaxScale()*Un,{maxImageWidth:g,maxImageHeight:x}=s.getMaxImageSize(u),b=Math.max(f,x*l);return{verticalLineContentWidth:Math.max(f,g*l),horizontalLineContentHeight:b}}function t2(u){switch(u){case"top":return 0;case"center":return .5;default:return 1}}function pR(u,s,l){return!(u===d.ao.horizontal||!s&&!Vd(l)||s&&(Ng[l]||(f=l,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(f)))));var f}function gR(u,s,l,f,g,x){const b=x[u.fontStack],T=function(C,R,O,B){if(C&&C.rect)return C;const V=R[O.fontStack],j=V&&V[B];return j?{rect:null,metrics:j.metrics}:null}(b&&b[s],g,u,s);if(T===null)return null;let A;if(l)A=f.verticalLineContentWidth-u.scale*Un;else{const C=t2(u.verticalAlign);A=(f.horizontalLineContentHeight-u.scale*Un)*C}return{rect:T.rect,metrics:T.metrics,baselineOffset:A}}function mR(u,s,l,f,g){const x=g[u.imageName];if(!x)return null;const b=x.paddedRect,T=x.displaySize,A={width:T[0],height:T[1],left:1,top:-3,advance:s?T[1]:T[0]};let C;if(s)C=f.verticalLineContentWidth-T[1]*u.scale;else{const R=t2(u.verticalAlign);C=(f.horizontalLineContentHeight-T[1]*u.scale)*R}return{rect:b,metrics:A,baselineOffset:C,imageOffset:(s?T[0]:T[1])*u.scale-Un*l}}function _R(u,s,l,f){if(f===0)return;const g=u[l],x=(u[l].x+g.metrics.advance*g.scale)*f;for(let b=s;b<=l;b++)u[b].x-=x}function yR(u,s,l){const{horizontalAlign:f,verticalAlign:g}=yv(l),x=s[0]-u.displaySize[0]*f,b=s[1]-u.displaySize[1]*g;return{image:u,top:b,bottom:b+u.displaySize[1],left:x,right:x+u.displaySize[0]}}function r2(u){var s,l;let f=u.left,g=u.top,x=u.right-f,b=u.bottom-g;const T=(s=u.image.textFitWidth)!==null&&s!==void 0?s:"stretchOrShrink",A=(l=u.image.textFitHeight)!==null&&l!==void 0?l:"stretchOrShrink",C=(u.image.content[2]-u.image.content[0])/(u.image.content[3]-u.image.content[1]);if(A==="proportional"){if(T==="stretchOnly"&&x/b<C||T==="proportional"){const R=Math.ceil(b*C);f*=R/x,x=R}}else if(T==="proportional"&&A==="stretchOnly"&&C!==0&&x/b>C){const R=Math.ceil(x/C);g*=R/b,b=R}return{x1:f,y1:g,x2:f+x,y2:g+b}}function n2(u,s,l,f,g,x){const b=u.image;let T;if(b.content){const J=b.content,oe=b.pixelRatio||1;T=[J[0]/oe,J[1]/oe,b.displaySize[0]-J[2]/oe,b.displaySize[1]-J[3]/oe]}const A=s.left*x,C=s.right*x;let R,O,B,V;l==="width"||l==="both"?(V=g[0]+A-f[3],O=g[0]+C+f[1]):(V=g[0]+(A+C-b.displaySize[0])/2,O=V+b.displaySize[0]);const j=s.top*x,X=s.bottom*x;return l==="height"||l==="both"?(R=g[1]+j-f[0],B=g[1]+X+f[2]):(R=g[1]+(j+X-b.displaySize[1])/2,B=R+b.displaySize[1]),{image:b,top:R,right:O,bottom:B,left:V,collisionPadding:T}}const Sa=128,dl=32640;function i2(u,s){const{expression:l}=s;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new jr(u+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=l;let x=0;for(;x<f.length&&f[x]<=u;)x++;x=Math.max(0,x-1);let b=x;for(;b<f.length&&f[b]<u+1;)b++;b=Math.min(f.length-1,b);const T=f[x],A=f[b];return l.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:A,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:A,minSize:l.evaluate(new jr(T)),maxSize:l.evaluate(new jr(A)),interpolationType:g}}}function vv(u,s,l){let f="never";const g=u.get(s);return g?f=g:u.get(l)&&(f="always"),f}const vR=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Lg(u,s,l,f,g,x,b,T,A,C,R,O,B){const V=T?Math.min(dl,Math.round(T[0])):0,j=T?Math.min(dl,Math.round(T[1])):0;u.emplaceBack(s,l,Math.round(32*f),Math.round(32*g),x,b,(V<<1)+(A?1:0),j,16*C,16*R,256*O,256*B)}function xv(u,s,l){u.emplaceBack(s.x,s.y,l),u.emplaceBack(s.x,s.y,l),u.emplaceBack(s.x,s.y,l),u.emplaceBack(s.x,s.y,l)}function xR(u){for(const s of u.sections)if(Tg(s.text))return!0;return!1}class bv{constructor(s){this.layoutVertexArray=new nt,this.indexArray=new zr,this.programConfigurations=s,this.segments=new Yt,this.dynamicLayoutVertexArray=new Xe,this.opacityVertexArray=new wt,this.hasVisibleVertices=!1,this.placedSymbolArray=new W}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,l,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,ZM.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,qM.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,vR,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}pt("SymbolBuffers",bv);class wv{constructor(s,l,f){this.layoutVertexArray=new s,this.layoutAttributes=l,this.indexArray=new f,this.segments=new Yt,this.collisionVertexArray=new Ar}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,YM.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}pt("CollisionBuffers",wv);class Ju{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.globalState=s.globalState,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(b=>b.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=i2(this.zoom,l["text-size"]),this.iconSizeData=i2(this.zoom,l["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),x=f.get("symbol-z-order");this.canOverlap=vv(f,"text-overlap","text-allow-overlap")!=="never"||vv(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(b=>d.ao[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=s.sourceID}createArrays(){this.text=new bv(new Hi(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new bv(new Hi(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new ne,this.lineVertexArray=new ae,this.symbolInstances=new ee,this.textAnchorOffsets=new ue}calculateGlyphDependencies(s,l,f,g,x){for(let b=0;b<s.length;b++)if(l[s.charCodeAt(b)]=!0,(f||g)&&x){const T=lf[s.charAt(b)];T&&(l[T.charCodeAt(0)]=!0)}}populate(s,l,f){const g=this.layers[0],x=g.layout,b=x.get("text-font"),T=x.get("text-field"),A=x.get("icon-image"),C=(T.value.kind!=="constant"||T.value.value instanceof pi&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),R=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,O=x.get("symbol-sort-key");if(this.features=[],!C&&!R)return;const B=l.iconDependencies,V=l.glyphDependencies,j=l.availableImages,X=new jr(this.zoom,{globalState:this.globalState});for(const{feature:J,id:oe,index:Se,sourceLayerIndex:fe}of s){const _e=g._featureFilter.needGeometry,Oe=uo(J,_e);if(!g._featureFilter.filter(X,Oe,f))continue;let Be,Ye;if(_e||(Oe.geometry=Vo(J)),C){const tt=g.getValueAndResolveTokens("text-field",Oe,f,j),ot=pi.factory(tt),Et=this.hasRTLText=this.hasRTLText||xR(ot);(!Et||xs.getRTLTextPluginStatus()==="unavailable"||Et&&xs.isParsed())&&(Be=KM(ot,g,Oe))}if(R){const tt=g.getValueAndResolveTokens("icon-image",Oe,f,j);Ye=tt instanceof $i?tt:$i.fromString(tt)}if(!Be&&!Ye)continue;const ut=this.sortFeaturesByKey?O.evaluate(Oe,{},f):void 0;if(this.features.push({id:oe,text:Be,icon:Ye,index:Se,sourceLayerIndex:fe,geometry:Oe.geometry,properties:J.properties,type:Gu.types[J.type],sortKey:ut}),Ye&&(B[Ye.name]=!0),Be){const tt=b.evaluate(Oe,{},f).join(","),ot=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d.ao.vertical)>=0;for(const Et of Be.sections)if(Et.image)B[Et.image.name]=!0;else{const st=Nu(Be.toString()),at=Et.fontStack||tt,He=V[at]=V[at]||{};this.calculateGlyphDependencies(Et.text,He,ot,this.allowVerticalPlacement,st)}}}x.get("symbol-placement")==="line"&&(this.features=function(J){const oe={},Se={},fe=[];let _e=0;function Oe(tt){fe.push(J[tt]),_e++}function Be(tt,ot,Et){const st=Se[tt];return delete Se[tt],Se[ot]=st,fe[st].geometry[0].pop(),fe[st].geometry[0]=fe[st].geometry[0].concat(Et[0]),st}function Ye(tt,ot,Et){const st=oe[ot];return delete oe[ot],oe[tt]=st,fe[st].geometry[0].shift(),fe[st].geometry[0]=Et[0].concat(fe[st].geometry[0]),st}function ut(tt,ot,Et){const st=Et?ot[0][ot[0].length-1]:ot[0][0];return`${tt}:${st.x}:${st.y}`}for(let tt=0;tt<J.length;tt++){const ot=J[tt],Et=ot.geometry,st=ot.text?ot.text.toString():null;if(!st){Oe(tt);continue}const at=ut(st,Et),He=ut(st,Et,!0);if(at in Se&&He in oe&&Se[at]!==oe[He]){const zt=Ye(at,He,Et),jt=Be(at,He,fe[zt].geometry);delete oe[at],delete Se[He],Se[ut(st,fe[jt].geometry,!0)]=jt,fe[zt].geometry=null}else at in Se?Be(at,He,Et):He in oe?Ye(at,He,Et):(Oe(tt),oe[at]=_e-1,Se[He]=_e-1)}return fe.filter(tt=>tt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,oe)=>J.sortKey-oe.sortKey)}update(s,l,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,l,this.layers,{imagePositions:f,globalState:this.globalState}),this.icon.programConfigurations.updatePaintArrays(s,l,this.layers,{imagePositions:f,globalState:this.globalState}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,l){const f=this.lineVertexArray.length;if(s.segment!==void 0){let g=s.dist(l[s.segment+1]),x=s.dist(l[s.segment]);const b={};for(let T=s.segment+1;T<l.length;T++)b[T]={x:l[T].x,y:l[T].y,tileUnitDistanceFromAnchor:g},T<l.length-1&&(g+=l[T+1].dist(l[T]));for(let T=s.segment||0;T>=0;T--)b[T]={x:l[T].x,y:l[T].y,tileUnitDistanceFromAnchor:x},T>0&&(x+=l[T-1].dist(l[T]));for(let T=0;T<l.length;T++){const A=b[T];this.lineVertexArray.emplaceBack(A.x,A.y,A.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(s,l,f,g,x,b,T,A,C,R,O,B){const V=s.indexArray,j=s.layoutVertexArray,X=s.segments.prepareSegment(4*l.length,j,V,this.canOverlap?b.sortKey:void 0),J=this.glyphOffsetArray.length,oe=X.vertexLength,Se=this.allowVerticalPlacement&&T===d.ao.vertical?Math.PI/2:0,fe=b.text&&b.text.sections;for(let _e=0;_e<l.length;_e++){const{tl:Oe,tr:Be,bl:Ye,br:ut,tex:tt,pixelOffsetTL:ot,pixelOffsetBR:Et,minFontScaleX:st,minFontScaleY:at,glyphOffset:He,isSDF:zt,sectionIndex:jt}=l[_e],Rt=X.vertexLength,Tt=He[1];Lg(j,A.x,A.y,Oe.x,Tt+Oe.y,tt.x,tt.y,f,zt,ot.x,ot.y,st,at),Lg(j,A.x,A.y,Be.x,Tt+Be.y,tt.x+tt.w,tt.y,f,zt,Et.x,ot.y,st,at),Lg(j,A.x,A.y,Ye.x,Tt+Ye.y,tt.x,tt.y+tt.h,f,zt,ot.x,Et.y,st,at),Lg(j,A.x,A.y,ut.x,Tt+ut.y,tt.x+tt.w,tt.y+tt.h,f,zt,Et.x,Et.y,st,at),xv(s.dynamicLayoutVertexArray,A,Se),V.emplaceBack(Rt,Rt+2,Rt+1),V.emplaceBack(Rt+1,Rt+2,Rt+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(He[0]),_e!==l.length-1&&jt===l[_e+1].sectionIndex||s.programConfigurations.populatePaintArrays(j.length,b,b.index,{imagePositions:{},canonical:B,formattedSection:fe&&fe[jt],globalState:this.globalState})}s.placedSymbolArray.emplaceBack(A.x,A.y,J,this.glyphOffsetArray.length-J,oe,C,R,A.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],T,0,!1,0,O)}_addCollisionDebugVertex(s,l,f,g,x,b){return l.emplaceBack(0,0),s.emplaceBack(f.x,f.y,g,x,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(s,l,f,g,x,b,T){const A=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),C=A.vertexLength,R=x.layoutVertexArray,O=x.collisionVertexArray,B=T.anchorX,V=T.anchorY;this._addCollisionDebugVertex(R,O,b,B,V,new y(s,l)),this._addCollisionDebugVertex(R,O,b,B,V,new y(f,l)),this._addCollisionDebugVertex(R,O,b,B,V,new y(f,g)),this._addCollisionDebugVertex(R,O,b,B,V,new y(s,g)),A.vertexLength+=4;const j=x.indexArray;j.emplaceBack(C,C+1),j.emplaceBack(C+1,C+2),j.emplaceBack(C+2,C+3),j.emplaceBack(C+3,C),A.primitiveLength+=4}addDebugCollisionBoxes(s,l,f,g){for(let x=s;x<l;x++){const b=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,g?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new wv(Kt,Hw.members,Fr),this.iconCollisionBox=new wv(Kt,Hw.members,Fr);for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(s,l,f,g,x,b,T,A,C){const R={};for(let O=l;O<f;O++){const B=s.get(O);R.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.textFeatureIndex=B.featureIndex;break}for(let O=g;O<x;O++){const B=s.get(O);R.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.verticalTextFeatureIndex=B.featureIndex;break}for(let O=b;O<T;O++){const B=s.get(O);R.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.iconFeatureIndex=B.featureIndex;break}for(let O=A;O<C;O++){const B=s.get(O);R.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.verticalIconFeatureIndex=B.featureIndex;break}return R}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const f=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,l){const f=s.placedSymbolArray.get(l),g=f.vertexStartIndex+4*f.numGlyphs;for(let x=f.vertexStartIndex;x<g;x+=4)s.indexArray.emplaceBack(x,x+2,x+1),s.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(s),f=Math.cos(s),g=[],x=[],b=[];for(let T=0;T<this.symbolInstances.length;++T){b.push(T);const A=this.symbolInstances.get(T);g.push(0|Math.round(l*A.anchorX+f*A.anchorY)),x.push(A.featureIndex)}return b.sort((T,A)=>g[T]-g[A]||x[A]-x[T]),b}addToSortKeyRanges(s,l){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===l?f.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const f=this.symbolInstances.get(l);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,x,b)=>{g>=0&&b.indexOf(g)===x&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let s2,o2;pt("SymbolBucket",Ju,{omit:["layers","collisionBoxArray","features","compareText"]}),Ju.MAX_GLYPHS=65535,Ju.addDynamicAttributes=xv;var Tv={get paint(){return o2=o2||new _i({"icon-opacity":new Nt(Te.paint_symbol["icon-opacity"]),"icon-color":new Nt(Te.paint_symbol["icon-color"]),"icon-halo-color":new Nt(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Nt(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Nt(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new St(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new St(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new Nt(Te.paint_symbol["text-opacity"]),"text-color":new Nt(Te.paint_symbol["text-color"],{runtimeType:Or,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new Nt(Te.paint_symbol["text-halo-color"]),"text-halo-width":new Nt(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new Nt(Te.paint_symbol["text-halo-blur"]),"text-translate":new St(Te.paint_symbol["text-translate"]),"text-translate-anchor":new St(Te.paint_symbol["text-translate-anchor"])})},get layout(){return s2=s2||new _i({"symbol-placement":new St(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new St(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new St(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Nt(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new St(Te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new St(Te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new St(Te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new St(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new St(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new St(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Nt(Te.layout_symbol["icon-size"]),"icon-text-fit":new St(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new St(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Nt(Te.layout_symbol["icon-image"]),"icon-rotate":new Nt(Te.layout_symbol["icon-rotate"]),"icon-padding":new Nt(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new St(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new Nt(Te.layout_symbol["icon-offset"]),"icon-anchor":new Nt(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new St(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new St(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new St(Te.layout_symbol["text-rotation-alignment"]),"text-field":new Nt(Te.layout_symbol["text-field"]),"text-font":new Nt(Te.layout_symbol["text-font"]),"text-size":new Nt(Te.layout_symbol["text-size"]),"text-max-width":new Nt(Te.layout_symbol["text-max-width"]),"text-line-height":new St(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new Nt(Te.layout_symbol["text-letter-spacing"]),"text-justify":new Nt(Te.layout_symbol["text-justify"]),"text-radial-offset":new Nt(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new St(Te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Nt(Te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Nt(Te.layout_symbol["text-anchor"]),"text-max-angle":new St(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new St(Te.layout_symbol["text-writing-mode"]),"text-rotate":new Nt(Te.layout_symbol["text-rotate"]),"text-padding":new St(Te.layout_symbol["text-padding"]),"text-keep-upright":new St(Te.layout_symbol["text-keep-upright"]),"text-transform":new Nt(Te.layout_symbol["text-transform"]),"text-offset":new Nt(Te.layout_symbol["text-offset"]),"text-allow-overlap":new St(Te.layout_symbol["text-allow-overlap"]),"text-overlap":new St(Te.layout_symbol["text-overlap"]),"text-ignore-placement":new St(Te.layout_symbol["text-ignore-placement"]),"text-optional":new St(Te.layout_symbol["text-optional"])})}};class a2{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:ts,this.defaultValue=s}evaluate(s){if(s.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(s.formattedSection))return l.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}pt("FormatSectionOverride",a2,{omit:["defaultValue"]});class zg extends os{constructor(s){super(s,Tv)}recalculate(s,l){if(super.recalculate(s,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const x of f)g.indexOf(x)<0&&g.push(x);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,l,f,g){const x=this.layout.get(s).evaluate(l,{},f,g),b=this._unevaluatedLayout._values[s];return b.isDataDriven()||Pu(b.value)||!x?x:function(T,A){return A.replace(/{([^{}]+)}/g,(C,R)=>T&&R in T?String(T[R]):"")}(l.properties,x)}createBucket(s){return new Ju(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of Tv.paint.overridableProperties){if(!zg.hasPaintOverride(this.layout,s))continue;const l=this.paint.get(s),f=new a2(l),g=new Pd(f,l.property.specification);let x=null;x=l.value.kind==="constant"||l.value.kind==="source"?new fc("source",g):new Cd("composite",g,l.value.zoomStops),this.paint._values[s]=new Hs(l.property,x,l.parameters)}}_handleOverridablePaintPropertyUpdate(s,l,f){return!(!this.layout||l.isDataDriven()||f.isDataDriven())&&zg.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,l){const f=s.get("text-field"),g=Tv.paint.properties[l];let x=!1;const b=T=>{for(const A of T)if(g.overrides&&g.overrides.hasOverride(A))return void(x=!0)};if(f.value.kind==="constant"&&f.value.value instanceof pi)b(f.value.value.sections);else if(f.value.kind==="source"||f.value.kind==="composite"){const T=C=>{x||(C instanceof oo&&Lt(C.value)===Pr?b(C.value.sections):C instanceof ua?b(C.sections):C.eachChild(T))},A=f.value;A._styleExpression&&T(A._styleExpression.expression)}return x}}let l2;var bR={get paint(){return l2=l2||new _i({"background-color":new St(Te.paint_background["background-color"]),"background-pattern":new No(Te.paint_background["background-pattern"]),"background-opacity":new St(Te.paint_background["background-opacity"])})}};class wR extends os{constructor(s){super(s,bR)}}let c2;var TR={get paint(){return c2=c2||new _i({"raster-opacity":new St(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new St(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new St(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new St(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new St(Te.paint_raster["raster-saturation"]),"raster-contrast":new St(Te.paint_raster["raster-contrast"]),"raster-resampling":new St(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new St(Te.paint_raster["raster-fade-duration"])})}};class SR extends os{constructor(s){super(s,TR)}}class ER extends os{constructor(s){super(s,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class AR{constructor(s){this._methodToThrottle=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const IR={once:!0},Sv=63710088e-1;class fl{constructor(s,l){if(isNaN(s)||isNaN(l))throw new Error(`Invalid LngLat object: (${s}, ${l})`);if(this.lng=+s,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new fl(nr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const l=Math.PI/180,f=this.lat*l,g=s.lat*l,x=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((s.lng-this.lng)*l);return Sv*Math.acos(Math.min(x,1))}static convert(s){if(s instanceof fl)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new fl(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new fl(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const u2=2*Math.PI*Sv;function h2(u){return u2*Math.cos(u*Math.PI/180)}function d2(u){return(180+u)/360}function f2(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function p2(u,s){return u/h2(s)}function Ev(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function g2(u,s){return u*h2(Ev(s))}class uf{constructor(s,l,f=0){this.x=+s,this.y=+l,this.z=+f}static fromLngLat(s,l=0){const f=fl.convert(s);return new uf(d2(f.lng),f2(f.lat),p2(l,f.lat))}toLngLat(){return new fl(360*this.x-180,Ev(this.y))}toAltitude(){return g2(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/u2*(s=Ev(this.y),1/Math.cos(s*Math.PI/180));var s}}function m2(u,s,l){var f=2*Math.PI*6378137/256/Math.pow(2,l);return[u*f-2*Math.PI*6378137/2,s*f-2*Math.PI*6378137/2]}class Av{constructor(s,l,f){if(!function(g,x,b){return!(g<0||g>25||b<0||b>=Math.pow(2,g)||x<0||x>=Math.pow(2,g))}(s,l,f))throw new Error(`x=${l}, y=${f}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=l,this.y=f,this.key=eh(0,s,s,l,f)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,l,f){const g=(b=this.y,T=this.z,A=m2(256*(x=this.x),256*(b=Math.pow(2,T)-b-1),T),C=m2(256*(x+1),256*(b+1),T),A[0]+","+A[1]+","+C[0]+","+C[1]);var x,b,T,A,C;const R=function(O,B,V){let j,X="";for(let J=O;J>0;J--)j=1<<J-1,X+=(B&j?1:0)+(V&j?2:0);return X}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,g)}isChildOf(s){const l=this.z-s.z;return l>0&&s.x===this.x>>l&&s.y===this.y>>l}getTilePoint(s){const l=Math.pow(2,this.z);return new y((s.x*l-this.x)*Qe,(s.y*l-this.y)*Qe)}toString(){return`${this.z}/${this.x}/${this.y}`}}class _2{constructor(s,l){this.wrap=s,this.canonical=l,this.key=eh(s,l.z,l.z,l.x,l.y)}}class Ss{constructor(s,l,f,g,x){if(this.terrainRttPosMatrix32f=null,s<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${f}`);this.overscaledZ=s,this.wrap=l,this.canonical=new Av(f,+g,+x),this.key=eh(l,s,f,g,x)}clone(){return new Ss(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-s;return s>this.canonical.z?new Ss(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ss(s,this.wrap,s,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(s,l){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-s;return s>this.canonical.z?eh(this.wrap*+l,s,this.canonical.z,this.canonical.x,this.canonical.y):eh(this.wrap*+l,s,s,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const l=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>l&&s.canonical.y===this.canonical.y>>l}children(s){if(this.overscaledZ>=s)return[new Ss(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new Ss(l,this.wrap,l,f,g),new Ss(l,this.wrap,l,f+1,g),new Ss(l,this.wrap,l,f,g+1),new Ss(l,this.wrap,l,f+1,g+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new Ss(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new Ss(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new _2(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new uf(s.x-this.wrap,s.y))}}function eh(u,s,l,f,g){(u*=2)<0&&(u=-1*u-1);const x=1<<l;return(x*x*u+x*g+f).toString(36)+l.toString(36)+s.toString(36)}function hf(u,s){return s?u.properties[s]:u.id}pt("CanonicalTileID",Av),pt("OverscaledTileID",Ss,{omit:["terrainRttPosMatrix32f"]});class Ac{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(s){return this.minX=Math.min(this.minX,s.x),this.minY=Math.min(this.minY,s.y),this.maxX=Math.max(this.maxX,s.x),this.maxY=Math.max(this.maxY,s.y),this}expandBy(s){return this.minX-=s,this.minY-=s,this.maxX+=s,this.maxY+=s,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(s){return this.expandBy(-s)}map(s){const l=new Ac;return l.extend(s(new y(this.minX,this.minY))),l.extend(s(new y(this.maxX,this.minY))),l.extend(s(new y(this.minX,this.maxY))),l.extend(s(new y(this.maxX,this.maxY))),l}static fromPoints(s){const l=new Ac;for(const f of s)l.extend(f);return l}contains(s){return s.x>=this.minX&&s.x<=this.maxX&&s.y>=this.minY&&s.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(s){return!this.empty()&&!s.empty()&&s.minX>=this.minX&&s.maxX<=this.maxX&&s.minY>=this.minY&&s.maxY<=this.maxY}intersects(s){return!this.empty()&&!s.empty()&&s.minX<=this.maxX&&s.maxX>=this.minX&&s.minY<=this.maxY&&s.maxY>=this.minY}}class y2{constructor(s){this._stringToNumber={},this._numberToString=[];for(let l=0;l<s.length;l++){const f=s[l];this._stringToNumber[f]=l,this._numberToString[l]=f}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class v2{constructor(s,l,f,g,x){this.type="Feature",this._vectorTileFeature=s,s._z=l,s._x=f,s._y=g,this.properties=s.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(s[l]=this[l]);return s}}class x2{constructor(s,l){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new xc(Qe,16,0),this.grid3D=new xc(Qe,16,0),this.featureIndexArray=new ye,this.promoteId=l}insert(s,l,f,g,x,b){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,x);const A=b?this.grid3D:this.grid;for(let C=0;C<l.length;C++){const R=l[C],O=[1/0,1/0,-1/0,-1/0];for(let B=0;B<R.length;B++){const V=R[B];O[0]=Math.min(O[0],V.x),O[1]=Math.min(O[1],V.y),O[2]=Math.max(O[2],V.x),O[3]=Math.max(O[3],V.y)}O[0]<Qe&&O[1]<Qe&&O[2]>=0&&O[3]>=0&&A.insert(T,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Nw(new gv(this.rawTileData)).layers,this.sourceLayerCoder=new y2(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,l,f,g){this.loadVTLayers();const x=s.params,b=Qe/s.tileSize/s.scale,T=ma(x.filter),A=s.queryGeometry,C=s.queryPadding*b,R=Ac.fromPoints(A),O=this.grid.query(R.minX-C,R.minY-C,R.maxX+C,R.maxY+C),B=Ac.fromPoints(s.cameraQueryGeometry).expandBy(C),V=this.grid3D.query(B.minX,B.minY,B.maxX,B.maxY,(J,oe,Se,fe)=>function(_e,Oe,Be,Ye,ut){for(const ot of _e)if(Oe<=ot.x&&Be<=ot.y&&Ye>=ot.x&&ut>=ot.y)return!0;const tt=[new y(Oe,Be),new y(Oe,ut),new y(Ye,ut),new y(Ye,Be)];if(_e.length>2){for(const ot of tt)if(Xu(_e,ot))return!0}for(let ot=0;ot<_e.length-1;ot++)if(sM(_e[ot],_e[ot+1],tt))return!0;return!1}(s.cameraQueryGeometry,J-C,oe-C,Se+C,fe+C));for(const J of V)O.push(J);O.sort(PR);const j={};let X;for(let J=0;J<O.length;J++){const oe=O[J];if(oe===X)continue;X=oe;const Se=this.featureIndexArray.get(oe);let fe=null;this.loadMatchingFeature(j,Se.bucketIndex,Se.sourceLayerIndex,Se.featureIndex,T,x.layers,x.availableImages,l,f,g,(_e,Oe,Be)=>(fe||(fe=Vo(_e)),Oe.queryIntersectsFeature({queryGeometry:A,feature:_e,featureState:Be,geometry:fe,zoom:this.z,transform:s.transform,pixelsToTileUnits:b,pixelPosMatrix:s.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:s.getElevation})))}return j}loadMatchingFeature(s,l,f,g,x,b,T,A,C,R,O){const B=this.bucketLayerIDs[l];if(b&&!B.some(J=>b.has(J)))return;const V=this.sourceLayerCoder.decode(f),j=this.vtLayers[V].feature(g);if(x.needGeometry){const J=uo(j,!0);if(!x.filter(new jr(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!x.filter(new jr(this.tileID.overscaledZ),j))return;const X=this.getId(j,V);for(let J=0;J<B.length;J++){const oe=B[J];if(b&&!b.has(oe))continue;const Se=A[oe];if(!Se)continue;let fe={};X&&R&&(fe=R.getState(Se.sourceLayer||"_geojsonTileLayer",X));const _e=Wt({},C[oe]);_e.paint=b2(_e.paint,Se.paint,j,fe,T),_e.layout=b2(_e.layout,Se.layout,j,fe,T);const Oe=!O||O(j,Se,fe);if(!Oe)continue;const Be=new v2(j,this.z,this.x,this.y,X);Be.layer=_e;let Ye=s[oe];Ye===void 0&&(Ye=s[oe]=[]),Ye.push({featureIndex:g,feature:Be,intersectionZ:Oe})}}lookupSymbolFeatures(s,l,f,g,x,b,T,A){const C={};this.loadVTLayers();const R=ma(x);for(const O of s)this.loadMatchingFeature(C,f,g,O,R,b,T,A,l);return C}hasLayer(s){for(const l of this.bucketLayerIDs)for(const f of l)if(s===f)return!0;return!1}getId(s,l){var f;let g=s.id;return this.promoteId&&(g=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof g=="boolean"&&(g=Number(g)),g===void 0&&(!((f=s.properties)===null||f===void 0)&&f.cluster)&&this.promoteId&&(g=Number(s.properties.cluster_id))),g}}function b2(u,s,l,f,g){return vr(u,(x,b)=>{const T=s instanceof zu?s.get(b):null;return T&&T.evaluate?T.evaluate(l,f,g):T})}function PR(u,s){return s-u}function w2(u,s,l,f,g){const x=[];for(let b=0;b<u.length;b++){const T=u[b];let A;for(let C=0;C<T.length-1;C++){let R=T[C],O=T[C+1];R.x<s&&O.x<s||(R.x<s?R=new y(s,R.y+(s-R.x)/(O.x-R.x)*(O.y-R.y))._round():O.x<s&&(O=new y(s,R.y+(s-R.x)/(O.x-R.x)*(O.y-R.y))._round()),R.y<l&&O.y<l||(R.y<l?R=new y(R.x+(l-R.y)/(O.y-R.y)*(O.x-R.x),l)._round():O.y<l&&(O=new y(R.x+(l-R.y)/(O.y-R.y)*(O.x-R.x),l)._round()),R.x>=f&&O.x>=f||(R.x>=f?R=new y(f,R.y+(f-R.x)/(O.x-R.x)*(O.y-R.y))._round():O.x>=f&&(O=new y(f,R.y+(f-R.x)/(O.x-R.x)*(O.y-R.y))._round()),R.y>=g&&O.y>=g||(R.y>=g?R=new y(R.x+(g-R.y)/(O.y-R.y)*(O.x-R.x),g)._round():O.y>=g&&(O=new y(R.x+(g-R.y)/(O.y-R.y)*(O.x-R.x),g)._round()),A&&R.equals(A[A.length-1])||(A=[R],x.push(A)),A.push(O)))))}}return x}pt("FeatureIndex",x2,{omit:["rawTileData","sourceLayerCoder"]});class pl extends y{constructor(s,l,f,g){super(s,l),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new pl(this.x,this.y,this.angle,this.segment)}}function T2(u,s,l,f,g){if(s.segment===void 0||l===0)return!0;let x=s,b=s.segment+1,T=0;for(;T>-l/2;){if(b--,b<0)return!1;T-=u[b].dist(x),x=u[b]}T+=u[b].dist(u[b+1]),b++;const A=[];let C=0;for(;T<l/2;){const R=u[b],O=u[b+1];if(!O)return!1;let B=u[b-1].angleTo(R)-R.angleTo(O);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:T,angleDelta:B}),C+=B;T-A[0].distance>f;)C-=A.shift().angleDelta;if(C>g)return!1;b++,T+=R.dist(O)}return!0}function S2(u){let s=0;for(let l=0;l<u.length-1;l++)s+=u[l].dist(u[l+1]);return s}function E2(u,s,l){return u?.6*s*l:0}function A2(u,s){return Math.max(u?u.right-u.left:0,s?s.right-s.left:0)}function CR(u,s,l,f,g,x){const b=E2(l,g,x),T=A2(l,f)*x;let A=0;const C=S2(u)/2;for(let R=0;R<u.length-1;R++){const O=u[R],B=u[R+1],V=O.dist(B);if(A+V>C){const j=(C-A)/V,X=$s.number(O.x,B.x,j),J=$s.number(O.y,B.y,j),oe=new pl(X,J,B.angleTo(O),R);return oe._round(),!b||T2(u,oe,T,b,s)?oe:void 0}A+=V}}function MR(u,s,l,f,g,x,b,T,A){const C=E2(f,x,b),R=A2(f,g),O=R*b,B=u[0].x===0||u[0].x===A||u[0].y===0||u[0].y===A;return s-O<s/4&&(s=O+s/4),I2(u,B?s/2*T%s:(R/2+2*x)*b*T%s,s,C,l,O,B,!1,A)}function I2(u,s,l,f,g,x,b,T,A){const C=x/2,R=S2(u);let O=0,B=s-l,V=[];for(let j=0;j<u.length-1;j++){const X=u[j],J=u[j+1],oe=X.dist(J),Se=J.angleTo(X);for(;B+l<O+oe;){B+=l;const fe=(B-O)/oe,_e=$s.number(X.x,J.x,fe),Oe=$s.number(X.y,J.y,fe);if(_e>=0&&_e<A&&Oe>=0&&Oe<A&&B-C>=0&&B+C<=R){const Be=new pl(_e,Oe,Se,j);Be._round(),f&&!T2(u,Be,x,f,g)||V.push(Be)}}O+=oe}return T||V.length||b||(V=I2(u,O/2,l,f,g,x,b,!0,A)),V}function P2(u,s,l,f){const g=[],x=u.image,b=x.pixelRatio,T=x.paddedRect.w-2,A=x.paddedRect.h-2;let C={x1:u.left,y1:u.top,x2:u.right,y2:u.bottom};const R=x.stretchX||[[0,T]],O=x.stretchY||[[0,A]],B=(He,zt)=>He+zt[1]-zt[0],V=R.reduce(B,0),j=O.reduce(B,0),X=T-V,J=A-j;let oe=0,Se=V,fe=0,_e=j,Oe=0,Be=X,Ye=0,ut=J;if(x.content&&f){const He=x.content,zt=He[2]-He[0],jt=He[3]-He[1];(x.textFitWidth||x.textFitHeight)&&(C=r2(u)),oe=Bg(R,0,He[0]),fe=Bg(O,0,He[1]),Se=Bg(R,He[0],He[2]),_e=Bg(O,He[1],He[3]),Oe=He[0]-oe,Ye=He[1]-fe,Be=zt-Se,ut=jt-_e}const tt=C.x1,ot=C.y1,Et=C.x2-tt,st=C.y2-ot,at=(He,zt,jt,Rt)=>{const Tt=Ug(He.stretch-oe,Se,Et,tt),hr=Vg(He.fixed-Oe,Be,He.stretch,V),an=Ug(zt.stretch-fe,_e,st,ot),On=Vg(zt.fixed-Ye,ut,zt.stretch,j),li=Ug(jt.stretch-oe,Se,Et,tt),Es=Vg(jt.fixed-Oe,Be,jt.stretch,V),Zi=Ug(Rt.stretch-fe,_e,st,ot),Gn=Vg(Rt.fixed-Ye,ut,Rt.stretch,j),rn=new y(Tt,an),Vn=new y(li,an),Kn=new y(li,Zi),Qn=new y(Tt,Zi),ki=new y(hr/b,On/b),As=new y(Es/b,Gn/b),jn=s*Math.PI/180;if(jn){const $n=Math.sin(jn),Wn=Math.cos(jn),Pn=[Wn,-$n,$n,Wn];rn._matMult(Pn),Vn._matMult(Pn),Qn._matMult(Pn),Kn._matMult(Pn)}const qi=He.stretch+He.fixed,Fn=zt.stretch+zt.fixed;return{tl:rn,tr:Vn,bl:Qn,br:Kn,tex:{x:x.paddedRect.x+1+qi,y:x.paddedRect.y+1+Fn,w:jt.stretch+jt.fixed-qi,h:Rt.stretch+Rt.fixed-Fn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ki,pixelOffsetBR:As,minFontScaleX:Be/b/Et,minFontScaleY:ut/b/st,isSDF:l}};if(f&&(x.stretchX||x.stretchY)){const He=C2(R,X,V),zt=C2(O,J,j);for(let jt=0;jt<He.length-1;jt++){const Rt=He[jt],Tt=He[jt+1];for(let hr=0;hr<zt.length-1;hr++)g.push(at(Rt,zt[hr],Tt,zt[hr+1]))}}else g.push(at({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:A+1}));return g}function Bg(u,s,l){let f=0;for(const g of u)f+=Math.max(s,Math.min(l,g[1]))-Math.max(s,Math.min(l,g[0]));return f}function C2(u,s,l){const f=[{fixed:-1,stretch:0}];for(const[g,x]of u){const b=f[f.length-1];f.push({fixed:g-b.stretch,stretch:b.stretch}),f.push({fixed:g-b.stretch,stretch:b.stretch+(x-g)})}return f.push({fixed:s+1,stretch:l}),f}function Ug(u,s,l,f){return u/s*l+f}function Vg(u,s,l,f){return u-s*l/f}pt("Anchor",pl);class jg{constructor(s,l,f,g,x,b,T,A,C,R){var O;if(this.boxStartIndex=s.length,C){let B=b.top,V=b.bottom;const j=b.collisionPadding;j&&(B-=j[1],V+=j[3]);let X=V-B;X>0&&(X=Math.max(10,X),this.circleDiameter=X)}else{const B=!((O=b.image)===null||O===void 0)&&O.content&&(b.image.textFitWidth||b.image.textFitHeight)?r2(b):{x1:b.left,y1:b.top,x2:b.right,y2:b.bottom};B.y1=B.y1*T-A[0],B.y2=B.y2*T+A[2],B.x1=B.x1*T-A[3],B.x2=B.x2*T+A[1];const V=b.collisionPadding;if(V&&(B.x1-=V[0]*T,B.y1-=V[1]*T,B.x2+=V[2]*T,B.y2+=V[3]*T),R){const j=new y(B.x1,B.y1),X=new y(B.x2,B.y1),J=new y(B.x1,B.y2),oe=new y(B.x2,B.y2),Se=R*Math.PI/180;j._rotate(Se),X._rotate(Se),J._rotate(Se),oe._rotate(Se),B.x1=Math.min(j.x,X.x,J.x,oe.x),B.x2=Math.max(j.x,X.x,J.x,oe.x),B.y1=Math.min(j.y,X.y,J.y,oe.y),B.y2=Math.max(j.y,X.y,J.y,oe.y)}s.emplaceBack(l.x,l.y,B.x1,B.y1,B.x2,B.y2,f,g,x)}this.boxEndIndex=s.length}}class RR{constructor(s=[],l=(f,g)=>f<g?-1:f>g?1:0){if(this.data=s,this.length=this.data.length,this.compare=l,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:l,compare:f}=this,g=l[s];for(;s>0;){const x=s-1>>1,b=l[x];if(f(g,b)>=0)break;l[s]=b,s=x}l[s]=g}_down(s){const{data:l,compare:f}=this,g=this.length>>1,x=l[s];for(;s<g;){let b=1+(s<<1);const T=b+1;if(T<this.length&&f(l[T],l[b])<0&&(b=T),f(l[b],x)>=0)break;l[s]=l[b],s=b}l[s]=x}}function kR(u,s=1,l=!1){const f=Ac.fromPoints(u[0]),g=Math.min(f.width(),f.height());let x=g/2;const b=new RR([],DR),{minX:T,minY:A,maxX:C,maxY:R}=f;if(g===0)return new y(T,A);for(let V=T;V<C;V+=g)for(let j=A;j<R;j+=g)b.push(new th(V+x,j+x,x,u));let O=function(V){let j=0,X=0,J=0;const oe=V[0];for(let Se=0,fe=oe.length,_e=fe-1;Se<fe;_e=Se++){const Oe=oe[Se],Be=oe[_e],Ye=Oe.x*Be.y-Be.x*Oe.y;X+=(Oe.x+Be.x)*Ye,J+=(Oe.y+Be.y)*Ye,j+=3*Ye}return new th(X/j,J/j,0,V)}(u),B=b.length;for(;b.length;){const V=b.pop();(V.d>O.d||!O.d)&&(O=V,l&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,B)),V.max-O.d<=s||(x=V.h/2,b.push(new th(V.p.x-x,V.p.y-x,x,u)),b.push(new th(V.p.x+x,V.p.y-x,x,u)),b.push(new th(V.p.x-x,V.p.y+x,x,u)),b.push(new th(V.p.x+x,V.p.y+x,x,u)),B+=4)}return l&&(console.log(`num probes: ${B}`),console.log(`best distance: ${O.d}`)),O.p}function DR(u,s){return s.max-u.max}function th(u,s,l,f){this.p=new y(u,s),this.h=l,this.d=function(g,x){let b=!1,T=1/0;for(let A=0;A<x.length;A++){const C=x[A];for(let R=0,O=C.length,B=O-1;R<O;B=R++){const V=C[R],j=C[B];V.y>g.y!=j.y>g.y&&g.x<(j.x-V.x)*(g.y-V.y)/(j.y-V.y)+V.x&&(b=!b),T=Math.min(T,fw(g,V,j))}}return(b?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var ai;d.aE=void 0,(ai=d.aE||(d.aE={}))[ai.center=1]="center",ai[ai.left=2]="left",ai[ai.right=3]="right",ai[ai.top=4]="top",ai[ai.bottom=5]="bottom",ai[ai["top-left"]=6]="top-left",ai[ai["top-right"]=7]="top-right",ai[ai["bottom-left"]=8]="bottom-left",ai[ai["bottom-right"]=9]="bottom-right";const Iv=Number.POSITIVE_INFINITY;function M2(u,s){return s[1]!==Iv?function(l,f,g){let x=0,b=0;switch(f=Math.abs(f),g=Math.abs(g),l){case"top-right":case"top-left":case"top":b=g-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-g}switch(l){case"top-right":case"bottom-right":case"right":x=-f;break;case"top-left":case"bottom-left":case"left":x=f}return[x,b]}(u,s[0],s[1]):function(l,f){let g=0,x=0;f<0&&(f=0);const b=f/Math.SQRT2;switch(l){case"top-right":case"top-left":x=b-7;break;case"bottom-right":case"bottom-left":x=7-b;break;case"bottom":x=7-f;break;case"top":x=f-7}switch(l){case"top-right":case"bottom-right":g=-b;break;case"top-left":case"bottom-left":g=b;break;case"left":g=f;break;case"right":g=-f}return[g,x]}(u,s[0])}function R2(u,s,l){var f;const g=u.layout,x=(f=g.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(s,{},l);if(x){const T=x.values,A=[];for(let C=0;C<T.length;C+=2){const R=A[C]=T[C],O=T[C+1].map(B=>B*Un);R.startsWith("top")?O[1]-=7:R.startsWith("bottom")&&(O[1]+=7),A[C+1]=O}return new mi(A)}const b=g.get("text-variable-anchor");if(b){let T;T=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(s,{},l)*Un,Iv]:g.get("text-offset").evaluate(s,{},l).map(C=>C*Un);const A=[];for(const C of b)A.push(C,M2(C,T));return new mi(A)}return null}function Pv(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function OR(u,s,l,f,g,x,b,T,A,C,R,O){let B=x.textMaxSize.evaluate(s,{});B===void 0&&(B=b);const V=u.layers[0].layout,j=V.get("icon-offset").evaluate(s,{},R),X=D2(l.horizontal),J=b/24,oe=u.tilePixelRatio*J,Se=u.tilePixelRatio*B/24,fe=u.tilePixelRatio*T,_e=u.tilePixelRatio*V.get("symbol-spacing"),Oe=V.get("text-padding")*u.tilePixelRatio,Be=function(jt,Rt,Tt,hr=1){const an=jt.get("icon-padding").evaluate(Rt,{},Tt),On=an&&an.values;return[On[0]*hr,On[1]*hr,On[2]*hr,On[3]*hr]}(V,s,R,u.tilePixelRatio),Ye=V.get("text-max-angle")/180*Math.PI,ut=V.get("text-rotation-alignment")!=="viewport"&&V.get("symbol-placement")!=="point",tt=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",ot=V.get("symbol-placement"),Et=_e/2,st=V.get("icon-text-fit");let at;f&&st!=="none"&&(u.allowVerticalPlacement&&l.vertical&&(at=n2(f,l.vertical,st,V.get("icon-text-fit-padding"),j,J)),X&&(f=n2(f,X,st,V.get("icon-text-fit-padding"),j,J)));const He=R?O.line.getGranularityForZoomLevel(R.z):1,zt=(jt,Rt)=>{Rt.x<0||Rt.x>=Qe||Rt.y<0||Rt.y>=Qe||function(Tt,hr,an,On,li,Es,Zi,Gn,rn,Vn,Kn,Qn,ki,As,jn,qi,Fn,$n,Wn,Pn,qr,ho,rh,fo,LR){const nh=Tt.addToLineVertexArray(hr,an);let Ic,ih,sh,oh,L2=0,z2=0,B2=0,U2=0,Nv=-1,Lv=-1;const Ea={};let V2=cl("");if(Tt.allowVerticalPlacement&&On.vertical){const xi=Gn.layout.get("text-rotate").evaluate(qr,{},fo)+90;sh=new jg(rn,hr,Vn,Kn,Qn,On.vertical,ki,As,jn,xi),Zi&&(oh=new jg(rn,hr,Vn,Kn,Qn,Zi,Fn,$n,jn,xi))}if(li){const xi=Gn.layout.get("icon-rotate").evaluate(qr,{}),Is=Gn.layout.get("icon-text-fit")!=="none",Pc=P2(li,xi,rh,Is),go=Zi?P2(Zi,xi,rh,Is):void 0;ih=new jg(rn,hr,Vn,Kn,Qn,li,Fn,$n,!1,xi),L2=4*Pc.length;const Cc=Tt.iconSizeData;let jo=null;Cc.kind==="source"?(jo=[Sa*Gn.layout.get("icon-size").evaluate(qr,{})],jo[0]>dl&&Ft(`${Tt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Cc.kind==="composite"&&(jo=[Sa*ho.compositeIconSizes[0].evaluate(qr,{},fo),Sa*ho.compositeIconSizes[1].evaluate(qr,{},fo)],(jo[0]>dl||jo[1]>dl)&&Ft(`${Tt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Tt.addSymbols(Tt.icon,Pc,jo,Pn,Wn,qr,d.ao.none,hr,nh.lineStartIndex,nh.lineLength,-1,fo),Nv=Tt.icon.placedSymbolArray.length-1,go&&(z2=4*go.length,Tt.addSymbols(Tt.icon,go,jo,Pn,Wn,qr,d.ao.vertical,hr,nh.lineStartIndex,nh.lineLength,-1,fo),Lv=Tt.icon.placedSymbolArray.length-1)}const j2=Object.keys(On.horizontal);for(const xi of j2){const Is=On.horizontal[xi];if(!Ic){V2=cl(Is.text);const go=Gn.layout.get("text-rotate").evaluate(qr,{},fo);Ic=new jg(rn,hr,Vn,Kn,Qn,Is,ki,As,jn,go)}const Pc=Is.positionedLines.length===1;if(B2+=k2(Tt,hr,Is,Es,Gn,jn,qr,qi,nh,On.vertical?d.ao.horizontal:d.ao.horizontalOnly,Pc?j2:[xi],Ea,Nv,ho,fo),Pc)break}On.vertical&&(U2+=k2(Tt,hr,On.vertical,Es,Gn,jn,qr,qi,nh,d.ao.vertical,["vertical"],Ea,Lv,ho,fo));const zR=Ic?Ic.boxStartIndex:Tt.collisionBoxArray.length,BR=Ic?Ic.boxEndIndex:Tt.collisionBoxArray.length,UR=sh?sh.boxStartIndex:Tt.collisionBoxArray.length,VR=sh?sh.boxEndIndex:Tt.collisionBoxArray.length,jR=ih?ih.boxStartIndex:Tt.collisionBoxArray.length,$R=ih?ih.boxEndIndex:Tt.collisionBoxArray.length,WR=oh?oh.boxStartIndex:Tt.collisionBoxArray.length,HR=oh?oh.boxEndIndex:Tt.collisionBoxArray.length;let po=-1;const Wg=(xi,Is)=>xi&&xi.circleDiameter?Math.max(xi.circleDiameter,Is):Is;po=Wg(Ic,po),po=Wg(sh,po),po=Wg(ih,po),po=Wg(oh,po);const $2=po>-1?1:0;$2&&(po*=LR/Un),Tt.glyphOffsetArray.length>=Ju.MAX_GLYPHS&&Ft("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),qr.sortKey!==void 0&&Tt.addToSortKeyRanges(Tt.symbolInstances.length,qr.sortKey);const XR=R2(Gn,qr,fo),[ZR,qR]=function(xi,Is){const Pc=xi.length,go=Is==null?void 0:Is.values;if((go==null?void 0:go.length)>0)for(let Cc=0;Cc<go.length;Cc+=2){const jo=go[Cc+1];xi.emplaceBack(d.aE[go[Cc]],jo[0],jo[1])}return[Pc,xi.length]}(Tt.textAnchorOffsets,XR);Tt.symbolInstances.emplaceBack(hr.x,hr.y,Ea.right>=0?Ea.right:-1,Ea.center>=0?Ea.center:-1,Ea.left>=0?Ea.left:-1,Ea.vertical||-1,Nv,Lv,V2,zR,BR,UR,VR,jR,$R,WR,HR,Vn,B2,U2,L2,z2,$2,0,ki,po,ZR,qR)}(u,Rt,jt,l,f,g,at,u.layers[0],u.collisionBoxArray,s.index,s.sourceLayerIndex,u.index,oe,[Oe,Oe,Oe,Oe],ut,A,fe,Be,tt,j,s,x,C,R,b)};if(ot==="line")for(const jt of w2(s.geometry,0,0,Qe,Qe)){const Rt=Ec(jt,He),Tt=MR(Rt,_e,Ye,l.vertical||X,f,24,Se,u.overscaling,Qe);for(const hr of Tt)X&&FR(u,X.text,Et,hr)||zt(Rt,hr)}else if(ot==="line-center"){for(const jt of s.geometry)if(jt.length>1){const Rt=Ec(jt,He),Tt=CR(Rt,Ye,l.vertical||X,f,24,Se);Tt&&zt(Rt,Tt)}}else if(s.type==="Polygon")for(const jt of lc(s.geometry,0)){const Rt=kR(jt,16);zt(Ec(jt[0],He,!0),new pl(Rt.x,Rt.y,0))}else if(s.type==="LineString")for(const jt of s.geometry){const Rt=Ec(jt,He);zt(Rt,new pl(Rt[0].x,Rt[0].y,0))}else if(s.type==="Point")for(const jt of s.geometry)for(const Rt of jt)zt([Rt],new pl(Rt.x,Rt.y,0))}function k2(u,s,l,f,g,x,b,T,A,C,R,O,B,V,j){const X=function(Se,fe,_e,Oe,Be,Ye,ut,tt){const ot=Oe.layout.get("text-rotate").evaluate(Ye,{})*Math.PI/180,Et=[];for(const st of fe.positionedLines)for(const at of st.positionedGlyphs){if(!at.rect)continue;const He=at.rect||{};let zt=4,jt=!0,Rt=1,Tt=0;const hr=(Be||tt)&&at.vertical,an=at.metrics.advance*at.scale/2;if(tt&&fe.verticalizable&&(Tt=st.lineOffset/2-(at.imageName?-(Un-at.metrics.width*at.scale)/2:(at.scale-1)*Un)),at.imageName){const $n=ut[at.imageName];jt=$n.sdf,Rt=$n.pixelRatio,zt=1/Rt}const On=Be?[at.x+an,at.y]:[0,0];let li=Be?[0,0]:[at.x+an+_e[0],at.y+_e[1]-Tt],Es=[0,0];hr&&(Es=li,li=[0,0]);const Zi=at.metrics.isDoubleResolution?2:1,Gn=(at.metrics.left-zt)*at.scale-an+li[0],rn=(-at.metrics.top-zt)*at.scale+li[1],Vn=Gn+He.w/Zi*at.scale/Rt,Kn=rn+He.h/Zi*at.scale/Rt,Qn=new y(Gn,rn),ki=new y(Vn,rn),As=new y(Gn,Kn),jn=new y(Vn,Kn);if(hr){const $n=new y(-an,an- -17),Wn=-Math.PI/2,Pn=12-an,qr=new y(22-Pn,-(at.imageName?Pn:0)),ho=new y(...Es);Qn._rotateAround(Wn,$n)._add(qr)._add(ho),ki._rotateAround(Wn,$n)._add(qr)._add(ho),As._rotateAround(Wn,$n)._add(qr)._add(ho),jn._rotateAround(Wn,$n)._add(qr)._add(ho)}if(ot){const $n=Math.sin(ot),Wn=Math.cos(ot),Pn=[Wn,-$n,$n,Wn];Qn._matMult(Pn),ki._matMult(Pn),As._matMult(Pn),jn._matMult(Pn)}const qi=new y(0,0),Fn=new y(0,0);Et.push({tl:Qn,tr:ki,bl:As,br:jn,tex:He,writingMode:fe.writingMode,glyphOffset:On,sectionIndex:at.sectionIndex,isSDF:jt,pixelOffsetTL:qi,pixelOffsetBR:Fn,minFontScaleX:0,minFontScaleY:0})}return Et}(0,l,T,g,x,b,f,u.allowVerticalPlacement),J=u.textSizeData;let oe=null;J.kind==="source"?(oe=[Sa*g.layout.get("text-size").evaluate(b,{})],oe[0]>dl&&Ft(`${u.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):J.kind==="composite"&&(oe=[Sa*V.compositeTextSizes[0].evaluate(b,{},j),Sa*V.compositeTextSizes[1].evaluate(b,{},j)],(oe[0]>dl||oe[1]>dl)&&Ft(`${u.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),u.addSymbols(u.text,X,oe,T,x,b,C,s,A.lineStartIndex,A.lineLength,B,j);for(const Se of R)O[Se]=u.text.placedSymbolArray.length-1;return 4*X.length}function D2(u){for(const s in u)return u[s];return null}function FR(u,s,l,f){const g=u.compareText;if(s in g){const x=g[s];for(let b=x.length-1;b>=0;b--)if(f.dist(x[b])<l)return!0}else g[s]=[];return g[s].push(f),!1}const O2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Cv{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,f]=new Uint8Array(s,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=f>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const x=O2[15&f];if(!x)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(s,2,1),[T]=new Uint32Array(s,4,1);return new Cv(T,b,x,s)}constructor(s,l=64,f=Float64Array,g){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=f,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const x=O2.indexOf(this.ArrayType),b=2*s*this.ArrayType.BYTES_PER_ELEMENT,T=s*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-T%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${f}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+T+A,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+b+T+A),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+T+A,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=s)}add(s,l){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=s,this.coords[this._pos++]=l,f}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return Mv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,l,f,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:b,nodeSize:T}=this,A=[0,x.length-1,0],C=[];for(;A.length;){const R=A.pop()||0,O=A.pop()||0,B=A.pop()||0;if(O-B<=T){for(let J=B;J<=O;J++){const oe=b[2*J],Se=b[2*J+1];oe>=s&&oe<=f&&Se>=l&&Se<=g&&C.push(x[J])}continue}const V=B+O>>1,j=b[2*V],X=b[2*V+1];j>=s&&j<=f&&X>=l&&X<=g&&C.push(x[V]),(R===0?s<=j:l<=X)&&(A.push(B),A.push(V-1),A.push(1-R)),(R===0?f>=j:g>=X)&&(A.push(V+1),A.push(O),A.push(1-R))}return C}within(s,l,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:x,nodeSize:b}=this,T=[0,g.length-1,0],A=[],C=f*f;for(;T.length;){const R=T.pop()||0,O=T.pop()||0,B=T.pop()||0;if(O-B<=b){for(let J=B;J<=O;J++)N2(x[2*J],x[2*J+1],s,l)<=C&&A.push(g[J]);continue}const V=B+O>>1,j=x[2*V],X=x[2*V+1];N2(j,X,s,l)<=C&&A.push(g[V]),(R===0?s-f<=j:l-f<=X)&&(T.push(B),T.push(V-1),T.push(1-R)),(R===0?s+f>=j:l+f>=X)&&(T.push(V+1),T.push(O),T.push(1-R))}return A}}function Mv(u,s,l,f,g,x){if(g-f<=l)return;const b=f+g>>1;F2(u,s,b,f,g,x),Mv(u,s,l,f,b-1,1-x),Mv(u,s,l,b+1,g,1-x)}function F2(u,s,l,f,g,x){for(;g>f;){if(g-f>600){const C=g-f+1,R=l-f+1,O=Math.log(C),B=.5*Math.exp(2*O/3),V=.5*Math.sqrt(O*B*(C-B)/C)*(R-C/2<0?-1:1);F2(u,s,l,Math.max(f,Math.floor(l-R*B/C+V)),Math.min(g,Math.floor(l+(C-R)*B/C+V)),x)}const b=s[2*l+x];let T=f,A=g;for(df(u,s,f,l),s[2*g+x]>b&&df(u,s,f,g);T<A;){for(df(u,s,T,A),T++,A--;s[2*T+x]<b;)T++;for(;s[2*A+x]>b;)A--}s[2*f+x]===b?df(u,s,f,A):(A++,df(u,s,A,g)),A<=l&&(f=A+1),l<=A&&(g=A-1)}}function df(u,s,l,f){Rv(u,l,f),Rv(s,2*l,2*f),Rv(s,2*l+1,2*f+1)}function Rv(u,s,l){const f=u[s];u[s]=u[l],u[l]=f}function N2(u,s,l,f){const g=u-l,x=s-f;return g*g+x*x}var kv;d.cx=void 0,(kv=d.cx||(d.cx={})).create="create",kv.load="load",kv.fullLoad="fullLoad";let $g=null,ff=[];const Dv=1e3/60,Ov="loadTime",Fv="fullLoadTime",NR={mark(u){performance.mark(u)},frame(u){const s=u;$g!=null&&ff.push(s-$g),$g=s},clearMetrics(){$g=null,ff=[],performance.clearMeasures(Ov),performance.clearMeasures(Fv);for(const u in d.cx)performance.clearMarks(d.cx[u])},getPerformanceMetrics(){performance.measure(Ov,d.cx.create,d.cx.load),performance.measure(Fv,d.cx.create,d.cx.fullLoad);const u=performance.getEntriesByName(Ov)[0].duration,s=performance.getEntriesByName(Fv)[0].duration,l=ff.length,f=1/(ff.reduce((x,b)=>x+b,0)/l/1e3),g=ff.filter(x=>x>Dv).reduce((x,b)=>x+(b-Dv)/Dv,0);return{loadTime:u,fullLoadTime:s,fps:f,percentDroppedFrames:g/(l+g)*100,totalFrames:l}}};d.$=Qe,d.A=Z,d.B=function([u,s,l]){return s+=90,s*=Math.PI/180,l*=Math.PI/180,{x:u*Math.cos(s)*Math.sin(l),y:u*Math.sin(s)*Math.sin(l),z:u*Math.cos(l)}},d.C=$s,d.D=St,d.E=ft,d.F=jr,d.G=yc,d.H=function(u){if(tr==null){const s=u.navigator?u.navigator.userAgent:null;tr=!!u.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return tr},d.I=mv,d.J=class{constructor(u,s){this.target=u,this.mapId=s,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new AR(()=>this.process()),this.subscription=Er(this.target,"message",l=>this.receive(l),!1),this.globalScope=xr(self)?u:window}registerMessageHandler(u,s){this.messageHandlers[u]=s}sendAsync(u,s){return new Promise((l,f)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10),x=s?Er(s.signal,"abort",()=>{x==null||x.unsubscribe(),delete this.resolveRejects[g];const A={id:g,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(A)},IR):null;this.resolveRejects[g]={resolve:A=>{x==null||x.unsubscribe(),l(A)},reject:A=>{x==null||x.unsubscribe(),f(A)}};const b=[],T=Object.assign(Object.assign({},u),{id:g,sourceMapId:this.mapId,origin:location.origin,data:nl(u.data,b)});this.target.postMessage(T,{transfer:b})})}receive(u){const s=u.data,l=s.id;if(!(s.origin!=="file://"&&location.origin!=="file://"&&s.origin!=="resource://android"&&location.origin!=="resource://android"&&s.origin!==location.origin||s.targetMapId&&this.mapId!==s.targetMapId)){if(s.type==="<cancel>"){delete this.tasks[l];const f=this.abortControllers[l];return delete this.abortControllers[l],void(f&&f.abort())}if(xr(self)||s.mustQueue)return this.tasks[l]=s,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,s)}}process(){if(this.taskQueue.length===0)return;const u=this.taskQueue.shift(),s=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),s&&this.processTask(u,s)}processTask(u,s){return a(this,void 0,void 0,function*(){if(s.type==="<response>"){const g=this.resolveRejects[u];return delete this.resolveRejects[u],g?void(s.error?g.reject(va(s.error)):g.resolve(va(s.data))):void 0}if(!this.messageHandlers[s.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${s.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const l=va(s.data),f=new AbortController;this.abortControllers[u]=f;try{const g=yield this.messageHandlers[s.type](s.sourceMapId,l,f);this.completeTask(u,null,g)}catch(g){this.completeTask(u,g)}})}completeTask(u,s,l){const f=[];delete this.abortControllers[u];const g={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:s?nl(s):null,data:nl(l,f)};this.target.postMessage(g,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},d.K=K,d.L=function(){var u=new Z(16);return Z!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},d.M=function(u,s,l){var f,g,x,b,T,A,C,R,O,B,V,j,X=l[0],J=l[1],oe=l[2];return s===u?(u[12]=s[0]*X+s[4]*J+s[8]*oe+s[12],u[13]=s[1]*X+s[5]*J+s[9]*oe+s[13],u[14]=s[2]*X+s[6]*J+s[10]*oe+s[14],u[15]=s[3]*X+s[7]*J+s[11]*oe+s[15]):(g=s[1],x=s[2],b=s[3],T=s[4],A=s[5],C=s[6],R=s[7],O=s[8],B=s[9],V=s[10],j=s[11],u[0]=f=s[0],u[1]=g,u[2]=x,u[3]=b,u[4]=T,u[5]=A,u[6]=C,u[7]=R,u[8]=O,u[9]=B,u[10]=V,u[11]=j,u[12]=f*X+T*J+O*oe+s[12],u[13]=g*X+A*J+B*oe+s[13],u[14]=x*X+C*J+V*oe+s[14],u[15]=b*X+R*J+j*oe+s[15]),u},d.N=function(u,s,l){var f=l[0],g=l[1],x=l[2];return u[0]=s[0]*f,u[1]=s[1]*f,u[2]=s[2]*f,u[3]=s[3]*f,u[4]=s[4]*g,u[5]=s[5]*g,u[6]=s[6]*g,u[7]=s[7]*g,u[8]=s[8]*x,u[9]=s[9]*x,u[10]=s[10]*x,u[11]=s[11]*x,u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},d.O=function(u,s,l){var f=s[0],g=s[1],x=s[2],b=s[3],T=s[4],A=s[5],C=s[6],R=s[7],O=s[8],B=s[9],V=s[10],j=s[11],X=s[12],J=s[13],oe=s[14],Se=s[15],fe=l[0],_e=l[1],Oe=l[2],Be=l[3];return u[0]=fe*f+_e*T+Oe*O+Be*X,u[1]=fe*g+_e*A+Oe*B+Be*J,u[2]=fe*x+_e*C+Oe*V+Be*oe,u[3]=fe*b+_e*R+Oe*j+Be*Se,u[4]=(fe=l[4])*f+(_e=l[5])*T+(Oe=l[6])*O+(Be=l[7])*X,u[5]=fe*g+_e*A+Oe*B+Be*J,u[6]=fe*x+_e*C+Oe*V+Be*oe,u[7]=fe*b+_e*R+Oe*j+Be*Se,u[8]=(fe=l[8])*f+(_e=l[9])*T+(Oe=l[10])*O+(Be=l[11])*X,u[9]=fe*g+_e*A+Oe*B+Be*J,u[10]=fe*x+_e*C+Oe*V+Be*oe,u[11]=fe*b+_e*R+Oe*j+Be*Se,u[12]=(fe=l[12])*f+(_e=l[13])*T+(Oe=l[14])*O+(Be=l[15])*X,u[13]=fe*g+_e*A+Oe*B+Be*J,u[14]=fe*x+_e*C+Oe*V+Be*oe,u[15]=fe*b+_e*R+Oe*j+Be*Se,u},d.P=y,d.Q=function(u,s){const l={};for(let f=0;f<s.length;f++){const g=s[f];g in u&&(l[g]=u[g])}return l},d.R=Xi,d.S=fl,d.T=sv,d.U=f2,d.V=d2,d.W=me,d.X=Y,d.Y=Ht,d.Z=Ss,d._=a,d.a=$,d.a$=Pt,d.a0=function(u,s){var l,f,g,x,b;if(!u)return s??{};if(!s)return u;let T=Object.assign({},u);if(s.removeAll&&(T={removeAll:!0}),s.remove){const A=new Set(s.remove);T.add&&(T.add=T.add.filter(R=>!A.has(R.id))),T.update&&(T.update=T.update.filter(R=>!A.has(R.id)));const C=new Set(((l=u.add)!==null&&l!==void 0?l:[]).map(R=>R.id));s.remove=s.remove.filter(R=>!C.has(R))}if(s.remove){const A=new Set(T.remove?T.remove.concat(s.remove):s.remove);T.remove=Array.from(A.values())}if(s.add){const A=T.add?T.add.concat(s.add):s.add,C=new Map(A.map(R=>[R.id,R]));T.add=Array.from(C.values())}if(s.update){const A=new Map((f=T.update)===null||f===void 0?void 0:f.map(C=>[C.id,C]));for(const C of s.update){const R=(g=A.get(C.id))!==null&&g!==void 0?g:{id:C.id};C.newGeometry&&(R.newGeometry=C.newGeometry),C.addOrUpdateProperties&&(R.addOrUpdateProperties=((x=R.addOrUpdateProperties)!==null&&x!==void 0?x:[]).concat(C.addOrUpdateProperties)),C.removeProperties&&(R.removeProperties=((b=R.removeProperties)!==null&&b!==void 0?b:[]).concat(C.removeProperties)),C.removeAllProperties&&(R.removeAllProperties=!0),A.set(C.id,R)}T.update=Array.from(A.values())}return T.remove&&T.add&&(T.remove=T.remove.filter(A=>T.add.findIndex(C=>C.id===A)===-1)),T},d.a1=uf,d.a2=Ac,d.a3=25,d.a4=Av,d.a5=u=>{const s=window.document.createElement("video");return s.muted=!0,new Promise(l=>{s.onloadstart=()=>{l(s)};for(const f of u){const g=window.document.createElement("source");Ie(f)||(s.crossOrigin="Anonymous"),g.src=f,s.appendChild(g)}})},d.a6=$e,d.a7=function(){return fr++},d.a8=L,d.a9=Ju,d.aA=function(u){let s=1/0,l=1/0,f=-1/0,g=-1/0;for(const x of u)s=Math.min(s,x.x),l=Math.min(l,x.y),f=Math.max(f,x.x),g=Math.max(g,x.y);return[s,l,f,g]},d.aB=Un,d.aC=gt,d.aD=function(u,s,l,f,g=!1){if(!l[0]&&!l[1])return[0,0];const x=g?f==="map"?-u.bearingInRadians:0:f==="viewport"?u.bearingInRadians:0;if(x){const b=Math.sin(x),T=Math.cos(x);l=[l[0]*T-l[1]*b,l[0]*b+l[1]*T]}return[g?l[0]:gt(s,l[0],u.zoom),g?l[1]:gt(s,l[1],u.zoom)]},d.aF=vv,d.aG=Pv,d.aH=yv,d.aI=Cv,d.aJ=dn,d.aK=Dg,d.aL=he,d.aM=Yt,d.aN=zr,d.aO=nr,d.aP=gr,d.aQ=g2,d.aR=qe,d.aS=Ze,d.aT=function(u){var s=new Z(3);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s},d.aU=function(u,s,l){return u[0]=s[0]-l[0],u[1]=s[1]-l[1],u[2]=s[2]-l[2],u},d.aV=function(u,s){var l=s[0],f=s[1],g=s[2],x=l*l+f*f+g*g;return x>0&&(x=1/Math.sqrt(x)),u[0]=s[0]*x,u[1]=s[1]*x,u[2]=s[2]*x,u},d.aW=Ke,d.aX=function(u,s){return u[0]*s[0]+u[1]*s[1]+u[2]*s[2]},d.aY=function(u,s,l){return u[0]=s[0]*l[0],u[1]=s[1]*l[1],u[2]=s[2]*l[2],u[3]=s[3]*l[3],u},d.aZ=je,d.a_=function(u,s,l){const f=s[0]*l[0]+s[1]*l[1]+s[2]*l[2];return f===0?null:(-(u[0]*l[0]+u[1]*l[1]+u[2]*l[2])-l[3])/f},d.aa=ma,d.ab=uo,d.ac=v2,d.ad=function(u){const s={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,f,g,x)=>{const b=g||x;return s[f]=!b||b.toLowerCase(),""}),s["max-age"]){const l=parseInt(s["max-age"],10);isNaN(l)?delete s["max-age"]:s["max-age"]=l}return s},d.ae=dr,d.af=function(u){return Math.pow(2,u)},d.ag=Ae,d.ah=mt,d.ai=85.051129,d.aj=p2,d.ak=function(u){return Math.log(u)/Math.LN2},d.al=function(u){var s=u[0],l=u[1];return s*s+l*l},d.am=function(u,s){const l=[];for(const f in u)f in s||l.push(f);return l},d.an=function(u,s){let l=0,f=0;if(u.kind==="constant")f=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:g,minZoom:x,maxZoom:b}=u,T=g?mt(Yn.interpolationFactor(g,s,x,b),0,1):0;u.kind==="camera"?f=$s.number(u.minSize,u.maxSize,T):l=T}return{uSizeT:l,uSize:f}},d.ap=function(u,{uSize:s,uSizeT:l},{lowerSize:f,upperSize:g}){return u.kind==="source"?f/Sa:u.kind==="composite"?$s.number(f/Sa,g/Sa,l):s},d.aq=function(u,s){var l=s[0],f=s[1],g=s[2],x=s[3],b=s[4],T=s[5],A=s[6],C=s[7],R=s[8],O=s[9],B=s[10],V=s[11],j=s[12],X=s[13],J=s[14],oe=s[15],Se=l*T-f*b,fe=l*A-g*b,_e=l*C-x*b,Oe=f*A-g*T,Be=f*C-x*T,Ye=g*C-x*A,ut=R*X-O*j,tt=R*J-B*j,ot=R*oe-V*j,Et=O*J-B*X,st=O*oe-V*X,at=B*oe-V*J,He=Se*at-fe*st+_e*Et+Oe*ot-Be*tt+Ye*ut;return He?(u[0]=(T*at-A*st+C*Et)*(He=1/He),u[1]=(g*st-f*at-x*Et)*He,u[2]=(X*Ye-J*Be+oe*Oe)*He,u[3]=(B*Be-O*Ye-V*Oe)*He,u[4]=(A*ot-b*at-C*tt)*He,u[5]=(l*at-g*ot+x*tt)*He,u[6]=(J*_e-j*Ye-oe*fe)*He,u[7]=(R*Ye-B*_e+V*fe)*He,u[8]=(b*st-T*ot+C*ut)*He,u[9]=(f*ot-l*st-x*ut)*He,u[10]=(j*Be-X*_e+oe*Se)*He,u[11]=(O*_e-R*Be-V*Se)*He,u[12]=(T*tt-b*Et-A*ut)*He,u[13]=(l*Et-f*tt+g*ut)*He,u[14]=(X*fe-j*Oe-J*Se)*He,u[15]=(R*Oe-O*fe+B*Se)*He,u):null},d.ar=$t,d.as=function(u){var s=u[0],l=u[1];return Math.sqrt(s*s+l*l)},d.at=function(u){return u[0]=0,u[1]=0,u},d.au=function(u,s,l){return u[0]=s[0]*l,u[1]=s[1]*l,u},d.av=xv,d.aw=xt,d.ax=function(u,s,l,f){const g=s.y-u.y,x=s.x-u.x,b=f.y-l.y,T=f.x-l.x,A=b*x-T*g;if(A===0)return null;const C=(T*(u.y-l.y)-b*(u.x-l.x))/A;return new y(u.x+C*x,u.y+C*g)},d.ay=w2,d.az=hw,d.b=Jt,d.b$=class extends _{},d.b0=function(u,s,l){return u[0]=s[0]*l,u[1]=s[1]*l,u[2]=s[2]*l,u[3]=s[3]*l,u},d.b1=function(u,s){return u[0]*s[0]+u[1]*s[1]+u[2]*s[2]+u[3]},d.b2=_2,d.b3=eh,d.b4=function(u,s,l,f,g){var x=1/Math.tan(s/2);if(u[0]=x/l,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=x,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,g!=null&&g!==1/0){var b=1/(f-g);u[10]=(g+f)*b,u[14]=2*g*f*b}else u[10]=-1,u[14]=-2*f;return u},d.b5=function(u){var s=new Z(16);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s[3]=u[3],s[4]=u[4],s[5]=u[5],s[6]=u[6],s[7]=u[7],s[8]=u[8],s[9]=u[9],s[10]=u[10],s[11]=u[11],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15],s},d.b6=function(u,s,l){var f=Math.sin(l),g=Math.cos(l),x=s[0],b=s[1],T=s[2],A=s[3],C=s[4],R=s[5],O=s[6],B=s[7];return s!==u&&(u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[0]=x*g+C*f,u[1]=b*g+R*f,u[2]=T*g+O*f,u[3]=A*g+B*f,u[4]=C*g-x*f,u[5]=R*g-b*f,u[6]=O*g-T*f,u[7]=B*g-A*f,u},d.b7=function(u,s,l){var f=Math.sin(l),g=Math.cos(l),x=s[4],b=s[5],T=s[6],A=s[7],C=s[8],R=s[9],O=s[10],B=s[11];return s!==u&&(u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[4]=x*g+C*f,u[5]=b*g+R*f,u[6]=T*g+O*f,u[7]=A*g+B*f,u[8]=C*g-x*f,u[9]=R*g-b*f,u[10]=O*g-T*f,u[11]=B*g-A*f,u},d.b8=function(){const u=new Float32Array(16);return Ae(u),u},d.b9=function(){const u=new Float64Array(16);return Ae(u),u},d.bA=function(u,s){const l=dt(u,360),f=dt(s,360),g=f-l,x=f>l?g-360:g+360;return Math.abs(g)<Math.abs(x)?g:x},d.bB=function(u){return u[0]=0,u[1]=0,u[2]=0,u},d.bC=function(u,s,l,f){const g=Math.sqrt(u*u+s*s),x=Math.sqrt(l*l+f*f);u/=g,s/=g,l/=x,f/=x;const b=Math.acos(u*l+s*f);return-s*l+u*f>0?b:-b},d.bD=function(u,s){const l=dt(u,2*Math.PI),f=dt(s,2*Math.PI);return Math.min(Math.abs(l-f),Math.abs(l-f+2*Math.PI),Math.abs(l-f-2*Math.PI))},d.bE=function(){const u={},s=Te.$version;for(const l in Te.$root){const f=Te.$root[l];if(f.required){let g=null;g=l==="version"?s:f.type==="array"?[]:{},g!=null&&(u[l]=g)}}return u},d.bF=Fu,d.bG=pe,d.bH=function u(s,l){if(Array.isArray(s)){if(!Array.isArray(l)||s.length!==l.length)return!1;for(let f=0;f<s.length;f++)if(!u(s[f],l[f]))return!1;return!0}if(typeof s=="object"&&s!==null&&l!==null){if(typeof l!="object"||Object.keys(s).length!==Object.keys(l).length)return!1;for(const f in s)if(!u(s[f],l[f]))return!1;return!0}return s===l},d.bI=function(u){u=u.slice();const s=Object.create(null);for(let l=0;l<u.length;l++)s[u[l].id]=u[l];for(let l=0;l<u.length;l++)"ref"in u[l]&&(u[l]=Bt(u[l],s[u[l].ref]));return u},d.bJ=function(u){if(u.type==="custom")return new ER(u);switch(u.type){case"background":return new wR(u);case"circle":return new aM(u);case"color-relief":return new fM(u);case"fill":return new PM(u);case"fill-extrusion":return new BM(u);case"heatmap":return new cM(u);case"hillshade":return new hM(u);case"line":return new XM(u);case"raster":return new SR(u);case"symbol":return new zg(u)}},d.bK=pr,d.bL=function(u,s){if(!u)return[{command:"setStyle",args:[s]}];let l=[];try{if(!_t(u.version,s.version))return[{command:"setStyle",args:[s]}];_t(u.center,s.center)||l.push({command:"setCenter",args:[s.center]}),_t(u.state,s.state)||l.push({command:"setGlobalState",args:[s.state]}),_t(u.centerAltitude,s.centerAltitude)||l.push({command:"setCenterAltitude",args:[s.centerAltitude]}),_t(u.zoom,s.zoom)||l.push({command:"setZoom",args:[s.zoom]}),_t(u.bearing,s.bearing)||l.push({command:"setBearing",args:[s.bearing]}),_t(u.pitch,s.pitch)||l.push({command:"setPitch",args:[s.pitch]}),_t(u.roll,s.roll)||l.push({command:"setRoll",args:[s.roll]}),_t(u.sprite,s.sprite)||l.push({command:"setSprite",args:[s.sprite]}),_t(u.glyphs,s.glyphs)||l.push({command:"setGlyphs",args:[s.glyphs]}),_t(u.transition,s.transition)||l.push({command:"setTransition",args:[s.transition]}),_t(u.light,s.light)||l.push({command:"setLight",args:[s.light]}),_t(u.terrain,s.terrain)||l.push({command:"setTerrain",args:[s.terrain]}),_t(u.sky,s.sky)||l.push({command:"setSky",args:[s.sky]}),_t(u.projection,s.projection)||l.push({command:"setProjection",args:[s.projection]});const f={},g=[];(function(b,T,A,C){let R;for(R in T=T||{},b=b||{})Object.prototype.hasOwnProperty.call(b,R)&&(Object.prototype.hasOwnProperty.call(T,R)||wr(R,A,C));for(R in T)Object.prototype.hasOwnProperty.call(T,R)&&(Object.prototype.hasOwnProperty.call(b,R)?_t(b[R],T[R])||(b[R].type==="geojson"&&T[R].type==="geojson"&&it(b,T,R)?Mt(A,{command:"setGeoJSONSourceData",args:[R,T[R].data]}):Rr(R,T,A,C)):Gt(R,T,A))})(u.sources,s.sources,g,f);const x=[];u.layers&&u.layers.forEach(b=>{"source"in b&&f[b.source]?l.push({command:"removeLayer",args:[b.id]}):x.push(b)}),l=l.concat(g),function(b,T,A){T=T||[];const C=(b=b||[]).map(Ut),R=T.map(Ut),O=b.reduce(kr,{}),B=T.reduce(kr,{}),V=C.slice(),j=Object.create(null);let X,J,oe,Se,fe;for(let _e=0,Oe=0;_e<C.length;_e++)X=C[_e],Object.prototype.hasOwnProperty.call(B,X)?Oe++:(Mt(A,{command:"removeLayer",args:[X]}),V.splice(V.indexOf(X,Oe),1));for(let _e=0,Oe=0;_e<R.length;_e++)X=R[R.length-1-_e],V[V.length-1-_e]!==X&&(Object.prototype.hasOwnProperty.call(O,X)?(Mt(A,{command:"removeLayer",args:[X]}),V.splice(V.lastIndexOf(X,V.length-Oe),1)):Oe++,Se=V[V.length-_e],Mt(A,{command:"addLayer",args:[B[X],Se]}),V.splice(V.length-_e,0,X),j[X]=!0);for(let _e=0;_e<R.length;_e++)if(X=R[_e],J=O[X],oe=B[X],!j[X]&&!_t(J,oe))if(_t(J.source,oe.source)&&_t(J["source-layer"],oe["source-layer"])&&_t(J.type,oe.type)){for(fe in Dt(J.layout,oe.layout,A,X,null,"setLayoutProperty"),Dt(J.paint,oe.paint,A,X,null,"setPaintProperty"),_t(J.filter,oe.filter)||Mt(A,{command:"setFilter",args:[X,oe.filter]}),_t(J.minzoom,oe.minzoom)&&_t(J.maxzoom,oe.maxzoom)||Mt(A,{command:"setLayerZoomRange",args:[X,oe.minzoom,oe.maxzoom]}),J)Object.prototype.hasOwnProperty.call(J,fe)&&fe!=="layout"&&fe!=="paint"&&fe!=="filter"&&fe!=="metadata"&&fe!=="minzoom"&&fe!=="maxzoom"&&(fe.indexOf("paint.")===0?Dt(J[fe],oe[fe],A,X,fe.slice(6),"setPaintProperty"):_t(J[fe],oe[fe])||Mt(A,{command:"setLayerProperty",args:[X,fe,oe[fe]]}));for(fe in oe)Object.prototype.hasOwnProperty.call(oe,fe)&&!Object.prototype.hasOwnProperty.call(J,fe)&&fe!=="layout"&&fe!=="paint"&&fe!=="filter"&&fe!=="metadata"&&fe!=="minzoom"&&fe!=="maxzoom"&&(fe.indexOf("paint.")===0?Dt(J[fe],oe[fe],A,X,fe.slice(6),"setPaintProperty"):_t(J[fe],oe[fe])||Mt(A,{command:"setLayerProperty",args:[X,fe,oe[fe]]}))}else Mt(A,{command:"removeLayer",args:[X]}),Se=V[V.lastIndexOf(X)+1],Mt(A,{command:"addLayer",args:[oe,Se]})}(x,s.layers,l)}catch(f){console.warn("Unable to compute style diff:",f),l=[{command:"setStyle",args:[s]}]}return l},d.bM=function(u){const s=[],l=u.id;return l===void 0&&s.push({message:`layers.${l}: missing required property "id"`}),u.render===void 0&&s.push({message:`layers.${l}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&s.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),s},d.bN=vr,d.bO=en,d.bP=class extends vi{constructor(u,s){super(u,s),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},d.bQ=Dn,d.bR=class extends vi{constructor(u,s){super(u,s),this.current=as}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let s=1;s<16;s++)if(u[s]!==this.current[s]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},d.bS=An,d.bT=class extends vi{constructor(u,s){super(u,s),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},d.bU=class extends vi{constructor(u,s){super(u,s),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},d.bV=le,d.bW=function(u,s){var l=Math.sin(s),f=Math.cos(s);return u[0]=f,u[1]=l,u[2]=0,u[3]=-l,u[4]=f,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},d.bX=function(u,s,l){var f=s[0],g=s[1],x=s[2];return u[0]=f*l[0]+g*l[3]+x*l[6],u[1]=f*l[1]+g*l[4]+x*l[7],u[2]=f*l[2]+g*l[5]+x*l[8],u},d.bY=function(u,s,l,f,g,x,b){var T=1/(s-l),A=1/(f-g),C=1/(x-b);return u[0]=-2*T,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*A,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*C,u[11]=0,u[12]=(s+l)*T,u[13]=(g+f)*A,u[14]=(b+x)*C,u[15]=1,u},d.bZ=class extends vi{constructor(u,s){super(u,s),this.current=new Array}set(u){if(u!=this.current){this.current=u;const s=new Float32Array(4*u.length);for(let l=0;l<u.length;l++)s[4*l]=u[l].r,s[4*l+1]=u[l].g,s[4*l+2]=u[l].b,s[4*l+3]=u[l].a;this.gl.uniform4fv(this.location,s)}}},d.b_=class extends vi{constructor(u,s){super(u,s),this.current=new Array}set(u){if(u!=this.current){this.current=u;const s=new Float32Array(u);this.gl.uniform1fv(this.location,s)}}},d.ba=function(){return new Float64Array(16)},d.bb=function(u,s,l){const f=new Float64Array(4);return Ot(f,u,s-90,l),f},d.bc=function(u,s,l,f){var g,x,b,T,A,C=s[0],R=s[1],O=s[2],B=s[3],V=l[0],j=l[1],X=l[2],J=l[3];return(x=C*V+R*j+O*X+B*J)<0&&(x=-x,V=-V,j=-j,X=-X,J=-J),1-x>q?(g=Math.acos(x),b=Math.sin(g),T=Math.sin((1-f)*g)/b,A=Math.sin(f*g)/b):(T=1-f,A=f),u[0]=T*C+A*V,u[1]=T*R+A*j,u[2]=T*O+A*X,u[3]=T*B+A*J,u},d.bd=function(u){const s=new Float64Array(9);var l,f,g,x,b,T,A,C,R,O,B,V,j,X,J,oe,Se,fe;O=(g=(f=u)[0])*(A=g+g),B=(x=f[1])*A,j=(b=f[2])*A,X=b*(C=x+x),oe=(T=f[3])*A,Se=T*C,fe=T*(R=b+b),(l=s)[0]=1-(V=x*C)-(J=b*R),l[3]=B-fe,l[6]=j+Se,l[1]=B+fe,l[4]=1-O-J,l[7]=X-oe,l[2]=j-Se,l[5]=X+oe,l[8]=1-O-V;const _e=gr(-Math.asin(mt(s[2],-1,1)));let Oe,Be;return Math.hypot(s[5],s[8])<.001?(Oe=0,Be=-gr(Math.atan2(s[3],s[4]))):(Oe=gr(s[5]===0&&s[8]===0?0:Math.atan2(s[5],s[8])),Be=gr(s[1]===0&&s[0]===0?0:Math.atan2(s[1],s[0]))),{roll:Oe,pitch:_e+90,bearing:Be}},d.be=function(u,s){return u.roll==s.roll&&u.pitch==s.pitch&&u.bearing==s.bearing},d.bf=or,d.bg=Bo,d.bh=Yu,d.bi=nf,d.bj=qu,d.bk=yt,d.bl=_r,d.bm=si,d.bn=function(u,s,l,f,g){return yt(f,g,mt((u-s)/(l-s),0,1))},d.bo=dt,d.bp=function(){return new Float64Array(3)},d.bq=function(u,s,l,f){return u[0]=s[0]+l[0]*f,u[1]=s[1]+l[1]*f,u[2]=s[2]+l[2]*f,u},d.br=Ot,d.bs=function(u,s,l){var f=l[0],g=l[1],x=l[2],b=l[3],T=s[0],A=s[1],C=s[2],R=g*C-x*A,O=x*T-f*C,B=f*A-g*T;return u[0]=T+b*(R+=R)+g*(B+=B)-x*(O+=O),u[1]=A+b*O+x*R-f*B,u[2]=C+b*B+f*O-g*R,u},d.bt=function(u,s,l){const f=(g=[u[0],u[1],u[2],s[0],s[1],s[2],l[0],l[1],l[2]])[0]*((R=g[8])*(b=g[4])-(T=g[5])*(C=g[7]))+g[1]*(-R*(x=g[3])+T*(A=g[6]))+g[2]*(C*x-b*A);var g,x,b,T,A,C,R;if(f===0)return null;const O=Ke([],[s[0],s[1],s[2]],[l[0],l[1],l[2]]),B=Ke([],[l[0],l[1],l[2]],[u[0],u[1],u[2]]),V=Ke([],[u[0],u[1],u[2]],[s[0],s[1],s[2]]),j=qe([],O,-u[3]);return Ze(j,j,qe([],B,-s[3])),Ze(j,j,qe([],V,-l[3])),qe(j,j,1/f),j},d.bu=Sv,d.bv=function(){return new Float64Array(4)},d.bw=function(u,s,l,f){var g=[],x=[];return g[0]=s[0]-l[0],g[1]=s[1]-l[1],g[2]=s[2]-l[2],x[0]=g[0]*Math.cos(f)-g[1]*Math.sin(f),x[1]=g[0]*Math.sin(f)+g[1]*Math.cos(f),x[2]=g[2],u[0]=x[0]+l[0],u[1]=x[1]+l[1],u[2]=x[2]+l[2],u},d.bx=function(u,s,l,f){var g=[],x=[];return g[0]=s[0]-l[0],g[1]=s[1]-l[1],g[2]=s[2]-l[2],x[0]=g[0],x[1]=g[1]*Math.cos(f)-g[2]*Math.sin(f),x[2]=g[1]*Math.sin(f)+g[2]*Math.cos(f),u[0]=x[0]+l[0],u[1]=x[1]+l[1],u[2]=x[2]+l[2],u},d.by=function(u,s,l,f){var g=[],x=[];return g[0]=s[0]-l[0],g[1]=s[1]-l[1],g[2]=s[2]-l[2],x[0]=g[2]*Math.sin(f)+g[0]*Math.cos(f),x[1]=g[1],x[2]=g[2]*Math.cos(f)-g[0]*Math.sin(f),u[0]=x[0]+l[0],u[1]=x[1]+l[1],u[2]=x[2]+l[2],u},d.bz=function(u,s,l){var f=Math.sin(l),g=Math.cos(l),x=s[0],b=s[1],T=s[2],A=s[3],C=s[8],R=s[9],O=s[10],B=s[11];return s!==u&&(u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[0]=x*g-C*f,u[1]=b*g-R*f,u[2]=T*g-O*f,u[3]=A*g-B*f,u[8]=x*f+C*g,u[9]=b*f+R*g,u[10]=T*f+O*g,u[11]=A*f+B*g,u},d.c=ve,d.c0=GM,d.c1=class extends h{},d.c2=iv,d.c3=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},d.c4=bw,d.c5=function(u,s,l){var f=s[0],g=s[1],x=s[2],b=l[3]*f+l[7]*g+l[11]*x+l[15];return u[0]=(l[0]*f+l[4]*g+l[8]*x+l[12])/(b=b||1),u[1]=(l[1]*f+l[5]*g+l[9]*x+l[13])/b,u[2]=(l[2]*f+l[6]*g+l[10]*x+l[14])/b,u},d.c6=class extends Xd{},d.c7=class extends k{},d.c8=function(u,s){return u[0]===s[0]&&u[1]===s[1]&&u[2]===s[2]&&u[3]===s[3]&&u[4]===s[4]&&u[5]===s[5]&&u[6]===s[6]&&u[7]===s[7]&&u[8]===s[8]&&u[9]===s[9]&&u[10]===s[10]&&u[11]===s[11]&&u[12]===s[12]&&u[13]===s[13]&&u[14]===s[14]&&u[15]===s[15]},d.c9=function(u,s){var l=u[0],f=u[1],g=u[2],x=u[3],b=u[4],T=u[5],A=u[6],C=u[7],R=u[8],O=u[9],B=u[10],V=u[11],j=u[12],X=u[13],J=u[14],oe=u[15],Se=s[0],fe=s[1],_e=s[2],Oe=s[3],Be=s[4],Ye=s[5],ut=s[6],tt=s[7],ot=s[8],Et=s[9],st=s[10],at=s[11],He=s[12],zt=s[13],jt=s[14],Rt=s[15];return Math.abs(l-Se)<=q*Math.max(1,Math.abs(l),Math.abs(Se))&&Math.abs(f-fe)<=q*Math.max(1,Math.abs(f),Math.abs(fe))&&Math.abs(g-_e)<=q*Math.max(1,Math.abs(g),Math.abs(_e))&&Math.abs(x-Oe)<=q*Math.max(1,Math.abs(x),Math.abs(Oe))&&Math.abs(b-Be)<=q*Math.max(1,Math.abs(b),Math.abs(Be))&&Math.abs(T-Ye)<=q*Math.max(1,Math.abs(T),Math.abs(Ye))&&Math.abs(A-ut)<=q*Math.max(1,Math.abs(A),Math.abs(ut))&&Math.abs(C-tt)<=q*Math.max(1,Math.abs(C),Math.abs(tt))&&Math.abs(R-ot)<=q*Math.max(1,Math.abs(R),Math.abs(ot))&&Math.abs(O-Et)<=q*Math.max(1,Math.abs(O),Math.abs(Et))&&Math.abs(B-st)<=q*Math.max(1,Math.abs(B),Math.abs(st))&&Math.abs(V-at)<=q*Math.max(1,Math.abs(V),Math.abs(at))&&Math.abs(j-He)<=q*Math.max(1,Math.abs(j),Math.abs(He))&&Math.abs(X-zt)<=q*Math.max(1,Math.abs(X),Math.abs(zt))&&Math.abs(J-jt)<=q*Math.max(1,Math.abs(J),Math.abs(jt))&&Math.abs(oe-Rt)<=q*Math.max(1,Math.abs(oe),Math.abs(Rt))},d.cA=function(u,s){$.REGISTERED_PROTOCOLS[u]=s},d.cB=function(u){delete $.REGISTERED_PROTOCOLS[u]},d.cC=function(u,s){const l={};for(let g=0;g<u.length;g++){const x=s&&s[u[g].id]||Xy(u[g]);s&&(s[u[g].id]=x);let b=l[x];b||(b=l[x]=[]),b.push(u[g])}const f=[];for(const g in l)f.push(l[g]);return f},d.cD=pt,d.cE=y2,d.cF=x2,d.cG=Gw,d.cH=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=Qe/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const s=u.bucket.layers[0],l=s.layout,f=s._unevaluatedLayout._values,g={layoutIconSize:f["icon-size"].possiblyEvaluate(new jr(u.bucket.zoom+1),u.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new jr(u.bucket.zoom+1),u.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new jr(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:R}=u.bucket.textSizeData;g.compositeTextSizes=[f["text-size"].possiblyEvaluate(new jr(C),u.canonical),f["text-size"].possiblyEvaluate(new jr(R),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:R}=u.bucket.iconSizeData;g.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new jr(C),u.canonical),f["icon-size"].possiblyEvaluate(new jr(R),u.canonical)]}const x=l.get("text-line-height")*Un,b=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",T=l.get("text-keep-upright"),A=l.get("text-size");for(const C of u.bucket.features){const R=l.get("text-font").evaluate(C,{},u.canonical).join(","),O=A.evaluate(C,{},u.canonical),B=g.layoutTextSize.evaluate(C,{},u.canonical),V=g.layoutIconSize.evaluate(C,{},u.canonical),j={horizontal:{},vertical:void 0},X=C.text;let J,oe=[0,0];if(X){const _e=X.toString(),Oe=l.get("text-letter-spacing").evaluate(C,{},u.canonical)*Un,Be=Gy(_e)?Oe:0,Ye=l.get("text-anchor").evaluate(C,{},u.canonical),ut=R2(s,C,u.canonical);if(!ut){const st=l.get("text-radial-offset").evaluate(C,{},u.canonical);oe=st?M2(Ye,[st*Un,Iv]):l.get("text-offset").evaluate(C,{},u.canonical).map(at=>at*Un)}let tt=b?"center":l.get("text-justify").evaluate(C,{},u.canonical);const ot=l.get("symbol-placement")==="point"?l.get("text-max-width").evaluate(C,{},u.canonical)*Un:1/0,Et=()=>{u.bucket.allowVerticalPlacement&&Nu(_e)&&(j.vertical=Fg(X,u.glyphMap,u.glyphPositions,u.imagePositions,R,ot,x,Ye,"left",Be,oe,d.ao.vertical,!0,B,O))};if(!b&&ut){const st=new Set;if(tt==="auto")for(let He=0;He<ut.values.length;He+=2)st.add(Pv(ut.values[He]));else st.add(tt);let at=!1;for(const He of st)if(!j.horizontal[He])if(at)j.horizontal[He]=j.horizontal[0];else{const zt=Fg(X,u.glyphMap,u.glyphPositions,u.imagePositions,R,ot,x,"center",He,Be,oe,d.ao.horizontal,!1,B,O);zt&&(j.horizontal[He]=zt,at=zt.positionedLines.length===1)}Et()}else{tt==="auto"&&(tt=Pv(Ye));const st=Fg(X,u.glyphMap,u.glyphPositions,u.imagePositions,R,ot,x,Ye,tt,Be,oe,d.ao.horizontal,!1,B,O);st&&(j.horizontal[tt]=st),Et(),Nu(_e)&&b&&T&&(j.vertical=Fg(X,u.glyphMap,u.glyphPositions,u.imagePositions,R,ot,x,Ye,tt,Be,oe,d.ao.vertical,!1,B,O))}}let Se=!1;if(C.icon&&C.icon.name){const _e=u.imageMap[C.icon.name];_e&&(J=yR(u.imagePositions[C.icon.name],l.get("icon-offset").evaluate(C,{},u.canonical),l.get("icon-anchor").evaluate(C,{},u.canonical)),Se=!!_e.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=Se:u.bucket.sdfIcons!==Se&&Ft("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_e.pixelRatio!==u.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const fe=D2(j.horizontal)||j.vertical;u.bucket.iconsInText=!!fe&&fe.iconsInText,(fe||J)&&OR(u.bucket,C,j,J,u.imageMap,g,B,V,oe,Se,u.canonical,u.subdivisionGranularity)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},d.cI=fv,d.cJ=uv,d.cK=dv,d.cL=Nw,d.cM=gv,d.cN=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},d.cO=function(u,s,l,f,g){return a(this,void 0,void 0,function*(){if(Y())try{return yield Ht(u,s,l,f,g)}catch{}return function(x,b,T,A,C){const R=x.width,O=x.height;ir&&yr||(ir=new OffscreenCanvas(R,O),yr=ir.getContext("2d",{willReadFrequently:!0})),ir.width=R,ir.height=O,yr.drawImage(x,0,0,R,O);const B=yr.getImageData(b,T,A,C);return yr.clearRect(0,0,R,O),B.data}(u,s,l,f,g)})},d.cP=Sw,d.cQ=S,d.cR=Fw,d.cS=Gu,d.cT=dc,d.cU=function(u,s){const l=new Map;if(u!=null)if(u.type==="Feature")l.set(hf(u,s),u);else for(const f of u.features)l.set(hf(f,s),f);return l},d.cV=function(u,s){if(u==null)return!0;if(u.type==="Feature")return hf(u,s)!=null;if(u.type==="FeatureCollection"){const l=new Set;for(const f of u.features){const g=hf(f,s);if(g==null||l.has(g))return!1;l.add(g)}return!0}return!1},d.cW=function(u,s,l){var f,g,x,b;if(s.removeAll&&u.clear(),s.remove)for(const T of s.remove)u.delete(T);if(s.add)for(const T of s.add){const A=hf(T,l);A!=null&&u.set(A,T)}if(s.update)for(const T of s.update){let A=u.get(T.id);if(A==null)continue;const C=!T.removeAllProperties&&(((f=T.removeProperties)===null||f===void 0?void 0:f.length)>0||((g=T.addOrUpdateProperties)===null||g===void 0?void 0:g.length)>0);if((T.newGeometry||T.removeAllProperties||C)&&(A=Object.assign({},A),u.set(T.id,A),C&&(A.properties=Object.assign({},A.properties))),T.newGeometry&&(A.geometry=T.newGeometry),T.removeAllProperties)A.properties={};else if(((x=T.removeProperties)===null||x===void 0?void 0:x.length)>0)for(const R of T.removeProperties)Object.prototype.hasOwnProperty.call(A.properties,R)&&delete A.properties[R];if(((b=T.addOrUpdateProperties)===null||b===void 0?void 0:b.length)>0)for(const{key:R,value:O}of T.addOrUpdateProperties)A.properties[R]=O}},d.cX=xs,d.ca=function(u,s){return u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},d.cb=u=>u.type==="symbol",d.cc=u=>u.type==="circle",d.cd=u=>u.type==="heatmap",d.ce=u=>u.type==="line",d.cf=u=>u.type==="fill",d.cg=u=>u.type==="fill-extrusion",d.ch=u=>u.type==="hillshade",d.ci=u=>u.type==="color-relief",d.cj=u=>u.type==="raster",d.ck=u=>u.type==="background",d.cl=u=>u.type==="custom",d.cm=lr,d.cn=function(u,s,l){const f=Je(s.x-l.x,s.y-l.y),g=Je(u.x-l.x,u.y-l.y);var x,b;return gr(Math.atan2(f[0]*g[1]-f[1]*g[0],(x=f)[0]*(b=g)[0]+x[1]*b[1]))},d.co=bt,d.cp=function(u,s){return Mr[s]&&(u instanceof MouseEvent||u instanceof WheelEvent)},d.cq=function(u,s){return Nr[s]&&"touches"in u},d.cr=function(u){return Nr[u]||Mr[u]},d.cs=function(u,s,l){var f=s[0],g=s[1];return u[0]=l[0]*f+l[4]*g+l[12],u[1]=l[1]*f+l[5]*g+l[13],u},d.ct=function(u,s){const{x:l,y:f}=uf.fromLngLat(s);return!(u<0||u>25||f<0||f>=1||l<0||l>=1)},d.cu=function(u,s){return u[0]=s[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=s[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=s[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},d.cv=class extends ol{},d.cw=NR,d.cy=function(u){return u.message===Qr},d.cz=se,d.d=Ie,d.e=Wt,d.f=u=>a(void 0,void 0,void 0,function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));const s=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(s)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),d.g=H,d.h=u=>new Promise((s,l)=>{const f=new Image;f.onload=()=>{s(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=sr})},f.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(u)],{type:"image/png"});f.src=u.byteLength?URL.createObjectURL(g):sr}),d.i=xr,d.j=(u,s)=>be(Wt(u,{type:"json"}),s),d.k=Ve,d.l=We,d.m=be,d.n=(u,s)=>be(Wt(u,{type:"arrayBuffer"}),s),d.o=function(u){return new gv(u).readFields(aR,[])},d.p=Yw,d.q=Qd,d.r=_i,d.s=Er,d.t=Sg,d.u=ur,d.v=Te,d.w=Ft,d.x=Zy,d.y=vc,d.z=rl}),o("worker",["./shared"],function(d){class a{constructor($){this.keyCache={},$&&this.replace($)}replace($){this._layerConfigs={},this._layers={},this.update($,[])}update($,H){for(const se of $){this._layerConfigs[se.id]=se;const pe=this._layers[se.id]=d.bJ(se);pe._featureFilter=d.aa(pe.filter),this.keyCache[se.id]&&delete this.keyCache[se.id]}for(const se of H)delete this.keyCache[se],delete this._layerConfigs[se],delete this._layers[se];this.familiesBySource={};const K=d.cC(Object.values(this._layerConfigs),this.keyCache);for(const se of K){const pe=se.map(Ve=>this._layers[Ve.id]),be=pe[0];if(be.visibility==="none")continue;const Ie=be.source||"";let xe=this.familiesBySource[Ie];xe||(xe=this.familiesBySource[Ie]={});const ze=be.sourceLayer||"_geojsonTileLayer";let We=xe[ze];We||(We=xe[ze]=[]),We.push(pe)}}}class y{constructor($){const H={},K=[];for(const Ie in $){const xe=$[Ie],ze=H[Ie]={};for(const We in xe){const Ve=xe[+We];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;const ft={x:0,y:0,w:Ve.bitmap.width+2,h:Ve.bitmap.height+2};K.push(ft),ze[We]={rect:ft,metrics:Ve.metrics}}}const{w:se,h:pe}=d.p(K),be=new d.q({width:se||1,height:pe||1});for(const Ie in $){const xe=$[Ie];for(const ze in xe){const We=xe[+ze];if(!We||We.bitmap.width===0||We.bitmap.height===0)continue;const Ve=H[Ie][ze].rect;d.q.copy(We.bitmap,be,{x:0,y:0},{x:Ve.x+1,y:Ve.y+1},We.bitmap)}}this.image=be,this.positions=H}}d.cD("GlyphAtlas",y);class S{constructor($){this.tileID=new d.Z($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.uid=$.uid,this.zoom=$.zoom,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=$.showCollisionBoxes,this.collectResourceTiming=!!$.collectResourceTiming,this.returnDependencies=!!$.returnDependencies,this.promoteId=$.promoteId,this.inFlightDependencies=[],this.globalState=$.globalState}parse($,H,K,se,pe){return d._(this,void 0,void 0,function*(){this.status="parsing",this.data=$,this.collisionBoxArray=new d.a8;const be=new d.cE(Object.keys($.layers).sort()),Ie=new d.cF(this.tileID,this.promoteId);Ie.bucketLayerIDs=[];const xe={},ze={featureIndex:Ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:K,subdivisionGranularity:pe},We=H.familiesBySource[this.source];for(const Dt in We){const Ut=$.layers[Dt];if(!Ut)continue;Ut.version===1&&d.w(`Vector tile source "${this.source}" layer "${Dt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const kr=be.encode(Dt),$e=[];for(let un=0;un<Ut.length;un++){const Dr=Ut.feature(un),Ai=Ie.getId(Dr,Dt);$e.push({feature:Dr,id:Ai,index:un,sourceLayerIndex:kr})}for(const un of We[Dt]){const Dr=un[0];Dr.source!==this.source&&d.w(`layer.source = ${Dr.source} does not equal this.source = ${this.source}`),Dr.minzoom&&this.zoom<Math.floor(Dr.minzoom)||Dr.maxzoom&&this.zoom>=Dr.maxzoom||Dr.visibility!=="none"&&(E(un,this.zoom,K,this.globalState),(xe[Dr.id]=Dr.createBucket({index:Ie.bucketLayerIDs.length,layers:un,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:kr,sourceID:this.source,globalState:this.globalState})).populate($e,ze,this.tileID.canonical),Ie.bucketLayerIDs.push(un.map(Ai=>Ai.id)))}}const Ve=d.bN(ze.glyphDependencies,Dt=>Object.keys(Dt).map(Number));this.inFlightDependencies.forEach(Dt=>Dt==null?void 0:Dt.abort()),this.inFlightDependencies=[];let ft=Promise.resolve({});if(Object.keys(Ve).length){const Dt=new AbortController;this.inFlightDependencies.push(Dt),ft=se.sendAsync({type:"GG",data:{stacks:Ve,source:this.source,tileID:this.tileID,type:"glyphs"}},Dt)}const Te=Object.keys(ze.iconDependencies);let kt=Promise.resolve({});if(Te.length){const Dt=new AbortController;this.inFlightDependencies.push(Dt),kt=se.sendAsync({type:"GI",data:{icons:Te,source:this.source,tileID:this.tileID,type:"icons"}},Dt)}const Bt=Object.keys(ze.patternDependencies);let _t=Promise.resolve({});if(Bt.length){const Dt=new AbortController;this.inFlightDependencies.push(Dt),_t=se.sendAsync({type:"GI",data:{icons:Bt,source:this.source,tileID:this.tileID,type:"patterns"}},Dt)}const[Mt,Gt,wr]=yield Promise.all([ft,kt,_t]),Rr=new y(Mt),it=new d.cG(Gt,wr);for(const Dt in xe){const Ut=xe[Dt];Ut instanceof d.a9?(E(Ut.layers,this.zoom,K,this.globalState),d.cH({bucket:Ut,glyphMap:Mt,glyphPositions:Rr.positions,imageMap:Gt,imagePositions:it.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:ze.subdivisionGranularity})):Ut.hasPattern&&(Ut instanceof d.cI||Ut instanceof d.cJ||Ut instanceof d.cK)&&(E(Ut.layers,this.zoom,K,this.globalState),Ut.addFeatures(ze,this.tileID.canonical,it.patternPositions))}return this.status="done",{buckets:Object.values(xe).filter(Dt=>!Dt.isEmpty()),featureIndex:Ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Rr.image,imageAtlas:it,glyphMap:this.returnDependencies?Mt:null,iconMap:this.returnDependencies?Gt:null,glyphPositions:this.returnDependencies?Rr.positions:null}})}}function E(ve,$,H,K){const se=new d.F($);for(const pe of ve)pe.setGlobalState(K),pe.recalculate(se,H)}class M{constructor($,H,K){this.actor=$,this.layerIndex=H,this.availableImages=K,this.fetching={},this.loading={},this.loaded={}}loadVectorTile($,H){return d._(this,void 0,void 0,function*(){const K=yield d.n($.request,H);try{return{vectorTile:new d.cL(new d.cM(K.data)),rawData:K.data,cacheControl:K.cacheControl,expires:K.expires}}catch(se){const pe=new Uint8Array(K.data);let be=`Unable to parse the tile at ${$.request.url}, `;throw be+=pe[0]===31&&pe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${se.message}`,new Error(be)}})}loadTile($){return d._(this,void 0,void 0,function*(){const H=$.uid,K=!!($&&$.request&&$.request.collectResourceTiming)&&new d.cN($.request),se=new S($);this.loading[H]=se;const pe=new AbortController;se.abort=pe;try{const be=yield this.loadVectorTile($,pe);if(delete this.loading[H],!be)return null;const Ie=be.rawData,xe={};be.expires&&(xe.expires=be.expires),be.cacheControl&&(xe.cacheControl=be.cacheControl);const ze={};if(K){const Ve=K.finish();Ve&&(ze.resourceTiming=JSON.parse(JSON.stringify(Ve)))}se.vectorTile=be.vectorTile;const We=se.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,$.subdivisionGranularity);this.loaded[H]=se,this.fetching[H]={rawTileData:Ie,cacheControl:xe,resourceTiming:ze};try{const Ve=yield We;return d.e({rawTileData:Ie.slice(0)},Ve,xe,ze)}finally{delete this.fetching[H]}}catch(be){throw delete this.loading[H],se.status="done",this.loaded[H]=se,be}})}reloadTile($){return d._(this,void 0,void 0,function*(){const H=$.uid;if(!this.loaded||!this.loaded[H])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const K=this.loaded[H];if(K.showCollisionBoxes=$.showCollisionBoxes,K.globalState=$.globalState,K.status==="parsing"){const se=yield K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,$.subdivisionGranularity);let pe;if(this.fetching[H]){const{rawTileData:be,cacheControl:Ie,resourceTiming:xe}=this.fetching[H];delete this.fetching[H],pe=d.e({rawTileData:be.slice(0)},se,Ie,xe)}else pe=se;return pe}if(K.status==="done"&&K.vectorTile)return K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,$.subdivisionGranularity)})}abortTile($){return d._(this,void 0,void 0,function*(){const H=this.loading,K=$.uid;H&&H[K]&&H[K].abort&&(H[K].abort.abort(),delete H[K])})}removeTile($){return d._(this,void 0,void 0,function*(){this.loaded&&this.loaded[$.uid]&&delete this.loaded[$.uid]})}}class F{constructor(){this.loaded={}}loadTile($){return d._(this,void 0,void 0,function*(){const{uid:H,encoding:K,rawImageData:se,redFactor:pe,greenFactor:be,blueFactor:Ie,baseShift:xe}=$,ze=se.width+2,We=se.height+2,Ve=d.b(se)?new d.R({width:ze,height:We},yield d.cO(se,-1,-1,ze,We)):se,ft=new d.cP(H,Ve,K,pe,be,Ie,xe);return this.loaded=this.loaded||{},this.loaded[H]=ft,ft})}removeTile($){const H=this.loaded,K=$.uid;H&&H[K]&&delete H[K]}}var N,G,re=function(){if(G)return N;function ve(H,K){if(H.length!==0){$(H[0],K);for(var se=1;se<H.length;se++)$(H[se],!K)}}function $(H,K){for(var se=0,pe=0,be=0,Ie=H.length,xe=Ie-1;be<Ie;xe=be++){var ze=(H[be][0]-H[xe][0])*(H[xe][1]+H[be][1]),We=se+ze;pe+=Math.abs(se)>=Math.abs(ze)?se-We+ze:ze-We+se,se=We}se+pe>=0!=!!K&&H.reverse()}return G=1,N=function H(K,se){var pe,be=K&&K.type;if(be==="FeatureCollection")for(pe=0;pe<K.features.length;pe++)H(K.features[pe],se);else if(be==="GeometryCollection")for(pe=0;pe<K.geometries.length;pe++)H(K.geometries[pe],se);else if(be==="Feature")H(K.geometry,se);else if(be==="Polygon")ve(K.coordinates,se);else if(be==="MultiPolygon")for(pe=0;pe<K.coordinates.length;pe++)ve(K.coordinates[pe],se);return K}}(),me=d.cQ(re);class Y extends d.cS{constructor($,H){super(new d.cM,0,H,[],[]),this.feature=$,this.type=$.type,this.properties=$.tags?$.tags:{},"id"in $&&(typeof $.id=="string"?this.id=parseInt($.id,10):typeof $.id!="number"||isNaN($.id)||(this.id=$.id))}loadGeometry(){const $=[],H=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const K of H){const se=[];for(const pe of K)se.push(new d.P(pe[0],pe[1]));$.push(se)}return $}}class q extends d.cR{constructor($,H){super(new d.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=H?H.version:1,this.extent=H?H.extent:4096,this.length=$.length,this.features=$}feature($){return new Y(this.features[$],this.extent)}}function Z(ve,$){$.writeVarintField(15,ve.version||1),$.writeStringField(1,ve.name||""),$.writeVarintField(5,ve.extent||4096);const H={keys:[],values:[],keycache:{},valuecache:{}};for(let pe=0;pe<ve.length;pe++)H.feature=ve.feature(pe),$.writeMessage(2,le,H);const K=H.keys;for(const pe of K)$.writeStringField(3,pe);const se=H.values;for(const pe of se)$.writeMessage(4,Ze,pe)}function le(ve,$){if(!ve.feature)return;const H=ve.feature;H.id!==void 0&&$.writeVarintField(1,H.id),$.writeMessage(2,Ae,ve),$.writeVarintField(3,H.type),$.writeMessage(4,Ue,H)}function Ae(ve,$){var H;for(const K in(H=ve.feature)==null?void 0:H.properties){let se=ve.feature.properties[K],pe=ve.keycache[K];if(se===null)continue;pe===void 0&&(ve.keys.push(K),pe=ve.keys.length-1,ve.keycache[K]=pe),$.writeVarint(pe),typeof se!="string"&&typeof se!="boolean"&&typeof se!="number"&&(se=JSON.stringify(se));const be=typeof se+":"+se;let Ie=ve.valuecache[be];Ie===void 0&&(ve.values.push(se),Ie=ve.values.length-1,ve.valuecache[be]=Ie),$.writeVarint(Ie)}}function we(ve,$){return($<<3)+(7&ve)}function je(ve){return ve<<1^ve>>31}function Ue(ve,$){const H=ve.loadGeometry(),K=ve.type;let se=0,pe=0;for(const be of H){let Ie=1;K===1&&(Ie=be.length),$.writeVarint(we(1,Ie));const xe=K===3?be.length-1:be.length;for(let ze=0;ze<xe;ze++){ze===1&&K!==1&&$.writeVarint(we(2,xe-1));const We=be[ze].x-se,Ve=be[ze].y-pe;$.writeVarint(je(We)),$.writeVarint(je(Ve)),se+=We,pe+=Ve}ve.type===3&&$.writeVarint(we(7,1))}}function Ze(ve,$){const H=typeof ve;H==="string"?$.writeStringField(1,ve):H==="boolean"?$.writeBooleanField(7,ve):H==="number"&&(ve%1!=0?$.writeDoubleField(3,ve):ve<0?$.writeSVarintField(6,ve):$.writeVarintField(5,ve))}const qe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ve=>ve},Ke=Math.fround||(ht=new Float32Array(1),ve=>(ht[0]=+ve,ht[0]));var ht;class Pt{constructor($){this.options=Object.assign(Object.create(qe),$),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load($){const{log:H,minZoom:K,maxZoom:se}=this.options;H&&console.time("total time");const pe=`prepare ${$.length} points`;H&&console.time(pe),this.points=$;const be=[];for(let xe=0;xe<$.length;xe++){const ze=$[xe];if(!ze.geometry)continue;const[We,Ve]=ze.geometry.coordinates,ft=Ke(Ot(We)),Te=Ke($t(Ve));be.push(ft,Te,1/0,xe,-1,1),this.options.reduce&&be.push(0)}let Ie=this.trees[se+1]=this._createTree(be);H&&console.timeEnd(pe);for(let xe=se;xe>=K;xe--){const ze=+Date.now();Ie=this.trees[xe]=this._createTree(this._cluster(Ie,xe)),H&&console.log("z%d: %d clusters in %dms",xe,Ie.numItems,+Date.now()-ze)}return H&&console.timeEnd("total time"),this}getClusters($,H){let K=(($[0]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,$[1]));let pe=$[2]===180?180:(($[2]+180)%360+360)%360-180;const be=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)K=-180,pe=180;else if(K>pe){const Ve=this.getClusters([K,se,180,be],H),ft=this.getClusters([-180,se,pe,be],H);return Ve.concat(ft)}const Ie=this.trees[this._limitZoom(H)],xe=Ie.range(Ot(K),$t(be),Ot(pe),$t(se)),ze=Ie.data,We=[];for(const Ve of xe){const ft=this.stride*Ve;We.push(ze[ft+5]>1?xt(ze,ft,this.clusterProps):this.points[ze[ft+3]])}return We}getChildren($){const H=this._getOriginId($),K=this._getOriginZoom($),se="No cluster with the specified id.",pe=this.trees[K];if(!pe)throw new Error(se);const be=pe.data;if(H*this.stride>=be.length)throw new Error(se);const Ie=this.options.radius/(this.options.extent*Math.pow(2,K-1)),xe=pe.within(be[H*this.stride],be[H*this.stride+1],Ie),ze=[];for(const We of xe){const Ve=We*this.stride;be[Ve+4]===$&&ze.push(be[Ve+5]>1?xt(be,Ve,this.clusterProps):this.points[be[Ve+3]])}if(ze.length===0)throw new Error(se);return ze}getLeaves($,H,K){const se=[];return this._appendLeaves(se,$,H=H||10,K=K||0,0),se}getTile($,H,K){const se=this.trees[this._limitZoom($)],pe=Math.pow(2,$),{extent:be,radius:Ie}=this.options,xe=Ie/be,ze=(K-xe)/pe,We=(K+1+xe)/pe,Ve={features:[]};return this._addTileFeatures(se.range((H-xe)/pe,ze,(H+1+xe)/pe,We),se.data,H,K,pe,Ve),H===0&&this._addTileFeatures(se.range(1-xe/pe,ze,1,We),se.data,pe,K,pe,Ve),H===pe-1&&this._addTileFeatures(se.range(0,ze,xe/pe,We),se.data,-1,K,pe,Ve),Ve.features.length?Ve:null}getClusterExpansionZoom($){let H=this._getOriginZoom($)-1;for(;H<=this.options.maxZoom;){const K=this.getChildren($);if(H++,K.length!==1)break;$=K[0].properties.cluster_id}return H}_appendLeaves($,H,K,se,pe){const be=this.getChildren(H);for(const Ie of be){const xe=Ie.properties;if(xe&&xe.cluster?pe+xe.point_count<=se?pe+=xe.point_count:pe=this._appendLeaves($,xe.cluster_id,K,se,pe):pe<se?pe++:$.push(Ie),$.length===K)break}return pe}_createTree($){const H=new d.aI($.length/this.stride|0,this.options.nodeSize,Float32Array);for(let K=0;K<$.length;K+=this.stride)H.add($[K],$[K+1]);return H.finish(),H.data=$,H}_addTileFeatures($,H,K,se,pe,be){for(const Ie of $){const xe=Ie*this.stride,ze=H[xe+5]>1;let We,Ve,ft;if(ze)We=Zt(H,xe,this.clusterProps),Ve=H[xe],ft=H[xe+1];else{const Bt=this.points[H[xe+3]];We=Bt.properties;const[_t,Mt]=Bt.geometry.coordinates;Ve=Ot(_t),ft=$t(Mt)}const Te={type:1,geometry:[[Math.round(this.options.extent*(Ve*pe-K)),Math.round(this.options.extent*(ft*pe-se))]],tags:We};let kt;kt=ze||this.options.generateId?H[xe+3]:this.points[H[xe+3]].id,kt!==void 0&&(Te.id=kt),be.features.push(Te)}}_limitZoom($){return Math.max(this.options.minZoom,Math.min(Math.floor(+$),this.options.maxZoom+1))}_cluster($,H){const{radius:K,extent:se,reduce:pe,minPoints:be}=this.options,Ie=K/(se*Math.pow(2,H)),xe=$.data,ze=[],We=this.stride;for(let Ve=0;Ve<xe.length;Ve+=We){if(xe[Ve+2]<=H)continue;xe[Ve+2]=H;const ft=xe[Ve],Te=xe[Ve+1],kt=$.within(xe[Ve],xe[Ve+1],Ie),Bt=xe[Ve+5];let _t=Bt;for(const Mt of kt){const Gt=Mt*We;xe[Gt+2]>H&&(_t+=xe[Gt+5])}if(_t>Bt&&_t>=be){let Mt,Gt=ft*Bt,wr=Te*Bt,Rr=-1;const it=(Ve/We<<5)+(H+1)+this.points.length;for(const Dt of kt){const Ut=Dt*We;if(xe[Ut+2]<=H)continue;xe[Ut+2]=H;const kr=xe[Ut+5];Gt+=xe[Ut]*kr,wr+=xe[Ut+1]*kr,xe[Ut+4]=it,pe&&(Mt||(Mt=this._map(xe,Ve,!0),Rr=this.clusterProps.length,this.clusterProps.push(Mt)),pe(Mt,this._map(xe,Ut)))}xe[Ve+4]=it,ze.push(Gt/_t,wr/_t,1/0,it,-1,_t),pe&&ze.push(Rr)}else{for(let Mt=0;Mt<We;Mt++)ze.push(xe[Ve+Mt]);if(_t>1)for(const Mt of kt){const Gt=Mt*We;if(!(xe[Gt+2]<=H)){xe[Gt+2]=H;for(let wr=0;wr<We;wr++)ze.push(xe[Gt+wr])}}}}return ze}_getOriginId($){return $-this.points.length>>5}_getOriginZoom($){return($-this.points.length)%32}_map($,H,K){if($[H+5]>1){const be=this.clusterProps[$[H+6]];return K?Object.assign({},be):be}const se=this.points[$[H+3]].properties,pe=this.options.map(se);return K&&pe===se?Object.assign({},pe):pe}}function xt(ve,$,H){return{type:"Feature",id:ve[$+3],properties:Zt(ve,$,H),geometry:{type:"Point",coordinates:[(K=ve[$],360*(K-.5)),Je(ve[$+1])]}};var K}function Zt(ve,$,H){const K=ve[$+5],se=K>=1e4?`${Math.round(K/1e3)}k`:K>=1e3?Math.round(K/100)/10+"k":K,pe=ve[$+6],be=pe===-1?{}:Object.assign({},H[pe]);return Object.assign(be,{cluster:!0,cluster_id:ve[$+3],point_count:K,point_count_abbreviated:se})}function Ot(ve){return ve/360+.5}function $t(ve){const $=Math.sin(ve*Math.PI/180),H=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return H<0?0:H>1?1:H}function Je(ve){const $=(180-360*ve)*Math.PI/180;return 360*Math.atan(Math.exp($))/Math.PI-90}function Qe(ve,$,H,K){let se=K;const pe=$+(H-$>>1);let be,Ie=H-$;const xe=ve[$],ze=ve[$+1],We=ve[H],Ve=ve[H+1];for(let ft=$+3;ft<H;ft+=3){const Te=gt(ve[ft],ve[ft+1],xe,ze,We,Ve);if(Te>se)be=ft,se=Te;else if(Te===se){const kt=Math.abs(ft-pe);kt<Ie&&(be=ft,Ie=kt)}}se>K&&(be-$>3&&Qe(ve,$,be,K),ve[be+2]=se,H-be>3&&Qe(ve,be,H,K))}function gt(ve,$,H,K,se,pe){let be=se-H,Ie=pe-K;if(be!==0||Ie!==0){const xe=((ve-H)*be+($-K)*Ie)/(be*be+Ie*Ie);xe>1?(H=se,K=pe):xe>0&&(H+=be*xe,K+=Ie*xe)}return be=ve-H,Ie=$-K,be*be+Ie*Ie}function dt(ve,$,H,K){const se={id:ve??null,type:$,geometry:H,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if($==="Point"||$==="MultiPoint"||$==="LineString")yt(se,H);else if($==="Polygon")yt(se,H[0]);else if($==="MultiLineString")for(const pe of H)yt(se,pe);else if($==="MultiPolygon")for(const pe of H)yt(se,pe[0]);return se}function yt(ve,$){for(let H=0;H<$.length;H+=3)ve.minX=Math.min(ve.minX,$[H]),ve.minY=Math.min(ve.minY,$[H+1]),ve.maxX=Math.max(ve.maxX,$[H]),ve.maxY=Math.max(ve.maxY,$[H+1])}function _r(ve,$,H,K){if(!$.geometry)return;const se=$.geometry.coordinates;if(se&&se.length===0)return;const pe=$.geometry.type,be=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2);let Ie=[],xe=$.id;if(H.promoteId?xe=$.properties[H.promoteId]:H.generateId&&(xe=K||0),pe==="Point")lr(se,Ie);else if(pe==="MultiPoint")for(const ze of se)lr(ze,Ie);else if(pe==="LineString")bt(se,Ie,be,!1);else if(pe==="MultiLineString"){if(H.lineMetrics){for(const ze of se)Ie=[],bt(ze,Ie,be,!1),ve.push(dt(xe,"LineString",Ie,$.properties));return}mt(se,Ie,be,!1)}else if(pe==="Polygon")mt(se,Ie,be,!0);else{if(pe!=="MultiPolygon"){if(pe==="GeometryCollection"){for(const ze of $.geometry.geometries)_r(ve,{id:xe,geometry:ze,properties:$.properties},H,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ze of se){const We=[];mt(ze,We,be,!0),Ie.push(We)}}ve.push(dt(xe,pe,Ie,$.properties))}function lr(ve,$){$.push(nr(ve[0]),Wt(ve[1]),0)}function bt(ve,$,H,K){let se,pe,be=0;for(let xe=0;xe<ve.length;xe++){const ze=nr(ve[xe][0]),We=Wt(ve[xe][1]);$.push(ze,We,0),xe>0&&(be+=K?(se*We-ze*pe)/2:Math.sqrt(Math.pow(ze-se,2)+Math.pow(We-pe,2))),se=ze,pe=We}const Ie=$.length-3;$[2]=1,Qe($,0,Ie,H),$[Ie+2]=1,$.size=Math.abs(be),$.start=0,$.end=$.size}function mt(ve,$,H,K){for(let se=0;se<ve.length;se++){const pe=[];bt(ve[se],pe,H,K),$.push(pe)}}function nr(ve){return ve/360+.5}function Wt(ve){const $=Math.sin(ve*Math.PI/180),H=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return H<0?0:H>1?1:H}function fr(ve,$,H,K,se,pe,be,Ie){if(K/=$,pe>=(H/=$)&&be<K)return ve;if(be<H||pe>=K)return null;const xe=[];for(const ze of ve){const We=ze.geometry;let Ve=ze.type;const ft=se===0?ze.minX:ze.minY,Te=se===0?ze.maxX:ze.maxY;if(ft>=H&&Te<K){xe.push(ze);continue}if(Te<H||ft>=K)continue;let kt=[];if(Ve==="Point"||Ve==="MultiPoint")vr(We,kt,H,K,se);else if(Ve==="LineString")en(We,kt,H,K,se,!1,Ie.lineMetrics);else if(Ve==="MultiLineString")er(We,kt,H,K,se,!1);else if(Ve==="Polygon")er(We,kt,H,K,se,!0);else if(Ve==="MultiPolygon")for(const Bt of We){const _t=[];er(Bt,_t,H,K,se,!0),_t.length&&kt.push(_t)}if(kt.length){if(Ie.lineMetrics&&Ve==="LineString"){for(const Bt of kt)xe.push(dt(ze.id,Ve,Bt,ze.tags));continue}Ve!=="LineString"&&Ve!=="MultiLineString"||(kt.length===1?(Ve="LineString",kt=kt[0]):Ve="MultiLineString"),Ve!=="Point"&&Ve!=="MultiPoint"||(Ve=kt.length===3?"Point":"MultiPoint"),xe.push(dt(ze.id,Ve,kt,ze.tags))}}return xe.length?xe:null}function vr(ve,$,H,K,se){for(let pe=0;pe<ve.length;pe+=3){const be=ve[pe+se];be>=H&&be<=K&&Ft($,ve[pe],ve[pe+1],ve[pe+2])}}function en(ve,$,H,K,se,pe,be){let Ie=pr(ve);const xe=se===0?Qt:xr;let ze,We,Ve=ve.start;for(let _t=0;_t<ve.length-3;_t+=3){const Mt=ve[_t],Gt=ve[_t+1],wr=ve[_t+2],Rr=ve[_t+3],it=ve[_t+4],Dt=se===0?Mt:Gt,Ut=se===0?Rr:it;let kr=!1;be&&(ze=Math.sqrt(Math.pow(Mt-Rr,2)+Math.pow(Gt-it,2))),Dt<H?Ut>H&&(We=xe(Ie,Mt,Gt,Rr,it,H),be&&(Ie.start=Ve+ze*We)):Dt>K?Ut<K&&(We=xe(Ie,Mt,Gt,Rr,it,K),be&&(Ie.start=Ve+ze*We)):Ft(Ie,Mt,Gt,wr),Ut<H&&Dt>=H&&(We=xe(Ie,Mt,Gt,Rr,it,H),kr=!0),Ut>K&&Dt<=K&&(We=xe(Ie,Mt,Gt,Rr,it,K),kr=!0),!pe&&kr&&(be&&(Ie.end=Ve+ze*We),$.push(Ie),Ie=pr(ve)),be&&(Ve+=ze)}let ft=ve.length-3;const Te=ve[ft],kt=ve[ft+1],Bt=se===0?Te:kt;Bt>=H&&Bt<=K&&Ft(Ie,Te,kt,ve[ft+2]),ft=Ie.length-3,pe&&ft>=3&&(Ie[ft]!==Ie[0]||Ie[ft+1]!==Ie[1])&&Ft(Ie,Ie[0],Ie[1],Ie[2]),Ie.length&&$.push(Ie)}function pr(ve){const $=[];return $.size=ve.size,$.start=ve.start,$.end=ve.end,$}function er(ve,$,H,K,se,pe){for(const be of ve)en(be,$,H,K,se,pe,!1)}function Ft(ve,$,H,K){ve.push($,H,K)}function Qt(ve,$,H,K,se,pe){const be=(pe-$)/(K-$);return Ft(ve,pe,H+(se-H)*be,1),be}function xr(ve,$,H,K,se,pe){const be=(pe-H)/(se-H);return Ft(ve,$+(K-$)*be,pe,1),be}function tr(ve,$){const H=[];for(let K=0;K<ve.length;K++){const se=ve[K],pe=se.type;let be;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")be=Jt(se.geometry,$);else if(pe==="MultiLineString"||pe==="Polygon"){be=[];for(const Ie of se.geometry)be.push(Jt(Ie,$))}else if(pe==="MultiPolygon"){be=[];for(const Ie of se.geometry){const xe=[];for(const ze of Ie)xe.push(Jt(ze,$));be.push(xe)}}H.push(dt(se.id,pe,be,se.tags))}return H}function Jt(ve,$){const H=[];H.size=ve.size,ve.start!==void 0&&(H.start=ve.start,H.end=ve.end);for(let K=0;K<ve.length;K+=3)H.push(ve[K]+$,ve[K+1],ve[K+2]);return H}function sr(ve,$){if(ve.transformed)return ve;const H=1<<ve.z,K=ve.x,se=ve.y;for(const pe of ve.features){const be=pe.geometry,Ie=pe.type;if(pe.geometry=[],Ie===1)for(let xe=0;xe<be.length;xe+=2)pe.geometry.push(Ht(be[xe],be[xe+1],$,H,K,se));else for(let xe=0;xe<be.length;xe++){const ze=[];for(let We=0;We<be[xe].length;We+=2)ze.push(Ht(be[xe][We],be[xe][We+1],$,H,K,se));pe.geometry.push(ze)}}return ve.transformed=!0,ve}function Ht(ve,$,H,K,se,pe){return[Math.round(H*(ve*K-se)),Math.round(H*($*K-pe))]}function ir(ve,$,H,K,se){const pe=$===se.maxZoom?0:se.tolerance/((1<<$)*se.extent),be={features:[],numPoints:0,numSimplified:0,numFeatures:ve.length,source:null,x:H,y:K,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ie of ve)yr(be,Ie,pe,se);return be}function yr(ve,$,H,K){const se=$.geometry,pe=$.type,be=[];if(ve.minX=Math.min(ve.minX,$.minX),ve.minY=Math.min(ve.minY,$.minY),ve.maxX=Math.max(ve.maxX,$.maxX),ve.maxY=Math.max(ve.maxY,$.maxY),pe==="Point"||pe==="MultiPoint")for(let Ie=0;Ie<se.length;Ie+=3)be.push(se[Ie],se[Ie+1]),ve.numPoints++,ve.numSimplified++;else if(pe==="LineString")Er(be,se,ve,H,!1,!1);else if(pe==="MultiLineString"||pe==="Polygon")for(let Ie=0;Ie<se.length;Ie++)Er(be,se[Ie],ve,H,pe==="Polygon",Ie===0);else if(pe==="MultiPolygon")for(let Ie=0;Ie<se.length;Ie++){const xe=se[Ie];for(let ze=0;ze<xe.length;ze++)Er(be,xe[ze],ve,H,!0,ze===0)}if(be.length){let Ie=$.tags||null;if(pe==="LineString"&&K.lineMetrics){Ie={};for(const ze in $.tags)Ie[ze]=$.tags[ze];Ie.mapbox_clip_start=se.start/se.size,Ie.mapbox_clip_end=se.end/se.size}const xe={geometry:be,type:pe==="Polygon"||pe==="MultiPolygon"?3:pe==="LineString"||pe==="MultiLineString"?2:1,tags:Ie};$.id!==null&&(xe.id=$.id),ve.features.push(xe)}}function Er(ve,$,H,K,se,pe){const be=K*K;if(K>0&&$.size<(se?be:K))return void(H.numPoints+=$.length/3);const Ie=[];for(let xe=0;xe<$.length;xe+=3)(K===0||$[xe+2]>be)&&(H.numSimplified++,Ie.push($[xe],$[xe+1])),H.numPoints++;se&&function(xe,ze){let We=0;for(let Ve=0,ft=xe.length,Te=ft-2;Ve<ft;Te=Ve,Ve+=2)We+=(xe[Ve]-xe[Te])*(xe[Ve+1]+xe[Te+1]);if(We>0===ze)for(let Ve=0,ft=xe.length;Ve<ft/2;Ve+=2){const Te=xe[Ve],kt=xe[Ve+1];xe[Ve]=xe[ft-2-Ve],xe[Ve+1]=xe[ft-1-Ve],xe[ft-2-Ve]=Te,xe[ft-1-Ve]=kt}}(Ie,pe),ve.push(Ie)}const dr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class gr{constructor($,H){const K=(H=this.options=function(pe,be){for(const Ie in be)pe[Ie]=be[Ie];return pe}(Object.create(dr),H)).debug;if(K&&console.time("preprocess data"),H.maxZoom<0||H.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(H.promoteId&&H.generateId)throw new Error("promoteId and generateId cannot be used together.");let se=function(pe,be){const Ie=[];if(pe.type==="FeatureCollection")for(let xe=0;xe<pe.features.length;xe++)_r(Ie,pe.features[xe],be,xe);else _r(Ie,pe.type==="Feature"?pe:{geometry:pe},be);return Ie}($,H);this.tiles={},this.tileCoords=[],K&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",H.indexMaxZoom,H.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),se=function(pe,be){const Ie=be.buffer/be.extent;let xe=pe;const ze=fr(pe,1,-1-Ie,Ie,0,-1,2,be),We=fr(pe,1,1-Ie,2+Ie,0,-1,2,be);return(ze||We)&&(xe=fr(pe,1,-Ie,1+Ie,0,-1,2,be)||[],ze&&(xe=tr(ze,1).concat(xe)),We&&(xe=xe.concat(tr(We,-1)))),xe}(se,H),se.length&&this.splitTile(se,0,0,0),K&&(se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile($,H,K,se,pe,be,Ie){const xe=[$,H,K,se],ze=this.options,We=ze.debug;for(;xe.length;){se=xe.pop(),K=xe.pop(),H=xe.pop(),$=xe.pop();const Ve=1<<H,ft=Nr(H,K,se);let Te=this.tiles[ft];if(!Te&&(We>1&&console.time("creation"),Te=this.tiles[ft]=ir($,H,K,se,ze),this.tileCoords.push({z:H,x:K,y:se}),We)){We>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",H,K,se,Te.numFeatures,Te.numPoints,Te.numSimplified),console.timeEnd("creation"));const kr=`z${H}`;this.stats[kr]=(this.stats[kr]||0)+1,this.total++}if(Te.source=$,pe==null){if(H===ze.indexMaxZoom||Te.numPoints<=ze.indexMaxPoints)continue}else{if(H===ze.maxZoom||H===pe)continue;if(pe!=null){const kr=pe-H;if(K!==be>>kr||se!==Ie>>kr)continue}}if(Te.source=null,$.length===0)continue;We>1&&console.time("clipping");const kt=.5*ze.buffer/ze.extent,Bt=.5-kt,_t=.5+kt,Mt=1+kt;let Gt=null,wr=null,Rr=null,it=null,Dt=fr($,Ve,K-kt,K+_t,0,Te.minX,Te.maxX,ze),Ut=fr($,Ve,K+Bt,K+Mt,0,Te.minX,Te.maxX,ze);$=null,Dt&&(Gt=fr(Dt,Ve,se-kt,se+_t,1,Te.minY,Te.maxY,ze),wr=fr(Dt,Ve,se+Bt,se+Mt,1,Te.minY,Te.maxY,ze),Dt=null),Ut&&(Rr=fr(Ut,Ve,se-kt,se+_t,1,Te.minY,Te.maxY,ze),it=fr(Ut,Ve,se+Bt,se+Mt,1,Te.minY,Te.maxY,ze),Ut=null),We>1&&console.timeEnd("clipping"),xe.push(Gt||[],H+1,2*K,2*se),xe.push(wr||[],H+1,2*K,2*se+1),xe.push(Rr||[],H+1,2*K+1,2*se),xe.push(it||[],H+1,2*K+1,2*se+1)}}getTile($,H,K){$=+$,H=+H,K=+K;const se=this.options,{extent:pe,debug:be}=se;if($<0||$>24)return null;const Ie=1<<$,xe=Nr($,H=H+Ie&Ie-1,K);if(this.tiles[xe])return sr(this.tiles[xe],pe);be>1&&console.log("drilling down to z%d-%d-%d",$,H,K);let ze,We=$,Ve=H,ft=K;for(;!ze&&We>0;)We--,Ve>>=1,ft>>=1,ze=this.tiles[Nr(We,Ve,ft)];return ze&&ze.source?(be>1&&(console.log("found parent tile z%d-%d-%d",We,Ve,ft),console.time("drilling down")),this.splitTile(ze.source,We,Ve,ft,$,H,K),be>1&&console.timeEnd("drilling down"),this.tiles[xe]?sr(this.tiles[xe],pe):null):null}}function Nr(ve,$,H){return 32*((1<<ve)*H+$)+ve}class Mr extends M{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile($,H){return d._(this,void 0,void 0,function*(){const K=$.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const se=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!se)return null;const pe=new q(se.features,{version:2,extent:d.$});let be=function(Ie){const xe=new d.cM;return function(ze,We){for(const Ve in ze.layers)We.writeMessage(3,Z,ze.layers[Ve])}(Ie,xe),xe.finish()}(pe);return be.byteOffset===0&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),{vectorTile:pe,rawData:be.buffer}})}loadData($){return d._(this,void 0,void 0,function*(){var H;(H=this._pendingRequest)===null||H===void 0||H.abort();const K=!!($&&$.request&&$.request.collectResourceTiming)&&new d.cN($.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON($,this._pendingRequest);const se=yield this._pendingData;this._geoJSONIndex=$.cluster?new Pt(function({superclusterOptions:be,clusterProperties:Ie}){if(!Ie||!be)return be;const xe={},ze={},We={accumulated:null,zoom:0},Ve={properties:null},ft=Object.keys(Ie);for(const Te of ft){const[kt,Bt]=Ie[Te],_t=d.cT(Bt),Mt=d.cT(typeof kt=="string"?[kt,["accumulated"],["get",Te]]:kt);xe[Te]=_t.value,ze[Te]=Mt.value}return be.map=Te=>{Ve.properties=Te;const kt={};for(const Bt of ft)kt[Bt]=xe[Bt].evaluate(We,Ve);return kt},be.reduce=(Te,kt)=>{Ve.properties=kt;for(const Bt of ft)We.accumulated=Te[Bt],Te[Bt]=ze[Bt].evaluate(We,Ve)},be}($)).load(se.features):function(be,Ie){return new gr(be,Ie)}(se,$.geojsonVtOptions),this.loaded={};const pe={data:se};if(K){const be=K.finish();be&&(pe.resourceTiming={},pe.resourceTiming[$.source]=JSON.parse(JSON.stringify(be)))}return pe}catch(se){if(delete this._pendingRequest,d.cy(se))return{abandoned:!0};throw se}})}getData(){return d._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile($){const H=this.loaded;return H&&H[$.uid]?super.reloadTile($):this.loadTile($)}loadAndProcessGeoJSON($,H){return d._(this,void 0,void 0,function*(){let K=yield this.loadGeoJSON($,H);if(delete this._pendingRequest,typeof K!="object")throw new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`);if(me(K,!0),$.filter){const se=d.cT($.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(se.result==="error")throw new Error(se.value.map(be=>`${be.key}: ${be.message}`).join(", "));K={type:"FeatureCollection",features:K.features.filter(be=>se.value.evaluate({zoom:0},be))}}return K})}loadGeoJSON($,H){return d._(this,void 0,void 0,function*(){const{promoteId:K}=$;if($.request){const se=yield d.j($.request,H);return this._dataUpdateable=d.cV(se.data,K)?d.cU(se.data,K):void 0,se.data}if(typeof $.data=="string")try{const se=JSON.parse($.data);return this._dataUpdateable=d.cV(se,K)?d.cU(se,K):void 0,se}catch{throw new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`)}if(!$.dataDiff)throw new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${$.source}`);return d.cW(this._dataUpdateable,$.dataDiff,K),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource($){return d._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom($){return this._geoJSONIndex.getClusterExpansionZoom($.clusterId)}getClusterChildren($){return this._geoJSONIndex.getChildren($.clusterId)}getClusterLeaves($){return this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset)}}class Qr{constructor($){this.self=$,this.actor=new d.J($),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(H,K)=>{if(this.externalWorkerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.externalWorkerSourceTypes[H]=K},this.self.addProtocol=d.cA,this.self.removeProtocol=d.cB,this.self.registerRTLTextPlugin=H=>{d.cX.setMethods(H)},this.actor.registerMessageHandler("LDT",(H,K)=>this._getDEMWorkerSource(H,K.source).loadTile(K)),this.actor.registerMessageHandler("RDT",(H,K)=>d._(this,void 0,void 0,function*(){this._getDEMWorkerSource(H,K.source).removeTile(K)})),this.actor.registerMessageHandler("GCEZ",(H,K)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(H,K.type,K.source).getClusterExpansionZoom(K)})),this.actor.registerMessageHandler("GCC",(H,K)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(H,K.type,K.source).getClusterChildren(K)})),this.actor.registerMessageHandler("GCL",(H,K)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(H,K.type,K.source).getClusterLeaves(K)})),this.actor.registerMessageHandler("LD",(H,K)=>this._getWorkerSource(H,K.type,K.source).loadData(K)),this.actor.registerMessageHandler("GD",(H,K)=>this._getWorkerSource(H,K.type,K.source).getData()),this.actor.registerMessageHandler("LT",(H,K)=>this._getWorkerSource(H,K.type,K.source).loadTile(K)),this.actor.registerMessageHandler("RT",(H,K)=>this._getWorkerSource(H,K.type,K.source).reloadTile(K)),this.actor.registerMessageHandler("AT",(H,K)=>this._getWorkerSource(H,K.type,K.source).abortTile(K)),this.actor.registerMessageHandler("RMT",(H,K)=>this._getWorkerSource(H,K.type,K.source).removeTile(K)),this.actor.registerMessageHandler("RS",(H,K)=>d._(this,void 0,void 0,function*(){if(!this.workerSources[H]||!this.workerSources[H][K.type]||!this.workerSources[H][K.type][K.source])return;const se=this.workerSources[H][K.type][K.source];delete this.workerSources[H][K.type][K.source],se.removeSource!==void 0&&se.removeSource(K)})),this.actor.registerMessageHandler("RM",H=>d._(this,void 0,void 0,function*(){delete this.layerIndexes[H],delete this.availableImages[H],delete this.workerSources[H],delete this.demWorkerSources[H]})),this.actor.registerMessageHandler("SR",(H,K)=>d._(this,void 0,void 0,function*(){this.referrer=K})),this.actor.registerMessageHandler("SRPS",(H,K)=>this._syncRTLPluginState(H,K)),this.actor.registerMessageHandler("IS",(H,K)=>d._(this,void 0,void 0,function*(){this.self.importScripts(K)})),this.actor.registerMessageHandler("SI",(H,K)=>this._setImages(H,K)),this.actor.registerMessageHandler("UL",(H,K)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(H).update(K.layers,K.removedIds)})),this.actor.registerMessageHandler("SL",(H,K)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(H).replace(K)}))}_setImages($,H){return d._(this,void 0,void 0,function*(){this.availableImages[$]=H;for(const K in this.workerSources[$]){const se=this.workerSources[$][K];for(const pe in se)se[pe].availableImages=H}})}_syncRTLPluginState($,H){return d._(this,void 0,void 0,function*(){return yield d.cX.syncState(H,this.self.importScripts)})}_getAvailableImages($){let H=this.availableImages[$];return H||(H=[]),H}_getLayerIndex($){let H=this.layerIndexes[$];return H||(H=this.layerIndexes[$]=new a),H}_getWorkerSource($,H,K){if(this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][H]||(this.workerSources[$][H]={}),!this.workerSources[$][H][K]){const se={sendAsync:(pe,be)=>(pe.targetMapId=$,this.actor.sendAsync(pe,be))};switch(H){case"vector":this.workerSources[$][H][K]=new M(se,this._getLayerIndex($),this._getAvailableImages($));break;case"geojson":this.workerSources[$][H][K]=new Mr(se,this._getLayerIndex($),this._getAvailableImages($));break;default:this.workerSources[$][H][K]=new this.externalWorkerSourceTypes[H](se,this._getLayerIndex($),this._getAvailableImages($))}}return this.workerSources[$][H][K]}_getDEMWorkerSource($,H){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][H]||(this.demWorkerSources[$][H]=new F),this.demWorkerSources[$][H]}}return d.i(self)&&(self.worker=new Qr(self)),Qr}),o("index",["exports","./shared"],function(d,a){var y="5.7.1";function S(){var _=new a.A(4);return a.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}let E,M;const F={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(_,i,h){const p=requestAnimationFrame(v=>{m(),i(v)}),{unsubscribe:m}=a.s(_.signal,"abort",()=>{m(),cancelAnimationFrame(p),h(a.c())},!1)},frameAsync(_){return new Promise((i,h)=>{this.frame(_,i,h)})},getImageData(_,i=0){return this.getImageCanvasContext(_).getImageData(-i,-i,_.width+2*i,_.height+2*i)},getImageCanvasContext(_){const i=window.document.createElement("canvas"),h=i.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return i.width=_.width,i.height=_.height,h.drawImage(_,0,0,_.width,_.height),h},resolveURL:_=>(E||(E=document.createElement("a")),E.href=_,E.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(M==null&&(M=matchMedia("(prefers-reduced-motion: reduce)")),M.matches)}};class N{static testProp(i){if(!N.docStyle)return i[0];for(let h=0;h<i.length;h++)if(i[h]in N.docStyle)return i[h];return i[0]}static create(i,h,p){const m=window.document.createElement(i);return h!==void 0&&(m.className=h),p&&p.appendChild(m),m}static createNS(i,h){return window.document.createElementNS(i,h)}static disableDrag(){N.docStyle&&N.selectProp&&(N.userSelect=N.docStyle[N.selectProp],N.docStyle[N.selectProp]="none")}static enableDrag(){N.docStyle&&N.selectProp&&(N.docStyle[N.selectProp]=N.userSelect)}static setTransform(i,h){i.style[N.transformProp]=h}static addEventListener(i,h,p,m={}){i.addEventListener(h,p,"passive"in m?m:m.capture)}static removeEventListener(i,h,p,m={}){i.removeEventListener(h,p,"passive"in m?m:m.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",N.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",N.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",N.suppressClickInternal,!0)},0)}static getScale(i){const h=i.getBoundingClientRect();return{x:h.width/i.offsetWidth||1,y:h.height/i.offsetHeight||1,boundingClientRect:h}}static getPoint(i,h,p){const m=h.boundingClientRect;return new a.P((p.clientX-m.left)/h.x-i.clientLeft,(p.clientY-m.top)/h.y-i.clientTop)}static mousePos(i,h){const p=N.getScale(i);return N.getPoint(i,p,h)}static touchPos(i,h){const p=[],m=N.getScale(i);for(let v=0;v<h.length;v++)p.push(N.getPoint(i,m,h[v]));return p}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}static sanitize(i){const h=new DOMParser().parseFromString(i,"text/html").body||document.createElement("body"),p=h.querySelectorAll("script");for(const m of p)m.remove();return N.clean(h),h.innerHTML}static isPossiblyDangerous(i,h){const p=h.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(i)||!p.includes("javascript:")&&!p.includes("data:"))||!!i.startsWith("on")||void 0}static clean(i){const h=i.children;for(const p of h)N.removeAttributes(p),N.clean(p)}static removeAttributes(i){for(const{name:h,value:p}of i.attributes)N.isPossiblyDangerous(h,p)&&i.removeAttribute(h)}}N.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,N.selectProp=N.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),N.transformProp=N.testProp(["transform","WebkitTransform"]);const G={supported:!1,testSupport:function(_){!Y&&me&&(q?Z(_):re=_)}};let re,me,Y=!1,q=!1;function Z(_){const i=_.createTexture();_.bindTexture(_.TEXTURE_2D,i);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,me),_.isContextLost())return;G.supported=!0}catch{}_.deleteTexture(i),Y=!0}var le;typeof document<"u"&&(me=document.createElement("img"),me.onload=()=>{re&&Z(re),re=null,q=!0},me.onerror=()=>{Y=!0,re=null},me.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(_){let i,h,p,m;_.resetRequestQueue=()=>{i=[],h=0,p=0,m={}},_.addThrottleControl=P=>{const k=p++;return m[k]=P,k},_.removeThrottleControl=P=>{delete m[P],w()},_.getImage=(P,k,D=!0)=>new Promise((z,L)=>{G.supported&&(P.headers||(P.headers={}),P.headers.accept="image/webp,*/*"),a.e(P,{type:"image"}),i.push({abortController:k,requestParameters:P,supportImageRefresh:D,state:"queued",onError:U=>{L(U)},onSuccess:U=>{z(U)}}),w()});const v=P=>a._(this,void 0,void 0,function*(){P.state="running";const{requestParameters:k,supportImageRefresh:D,onError:z,onSuccess:L,abortController:U}=P,W=D===!1&&!a.i(self)&&!a.g(k.url)&&(!k.headers||Object.keys(k.headers).reduce((ne,ae)=>ne&&ae==="accept",!0));h++;const te=W?I(k,U):a.m(k,U);try{const ne=yield te;delete P.abortController,P.state="completed",ne.data instanceof HTMLImageElement||a.b(ne.data)?L(ne):ne.data&&L({data:yield(ee=ne.data,typeof createImageBitmap=="function"?a.f(ee):a.h(ee)),cacheControl:ne.cacheControl,expires:ne.expires})}catch(ne){delete P.abortController,z(ne)}finally{h--,w()}var ee}),w=()=>{const P=(()=>{for(const k of Object.keys(m))if(m[k]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let k=h;k<P&&i.length>0;k++){const D=i.shift();D.abortController.signal.aborted?k--:v(D)}},I=(P,k)=>new Promise((D,z)=>{const L=new Image,U=P.url,W=P.credentials;W&&W==="include"?L.crossOrigin="use-credentials":(W&&W==="same-origin"||!a.d(U))&&(L.crossOrigin="anonymous"),k.signal.addEventListener("abort",()=>{L.src="",z(a.c())}),L.fetchPriority="high",L.onload=()=>{L.onerror=L.onload=null,D({data:L})},L.onerror=()=>{L.onerror=L.onload=null,k.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},L.src=U})}(le||(le={})),le.resetRequestQueue();class Ae{constructor(i){this._transformRequestFn=i??null}transformRequest(i,h){return this._transformRequestFn&&this._transformRequestFn(i,h)||{url:i}}setTransformRequest(i){this._transformRequestFn=i}}function we(_){const i=[];if(typeof _=="string")i.push({id:"default",url:_});else if(_&&_.length>0){const h=[];for(const{id:p,url:m}of _){const v=`${p}${m}`;h.indexOf(v)===-1&&(h.push(v),i.push({id:p,url:m}))}}return i}function je(_,i,h){try{const p=new URL(_);return p.pathname+=`${i}${h}`,p.toString()}catch{throw new Error(`Invalid sprite URL "${_}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Ue(_){const{userImage:i}=_;return!!(i&&i.render&&i.render())&&(_.data.replace(new Uint8Array(i.data.buffer)),!0)}class Ze extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:h,promiseResolve:p}of this.requestors)p(this._getImagesForIds(h));this.requestors=[]}}getImage(i){const h=this.images[i];if(h&&!h.data&&h.spriteData){const p=h.spriteData;h.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),h.spriteData=null}return h}addImage(i,h){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,h)&&(this.images[i]=h)}_validate(i,h){let p=!0;const m=h.data||h.spriteData;return this._validateStretch(h.stretchX,m&&m.width)||(this.fire(new a.k(new Error(`Image "${i}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,m&&m.height)||(this.fire(new a.k(new Error(`Image "${i}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new a.k(new Error(`Image "${i}" has invalid "content" value`))),p=!1),p}_validateStretch(i,h){if(!i)return!0;let p=0;for(const m of i){if(m[0]<p||m[1]<m[0]||h<m[1])return!1;p=m[1]}return!0}_validateContent(i,h){if(!i)return!0;if(i.length!==4)return!1;const p=h.spriteData,m=p&&p.width||h.data.width,v=p&&p.height||h.data.height;return!(i[0]<0||m<i[0]||i[1]<0||v<i[1]||i[2]<0||m<i[2]||i[3]<0||v<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,h,p=!0){const m=this.getImage(i);if(p&&(m.data.width!==h.data.width||m.data.height!==h.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=m.version+1,this.images[i]=h,this.updatedImages[i]=!0}removeImage(i){const h=this.images[i];delete this.images[i],delete this.patterns[i],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise((h,p)=>{let m=!0;if(!this.isLoaded())for(const v of i)this.images[v]||(m=!1);this.isLoaded()||m?h(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:h})})}_getImagesForIds(i){const h={};for(const p of i){let m=this.getImage(p);m||(this.fire(new a.l("styleimagemissing",{id:p})),m=this.getImage(p)),m?h[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:i,height:h}=this.atlasImage;return{width:i,height:h}}getPattern(i){const h=this.patterns[i],p=this.getImage(i);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new a.I(m,p);this.patterns[i]={bin:m,position:v}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const h=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.T(i,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const v in this.patterns)i.push(this.patterns[v].bin);const{w:h,h:p}=a.p(i),m=this.atlasImage;m.resize({width:h||1,height:p||1});for(const v in this.patterns){const{bin:w}=this.patterns[v],I=w.x+1,P=w.y+1,k=this.getImage(v).data,D=k.width,z=k.height;a.R.copy(k,m,{x:0,y:0},{x:I,y:P},{width:D,height:z}),a.R.copy(k,m,{x:0,y:z-1},{x:I,y:P-1},{width:D,height:1}),a.R.copy(k,m,{x:0,y:0},{x:I,y:P+z},{width:D,height:1}),a.R.copy(k,m,{x:D-1,y:0},{x:I-1,y:P},{width:1,height:z}),a.R.copy(k,m,{x:0,y:0},{x:I+D,y:P},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const h of i){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.getImage(h);p||a.w(`Image with ID: "${h}" was not found`),Ue(p)&&this.updateImage(h,p)}}}const qe=1e20;function Ke(_,i,h,p,m,v,w,I,P){for(let k=i;k<i+p;k++)ht(_,h*v+k,v,m,w,I,P);for(let k=h;k<h+m;k++)ht(_,k*v+i,1,p,w,I,P)}function ht(_,i,h,p,m,v,w){v[0]=0,w[0]=-qe,w[1]=qe,m[0]=_[i];for(let I=1,P=0,k=0;I<p;I++){m[I]=_[i+I*h];const D=I*I;do{const z=v[P];k=(m[I]-m[z]+D-z*z)/(I-z)/2}while(k<=w[P]&&--P>-1);P++,v[P]=I,w[P]=k,w[P+1]=qe}for(let I=0,P=0;I<p;I++){for(;w[P+1]<I;)P++;const k=v[P],D=I-k;_[i+I*h]=m[k]+D*D}}class Pt{constructor(i,h,p){this.requestManager=i,this.localIdeographFontFamily=h,this.entries={},this.lang=p}setURL(i){this.url=i}getGlyphs(i){return a._(this,void 0,void 0,function*(){const h=[];for(const v in i)for(const w of i[v])h.push(this._getAndCacheGlyphsPromise(v,w));const p=yield Promise.all(h),m={};for(const{stack:v,id:w,glyph:I}of p)m[v]||(m[v]={}),m[v][w]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};return m})}_getAndCacheGlyphsPromise(i,h){return a._(this,void 0,void 0,function*(){let p=this.entries[i];p||(p=this.entries[i]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[h];if(m!==void 0)return{stack:i,id:h,glyph:m};if(m=this._tinySDF(p,i,h),m)return p.glyphs[h]=m,{stack:i,id:h,glyph:m};const v=Math.floor(h/256);if(256*v>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[v])return{stack:i,id:h,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[v]){const I=Pt.loadGlyphRange(i,v,this.url,this.requestManager);p.requests[v]=I}const w=yield p.requests[v];for(const I in w)this._doesCharSupportLocalGlyph(+I)||(p.glyphs[+I]=w[+I]);return p.ranges[v]=!0,{stack:i,id:h,glyph:w[h]||null}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(i))||a.u["CJK Unified Ideographs"](i)||a.u["Hangul Syllables"](i)||a.u.Hiragana(i)||a.u.Katakana(i)||a.u["CJK Symbols and Punctuation"](i)||a.u["Halfwidth and Fullwidth Forms"](i))}_tinySDF(i,h,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let v=i.tinySDF;if(!v){let I="400";/bold/i.test(h)?I="900":/medium/i.test(h)?I="500":/light/i.test(h)&&(I="200"),v=i.tinySDF=new Pt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:m,fontWeight:I})}const w=v.draw(String.fromCharCode(p));return{id:p,bitmap:new a.q({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}}Pt.loadGlyphRange=function(_,i,h,p){return a._(this,void 0,void 0,function*(){const m=256*i,v=m+255,w=p.transformRequest(h.replace("{fontstack}",_).replace("{range}",`${m}-${v}`),"Glyphs"),I=yield a.n(w,new AbortController);if(!I||!I.data)throw new Error(`Could not load glyph range. range: ${i}, ${m}-${v}`);const P={};for(const k of a.o(I.data))P[k.id]=k;return P})},Pt.TinySDF=class{constructor({fontSize:_=24,buffer:i=3,radius:h=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:v="normal",fontStyle:w="normal",lang:I=null}={}){this.buffer=i,this.cutoff=p,this.radius=h,this.lang=I;const P=this.size=_+4*i,k=this._createCanvas(P),D=this.ctx=k.getContext("2d",{willReadFrequently:!0});D.font=`${w} ${v} ${_}px ${m}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(_){const i=document.createElement("canvas");return i.width=i.height=_,i}draw(_){const{width:i,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:v}=this.ctx.measureText(_),w=Math.ceil(h),I=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-m))),P=Math.min(this.size-this.buffer,w+Math.ceil(p)),k=I+2*this.buffer,D=P+2*this.buffer,z=Math.max(k*D,0),L=new Uint8ClampedArray(z),U={data:L,width:k,height:D,glyphWidth:I,glyphHeight:P,glyphTop:w,glyphLeft:0,glyphAdvance:i};if(I===0||P===0)return U;const{ctx:W,buffer:te,gridInner:ee,gridOuter:ne}=this;this.lang&&(W.lang=this.lang),W.clearRect(te,te,I,P),W.fillText(_,te,te+w);const ae=W.getImageData(te,te,I,P);ne.fill(qe,0,z),ee.fill(0,0,z);for(let de=0;de<P;de++)for(let ue=0;ue<I;ue++){const ge=ae.data[4*(de*I+ue)+3]/255;if(ge===0)continue;const ye=(de+te)*k+ue+te;if(ge===1)ne[ye]=0,ee[ye]=qe;else{const he=.5-ge;ne[ye]=he>0?he*he:0,ee[ye]=he<0?he*he:0}}Ke(ne,0,0,k,D,k,this.f,this.v,this.z),Ke(ee,te,te,I,P,k,this.f,this.v,this.z);for(let de=0;de<z;de++){const ue=Math.sqrt(ne[de])-Math.sqrt(ee[de]);L[de]=Math.round(255-255*(ue/this.radius+this.cutoff))}return U}};class xt{constructor(){this.specification=a.v.light.position}possiblyEvaluate(i,h){return a.B(i.expression.evaluate(h))}interpolate(i,h,p){return{x:a.C.number(i.x,h.x,p),y:a.C.number(i.y,h.y,p),z:a.C.number(i.z,h.z,p)}}}let Zt;class Ot extends a.E{constructor(i){super(),Zt=Zt||new a.r({anchor:new a.D(a.v.light.anchor),position:new xt,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.t(Zt),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,h={}){if(!this._validate(a.x,i,h))for(const p in i){const m=i[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,p){return(!p||p.validate!==!1)&&a.y(this,i.call(a.z,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const $t=new a.r({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class Je extends a.E{constructor(i){super(),this._transitionable=new a.t($t),this.setSky(i),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0))}setSky(i,h={}){if(!this._validate(a.G,i,h)){i||(i={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const p in i){const m=i[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,p={}){return(p==null?void 0:p.validate)!==!1&&a.y(this,i.call(a.z,a.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(i){return i<60?0:i<70?(i-60)/10:1}}class Qe{constructor(i,h){this.width=i,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,h){const p=i.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(i,h)),this.dashEntry[p]}getDashRanges(i,h,p){const m=[];let v=i.length%2==1?-i[i.length-1]*p:0,w=i[0]*p,I=!0;m.push({left:v,right:w,isDash:I,zeroLength:i[0]===0});let P=i[0];for(let k=1;k<i.length;k++){I=!I;const D=i[k];v=P*p,P+=D,w=P*p,m.push({left:v,right:w,isDash:I,zeroLength:D===0})}return m}addRoundDash(i,h,p){const m=h/2;for(let v=-p;v<=p;v++){const w=this.width*(this.nextRow+p+v);let I=0,P=i[I];for(let k=0;k<this.width;k++){k/P.right>1&&(P=i[++I]);const D=Math.abs(k-P.left),z=Math.abs(k-P.right),L=Math.min(D,z);let U;const W=v/p*(m+1);if(P.isDash){const te=m-Math.abs(W);U=Math.sqrt(L*L+te*te)}else U=m-Math.sqrt(L*L+W*W);this.data[w+k]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(i){for(let I=i.length-1;I>=0;--I){const P=i[I],k=i[I+1];P.zeroLength?i.splice(I,1):k&&k.isDash===P.isDash&&(k.left=P.left,i.splice(I,1))}const h=i[0],p=i[i.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const m=this.width*this.nextRow;let v=0,w=i[v];for(let I=0;I<this.width;I++){I/w.right>1&&(w=i[++v]);const P=Math.abs(I-w.left),k=Math.abs(I-w.right),D=Math.min(P,k);this.data[m+I]=Math.max(0,Math.min(255,(w.isDash?D:-D)+128))}}addDash(i,h){const p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let v=0;for(let I=0;I<i.length;I++)v+=i[I];if(v!==0){const I=this.width/v,P=this.getDashRanges(i,this.width,I);h?this.addRoundDash(P,I,p):this.addRegularDash(P)}const w={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:v};return this.nextRow+=m,this.dirty=!0,w}bind(i){const h=i.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const gt="maplibre_preloaded_worker_pool";class dt{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<dt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[gt]}numActive(){return Object.keys(this.active).length}}const yt=Math.floor(F.hardwareConcurrency/2);let _r,lr;function bt(){return _r||(_r=new dt),_r}dt.workerCount=a.H(globalThis)?Math.max(Math.min(yt,3),1):1;class mt{constructor(i,h){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=h;const p=this.workerPool.acquire(h);for(let m=0;m<p.length;m++){const v=new a.J(p[m],h);v.name=`Worker ${m}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,h){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:i,data:h}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,h){for(const p of this.actors)p.registerMessageHandler(i,h)}}function nr(){return lr||(lr=new mt(bt(),a.K),lr.registerMessageHandler("GR",(_,i,h)=>a.m(i,h))),lr}function Wt(_,i){const h=a.L();return a.M(h,h,[1,1,0]),a.N(h,h,[.5*_.width,.5*_.height,1]),_.calculatePosMatrix?a.O(h,h,_.calculatePosMatrix(i.toUnwrapped())):h}function fr(_,i,h,p,m,v,w){var I;const P=function(L,U,W){if(L)for(const te of L){const ee=U[te];if(ee&&ee.source===W&&ee.type==="fill-extrusion")return!0}else for(const te in U){const ee=U[te];if(ee.source===W&&ee.type==="fill-extrusion")return!0}return!1}((I=m==null?void 0:m.layers)!==null&&I!==void 0?I:null,i,_.id),k=v.maxPitchScaleFactor(),D=_.tilesIn(p,k,P);D.sort(vr);const z=[];for(const L of D)z.push({wrappedTileID:L.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(i,h,_._state,L.queryGeometry,L.cameraQueryGeometry,L.scale,m,v,k,Wt(_.transform,L.tileID),w?(U,W)=>w(L.tileID,U,W):void 0)});return function(L,U){for(const W in L)for(const te of L[W])en(te,U);return L}(function(L){const U={},W={};for(const te of L){const ee=te.queryResults,ne=te.wrappedTileID,ae=W[ne]=W[ne]||{};for(const de in ee){const ue=ee[de],ge=ae[de]=ae[de]||{},ye=U[de]=U[de]||[];for(const he of ue)ge[he.featureIndex]||(ge[he.featureIndex]=!0,ye.push(he))}}return U}(z),_)}function vr(_,i){const h=_.tileID,p=i.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}function en(_,i){const h=_.feature,p=i.getFeatureState(h.layer["source-layer"],h.id);h.source=h.layer.source,h.layer["source-layer"]&&(h.sourceLayer=h.layer["source-layer"]),h.state=p}function pr(_,i,h){return a._(this,void 0,void 0,function*(){let p=_;if(_.url?p=(yield a.j(i.transformRequest(_.url,"Source"),h)).data:yield F.frameAsync(h),!p)return null;const m=a.Q(a.e(p,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(v=>v.id)),m})}class er{constructor(i,h){i&&(h?this.setSouthWest(i).setNorthEast(h):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof a.S?new a.S(i.lng,i.lat):a.S.convert(i),this}setSouthWest(i){return this._sw=i instanceof a.S?new a.S(i.lng,i.lat):a.S.convert(i),this}extend(i){const h=this._sw,p=this._ne;let m,v;if(i instanceof a.S)m=i,v=i;else{if(!(i instanceof er))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(er.convert(i)):this.extend(a.S.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(a.S.convert(i)):this;if(m=i._sw,v=i._ne,!m||!v)return this}return h||p?(h.lng=Math.min(m.lng,h.lng),h.lat=Math.min(m.lat,h.lat),p.lng=Math.max(v.lng,p.lng),p.lat=Math.max(v.lat,p.lat)):(this._sw=new a.S(m.lng,m.lat),this._ne=new a.S(v.lng,v.lat)),this}getCenter(){return new a.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.S(this.getWest(),this.getNorth())}getSouthEast(){return new a.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:h,lat:p}=a.S.convert(i);let m=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(i){return i instanceof er?i:i&&new er(i)}static fromLngLat(i,h=0){const p=360*h/40075017,m=p/Math.cos(Math.PI/180*i.lat);return new er(new a.S(i.lng-m,i.lat-p),new a.S(i.lng+m,i.lat+p))}adjustAntiMeridian(){const i=new a.S(this._sw.lng,this._sw.lat),h=new a.S(this._ne.lng,this._ne.lat);return new er(i,i.lng>h.lng?new a.S(h.lng+360,h.lat):h)}}class Ft{constructor(i,h,p){this.bounds=er.convert(this.validateBounds(i)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const h=Math.pow(2,i.z),p=Math.floor(a.V(this.bounds.getWest())*h),m=Math.floor(a.U(this.bounds.getNorth())*h),v=Math.ceil(a.V(this.bounds.getEast())*h),w=Math.ceil(a.U(this.bounds.getSouth())*h);return i.x>=p&&i.x<v&&i.y>=m&&i.y<w}}class Qt extends a.E{constructor(i,h,p,m){if(super(),this.id=i,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.Q(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield pr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(a.e(this,i),i.bounds&&(this.tileBounds=new Ft(i.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new a.k(i))}})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(i){return a._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(h,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise((v,w)=>{i.reloadPromise={resolve:v,reject:w}})}else i.actor=this.dispatcher.getActor(),m="LT";i.abortController=new AbortController;try{const v=yield i.actor.sendAsync({type:m,data:p},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,v)}catch(v){if(delete i.abortController,i.aborted)return;if(v&&v.status!==404)throw v;this._afterTileLoadWorkerResponse(i,null)}})}_afterTileLoadWorkerResponse(i,h){if(h&&h.resourceTiming&&(i.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&i.setExpiryData(h),i.loadVectorData(h,this.map.painter),i.reloadPromise){const p=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(p.resolve).catch(p.reject)}}abortTile(i){return a._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))})}unloadTile(i){return a._(this,void 0,void 0,function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class xr extends a.E{constructor(i,h,p,m){super(),this.id=i,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.Q(h,["url","scheme","tileSize"]))}load(){return a._(this,arguments,void 0,function*(i=!1){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const h=yield pr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,h&&(a.e(this,h),h.bounds&&(this.tileBounds=new Ft(h.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:i})))}catch(h){this._tileJSONRequest=null,this.fire(new a.k(h))}})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load(!0)}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}serialize(){return a.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return a._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const p=yield le.getImage(this.map._requestManager.transformRequest(h,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&i.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,v=m.gl,w=p.data;i.texture=this.map.painter.getTileTexture(w.width),i.texture?i.texture.update(w,{useMipmap:!0}):(i.texture=new a.T(m,w,v.RGBA,{useMipmap:!0}),i.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST)),i.state="loaded"}}catch(p){if(delete i.abortController,i.aborted)i.state="unloaded";else if(p)throw i.state="errored",p}})}abortTile(i){return a._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)})}unloadTile(i){return a._(this,void 0,void 0,function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)})}hasTransition(){return!1}}class tr extends xr{constructor(i,h,p,m){super(i,h,p,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(i){return a._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(h,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const m=yield le.getImage(p,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(m&&m.data){const v=m.data;this.map._refreshExpiredTiles&&(m.cacheControl||m.expires)&&i.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const w=a.b(v)&&a.W()?v:yield this.readImageNow(v),I={type:this.type,uid:i.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const P=yield i.actor.sendAsync({type:"LDT",data:I});i.dem=P,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(m){if(delete i.abortController,i.aborted)i.state="unloaded";else if(m)throw i.state="errored",m}})}readImageNow(i){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.X()){const h=i.width+2,p=i.height+2;try{return new a.R({width:h,height:p},yield a.Y(i,-1,-1,h,p))}catch{}}return F.getImageData(i,1)})}_getNeighboringTiles(i){const h=i.canonical,p=Math.pow(2,h.z),m=(h.x-1+p)%p,v=h.x===0?i.wrap-1:i.wrap,w=(h.x+1+p)%p,I=h.x+1===p?i.wrap+1:i.wrap,P={};return P[new a.Z(i.overscaledZ,v,h.z,m,h.y).key]={backfilled:!1},P[new a.Z(i.overscaledZ,I,h.z,w,h.y).key]={backfilled:!1},h.y>0&&(P[new a.Z(i.overscaledZ,v,h.z,m,h.y-1).key]={backfilled:!1},P[new a.Z(i.overscaledZ,i.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},P[new a.Z(i.overscaledZ,I,h.z,w,h.y-1).key]={backfilled:!1}),h.y+1<p&&(P[new a.Z(i.overscaledZ,v,h.z,m,h.y+1).key]={backfilled:!1},P[new a.Z(i.overscaledZ,i.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},P[new a.Z(i.overscaledZ,I,h.z,w,h.y+1).key]={backfilled:!1}),P}unloadTile(i){return a._(this,void 0,void 0,function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))})}}class Jt extends a.E{constructor(i,h,p,m){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:h.data},this.actor=p.getActor(),this.setEventedParent(m),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId,h.clusterMaxZoom!==void 0&&this.maxzoom<=h.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${h.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(h.buffer!==void 0?h.buffer:128),tolerance:this._pixelsToTileUnits(h.tolerance!==void 0?h.tolerance:.375),extent:a.$,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(h.clusterMaxZoom),minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.$,radius:this._pixelsToTileUnits(h.clusterRadius||50),log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(i){return i*(a.$/this.tileSize)}_getClusterMaxZoom(i){const h=i?Math.round(i):this.maxzoom-1;return Number.isInteger(i)||i===void 0||a.w(`Integer expected for option 'clusterMaxZoom': provided value "${i}" rounded to "${h}"`),h}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._pendingWorkerUpdate={data:i},this._updateWorkerData(),this}updateData(i){return this._pendingWorkerUpdate.diff=a.a0(this._pendingWorkerUpdate.diff,i),this._updateWorkerData(),this}getData(){return a._(this,void 0,void 0,function*(){const i=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:i})})}getCoordinatesFromGeometry(i){return i.type==="GeometryCollection"?i.geometries.map(h=>h.coordinates).flat(1/0):i.coordinates.flat(1/0)}getBounds(){return a._(this,void 0,void 0,function*(){const i=new er,h=yield this.getData();let p;switch(h.type){case"FeatureCollection":p=h.features.map(m=>this.getCoordinatesFromGeometry(m.geometry)).flat(1/0);break;case"Feature":p=this.getCoordinatesFromGeometry(h.geometry);break;default:p=this.getCoordinatesFromGeometry(h)}if(p.length==0)return i;for(let m=0;m<p.length-1;m+=2)i.extend([p[m],p[m+1]]);return i})}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(i.clusterRadius)),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(i.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,h,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:h,offset:p}})}_updateWorkerData(){return a._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;const{data:i,diff:h}=this._pendingWorkerUpdate;if(!i&&!h)return void a.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const p=a.e({type:this.type},this.workerOptions);i?(typeof i=="string"?(p.request=this.map._requestManager.transformRequest(F.resolveURL(i),"Source"),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(i),this._pendingWorkerUpdate.data=void 0):h&&(p.dataDiff=h,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new a.l("dataloading",{dataType:"source"}));try{const m=yield this.actor.sendAsync({type:"LD",data:p});if(this._isUpdatingWorker=!1,this._removed||m.abandoned)return void this.fire(new a.l("dataabort",{dataType:"source"}));this._data=m.data;let v=null;m.resourceTiming&&m.resourceTiming[this.id]&&(v=m.resourceTiming[this.id].slice(0));const w={dataType:"source"};this._collectResourceTiming&&v&&v.length>0&&a.e(w,{resourceTiming:v}),this.fire(new a.l("data",Object.assign(Object.assign({},w),{sourceDataType:"metadata"}))),this.fire(new a.l("data",Object.assign(Object.assign({},w),{sourceDataType:"content"})))}catch(m){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new a.l("dataabort",{dataType:"source"}));this.fire(new a.k(m))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}})}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(i){return a._(this,void 0,void 0,function*(){const h=i.actor?"RT":"LT";i.actor=this.actor;const p={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};i.abortController=new AbortController;const m=yield this.actor.sendAsync({type:h,data:p},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(m,this.map.painter,h==="RT")})}abortTile(i){return a._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0})}unloadTile(i){return a._(this,void 0,void 0,function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class sr extends a.E{constructor(i,h,p,m){super(),this.flippedWindingOrder=!1,this.id=i,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=h}load(i){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield le.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,i&&(this.coordinates=i),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new a.k(h))}})}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const h=i.map(a.a1.fromLngLat);var p;return this.tileID=function(m){const v=a.a2.fromPoints(m),w=v.width(),I=v.height(),P=Math.max(w,I),k=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),D=Math.pow(2,k);return new a.a4(k,Math.floor((v.minX+v.maxX)/2*D),Math.floor((v.minY+v.maxY)/2*D))}(h),this.terrainTileRanges=this._getOverlappingTileRanges(h),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=h.map(m=>this.tileID.getTilePoint(m)._round()),this.flippedWindingOrder=((p=this.tileCoords)[1].x-p[0].x)*(p[2].y-p[0].y)-(p[1].y-p[0].y)*(p[2].x-p[0].x)<0,this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,h=i.gl;this.texture||(this.texture=new a.T(i,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,p=!0)}p&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(i){const{minX:h,minY:p,maxX:m,maxY:v}=a.a2.fromPoints(i),w={};for(let I=0;I<=a.a3;I++){const P=Math.pow(2,I),k=Math.floor(h*P),D=Math.floor(p*P),z=Math.floor(m*P),L=Math.floor(v*P);w[I]={minTileX:k,minTileY:D,maxTileX:z,maxTileY:L}}return w}}class Ht extends sr{constructor(i,h,p,m){super(i,h,p,m),this.roundZoom=!0,this.type="video",this.options=h}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const h of i.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield a.a5(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new a.k(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const h=this.video.seekable;i<h.start(0)||i>h.end(0)?this.fire(new a.k(new a.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,h=i.gl;this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(i,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,p=!0)}p&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ir extends sr{constructor(i,h,p,m){super(i,h,p,m),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(w=>typeof w!="number"))||this.fire(new a.k(new a.a6(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.k(new a.a6(`sources.${i}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.k(new a.a6(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.k(new a.a6(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.k(new a.a6(`sources.${i}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(h,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const v in this.tiles){const w=this.tiles[v];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,m=!0)}m&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const yr={},Er=_=>{switch(_){case"geojson":return Jt;case"image":return sr;case"raster":return xr;case"raster-dem":return tr;case"vector":return Qt;case"video":return Ht;case"canvas":return ir}return yr[_]},dr="RTLPluginLoaded";class gr extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=nr()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return a._(this,arguments,void 0,function*(h,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=F.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.l(dr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Nr=null;function Mr(){return Nr||(Nr=new gr),Nr}class Qr{constructor(i,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=a.a7(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const h=i+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(m,v){const w={};if(!v)return w;for(const I of m){const P=I.layerIds.map(k=>v.getLayer(k)).filter(Boolean);if(P.length!==0){I.layers=P,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map(k=>P.filter(D=>D.id===k)[0]));for(const k of P)w[k.id]=I}}return w}(i.buckets,h==null?void 0:h.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const v=this.buckets[m];if(v instanceof a.a9){if(this.hasSymbolBuckets=!0,!p)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const v=this.buckets[m];if(v instanceof a.a9&&v.hasRTLText){this.hasRTLText=!0,Mr().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const v=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(m).queryRadius(v))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new a.a8}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(i)}const h=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new a.T(i,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(i,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,h,p,m,v,w,I,P,k,D,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:v,scale:w,tileSize:this.tileSize,pixelPosMatrix:D,transform:P,params:I,queryPadding:this.queryPadding*k,getElevation:z},i,h,p):{}}querySourceFeatures(i,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),v=h&&h.sourceLayer?h.sourceLayer:"",w=m._geojsonTileLayer||m[v];if(!w)return;const I=a.aa(h&&h.filter),{z:P,x:k,y:D}=this.tileID.canonical,z={z:P,x:k,y:D};for(let L=0;L<w.length;L++){const U=w.feature(L);if(I.needGeometry){const ee=a.ab(U,!0);if(!I.filter(new a.F(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!I.filter(new a.F(this.tileID.overscaledZ),U))continue;const W=p.getId(U,v),te=new a.ac(U,P,k,D,W);te.tile=z,i.push(te)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const h=this.expirationTime;if(i.cacheControl){const p=a.ad(i.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(h)if(this.expirationTime<h)m=!0;else{const v=this.expirationTime-h;v?this.expirationTime=p+Math.max(v,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!h.style.hasLayer(m))continue;const v=this.buckets[m],w=v.layers[0].sourceLayer||"_geojsonTileLayer",I=p[w],P=i[w];if(!I||!P||Object.keys(P).length===0)continue;v.update(P,I,this.imageAtlas&&this.imageAtlas.patternPositions||{});const k=h&&h.style&&h.style.getLayer(m);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<F.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=F.now()+i}setDependencies(i,h){const p={};for(const m of h)p[m]=!0;this.dependencies[i]=p}hasDependency(i,h){for(const p of i){const m=this.dependencies[p];if(m){for(const v of h)if(m[v])return!0}}return!1}}class ve{constructor(i,h){this.max=i,this.onRemove=h,this.reset()}reset(){for(const i in this.data)for(const h of this.data[i])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(i,h,p){const m=i.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const v={value:h,timeout:void 0};if(p!==void 0&&(v.timeout=setTimeout(()=>{this.remove(i,v)},p)),this.data[m].push(v),this.order.push(m),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const h=this.data[i].shift();return h.timeout&&clearTimeout(h.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),h.value}getByKey(i){const h=this.data[i];return h?h[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,h){if(!this.has(i))return this;const p=i.wrapped().key,m=h===void 0?0:this.data[p].indexOf(h),v=this.data[p][m];return this.data[p].splice(m,1),v.timeout&&clearTimeout(v.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(v.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(i){const h=[];for(const p in this.data)for(const m of this.data[p])i(m.value)||h.push(m);for(const p of h)this.remove(p.value.tileID,p)}}class ${constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,h,p){const m=String(h);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][m]=this.stateChanges[i][m]||{},a.e(this.stateChanges[i][m],p),this.deletedStates[i]===null){this.deletedStates[i]={};for(const v in this.state[i])v!==m&&(this.deletedStates[i][v]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][m]===null){this.deletedStates[i][m]={};for(const v in this.state[i][m])p[v]||(this.deletedStates[i][m][v]=null)}else for(const v in p)this.deletedStates[i]&&this.deletedStates[i][m]&&this.deletedStates[i][m][v]===null&&delete this.deletedStates[i][m][v]}removeFeatureState(i,h,p){if(this.deletedStates[i]===null)return;const m=String(h);if(this.deletedStates[i]=this.deletedStates[i]||{},p&&h!==void 0)this.deletedStates[i][m]!==null&&(this.deletedStates[i][m]=this.deletedStates[i][m]||{},this.deletedStates[i][m][p]=null);else if(h!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][m])for(p in this.deletedStates[i][m]={},this.stateChanges[i][m])this.deletedStates[i][m][p]=null;else this.deletedStates[i][m]=null;else this.deletedStates[i]=null}getState(i,h){const p=String(h),m=a.e({},(this.state[i]||{})[p],(this.stateChanges[i]||{})[p]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const v=this.deletedStates[i][h];if(v===null)return{};for(const w in v)delete m[w]}return m}initializeTileState(i,h){i.setFeatureState(this.state,h)}coalesceChanges(i,h){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const v={};for(const w in this.stateChanges[m])this.state[m][w]||(this.state[m][w]={}),a.e(this.state[m][w],this.stateChanges[m][w]),v[w]=this.state[m][w];p[m]=v}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const v={};if(this.deletedStates[m]===null)for(const w in this.state[m])v[w]={},this.state[m][w]={};else for(const w in this.deletedStates[m]){if(this.deletedStates[m][w]===null)this.state[m][w]={};else for(const I of Object.keys(this.deletedStates[m][w]))delete this.state[m][w][I];v[w]=this.state[m][w]}p[m]=p[m]||{},a.e(p[m],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in i)i[m].setFeatureState(p,h)}}const H=89.25;function K(_,i){const h=a.ah(i.lat,-a.ai,a.ai);return new a.P(a.V(i.lng)*_,a.U(h)*_)}function se(_,i){return new a.a1(i.x/_,i.y/_).toLngLat()}function pe(_){return _.cameraToCenterDistance*Math.min(.85*Math.tan(a.ae(90-_.pitch)),Math.tan(a.ae(H-_.pitch)))}function be(_,i){const h=_.canonical,p=i/a.af(h.z),m=h.x+Math.pow(2,h.z)*_.wrap,v=a.ag(new Float64Array(16));return a.M(v,v,[m*p,h.y*p,0]),a.N(v,v,[p/a.$,p/a.$,1]),v}function Ie(_,i,h,p,m){const v=a.a1.fromLngLat(_,i),w=m*a.aj(1,_.lat),I=w*Math.cos(a.ae(h)),P=Math.sqrt(w*w-I*I),k=P*Math.sin(a.ae(-p)),D=P*Math.cos(a.ae(-p));return new a.a1(v.x+k,v.y+D,v.z+I)}function xe(_,i,h){const p=i.intersectsFrustum(_);if(!h||p===0)return p;const m=i.intersectsPlane(h);return m===0?0:p===2&&m===2?2:1}function ze(_,i,h){let p=0;const m=(h-i)/10;for(let v=0;v<10;v++)p+=m*Math.pow(Math.cos(i+(v+.5)/10*(h-i)),_);return p}function We(_,i){return function(h,p,m,v,w){const I=2*((_-1)/a.ak(Math.cos(a.ae(H-w))/Math.cos(a.ae(H)))-1),P=Math.acos(m/v),k=2*ze(I-1,0,a.ae(w/2)),D=Math.min(a.ae(H),P+a.ae(w/2)),z=ze(I-1,Math.min(D,P-a.ae(w/2)),D),L=Math.atan(p/m),U=Math.hypot(p,m);let W=h;return W+=a.ak(v/U/Math.max(.5,Math.cos(a.ae(w/2)))),W+=I*a.ak(Math.cos(L))/2,W-=a.ak(Math.max(1,z/k/i))/2,W}}const Ve=We(9.314,3);function ft(_,i){const h=(i.roundZoom?Math.round:Math.floor)(_.zoom+a.ak(_.tileSize/i.tileSize));return Math.max(0,h)}function Te(_,i){const h=_.getCameraFrustum(),p=_.getClippingPlane(),m=_.screenPointToMercatorCoordinate(_.getCameraPoint()),v=a.a1.fromLngLat(_.center,_.elevation);m.z=v.z+Math.cos(_.pitchInRadians)*_.cameraToCenterDistance/_.worldSize;const w=_.getCoveringTilesDetailsProvider(),I=w.allowVariableZoom(_,i),P=ft(_,i),k=i.minzoom||0,D=i.maxzoom!==void 0?i.maxzoom:_.maxZoom,z=Math.min(Math.max(0,P),D),L=Math.pow(2,z),U=[L*m.x,L*m.y,0],W=[L*v.x,L*v.y,0],te=Math.hypot(v.x-m.x,v.y-m.y),ee=Math.abs(v.z-m.z),ne=Math.hypot(te,ee),ae=ge=>({zoom:0,x:0,y:0,wrap:ge,fullyVisible:!1}),de=[],ue=[];if(_.renderWorldCopies&&w.allowWorldCopies())for(let ge=1;ge<=3;ge++)de.push(ae(-ge)),de.push(ae(ge));for(de.push(ae(0));de.length>0;){const ge=de.pop(),ye=ge.x,he=ge.y;let Ee=ge.fullyVisible;const Le={x:ye,y:he,z:ge.zoom},ke=w.getTileBoundingVolume(Le,ge.wrap,_.elevation,i);if(!Ee){const nt=xe(h,ke,p);if(nt===0)continue;Ee=nt===2}const De=w.distanceToTile2d(m.x,m.y,Le,ke);let Ne=P;I&&(Ne=(i.calculateTileZoom||Ve)(_.zoom+a.ak(_.tileSize/i.tileSize),De,ee,ne,_.fov)),Ne=(i.roundZoom?Math.round:Math.floor)(Ne),Ne=Math.max(0,Ne);const et=Math.min(Ne,D);if(ge.wrap=w.getWrap(v,Le,ge.wrap),ge.zoom>=et){if(ge.zoom<k)continue;const nt=z-ge.zoom,Xe=U[0]-.5-(ye<<nt),wt=U[1]-.5-(he<<nt),Kt=i.reparseOverscaled?Math.max(ge.zoom,Ne):ge.zoom;ue.push({tileID:new a.Z(ge.zoom===D?Kt:ge.zoom,ge.wrap,ge.zoom,ye,he),distanceSq:a.al([W[0]-.5-ye,W[1]-.5-he]),tileDistanceToCamera:Math.sqrt(Xe*Xe+wt*wt)})}else for(let nt=0;nt<4;nt++)de.push({zoom:ge.zoom+1,x:(ye<<1)+nt%2,y:(he<<1)+(nt>>1),wrap:ge.wrap,fullyVisible:Ee})}return ue.sort((ge,ye)=>ge.distanceSq-ye.distanceSq).map(ge=>ge.tileID)}const kt=a.a2.fromPoints([new a.P(0,0),new a.P(a.$,a.$)]);class Bt extends a.E{constructor(i,h,p){super(),this.id=i,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,v,w,I)=>{const P=new(Er(v.type))(m,v,w,I);if(P.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${P.id}`);return P})(i,h,p,this),this._tiles={},this._cache=new ve(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new $,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const h=this._tiles[i];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,h,p){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,h,p)}catch(m){i.state="errored",m.status!==404?this._source.fire(new a.k(m,{tile:i})):this.update(this.transform,this.terrain)}})}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new a.l("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(i),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(_t).map(i=>i.key)}getRenderableIds(i){const h=[];for(const p in this._tiles)this._isIdRenderable(p,i)&&h.push(this._tiles[p]);return i?h.sort((p,m)=>{const v=p.tileID,w=m.tileID,I=new a.P(v.canonical.x,v.canonical.y)._rotate(-this.transform.bearingInRadians),P=new a.P(w.canonical.x,w.canonical.y)._rotate(-this.transform.bearingInRadians);return v.overscaledZ-w.overscaledZ||P.y-I.y||P.x-I.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(_t).map(p=>p.key)}hasRenderableParent(i){const h=this.findLoadedParent(i,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(i,h){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(h||!this._tiles[i].holdingForFade())}reload(i){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const h in this._tiles)i?this._reloadTile(h,"expired"):this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")}}_reloadTile(i,h){return a._(this,void 0,void 0,function*(){const p=this._tiles[i];p&&(p.state!=="loading"&&(p.state=h),yield this._loadTile(p,i,h))})}_tileLoaded(i,h,p){i.timeAdded=F.now(),p==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(h,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new a.l("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const h=this.getRenderableIds();for(let m=0;m<h.length;m++){const v=h[m];if(i.neighboringTiles&&i.neighboringTiles[v]){const w=this.getTileByID(v);p(i,w),p(w,i)}}function p(m,v){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let w=v.tileID.canonical.x-m.tileID.canonical.x;const I=v.tileID.canonical.y-m.tileID.canonical.y,P=Math.pow(2,m.tileID.canonical.z),k=v.tileID.key;w===0&&I===0||Math.abs(I)>1||(Math.abs(w)>1&&(Math.abs(w+P)===1?w+=P:Math.abs(w-P)===1&&(w-=P)),v.dem&&m.dem&&(m.dem.backfillBorder(v.dem,w,I),m.neighboringTiles&&m.neighboringTiles[k]&&(m.neighboringTiles[k].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,h,p,m){for(const v in this._tiles){let w=this._tiles[v];if(m[v]||!w.hasData()||w.tileID.overscaledZ<=h||w.tileID.overscaledZ>p)continue;let I=w.tileID;for(;w&&w.tileID.overscaledZ>h+1;){const k=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[k.key],w&&w.hasData()&&(I=k)}let P=I;for(;P.overscaledZ>h;)if(P=P.scaledTo(P.overscaledZ-1),i[P.key]||i[P.canonical.key]){m[I.key]=I;break}}}findLoadedParent(i,h){if(i.key in this._loadedParentTiles){const p=this._loadedParentTiles[i.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=i.overscaledZ-1;p>=h;p--){const m=i.scaledTo(p),v=this._getLoadedTile(m);if(v)return v}}findLoadedSibling(i){return this._getLoadedTile(i)}_getLoadedTile(i){const h=this._tiles[i.key];return h&&h.hasData()?h:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const h=Math.ceil(i.width/this._source.tileSize)+1,p=Math.ceil(i.height/this._source.tileSize)+1,m=Math.floor(h*p*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(i){const h=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,h){const p={};for(const m in this._tiles){const v=this._tiles[m];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+h),p[v.tileID.key]=v}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(i,h,p,m,v,w){const I={},P={},k=Object.keys(i),D=F.now();for(const z of k){const L=i[z],U=this._tiles[z];if(!U||U.fadeEndTime!==0&&U.fadeEndTime<=D)continue;const W=this.findLoadedParent(L,h),te=this.findLoadedSibling(L),ee=W||te||null;ee&&(this._addTile(ee.tileID),I[ee.tileID.key]=ee.tileID),P[z]=L}this._retainLoadedChildren(P,m,p,i);for(const z in I)i[z]||(this._coveredTiles[z]=!0,i[z]=I[z]);if(w){const z={},L={};for(const U of v)this._tiles[U.key].hasData()?z[U.key]=U:L[U.key]=U;for(const U in L){const W=L[U].children(this._source.maxzoom);this._tiles[W[0].key]&&this._tiles[W[1].key]&&this._tiles[W[2].key]&&this._tiles[W[3].key]&&(z[W[0].key]=i[W[0].key]=W[0],z[W[1].key]=i[W[1].key]=W[1],z[W[2].key]=i[W[2].key]=W[2],z[W[3].key]=i[W[3].key]=W[3],delete L[U])}for(const U in L){const W=L[U],te=this.findLoadedParent(W,this._source.minzoom),ee=this.findLoadedSibling(W),ne=te||ee||null;if(ne){z[ne.tileID.key]=i[ne.tileID.key]=ne.tileID;for(const ae in z)z[ae].isChildOf(ne.tileID)&&delete z[ae]}}for(const U in this._tiles)z[U]||(this._coveredTiles[U]=!0)}}update(i,h){if(!this._sourceLoaded||this._paused)return;let p;this.transform=i,this.terrain=h,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new a.Z(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(p=Te(i,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(p=p.filter(D=>this._source.hasTile(D)))):p=[];const m=ft(i,this._source),v=Math.max(m-Bt.maxOverzooming,this._source.minzoom),w=Math.max(m+Bt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const D={};for(const z of p)if(z.canonical.z>this._source.minzoom){const L=z.scaledTo(z.canonical.z-1);D[L.key]=L;const U=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));D[U.key]=U}p=p.concat(Object.values(D))}const I=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,I&&this.fire(new a.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const P=this._updateRetainedTiles(p,m);Mt(this._source.type)&&this._updateCoveredAndRetainedTiles(P,v,w,m,p,h);for(const D in P)this._tiles[D].clearFadeHold();const k=a.am(this._tiles,P);for(const D of k){const z=this._tiles[D];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(D)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,h){var p;const m={},v={},w=Math.max(h-Bt.maxOverzooming,this._source.minzoom),I=Math.max(h+Bt.maxUnderzooming,this._source.minzoom),P={};for(const k of i){const D=this._addTile(k);m[k.key]=k,D.hasData()||h<this._source.maxzoom&&(P[k.key]=k)}this._retainLoadedChildren(P,h,I,m);for(const k of i){let D=this._tiles[k.key];if(D.hasData())continue;if(h+1>this._source.maxzoom){const L=k.children(this._source.maxzoom)[0],U=this.getTile(L);if(U&&U.hasData()){m[L.key]=L;continue}}else{const L=k.children(this._source.maxzoom);if(m[L[0].key]&&m[L[1].key]&&m[L[2].key]&&m[L[3].key])continue}let z=D.wasRequested();for(let L=k.overscaledZ-1;L>=w;--L){const U=k.scaledTo(L);if(v[U.key])break;if(v[U.key]=!0,D=this.getTile(U),!D&&z&&(D=this._addTile(U)),D){const W=D.hasData();if((W||!(!((p=this.map)===null||p===void 0)&&p.cancelPendingTileRequestsWhileZooming)||z)&&(m[U.key]=U),z=D.wasRequested(),W)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const h=[];let p,m=this._tiles[i].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}h.push(m.key);const v=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(v),p)break;m=v}for(const v of h)this._loadedParentTiles[v]=p}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const i in this._tiles){const h=this._tiles[i].tileID,p=this._getLoadedTile(h);this._loadedSiblingTiles[h.key]=p}}_addTile(i){let h=this._tiles[i.key];if(h)return h;h=this._cache.getAndRemove(i),h&&(this._setTileReloadTimer(i.key,h),h.tileID=i,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,h)));const p=h;return h||(h=new Qr(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(h,i.key,h.state)),h.uses++,this._tiles[i.key]=h,p||this._source.fire(new a.l("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(i,h){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const p=h.getExpiryTimeout();p&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},p))}refreshTiles(i){for(const h in this._tiles)(this._isIdRenderable(h)||this._tiles[h].state=="errored")&&i.some(p=>p.equals(this._tiles[h].tileID.canonical))&&this._reloadTile(h,"expired")}_removeTile(i){const h=this._tiles[i];h&&(h.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(i){const h=i.sourceDataType;i.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&h==="content"&&(this.reload(i.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,h,p){const m=[],v=this.transform;if(!v)return m;const w=v.getCoveringTilesDetailsProvider().allowWorldCopies(),I=p?v.getCameraQueryGeometry(i):i,P=U=>v.screenPointToMercatorCoordinate(U,this.terrain),k=this.transformBbox(i,P,!w),D=this.transformBbox(I,P,!w),z=this.getIds(),L=a.a2.fromPoints(D);for(let U=0;U<z.length;U++){const W=this._tiles[z[U]];if(W.holdingForFade())continue;const te=w?[W.tileID]:[W.tileID.unwrapTo(-1),W.tileID.unwrapTo(0)],ee=Math.pow(2,v.zoom-W.tileID.overscaledZ),ne=h*W.queryPadding*a.$/W.tileSize/ee;for(const ae of te){const de=L.map(ue=>ae.getTilePoint(new a.a1(ue.x,ue.y)));if(de.expandBy(ne),de.intersects(kt)){const ue=k.map(ye=>ae.getTilePoint(ye)),ge=D.map(ye=>ae.getTilePoint(ye));m.push({tile:W,tileID:w?ae:ae.unwrapTo(0),queryGeometry:ue,cameraQueryGeometry:ge,scale:ee})}}}return m}transformBbox(i,h,p){let m=i.map(h);if(p){const v=a.a2.fromPoints(i);v.shrinkBy(.001*Math.min(v.width(),v.height()));const w=v.map(h);a.a2.fromPoints(m).covers(w)||(m=m.map(I=>I.x>.5?new a.a1(I.x-1,I.y,I.z):I))}return m}getVisibleCoordinates(i){const h=this.getRenderableIds(i).map(p=>this._tiles[p].tileID);return this.transform&&this.transform.populateCache(h),h}hasTransition(){if(this._source.hasTransition())return!0;if(Mt(this._source.type)){const i=F.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=i)return!0}return!1}setFeatureState(i,h,p){this._state.updateState(i=i||"_geojsonTileLayer",h,p)}removeFeatureState(i,h,p){this._state.removeFeatureState(i=i||"_geojsonTileLayer",h,p)}getFeatureState(i,h){return this._state.getState(i=i||"_geojsonTileLayer",h)}setDependencies(i,h,p){const m=this._tiles[i];m&&m.setDependencies(h,p)}reloadTilesForDependencies(i,h){for(const p in this._tiles)this._tiles[p].hasDependency(i,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(i,h))}}function _t(_,i){const h=Math.abs(2*_.wrap)-+(_.wrap<0),p=Math.abs(2*i.wrap)-+(i.wrap<0);return _.overscaledZ-i.overscaledZ||p-h||i.canonical.y-_.canonical.y||i.canonical.x-_.canonical.x}function Mt(_){return _==="raster"||_==="image"||_==="video"}Bt.maxOverzooming=10,Bt.maxUnderzooming=3;class Gt{constructor(i,h){this.reset(i,h)}reset(i,h){this.points=i||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=a.ah(i,0,1);let h=1,p=this._distances[h];const m=i*this.paddedLength+this.padding;for(;p<m&&h<this._distances.length;)p=this._distances[++h];const v=h-1,w=this._distances[v],I=p-w,P=I>0?(m-w)/I:0;return this.points[v].mult(1-P).add(this.points[h].mult(P))}}function wr(_,i){let h=!0;return _==="always"||_!=="never"&&i!=="never"||(h=!1),h}class Rr{constructor(i,h,p){const m=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(i/p),this.yCellCount=Math.ceil(h/p);for(let w=0;w<this.xCellCount*this.yCellCount;w++)m.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=h,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,h,p,m,v){this._forEachCell(h,p,m,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(v)}insertCircle(i,h,p,m){this._forEachCell(h-m,p-m,h+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(h),this.circles.push(p),this.circles.push(m)}_insertBoxCell(i,h,p,m,v,w){this.boxCells[v].push(w)}_insertCircleCell(i,h,p,m,v,w){this.circleCells[v].push(w)}_query(i,h,p,m,v,w,I){if(p<0||i>this.width||m<0||h>this.height)return[];const P=[];if(i<=0&&h<=0&&this.width<=p&&this.height<=m){if(v)return[{key:null,x1:i,y1:h,x2:p,y2:m}];for(let k=0;k<this.boxKeys.length;k++)P.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const D=this.circles[3*k],z=this.circles[3*k+1],L=this.circles[3*k+2];P.push({key:this.circleKeys[k],x1:D-L,y1:z-L,x2:D+L,y2:z+L})}}else this._forEachCell(i,h,p,m,this._queryCell,P,{hitTest:v,overlapMode:w,seenUids:{box:{},circle:{}}},I);return P}query(i,h,p,m){return this._query(i,h,p,m,!1,null)}hitTest(i,h,p,m,v,w){return this._query(i,h,p,m,!0,v,w).length>0}hitTestCircle(i,h,p,m,v){const w=i-p,I=i+p,P=h-p,k=h+p;if(I<0||w>this.width||k<0||P>this.height)return!1;const D=[];return this._forEachCell(w,P,I,k,this._queryCellCircle,D,{hitTest:!0,overlapMode:m,circle:{x:i,y:h,radius:p},seenUids:{box:{},circle:{}}},v),D.length>0}_queryCell(i,h,p,m,v,w,I,P){const{seenUids:k,hitTest:D,overlapMode:z}=I,L=this.boxCells[v];if(L!==null){const W=this.bboxes;for(const te of L)if(!k.box[te]){k.box[te]=!0;const ee=4*te,ne=this.boxKeys[te];if(i<=W[ee+2]&&h<=W[ee+3]&&p>=W[ee+0]&&m>=W[ee+1]&&(!P||P(ne))&&(!D||!wr(z,ne.overlapMode))&&(w.push({key:ne,x1:W[ee],y1:W[ee+1],x2:W[ee+2],y2:W[ee+3]}),D))return!0}}const U=this.circleCells[v];if(U!==null){const W=this.circles;for(const te of U)if(!k.circle[te]){k.circle[te]=!0;const ee=3*te,ne=this.circleKeys[te];if(this._circleAndRectCollide(W[ee],W[ee+1],W[ee+2],i,h,p,m)&&(!P||P(ne))&&(!D||!wr(z,ne.overlapMode))){const ae=W[ee],de=W[ee+1],ue=W[ee+2];if(w.push({key:ne,x1:ae-ue,y1:de-ue,x2:ae+ue,y2:de+ue}),D)return!0}}}return!1}_queryCellCircle(i,h,p,m,v,w,I,P){const{circle:k,seenUids:D,overlapMode:z}=I,L=this.boxCells[v];if(L!==null){const W=this.bboxes;for(const te of L)if(!D.box[te]){D.box[te]=!0;const ee=4*te,ne=this.boxKeys[te];if(this._circleAndRectCollide(k.x,k.y,k.radius,W[ee+0],W[ee+1],W[ee+2],W[ee+3])&&(!P||P(ne))&&!wr(z,ne.overlapMode))return w.push(!0),!0}}const U=this.circleCells[v];if(U!==null){const W=this.circles;for(const te of U)if(!D.circle[te]){D.circle[te]=!0;const ee=3*te,ne=this.circleKeys[te];if(this._circlesCollide(W[ee],W[ee+1],W[ee+2],k.x,k.y,k.radius)&&(!P||P(ne))&&!wr(z,ne.overlapMode))return w.push(!0),!0}}}_forEachCell(i,h,p,m,v,w,I,P){const k=this._convertToXCellCoord(i),D=this._convertToYCellCoord(h),z=this._convertToXCellCoord(p),L=this._convertToYCellCoord(m);for(let U=k;U<=z;U++)for(let W=D;W<=L;W++)if(v.call(this,i,h,p,m,this.xCellCount*W+U,w,I,P))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,h,p,m,v,w){const I=m-i,P=v-h,k=p+w;return k*k>I*I+P*P}_circleAndRectCollide(i,h,p,m,v,w,I){const P=(w-m)/2,k=Math.abs(i-(m+P));if(k>P+p)return!1;const D=(I-v)/2,z=Math.abs(h-(v+D));if(z>D+p)return!1;if(k<=P||z<=D)return!0;const L=k-P,U=z-D;return L*L+U*U<=p*p}}function it(_,i,h){const p=a.L();if(!_){const{vecSouth:z,vecEast:L}=Ut(i),U=S();U[0]=L[0],U[1]=L[1],U[2]=z[0],U[3]=z[1],m=U,(D=(w=(v=U)[0])*(k=v[3])-(P=v[2])*(I=v[1]))&&(m[0]=k*(D=1/D),m[1]=-I*D,m[2]=-P*D,m[3]=w*D),p[0]=U[0],p[1]=U[1],p[4]=U[2],p[5]=U[3]}var m,v,w,I,P,k,D;return a.N(p,p,[1/h,1/h,1]),p}function Dt(_,i,h,p){if(_){const m=a.L();if(!i){const{vecSouth:v,vecEast:w}=Ut(h);m[0]=w[0],m[1]=w[1],m[4]=v[0],m[5]=v[1]}return a.N(m,m,[p,p,1]),m}return h.pixelsToClipSpaceMatrix}function Ut(_){const i=Math.cos(_.rollInRadians),h=Math.sin(_.rollInRadians),p=Math.cos(_.pitchInRadians),m=Math.cos(_.bearingInRadians),v=Math.sin(_.bearingInRadians),w=a.ar();w[0]=-m*p*h-v*i,w[1]=-v*p*h+m*i;const I=a.as(w);I<1e-9?a.at(w):a.au(w,w,1/I);const P=a.ar();P[0]=m*p*i-v*h,P[1]=v*p*i+m*h;const k=a.as(P);return k<1e-9?a.at(P):a.au(P,P,1/k),{vecEast:P,vecSouth:w}}function kr(_,i,h,p){let m;p?(m=[_,i,p(_,i),1],a.aw(m,m,h)):(m=[_,i,0,1],Bs(m,m,h));const v=m[3];return{point:new a.P(m[0]/v,m[1]/v),signedDistanceFromCamera:v,isOccluded:!1}}function $e(_,i){return .5+_/i*.5}function un(_,i){return _.x>=-i[0]&&_.x<=i[0]&&_.y>=-i[1]&&_.y<=i[1]}function Dr(_,i,h,p,m,v,w,I,P,k,D,z,L){const U=h?_.textSizeData:_.iconSizeData,W=a.an(U,i.transform.zoom),te=[256/i.width*2+1,256/i.height*2+1],ee=h?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;ee.clear();const ne=_.lineVertexArray,ae=h?_.text.placedSymbolArray:_.icon.placedSymbolArray,de=i.transform.width/i.transform.height;let ue=!1;for(let ge=0;ge<ae.length;ge++){const ye=ae.get(ge);if(ye.hidden||ye.writingMode===a.ao.vertical&&!ue){Pi(ye.numGlyphs,ee);continue}ue=!1;const he=new a.P(ye.anchorX,ye.anchorY),Ee={getElevation:L,pitchedLabelPlaneMatrix:p,lineVertexArray:ne,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:i.transform,tileAnchorPoint:he,unwrappedTileID:P,width:k,height:D,translation:z},Le=fi(ye.anchorX,ye.anchorY,Ee);if(!un(Le.point,te)){Pi(ye.numGlyphs,ee);continue}const ke=$e(i.transform.cameraToCenterDistance,Le.signedDistanceFromCamera),De=a.ap(U,W,ye),Ne=v?De*i.transform.getPitchedTextCorrection(ye.anchorX,ye.anchorY,P)/ke:De*ke,et=rt({projectionContext:Ee,pitchedLabelPlaneMatrixInverse:m,symbol:ye,fontSize:Ne,flip:!1,keepUpright:w,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:ee,aspectRatio:de,rotateToLine:I});ue=et.useVertical,(et.notEnoughRoom||ue||et.needsFlipping&&rt({projectionContext:Ee,pitchedLabelPlaneMatrixInverse:m,symbol:ye,fontSize:Ne,flip:!0,keepUpright:w,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:ee,aspectRatio:de,rotateToLine:I}).notEnoughRoom)&&Pi(ye.numGlyphs,ee)}h?_.text.dynamicLayoutVertexBuffer.updateData(ee):_.icon.dynamicLayoutVertexBuffer.updateData(ee)}function Ai(_,i,h,p,m,v,w,I){const P=v.glyphStartIndex+v.numGlyphs,k=v.lineStartIndex,D=v.lineStartIndex+v.lineLength,z=i.getoffsetX(v.glyphStartIndex),L=i.getoffsetX(P-1),U=Pr(_*z,h,p,m,v.segment,k,D,I,w);if(!U)return null;const W=Pr(_*L,h,p,m,v.segment,k,D,I,w);return W?I.projectionCache.anyProjectionOccluded?null:{first:U,last:W}:null}function ts(_,i,h,p){return _===a.ao.horizontal&&Math.abs(h.y-i.y)>Math.abs(h.x-i.x)*p?{useVertical:!0}:(_===a.ao.vertical?i.y<h.y:i.x>h.x)?{needsFlipping:!0}:null}function rt(_){const{projectionContext:i,pitchedLabelPlaneMatrixInverse:h,symbol:p,fontSize:m,flip:v,keepUpright:w,glyphOffsetArray:I,dynamicLayoutVertexArray:P,aspectRatio:k,rotateToLine:D}=_,z=m/24,L=p.lineOffsetX*z,U=p.lineOffsetY*z;let W;if(p.numGlyphs>1){const te=p.glyphStartIndex+p.numGlyphs,ee=p.lineStartIndex,ne=p.lineStartIndex+p.lineLength,ae=Ai(z,I,L,U,v,p,D,i);if(!ae)return{notEnoughRoom:!0};const de=Ii(ae.first.point.x,ae.first.point.y,i,h),ue=Ii(ae.last.point.x,ae.last.point.y,i,h);if(w&&!v){const ge=ts(p.writingMode,de,ue,k);if(ge)return ge}W=[ae.first];for(let ge=p.glyphStartIndex+1;ge<te-1;ge++){const ye=Pr(z*I.getoffsetX(ge),L,U,v,p.segment,ee,ne,i,D);if(!ye)return{notEnoughRoom:!0};W.push(ye)}W.push(ae.last)}else{if(w&&!v){const ee=Or(i.tileAnchorPoint.x,i.tileAnchorPoint.y,i).point,ne=p.lineStartIndex+p.segment+1,ae=new a.P(i.lineVertexArray.getx(ne),i.lineVertexArray.gety(ne)),de=Or(ae.x,ae.y,i),ue=de.signedDistanceFromCamera>0?de.point:Vt(i.tileAnchorPoint,ae,ee,1,i),ge=Ii(ee.x,ee.y,i,h),ye=Ii(ue.x,ue.y,i,h),he=ts(p.writingMode,ge,ye,k);if(he)return he}const te=Pr(z*I.getoffsetX(p.glyphStartIndex),L,U,v,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,i,D);if(!te||i.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};W=[te]}for(const te of W)a.av(P,te.point,te.angle);return{}}function Vt(_,i,h,p,m){const v=_.add(_.sub(i)._unit()),w=Or(v.x,v.y,m).point,I=h.sub(w);return h.add(I._mult(p/I.mag()))}function At(_,i,h){const p=i.projectionCache;if(p.projections[_])return p.projections[_];const m=new a.P(i.lineVertexArray.getx(_),i.lineVertexArray.gety(_)),v=Or(m.x,m.y,i);if(v.signedDistanceFromCamera>0)return p.projections[_]=v.point,p.anyProjectionOccluded=p.anyProjectionOccluded||v.isOccluded,v.point;const w=_-h.direction;return Vt(h.distanceFromAnchor===0?i.tileAnchorPoint:new a.P(i.lineVertexArray.getx(w),i.lineVertexArray.gety(w)),m,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,i)}function Or(_,i,h){const p=_+h.translation[0],m=i+h.translation[1];let v;return h.pitchWithMap?(v=kr(p,m,h.pitchedLabelPlaneMatrix,h.getElevation),v.isOccluded=!1):(v=h.transform.projectTileCoordinates(p,m,h.unwrappedTileID,h.getElevation),v.point.x=(.5*v.point.x+.5)*h.width,v.point.y=(.5*-v.point.y+.5)*h.height),v}function Ii(_,i,h,p){if(h.pitchWithMap){const m=[_,i,0,1];return a.aw(m,m,p),h.transform.projectTileCoordinates(m[0]/m[3],m[1]/m[3],h.unwrappedTileID,h.getElevation).point}return{x:_/h.width*2-1,y:1-i/h.height*2}}function fi(_,i,h){return h.transform.projectTileCoordinates(_,i,h.unwrappedTileID,h.getElevation)}function Ct(_,i,h){return _._unit()._perp()._mult(i*h)}function _n(_,i,h,p,m,v,w,I,P){if(I.projectionCache.offsets[_])return I.projectionCache.offsets[_];const k=h.add(i);if(_+P.direction<p||_+P.direction>=m)return I.projectionCache.offsets[_]=k,k;const D=At(_+P.direction,I,P),z=Ct(D.sub(h),w,P.direction),L=h.add(z),U=D.add(z);return I.projectionCache.offsets[_]=a.ax(v,k,L,U)||k,I.projectionCache.offsets[_]}function Pr(_,i,h,p,m,v,w,I,P){const k=p?_-i:_+i;let D=k>0?1:-1,z=0;p&&(D*=-1,z=Math.PI),D<0&&(z+=Math.PI);let L,U=D>0?v+m:v+m+1;I.projectionCache.cachedAnchorPoint?L=I.projectionCache.cachedAnchorPoint:(L=Or(I.tileAnchorPoint.x,I.tileAnchorPoint.y,I).point,I.projectionCache.cachedAnchorPoint=L);let W,te,ee=L,ne=L,ae=0,de=0;const ue=Math.abs(k),ge=[];let ye;for(;ae+de<=ue;){if(U+=D,U<v||U>=w)return null;ae+=de,ne=ee,te=W;const Le={absOffsetX:ue,direction:D,distanceFromAnchor:ae,previousVertex:ne};if(ee=At(U,I,Le),h===0)ge.push(ne),ye=ee.sub(ne);else{let ke;const De=ee.sub(ne);ke=De.mag()===0?Ct(At(U+D,I,Le).sub(ee),h,D):Ct(De,h,D),te||(te=ne.add(ke)),W=_n(U,ke,ee,v,w,te,h,I,Le),ge.push(te),ye=W.sub(te)}de=ye.mag()}const he=ye._mult((ue-ae)/de)._add(te||ne),Ee=z+Math.atan2(ee.y-ne.y,ee.x-ne.x);return ge.push(he),{point:he,angle:P?Ee:0,path:ge}}const rs=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Pi(_,i){for(let h=0;h<_;h++){const p=i.length;i.resize(p+4),i.float32.set(rs,3*p)}}function Bs(_,i,h){const p=i[0],m=i[1];return _[0]=h[0]*p+h[4]*m+h[12],_[1]=h[1]*p+h[5]*m+h[13],_[3]=h[3]*p+h[7]*m+h[15],_}const Xr=100;class Mo{constructor(i,h=new Rr(i.width+200,i.height+200,25),p=new Rr(i.width+200,i.height+200,25)){this.transform=i,this.grid=h,this.ignoredGrid=p,this.pitchFactor=Math.cos(i.pitch*Math.PI/180)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Xr,this.screenBottomBoundary=i.height+Xr,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,h,p,m,v,w,I,P,k,D,z,L){const U=this.projectAndGetPerspectiveRatio(i.anchorPointX+P[0],i.anchorPointY+P[1],v,D,L),W=p*U.perspectiveRatio;let te;if(w||I)te=this._projectCollisionBox(i,W,m,v,w,I,P,U,D,z,L);else{const ye=U.x+(z?z.x*W:0),he=U.y+(z?z.y*W:0);te={allPointsOccluded:!1,box:[ye+i.x1*W,he+i.y1*W,ye+i.x2*W,he+i.y2*W]}}const[ee,ne,ae,de]=te.box,ue=w?te.allPointsOccluded:U.isOccluded;let ge=ue;return ge||(ge=U.perspectiveRatio<this.perspectiveRatioCutoff),ge||(ge=!this.isInsideGrid(ee,ne,ae,de)),ge||h!=="always"&&this.grid.hitTest(ee,ne,ae,de,h,k)?{box:[ee,ne,ae,de],placeable:!1,offscreen:!1,occluded:ue}:{box:[ee,ne,ae,de],placeable:!0,offscreen:this.isOffscreen(ee,ne,ae,de),occluded:ue}}placeCollisionCircles(i,h,p,m,v,w,I,P,k,D,z,L,U,W){const te=[],ee=new a.P(h.anchorX,h.anchorY),ne=this.getPerspectiveRatio(ee.x,ee.y,w,W),ae=(k?v*this.transform.getPitchedTextCorrection(h.anchorX,h.anchorY,w)/ne:v*ne)/a.aB,de={getElevation:W,pitchedLabelPlaneMatrix:I,lineVertexArray:p,pitchWithMap:k,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ee,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:U},ue=Ai(ae,m,h.lineOffsetX*ae,h.lineOffsetY*ae,!1,h,!1,de);let ge=!1,ye=!1,he=!0;if(ue){const Ee=.5*z*ne+L,Le=new a.P(-100,-100),ke=new a.P(this.screenRightBoundary,this.screenBottomBoundary),De=new Gt,Ne=ue.first,et=ue.last;let nt=[];for(let Kt=Ne.path.length-1;Kt>=1;Kt--)nt.push(Ne.path[Kt]);for(let Kt=1;Kt<et.path.length;Kt++)nt.push(et.path[Kt]);const Xe=2.5*Ee;if(k){const Kt=this.projectPathToScreenSpace(nt,de);nt=Kt.some(Ar=>Ar.signedDistanceFromCamera<=0)?[]:Kt.map(Ar=>Ar.point)}let wt=[];if(nt.length>0){const Kt=nt[0].clone(),Ar=nt[0].clone();for(let zr=1;zr<nt.length;zr++)Kt.x=Math.min(Kt.x,nt[zr].x),Kt.y=Math.min(Kt.y,nt[zr].y),Ar.x=Math.max(Ar.x,nt[zr].x),Ar.y=Math.max(Ar.y,nt[zr].y);wt=Kt.x>=Le.x&&Ar.x<=ke.x&&Kt.y>=Le.y&&Ar.y<=ke.y?[nt]:Ar.x<Le.x||Kt.x>ke.x||Ar.y<Le.y||Kt.y>ke.y?[]:a.ay([nt],Le.x,Le.y,ke.x,ke.y)}for(const Kt of wt){De.reset(Kt,.25*Ee);let Ar=0;Ar=De.length<=.5*Ee?1:Math.ceil(De.paddedLength/Xe)+1;for(let zr=0;zr<Ar;zr++){const Fr=zr/Math.max(Ar-1,1),tn=De.lerp(Fr),on=tn.x+Xr,Yt=tn.y+Xr;te.push(on,Yt,Ee,0);const Br=on-Ee,En=Yt-Ee,kn=on+Ee,Bn=Yt+Ee;if(he=he&&this.isOffscreen(Br,En,kn,Bn),ye=ye||this.isInsideGrid(Br,En,kn,Bn),i!=="always"&&this.grid.hitTestCircle(on,Yt,Ee,i,D)&&(ge=!0,!P))return{circles:[],offscreen:!1,collisionDetected:ge}}}}return{circles:!P&&ge||!ye||ne<this.perspectiveRatioCutoff?[]:te,offscreen:he,collisionDetected:ge}}projectPathToScreenSpace(i,h){const p=function(m,v){const w=a.L();return a.aq(w,v.pitchedLabelPlaneMatrix),m.map(I=>{const P=kr(I.x,I.y,w,v.getElevation),k=v.transform.projectTileCoordinates(P.point.x,P.point.y,v.unwrappedTileID,v.getElevation);return k.point.x=(.5*k.point.x+.5)*v.width,k.point.y=(.5*-k.point.y+.5)*v.height,k})}(i,h);return function(m){let v=0,w=0,I=0,P=0;for(let k=0;k<m.length;k++)m[k].isOccluded?(I=k+1,P=0):(P++,P>w&&(w=P,v=I));return m.slice(v,v+w)}(p)}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[],p=new a.a2;for(const z of i){const L=new a.P(z.x+Xr,z.y+Xr);p.extend(L),h.push(L)}const{minX:m,minY:v,maxX:w,maxY:I}=p,P=this.grid.query(m,v,w,I).concat(this.ignoredGrid.query(m,v,w,I)),k={},D={};for(const z of P){const L=z.key;if(k[L.bucketInstanceId]===void 0&&(k[L.bucketInstanceId]={}),k[L.bucketInstanceId][L.featureIndex])continue;const U=[new a.P(z.x1,z.y1),new a.P(z.x2,z.y1),new a.P(z.x2,z.y2),new a.P(z.x1,z.y2)];a.az(h,U)&&(k[L.bucketInstanceId][L.featureIndex]=!0,D[L.bucketInstanceId]===void 0&&(D[L.bucketInstanceId]=[]),D[L.bucketInstanceId].push(L.featureIndex))}return D}insertCollisionBox(i,h,p,m,v,w){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:w,overlapMode:h},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,h,p,m,v,w){const I=p?this.ignoredGrid:this.grid,P={bucketInstanceId:m,featureIndex:v,collisionGroupID:w,overlapMode:h};for(let k=0;k<i.length;k+=4)I.insertCircle(P,i[k],i[k+1],i[k+2])}projectAndGetPerspectiveRatio(i,h,p,m,v){if(v){let w;m?(w=[i,h,m(i,h),1],a.aw(w,w,v)):(w=[i,h,0,1],Bs(w,w,v));const I=w[3];return{x:(w[0]/I+1)/2*this.transform.width+Xr,y:(-w[1]/I+1)/2*this.transform.height+Xr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/I*.5,isOccluded:!1,signedDistanceFromCamera:I}}{const w=this.transform.projectTileCoordinates(i,h,p,m);return{x:(w.point.x+1)/2*this.transform.width+Xr,y:(1-w.point.y)/2*this.transform.height+Xr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5,isOccluded:w.isOccluded,signedDistanceFromCamera:w.signedDistanceFromCamera}}}getPerspectiveRatio(i,h,p,m){const v=this.transform.projectTileCoordinates(i,h,p,m);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(i,h,p,m){return p<Xr||i>=this.screenRightBoundary||m<Xr||h>this.screenBottomBoundary}isInsideGrid(i,h,p,m){return p>=0&&i<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const i=a.ag([]);return a.M(i,i,[-100,-100,0]),i}_projectCollisionBox(i,h,p,m,v,w,I,P,k,D,z){let L=1,U=0,W=0,te=1;const ee=i.anchorPointX+I[0],ne=i.anchorPointY+I[1];if(w&&!v){const nt=this.projectAndGetPerspectiveRatio(ee+1,ne,m,k,z),Xe=nt.x-P.x,wt=Math.atan((nt.y-P.y)/Xe)+(Xe<0?Math.PI:0),Kt=Math.sin(wt),Ar=Math.cos(wt);L=Ar,U=Kt,W=-Kt,te=Ar}else if(!w&&v){const nt=Ut(this.transform);L=nt.vecEast[0],U=nt.vecEast[1],W=nt.vecSouth[0],te=nt.vecSouth[1]}let ae=P.x,de=P.y,ue=h;v&&(ae=ee,de=ne,ue=Math.pow(2,-(this.transform.zoom-p.overscaledZ)),ue*=this.transform.getPitchedTextCorrection(ee,ne,m),D||(ue*=a.ah(.5+P.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),D&&(ae+=L*D.x*ue+W*D.y*ue,de+=U*D.x*ue+te*D.y*ue);const ge=i.x1*ue,ye=i.x2*ue,he=(ge+ye)/2,Ee=i.y1*ue,Le=i.y2*ue,ke=(Ee+Le)/2,De=[{offsetX:ge,offsetY:Ee},{offsetX:he,offsetY:Ee},{offsetX:ye,offsetY:Ee},{offsetX:ye,offsetY:ke},{offsetX:ye,offsetY:Le},{offsetX:he,offsetY:Le},{offsetX:ge,offsetY:Le},{offsetX:ge,offsetY:ke}];let Ne=[];for(const{offsetX:nt,offsetY:Xe}of De)Ne.push(new a.P(ae+L*nt+W*Xe,de+U*nt+te*Xe));let et=!1;if(v){const nt=Ne.map(Xe=>this.projectAndGetPerspectiveRatio(Xe.x,Xe.y,m,k,z));et=nt.some(Xe=>!Xe.isOccluded),Ne=nt.map(Xe=>new a.P(Xe.x,Xe.y))}else et=!0;return{box:a.aA(Ne),allPointsOccluded:!et}}}class Tn{constructor(i,h,p,m){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?h:-h))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Tr{constructor(i,h,p,m,v){this.text=new Tn(i?i.text:null,h,p,v),this.icon=new Tn(i?i.icon:null,h,m,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Va{constructor(i,h,p){this.text=i,this.icon=h,this.skipFade=p}}class no{constructor(i,h,p,m,v){this.bucketInstanceId=i,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=v}}class fs{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const h=++this.maxGroupID;this.collisionGroups[i]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[i]}}function ii(_,i,h,p,m){const{horizontalAlign:v,verticalAlign:w}=a.aH(_);return new a.P(-(v-.5)*i+p[0]*m,-(w-.5)*h+p[1]*m)}class ns{constructor(i,h,p,m,v){this.transform=i.clone(),this.terrain=h,this.collisionIndex=new Mo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new fs(m),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(i){const h=this.terrain;return h?(p,m)=>h.getElevation(i,p,m):null}getBucketParts(i,h,p,m){const v=p.getBucket(h),w=p.latestFeatureIndex;if(!v||!w||h.id!==v.layerIds[0])return;const I=p.collisionBoxArray,P=v.layers[0].layout,k=v.layers[0].paint,D=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),z=p.tileSize/a.$,L=p.tileID.toUnwrapped(),U=P.get("text-rotation-alignment")==="map",W=a.aC(p,1,this.transform.zoom),te=a.aD(this.collisionIndex.transform,p,k.get("text-translate"),k.get("text-translate-anchor")),ee=a.aD(this.collisionIndex.transform,p,k.get("icon-translate"),k.get("icon-translate-anchor")),ne=it(U,this.transform,W);this.retainedQueryData[v.bucketInstanceId]=new no(v.bucketInstanceId,w,v.sourceLayerIndex,v.index,p.tileID);const ae={bucket:v,layout:P,translationText:te,translationIcon:ee,unwrappedTileID:L,pitchedLabelPlaneMatrix:ne,scale:D,textPixelRatio:z,holdingForFade:p.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:a.an(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(m)for(const de of v.sortKeyRanges){const{sortKey:ue,symbolInstanceStart:ge,symbolInstanceEnd:ye}=de;i.push({sortKey:ue,symbolInstanceStart:ge,symbolInstanceEnd:ye,parameters:ae})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ae})}attemptAnchorPlacement(i,h,p,m,v,w,I,P,k,D,z,L,U,W,te,ee,ne,ae,de,ue){const ge=a.aE[i.textAnchor],ye=[i.textOffset0,i.textOffset1],he=ii(ge,p,m,ye,v),Ee=this.collisionIndex.placeCollisionBox(h,L,P,k,D,I,w,ee,z.predicate,de,he,ue);if((!ae||this.collisionIndex.placeCollisionBox(ae,L,P,k,D,I,w,ne,z.predicate,de,he,ue).placeable)&&Ee.placeable){let Le;if(this.prevPlacement&&this.prevPlacement.variableOffsets[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID].text&&(Le=this.prevPlacement.variableOffsets[U.crossTileID].anchor),U.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[U.crossTileID]={textOffset:ye,width:p,height:m,anchor:ge,textBoxScale:v,prevAnchor:Le},this.markUsedJustification(W,ge,U,te),W.allowVerticalPlacement&&(this.markUsedOrientation(W,te,U),this.placedOrientations[U.crossTileID]=te),{shift:he,placedGlyphBoxes:Ee}}}placeLayerBucketPart(i,h,p){const{bucket:m,layout:v,translationText:w,translationIcon:I,unwrappedTileID:P,pitchedLabelPlaneMatrix:k,textPixelRatio:D,holdingForFade:z,collisionBoxArray:L,partiallyEvaluatedTextSize:U,collisionGroup:W}=i.parameters,te=v.get("text-optional"),ee=v.get("icon-optional"),ne=a.aF(v,"text-overlap","text-allow-overlap"),ae=ne==="always",de=a.aF(v,"icon-overlap","icon-allow-overlap"),ue=de==="always",ge=v.get("text-rotation-alignment")==="map",ye=v.get("text-pitch-alignment")==="map",he=v.get("icon-text-fit")!=="none",Ee=v.get("symbol-z-order")==="viewport-y",Le=ae&&(ue||!m.hasIconData()||ee),ke=ue&&(ae||!m.hasTextData()||te);!m.collisionArrays&&L&&m.deserializeCollisionBoxes(L);const De=this.retainedQueryData[m.bucketInstanceId].tileID,Ne=this._getTerrainElevationFunc(De),et=this.transform.getFastPathSimpleProjectionMatrix(De),nt=(Xe,wt,Kt)=>{var Ar,zr;if(h[Xe.crossTileID])return;if(z)return void(this.placements[Xe.crossTileID]=new Va(!1,!1,!1));let Fr=!1,tn=!1,on=!0,Yt=null,Br={box:null,placeable:!1,offscreen:null,occluded:!1},En={placeable:!1},kn=null,Bn=null,yi=null,bs=0,Lo=0,zo=0;wt.textFeatureIndex?bs=wt.textFeatureIndex:Xe.useRuntimeCollisionCircles&&(bs=Xe.featureIndex),wt.verticalTextFeatureIndex&&(Lo=wt.verticalTextFeatureIndex);const ll=wt.textBox;if(ll){const Ri=An=>{let Dn=a.ao.horizontal;if(m.allowVerticalPlacement&&!An&&this.prevPlacement){const as=this.prevPlacement.placedOrientations[Xe.crossTileID];as&&(this.placedOrientations[Xe.crossTileID]=as,Dn=as,this.markUsedOrientation(m,Dn,Xe))}return Dn},ws=(An,Dn)=>{if(m.allowVerticalPlacement&&Xe.numVerticalGlyphVertices>0&&wt.verticalTextBox){for(const as of m.writingModes)if(as===a.ao.vertical?(Br=Dn(),En=Br):Br=An(),Br&&Br.placeable)break}else Br=An()},vi=Xe.textAnchorOffsetStartIndex,Bo=Xe.textAnchorOffsetEndIndex;if(Bo===vi){const An=(Dn,as)=>{const In=this.collisionIndex.placeCollisionBox(Dn,ne,D,De,P,ye,ge,w,W.predicate,Ne,void 0,et);return In&&In.placeable&&(this.markUsedOrientation(m,as,Xe),this.placedOrientations[Xe.crossTileID]=as),In};ws(()=>An(ll,a.ao.horizontal),()=>{const Dn=wt.verticalTextBox;return m.allowVerticalPlacement&&Xe.numVerticalGlyphVertices>0&&Dn?An(Dn,a.ao.vertical):{box:null,offscreen:null}}),Ri(Br&&Br.placeable)}else{let An=a.aE[(zr=(Ar=this.prevPlacement)===null||Ar===void 0?void 0:Ar.variableOffsets[Xe.crossTileID])===null||zr===void 0?void 0:zr.anchor];const Dn=(In,Tc,ul)=>{const co=In.x2-In.x1,Ts=In.y2-In.y1,Uo=Xe.textBoxScale,Ig=he&&de==="never"?Tc:null;let Hi=null,Pg=ne==="never"?1:2,Gd="never";An&&Pg++;for(let Wu=0;Wu<Pg;Wu++){for(let Hu=vi;Hu<Bo;Hu++){const Vo=m.textAnchorOffsets.get(Hu);if(An&&Vo.textAnchor!==An)continue;const uo=this.attemptAnchorPlacement(Vo,In,co,Ts,Uo,ge,ye,D,De,P,W,Gd,Xe,m,ul,w,I,Ig,Ne);if(uo&&(Hi=uo.placedGlyphBoxes,Hi&&Hi.placeable))return Fr=!0,Yt=uo.shift,Hi}An?An=null:Gd=ne}return p&&!Hi&&(Hi={box:this.collisionIndex.placeCollisionBox(ll,"always",D,De,P,ye,ge,w,W.predicate,Ne,void 0,et).box,offscreen:!1,placeable:!1,occluded:!1}),Hi};ws(()=>Dn(ll,wt.iconBox,a.ao.horizontal),()=>{const In=wt.verticalTextBox;return m.allowVerticalPlacement&&(!Br||!Br.placeable)&&Xe.numVerticalGlyphVertices>0&&In?Dn(In,wt.verticalIconBox,a.ao.vertical):{box:null,occluded:!0,offscreen:null}}),Br&&(Fr=Br.placeable,on=Br.offscreen);const as=Ri(Br&&Br.placeable);if(!Fr&&this.prevPlacement){const In=this.prevPlacement.variableOffsets[Xe.crossTileID];In&&(this.variableOffsets[Xe.crossTileID]=In,this.markUsedJustification(m,In.anchor,Xe,as))}}}if(kn=Br,Fr=kn&&kn.placeable,on=kn&&kn.offscreen,Xe.useRuntimeCollisionCircles){const Ri=m.text.placedSymbolArray.get(Xe.centerJustifiedTextSymbolIndex),ws=a.ap(m.textSizeData,U,Ri),vi=v.get("text-padding");Bn=this.collisionIndex.placeCollisionCircles(ne,Ri,m.lineVertexArray,m.glyphOffsetArray,ws,P,k,p,ye,W.predicate,Xe.collisionCircleDiameter,vi,w,Ne),Bn.circles.length&&Bn.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),Fr=ae||Bn.circles.length>0&&!Bn.collisionDetected,on=on&&Bn.offscreen}if(wt.iconFeatureIndex&&(zo=wt.iconFeatureIndex),wt.iconBox){const Ri=ws=>this.collisionIndex.placeCollisionBox(ws,de,D,De,P,ye,ge,I,W.predicate,Ne,he&&Yt?Yt:void 0,et);En&&En.placeable&&wt.verticalIconBox?(yi=Ri(wt.verticalIconBox),tn=yi.placeable):(yi=Ri(wt.iconBox),tn=yi.placeable),on=on&&yi.offscreen}const cl=te||Xe.numHorizontalGlyphVertices===0&&Xe.numVerticalGlyphVertices===0,wa=ee||Xe.numIconVertices===0;cl||wa?wa?cl||(tn=tn&&Fr):Fr=tn&&Fr:tn=Fr=tn&&Fr;const Ta=tn&&yi.placeable;if(Fr&&kn.placeable&&this.collisionIndex.insertCollisionBox(kn.box,ne,v.get("text-ignore-placement"),m.bucketInstanceId,En&&En.placeable&&Lo?Lo:bs,W.ID),Ta&&this.collisionIndex.insertCollisionBox(yi.box,de,v.get("icon-ignore-placement"),m.bucketInstanceId,zo,W.ID),Bn&&Fr&&this.collisionIndex.insertCollisionCircles(Bn.circles,ne,v.get("text-ignore-placement"),m.bucketInstanceId,bs,W.ID),p&&this.storeCollisionData(m.bucketInstanceId,Kt,wt,kn,yi,Bn),Xe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Xe.crossTileID]=new Va((Fr||Le)&&!(kn!=null&&kn.occluded),(tn||ke)&&!(yi!=null&&yi.occluded),on||m.justReloaded),h[Xe.crossTileID]=!0};if(Ee){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Xe=m.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let wt=Xe.length-1;wt>=0;--wt){const Kt=Xe[wt];nt(m.symbolInstances.get(Kt),m.collisionArrays[Kt],Kt)}}else for(let Xe=i.symbolInstanceStart;Xe<i.symbolInstanceEnd;Xe++)nt(m.symbolInstances.get(Xe),m.collisionArrays[Xe],Xe);m.justReloaded=!1}storeCollisionData(i,h,p,m,v,w){if(p.textBox||p.iconBox){let I,P;this.collisionBoxArrays.has(i)?I=this.collisionBoxArrays.get(i):(I=new Map,this.collisionBoxArrays.set(i,I)),I.has(h)?P=I.get(h):(P={text:null,icon:null},I.set(h,P)),p.textBox&&(P.text=m.box),p.iconBox&&(P.icon=v.box)}if(w){let I=this.collisionCircleArrays[i];I===void 0&&(I=this.collisionCircleArrays[i]=[]);for(let P=0;P<w.circles.length;P+=4)I.push(w.circles[P+0]-Xr),I.push(w.circles[P+1]-Xr),I.push(w.circles[P+2]),I.push(w.collisionDetected?1:0)}}markUsedJustification(i,h,p,m){let v;v=m===a.ao.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.aG(h)];const w=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const I of w)I>=0&&(i.text.placedSymbolArray.get(I).crossTileID=v>=0&&I!==v?0:p.crossTileID)}markUsedOrientation(i,h,p){const m=h===a.ao.horizontal||h===a.ao.horizontalOnly?h:0,v=h===a.ao.vertical?h:0,w=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const I of w)i.text.placedSymbolArray.get(I).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const m=h?h.symbolFadeChange(i):1,v=h?h.opacities:{},w=h?h.variableOffsets:{},I=h?h.placedOrientations:{};for(const P in this.placements){const k=this.placements[P],D=v[P];D?(this.opacities[P]=new Tr(D,m,k.text,k.icon),p=p||k.text!==D.text.placed||k.icon!==D.icon.placed):(this.opacities[P]=new Tr(null,m,k.text,k.icon,k.skipFade),p=p||k.text||k.icon)}for(const P in v){const k=v[P];if(!this.opacities[P]){const D=new Tr(k,m,!1,!1);D.isHidden()||(this.opacities[P]=D,p=p||k.text.placed||k.icon.placed)}}for(const P in w)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=w[P]);for(const P in I)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=I[P]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:i)}updateLayerOpacities(i,h){const p={};for(const m of h){const v=m.getBucket(i);v&&m.latestFeatureIndex&&i.id===v.layerIds[0]&&this.updateBucketOpacities(v,m.tileID,p,m.collisionBoxArray)}}updateBucketOpacities(i,h,p,m){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const v=i.layers[0],w=v.layout,I=new Tr(null,0,!1,!1,!0),P=w.get("text-allow-overlap"),k=w.get("icon-allow-overlap"),D=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=w.get("text-rotation-alignment")==="map",L=w.get("text-pitch-alignment")==="map",U=w.get("icon-text-fit")!=="none",W=new Tr(null,0,P&&(k||!i.hasIconData()||w.get("icon-optional")),k&&(P||!i.hasTextData()||w.get("text-optional")),!0);!i.collisionArrays&&m&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(m);const te=(ne,ae,de)=>{for(let ue=0;ue<ae/4;ue++)ne.opacityVertexArray.emplaceBack(de);ne.hasVisibleVertices=ne.hasVisibleVertices||de!==Us},ee=this.collisionBoxArrays.get(i.bucketInstanceId);for(let ne=0;ne<i.symbolInstances.length;ne++){const ae=i.symbolInstances.get(ne),{numHorizontalGlyphVertices:de,numVerticalGlyphVertices:ue,crossTileID:ge}=ae;let ye=this.opacities[ge];p[ge]?ye=I:ye||(ye=W,this.opacities[ge]=ye),p[ge]=!0;const he=ae.numIconVertices>0,Ee=this.placedOrientations[ae.crossTileID],Le=Ee===a.ao.vertical,ke=Ee===a.ao.horizontal||Ee===a.ao.horizontalOnly;if(de>0||ue>0){const Ne=io(ye.text);te(i.text,de,Le?Us:Ne),te(i.text,ue,ke?Us:Ne);const et=ye.text.isHidden();[ae.rightJustifiedTextSymbolIndex,ae.centerJustifiedTextSymbolIndex,ae.leftJustifiedTextSymbolIndex].forEach(wt=>{wt>=0&&(i.text.placedSymbolArray.get(wt).hidden=et||Le?1:0)}),ae.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(ae.verticalPlacedTextSymbolIndex).hidden=et||ke?1:0);const nt=this.variableOffsets[ae.crossTileID];nt&&this.markUsedJustification(i,nt.anchor,ae,Ee);const Xe=this.placedOrientations[ae.crossTileID];Xe&&(this.markUsedJustification(i,"left",ae,Xe),this.markUsedOrientation(i,Xe,ae))}if(he){const Ne=io(ye.icon),et=!(U&&ae.verticalPlacedIconSymbolIndex&&Le);ae.placedIconSymbolIndex>=0&&(te(i.icon,ae.numIconVertices,et?Ne:Us),i.icon.placedSymbolArray.get(ae.placedIconSymbolIndex).hidden=ye.icon.isHidden()),ae.verticalPlacedIconSymbolIndex>=0&&(te(i.icon,ae.numVerticalIconVertices,et?Us:Ne),i.icon.placedSymbolArray.get(ae.verticalPlacedIconSymbolIndex).hidden=ye.icon.isHidden())}const De=ee&&ee.has(ne)?ee.get(ne):{text:null,icon:null};if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Ne=i.collisionArrays[ne];if(Ne){let et=new a.P(0,0);if(Ne.textBox||Ne.verticalTextBox){let nt=!0;if(D){const Xe=this.variableOffsets[ge];Xe?(et=ii(Xe.anchor,Xe.width,Xe.height,Xe.textOffset,Xe.textBoxScale),z&&et._rotate(L?-this.transform.bearingInRadians:this.transform.bearingInRadians)):nt=!1}if(Ne.textBox||Ne.verticalTextBox){let Xe;Ne.textBox&&(Xe=Le),Ne.verticalTextBox&&(Xe=ke),ta(i.textCollisionBox.collisionVertexArray,ye.text.placed,!nt||Xe,De.text,et.x,et.y)}}if(Ne.iconBox||Ne.verticalIconBox){const nt=!!(!ke&&Ne.verticalIconBox);let Xe;Ne.iconBox&&(Xe=nt),Ne.verticalIconBox&&(Xe=!nt),ta(i.iconCollisionBox.collisionVertexArray,ye.icon.placed,Xe,De.icon,U?et.x:0,U?et.y:0)}}}}if(i.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);i.bucketInstanceId in this.collisionCircleArrays&&(i.collisionCircleArray=this.collisionCircleArrays[i.bucketInstanceId],delete this.collisionCircleArrays[i.bucketInstanceId])}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>i}setStale(){this.stale=!0}}function ta(_,i,h,p,m,v){p&&p.length!==0||(p=[0,0,0,0]);const w=p[0]-Xr,I=p[1]-Xr,P=p[2]-Xr,k=p[3]-Xr;_.emplaceBack(i?1:0,h?1:0,m||0,v||0,w,I),_.emplaceBack(i?1:0,h?1:0,m||0,v||0,P,I),_.emplaceBack(i?1:0,h?1:0,m||0,v||0,P,k),_.emplaceBack(i?1:0,h?1:0,m||0,v||0,w,k)}const ja=Math.pow(2,25),$a=Math.pow(2,24),Vi=Math.pow(2,17),Wa=Math.pow(2,16),ql=Math.pow(2,9),ra=Math.pow(2,8),Ha=Math.pow(2,1);function io(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const i=_.placed?1:0,h=Math.floor(127*_.opacity);return h*ja+i*$a+h*Vi+i*Wa+h*ql+i*ra+h*Ha+i}const Us=0;class na{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,h,p,m,v){const w=this._bucketParts;for(;this._currentTileIndex<i.length;)if(h.getBucketParts(w,m,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((I,P)=>I.sortKey-P.sortKey));this._currentPartIndex<w.length;)if(h.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,v())return!0;return!1}}class Yl{constructor(i,h,p,m,v,w,I,P){this.placement=new ns(i,h,w,I,P),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(i,h,p){const m=F.now(),v=()=>!this._forceFullPlacement&&F.now()-m>2;for(;this._currentPlacementIndex>=0;){const w=h[i[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=I)&&(!w.maxzoom||w.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new na(w)),this._inProgressLayer.continuePlacement(p[w.source],this.placement,this._showCollisionBoxes,w,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Ro=512/a.$/2;class Gl{constructor(i,h,p){this.tileID=i,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let v=0;v<h.length;v++){const w=h.get(v),I=w.key,P=m.get(I);P?P.push(w):m.set(I,[w])}for(const[v,w]of m){const I={positions:w.map(P=>({x:Math.floor(P.anchorX*Ro),y:Math.floor(P.anchorY*Ro)})),crossTileIDs:w.map(P=>P.crossTileID)};if(I.positions.length>128){const P=new a.aI(I.positions.length,16,Uint16Array);for(const{x:k,y:D}of I.positions)P.add(k,D);P.finish(),delete I.positions,I.index=P}this._symbolsByKey[v]=I}}getScaledCoordinates(i,h){const{x:p,y:m,z:v}=this.tileID.canonical,{x:w,y:I,z:P}=h.canonical,k=Ro/Math.pow(2,P-v),D=(I*a.$+i.anchorY)*k,z=m*a.$*Ro;return{x:Math.floor((w*a.$+i.anchorX)*k-p*a.$*Ro),y:Math.floor(D-z)}}findMatches(i,h,p){const m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let v=0;v<i.length;v++){const w=i.get(v);if(w.crossTileID)continue;const I=this._symbolsByKey[w.key];if(!I)continue;const P=this.getScaledCoordinates(w,h);if(I.index){const k=I.index.range(P.x-m,P.y-m,P.x+m,P.y+m).sort();for(const D of k){const z=I.crossTileIDs[D];if(!p[z]){p[z]=!0,w.crossTileID=z;break}}}else if(I.positions)for(let k=0;k<I.positions.length;k++){const D=I.positions[k],z=I.crossTileIDs[k];if(Math.abs(D.x-P.x)<=m&&Math.abs(D.y-P.y)<=m&&!p[z]){p[z]=!0,w.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class Kl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class cd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const h=Math.round((i-this.lng)/360);if(h!==0)for(const p in this.indexes){const m=this.indexes[p],v={};for(const w in m){const I=m[w];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+h),v[I.tileID.key]=I}this.indexes[p]=v}this.lng=i}addBucket(i,h,p){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let v=0;v<h.symbolInstances.length;v++)h.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const m=this.usedCrossTileIDs[i.overscaledZ];for(const v in this.indexes){const w=this.indexes[v];if(Number(v)>i.overscaledZ)for(const I in w){const P=w[I];P.tileID.isChildOf(i)&&P.findMatches(h.symbolInstances,i,m)}else{const I=w[i.scaledTo(Number(v)).key];I&&I.findMatches(h.symbolInstances,i,m)}}for(let v=0;v<h.symbolInstances.length;v++){const w=h.symbolInstances.get(v);w.crossTileID||(w.crossTileID=p.generate(),m[w.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Gl(i,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(i,h){for(const p of h.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[i][m]}removeStaleBuckets(i){let h=!1;for(const p in this.indexes){const m=this.indexes[p];for(const v in m)i[m[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[v]),delete m[v],h=!0)}return h}}class ko{constructor(){this.layerIndexes={},this.crossTileIDs=new Kl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,h,p){let m=this.layerIndexes[i.id];m===void 0&&(m=this.layerIndexes[i.id]=new cd);let v=!1;const w={};m.handleWrapJump(p);for(const I of h){const P=I.getBucket(i);P&&i.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(I.tileID,P,this.crossTileIDs)&&(v=!0),w[P.bucketInstanceId]=!0)}return m.removeStaleBuckets(w)&&(v=!0),v}pruneUnusedLayers(i){const h={};i.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}var ia="void main() {fragColor=vec4(1.0);}";const ji={prelude:rr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:rr("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:rr("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:rr(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:rr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:rr(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:rr(ia,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:rr(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:rr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:rr("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:rr("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:rr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:rr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:rr(ia,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:rr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:rr(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:rr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:rr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:rr(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:rr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:rr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:rr(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:rr(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:rr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:rr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:rr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:rr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:rr(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:rr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:rr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:rr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:rr("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:rr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:rr("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:rr(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:rr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function rr(_,i){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=i.match(/in ([\w]+) ([\w]+)/g),m=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=v?v.concat(m):m,I={};return{fragmentSource:_=_.replace(h,(P,k,D,z,L)=>(I[L]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${L}
in ${D} ${z} ${L};
#else
uniform ${D} ${z} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${D} ${z} ${L} = u_${L};
#endif
`)),vertexSource:i=i.replace(h,(P,k,D,z,L)=>{const U=z==="float"?"vec2":"vec4",W=L.match(/color/)?"color":U;return I[L]?k==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${D} ${U} a_${L};
out ${D} ${z} ${L};
#else
uniform ${D} ${z} u_${L};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${D} ${z} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${W}(a_${L}, u_${L}_t);
#else
    ${D} ${z} ${L} = u_${L};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${D} ${U} a_${L};
#else
uniform ${D} ${z} u_${L};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${D} ${z} ${L} = a_${L};
#else
    ${D} ${z} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${D} ${z} ${L} = unpack_mix_${W}(a_${L}, u_${L}_t);
#else
    ${D} ${z} ${L} = u_${L};
#endif
`}),staticAttributes:p,staticUniforms:w}}class sa{constructor(i,h,p){this.vertexBuffer=i,this.indexBuffer=h,this.segments=p}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Do=a.aJ([{name:"a_pos",type:"Int16",components:2}]);const so="#define PROJECTION_MERCATOR",oa="mercator";class or{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return oa}get shaderDefine(){return so}get shaderPreludeCode(){return ji.projectionMercator}get vertexShaderPreludeCode(){return ji.projectionMercator.vertexSource}get subdivisionGranularity(){return a.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(i){}getMeshFromTileID(i,h,p,m,v){if(this._cachedMesh)return this._cachedMesh;const w=new a.aL;w.emplaceBack(0,0),w.emplaceBack(a.$,0),w.emplaceBack(0,a.$),w.emplaceBack(a.$,a.$);const I=i.createVertexBuffer(w,Do.members),P=a.aM.simpleSegment(0,0,4,2),k=new a.aN;k.emplaceBack(1,0,2),k.emplaceBack(1,2,3);const D=i.createIndexBuffer(k);return this._cachedMesh=new sa(I,D,P),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(i){}}class aa{constructor(i=0,h=0,p=0,m=0){if(isNaN(i)||i<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=h,this.left=p,this.right=m}interpolate(i,h,p){return h.top!=null&&i.top!=null&&(this.top=a.C.number(i.top,h.top,p)),h.bottom!=null&&i.bottom!=null&&(this.bottom=a.C.number(i.bottom,h.bottom,p)),h.left!=null&&i.left!=null&&(this.left=a.C.number(i.left,h.left,p)),h.right!=null&&i.right!=null&&(this.right=a.C.number(i.right,h.right,p)),this}getCenter(i,h){const p=a.ah((this.left+i-this.right)/2,0,i),m=a.ah((this.top+h-this.bottom)/2,0,h);return new a.P(p,m)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new aa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function cu(_,i){if(!_.renderWorldCopies||_.lngRange)return;const h=i.lng-_.center.lng;i.lng+=h>180?-360:h<-180?360:0}function uu(_){return Math.max(0,Math.floor(_))}class pi{constructor(i,h,p,m,v,w){this._callbacks=i,this._tileSize=512,this._renderWorldCopies=w===void 0||!!w,this._minZoom=h||0,this._maxZoom=p||22,this._minPitch=m??0,this._maxPitch=v??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new a.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=uu(this._zoom),this._scale=a.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new aa,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(i,h,p){this._latRange=i.latRange,this._lngRange=i.lngRange,this._width=i.width,this._height=i.height,this._center=i.center,this._elevation=i.elevation,this._minElevationForCurrentTile=i.minElevationForCurrentTile,this._zoom=i.zoom,this._tileZoom=uu(this._zoom),this._scale=a.af(this._zoom),this._bearingInRadians=i.bearingInRadians,this._fovInRadians=i.fovInRadians,this._pitchInRadians=i.pitchInRadians,this._rollInRadians=i.rollInRadians,this._unmodified=i.unmodified,this._edgeInsets=new aa(i.padding.top,i.padding.bottom,i.padding.left,i.padding.right),this._minZoom=i.minZoom,this._maxZoom=i.maxZoom,this._minPitch=i.minPitch,this._maxPitch=i.maxPitch,this._renderWorldCopies=i.renderWorldCopies,this._cameraToCenterDistance=i.cameraToCenterDistance,this._nearZ=i.nearZ,this._farZ=i.farZ,this._autoCalculateNearFarZ=!p&&i.autoCalculateNearFarZ,h&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(i){this._minElevationForCurrentTile=i}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(i){this._minZoom!==i&&(this._minZoom=i,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(i){this._minPitch!==i&&(this._minPitch=i,this.setPitch(Math.max(this.pitch,i)))}get maxPitch(){return this._maxPitch}setMaxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.setPitch(Math.min(this.pitch,i)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(i){const h=a.aO(i,-180,180)*Math.PI/180;var p,m,v,w,I,P,k,D,z;this._bearingInRadians!==h&&(this._unmodified=!1,this._bearingInRadians=h,this._calcMatrices(),this._rotationMatrix=S(),p=this._rotationMatrix,v=-this._bearingInRadians,w=(m=this._rotationMatrix)[0],I=m[1],P=m[2],k=m[3],D=Math.sin(v),z=Math.cos(v),p[0]=w*z+P*D,p[1]=I*z+k*D,p[2]=w*-D+P*z,p[3]=I*-D+k*z)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(i){const h=a.ah(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==h&&(this._unmodified=!1,this._pitchInRadians=h,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(i){const h=i/180*Math.PI;this._rollInRadians!==h&&(this._unmodified=!1,this._rollInRadians=h,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return a.aP(this._fovInRadians)}setFov(i){i=a.ah(i,.1,150),this.fov!==i&&(this._unmodified=!1,this._fovInRadians=a.ae(i),this._calcMatrices())}get zoom(){return this._zoom}setZoom(i){const h=this.getConstrained(this._center,i).zoom;this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this._tileZoom=Math.max(0,Math.floor(h)),this._scale=a.af(h),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(i,h){this._autoCalculateNearFarZ=!1,this._nearZ=i,this._farZ=h,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,h,p){this._unmodified=!1,this._edgeInsets.interpolate(i,h,p),this._constrain(),this._calcMatrices()}resize(i,h,p=!0){this._width=i,this._height=h,p&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new er([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(i){i?(this._lngRange=[i.getWest(),i.getEast()],this._latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-a.ai,a.ai])}getConstrained(i,h){return this._callbacks.getConstrained(i,h)}getCameraQueryGeometry(i,h){if(h.length===1)return[h[0],i];{const{minX:p,minY:m,maxX:v,maxY:w}=a.a2.fromPoints(h).extend(i);return[new a.P(p,m),new a.P(v,m),new a.P(v,w),new a.P(p,w),new a.P(p,m)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:h,zoom:p}=this.getConstrained(this.center,this.zoom);this.setCenter(h),this.setZoom(p),this._unmodified=i,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let i=a.ag(new Float64Array(16));a.N(i,i,[this._width/2,-this._height/2,1]),a.M(i,i,[1,-1,0]),this._clipSpaceToPixelsMatrix=i,i=a.ag(new Float64Array(16)),a.N(i,i,[1,-1,1]),a.M(i,i,[-1,-1,0]),a.N(i,i,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=i,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(i,h,p,m){const v=p!==void 0?p:this.bearing,w=m=m!==void 0?m:this.pitch,I=a.a1.fromLngLat(i,h),P=-Math.cos(a.ae(w)),k=Math.sin(a.ae(w)),D=k*Math.sin(a.ae(v)),z=-k*Math.cos(a.ae(v));let L=this.elevation;const U=h-L;let W;P*U>=0||Math.abs(P)<.1?(W=1e4,L=h+W*P):W=-U/P;let te,ee,ne=a.aQ(1,I.y),ae=0;do{if(ae+=1,ae>10)break;ee=W/ne,te=new a.a1(I.x+D*ee,I.y+z*ee),ne=1/te.meterInMercatorCoordinateUnits()}while(Math.abs(W-ee*ne)>1e-12);return{center:te.toLngLat(),elevation:L,zoom:a.ak(this.height/2/Math.tan(this.fovInRadians/2)/ee/this.tileSize)}}recalculateZoomAndCenter(i){if(this.elevation-i==0)return;const h=a.aj(1,this.center.lat)*this.worldSize,p=this.cameraToCenterDistance/h,m=a.a1.fromLngLat(this.center,this.elevation),v=Ie(this.center,this.elevation,this.pitch,this.bearing,p);this._elevation=i;const w=this.calculateCenterFromCameraLngLatAlt(v.toLngLat(),a.aQ(v.z,m.y),this.bearing,this.pitch);this._elevation=w.elevation,this._center=w.center,this.setZoom(w.zoom)}getCameraPoint(){const i=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(i*Math.sin(this.rollInRadians),i*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const i=a.aj(1,this.center.lat)*this.worldSize;return Ie(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/i).toLngLat()}getMercatorTileCoordinates(i){if(!i)return[0,0,1,1];const h=i.canonical.z>=0?1<<i.canonical.z:Math.pow(2,i.canonical.z);return[i.canonical.x/h,i.canonical.y/h,1/h/a.$,1/h/a.$]}}class Ln{constructor(i,h){this.min=i,this.max=h,this.center=a.aR([],a.aS([],this.min,this.max),.5)}quadrant(i){const h=[i%2==0,i<2],p=a.aT(this.min),m=a.aT(this.max);for(let v=0;v<h.length;v++)p[v]=h[v]?this.min[v]:this.center[v],m[v]=h[v]?this.center[v]:this.max[v];return m[2]=this.max[2],new Ln(p,m)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersectsFrustum(i){let h=!0;for(let p=0;p<i.planes.length;p++){const m=this.intersectsPlane(i.planes[p]);if(m===0)return 0;m===1&&(h=!1)}return h?2:i.aabb.min[0]>this.max[0]||i.aabb.min[1]>this.max[1]||i.aabb.min[2]>this.max[2]||i.aabb.max[0]<this.min[0]||i.aabb.max[1]<this.min[1]||i.aabb.max[2]<this.min[2]?0:1}intersectsPlane(i){let h=i[3],p=i[3];for(let m=0;m<3;m++)i[m]>0?(h+=i[m]*this.min[m],p+=i[m]*this.max[m]):(p+=i[m]*this.min[m],h+=i[m]*this.max[m]);return h>=0?2:p<0?0:1}}class gi{distanceToTile2d(i,h,p,m){const v=m.distanceX([i,h]),w=m.distanceY([i,h]);return Math.hypot(v,w)}getWrap(i,h,p){return p}getTileBoundingVolume(i,h,p,m){var v,w;let I=0,P=0;if(m!=null&&m.terrain){const D=new a.Z(i.z,h,i.z,i.x,i.y),z=m.terrain.getMinMaxElevation(D);I=(v=z.minElevation)!==null&&v!==void 0?v:Math.min(0,p),P=(w=z.maxElevation)!==null&&w!==void 0?w:Math.max(0,p)}const k=1<<i.z;return new Ln([h+i.x/k,i.y/k,I],[h+(i.x+1)/k,(i.y+1)/k,P])}allowVariableZoom(i,h){const p=i.fov*(Math.abs(Math.cos(i.rollInRadians))*i.height+Math.abs(Math.sin(i.rollInRadians))*i.width)/i.height,m=a.ah(78.5-p/2,0,60);return!!h.terrain||i.pitch>m}allowWorldCopies(){return!0}prepareNextFrame(){}}class Sn{constructor(i,h,p){this.points=i,this.planes=h,this.aabb=p}static fromInvProjectionMatrix(i,h=1,p=0,m,v){const w=v?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],I=Math.pow(2,p),P=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(L=>function(U,W,te,ee){const ne=a.aw([],U,W),ae=1/ne[3]/te*ee;return a.aY(ne,ne,[ae,ae,1/ne[3],ae])}(L,i,h,I));m&&function(L,U,W,te){const ee=te?4:0,ne=te?0:4;let ae=0;const de=[],ue=[];for(let he=0;he<4;he++){const Ee=a.aU([],L[he+ne],L[he+ee]),Le=a.aZ(Ee);a.aR(Ee,Ee,1/Le),de.push(Le),ue.push(Ee)}for(let he=0;he<4;he++){const Ee=a.a_(L[he+ee],ue[he],W);ae=Ee!==null&&Ee>=0?Math.max(ae,Ee):Math.max(ae,de[he])}const ge=function(he,Ee){const Le=a.aU([],he[Ee[0]],he[Ee[1]]),ke=a.aU([],he[Ee[2]],he[Ee[1]]),De=[0,0,0,0];return a.aV(De,a.aW([],Le,ke)),De[3]=-a.aX(De,he[Ee[0]]),De}(L,U),ye=function(he,Ee){const Le=a.a$(he),ke=a.b0([],he,1/Le),De=a.aU([],Ee,a.aR([],ke,a.aX(Ee,ke))),Ne=a.a$(De);if(Ne>0){const et=Math.sqrt(1-ke[3]*ke[3]),nt=a.aR([],ke,-ke[3]),Xe=a.aS([],nt,a.aR([],De,et/Ne));return a.b1(Ee,Xe)}return null}(W,ge);if(ye!==null){const he=ye/a.aX(ue[0],ge);ae=Math.min(ae,he)}for(let he=0;he<4;he++){const Ee=Math.min(ae,de[he]);L[he+ne]=[L[he+ee][0]+ue[he][0]*Ee,L[he+ee][1]+ue[he][1]*Ee,L[he+ee][2]+ue[he][2]*Ee,1]}}(P,w[0],m,v);const k=w.map(L=>{const U=a.aU([],P[L[0]],P[L[1]]),W=a.aU([],P[L[2]],P[L[1]]),te=a.aV([],a.aW([],U,W)),ee=-a.aX(te,P[L[1]]);return te.concat(ee)}),D=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],z=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const L of P)for(let U=0;U<3;U++)D[U]=Math.min(D[U],L[U]),z[U]=Math.max(z[U],L[U]);return new Sn(P,k,new Ln(D,z))}}class Vr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,h,p){return this._helper.interpolatePadding(i,h,p)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,h,p=!0){this._helper.resize(i,h,p)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}overrideNearFarZ(i,h){this._helper.overrideNearFarZ(i,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(i,h){}constructor(i,h,p,m,v){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new pi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(w,I)=>this.getConstrained(w,I)},i,h,p,m,v),this._coveringTilesDetailsProvider=new gi}clone(){const i=new Vr;return i.apply(this),i}apply(i,h,p){this._helper.apply(i,h,p)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(i){const h=[new a.b2(0,i)];if(this._helper._renderWorldCopies){const p=this.screenPointToMercatorCoordinate(new a.P(0,0)),m=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,0)),v=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,this._helper._height)),w=this.screenPointToMercatorCoordinate(new a.P(0,this._helper._height)),I=Math.floor(Math.min(p.x,m.x,v.x,w.x)),P=Math.floor(Math.max(p.x,m.x,v.x,w.x)),k=1;for(let D=I-k;D<=P+k;D++)D!==0&&h.push(new a.b2(D,i))}return h}getCameraFrustum(){return Sn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(i){const h=this.screenPointToLocation(this.centerPoint,i),p=i?i.getElevationForLngLatZoom(h,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(p)}setLocationAtPoint(i,h){const p=a.aj(this.elevation,this.center.lat),m=this.screenPointToMercatorCoordinateAtZ(h,p),v=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,p),w=a.a1.fromLngLat(i),I=new a.a1(w.x-(m.x-v.x),w.y-(m.y-v.y));this.setCenter(I==null?void 0:I.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(i,h){return h?this.coordinatePoint(a.a1.fromLngLat(i),h.getElevationForLngLatZoom(i,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(a.a1.fromLngLat(i))}screenPointToLocation(i,h){var p;return(p=this.screenPointToMercatorCoordinate(i,h))===null||p===void 0?void 0:p.toLngLat()}screenPointToMercatorCoordinate(i,h){if(h){const p=h.pointCoordinate(i);if(p!=null)return p}return this.screenPointToMercatorCoordinateAtZ(i)}screenPointToMercatorCoordinateAtZ(i,h){const p=h||0,m=[i.x,i.y,0,1],v=[i.x,i.y,1,1];a.aw(m,m,this._pixelMatrixInverse),a.aw(v,v,this._pixelMatrixInverse);const w=m[3],I=v[3],P=m[1]/w,k=v[1]/I,D=m[2]/w,z=v[2]/I,L=D===z?0:(p-D)/(z-D);return new a.a1(a.C.number(m[0]/w,v[0]/I,L)/this.worldSize,a.C.number(P,k,L)/this.worldSize,p)}coordinatePoint(i,h=0,p=this._pixelMatrix){const m=[i.x*this.worldSize,i.y*this.worldSize,h,1];return a.aw(m,m,p),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const i=Math.max(0,this._helper._height/2-pe(this));return new er().extend(this.screenPointToLocation(new a.P(0,i))).extend(this.screenPointToLocation(new a.P(this._helper._width,i))).extend(this.screenPointToLocation(new a.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new a.P(0,this._helper._height)))}isPointOnMapSurface(i,h){return h?h.pointCoordinate(i)!=null:i.y>this.height/2-pe(this)}calculatePosMatrix(i,h=!1,p){var m;const v=(m=i.key)!==null&&m!==void 0?m:a.b3(i.wrap,i.canonical.z,i.canonical.z,i.canonical.x,i.canonical.y),w=h?this._alignedPosMatrixCache:this._posMatrixCache;if(w.has(v)){const k=w.get(v);return p?k.f32:k.f64}const I=be(i,this.worldSize);a.O(I,h?this._alignedProjMatrix:this._viewProjMatrix,I);const P={f64:I,f32:new Float32Array(I)};return w.set(v,P),p?P.f32:P.f64}calculateFogMatrix(i){const h=i.key,p=this._fogMatrixCacheF32;if(p.has(h))return p.get(h);const m=be(i,this.worldSize);return a.O(m,this._fogMatrix,m),p.set(h,new Float32Array(m)),p.get(h)}getConstrained(i,h){h=a.ah(+h,this.minZoom,this.maxZoom);const p={center:new a.S(i.lng,i.lat),zoom:h};let m=this._helper._lngRange;if(!this._helper._renderWorldCopies&&m===null){const de=179.9999999999;m=[-de,de]}const v=this.tileSize*a.af(p.zoom);let w=0,I=v,P=0,k=v,D=0,z=0;const{x:L,y:U}=this.size;if(this._helper._latRange){const de=this._helper._latRange;w=a.U(de[1])*v,I=a.U(de[0])*v,I-w<U&&(D=U/(I-w))}m&&(P=a.aO(a.V(m[0])*v,0,v),k=a.aO(a.V(m[1])*v,0,v),k<P&&(k+=v),k-P<L&&(z=L/(k-P)));const{x:W,y:te}=K(v,i);let ee,ne;const ae=Math.max(z||0,D||0);if(ae){const de=new a.P(z?(k+P)/2:W,D?(I+w)/2:te);return p.center=se(v,de).wrap(),p.zoom+=a.ak(ae),p}if(this._helper._latRange){const de=U/2;te-de<w&&(ne=w+de),te+de>I&&(ne=I-de)}if(m){const de=(P+k)/2;let ue=W;this._helper._renderWorldCopies&&(ue=a.aO(W,de-v/2,de+v/2));const ge=L/2;ue-ge<P&&(ee=P+ge),ue+ge>k&&(ee=k-ge)}if(ee!==void 0||ne!==void 0){const de=new a.P(ee??W,ne??te);p.center=se(v,de).wrap()}return p}calculateCenterFromCameraLngLatAlt(i,h,p,m){return this._helper.calculateCenterFromCameraLngLatAlt(i,h,p,m)}_calculateNearFarZIfNeeded(i,h,p){if(!this._helper.autoCalculateNearFarZ)return;const m=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),v=i-m*this._helper._pixelPerMeter/Math.cos(h),w=m<0?v:i,I=Math.PI/2+this.pitchInRadians,P=a.ae(this.fov)*(Math.abs(Math.cos(a.ae(this.roll)))*this.height+Math.abs(Math.sin(a.ae(this.roll)))*this.width)/this.height*(.5+p.y/this.height),k=Math.sin(P)*w/Math.sin(a.ah(Math.PI-I-P,.01,Math.PI-.01)),D=pe(this),z=Math.atan(D/this._helper.cameraToCenterDistance),L=a.ae(.75),U=z>L?2*z*(.5+p.y/(2*D)):L,W=Math.sin(U)*w/Math.sin(a.ah(Math.PI-I-U,.01,Math.PI-.01)),te=Math.min(k,W);this._helper._farZ=1.01*(Math.cos(Math.PI/2-h)*te+w),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const i=this.centerOffset,h=K(this.worldSize,this.center),p=h.x,m=h.y;this._helper._pixelPerMeter=a.aj(1,this.center.lat)*this.worldSize;const v=a.ae(Math.min(this.pitch,H)),w=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(v));let I;this._calculateNearFarZIfNeeded(w,v,i),I=new Float64Array(16),a.b4(I,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),a.aq(this._invProjMatrix,I),I[8]=2*-i.x/this._helper._width,I[9]=2*i.y/this._helper._height,this._projectionMatrix=a.b5(I),a.N(I,I,[1,-1,1]),a.M(I,I,[0,0,-this._helper.cameraToCenterDistance]),a.b6(I,I,-this.rollInRadians),a.b7(I,I,this.pitchInRadians),a.b6(I,I,-this.bearingInRadians),a.M(I,I,[-p,-m,0]),this._mercatorMatrix=a.N([],I,[this.worldSize,this.worldSize,this.worldSize]),a.N(I,I,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,I),a.M(I,I,[0,0,-this.elevation]),this._viewProjMatrix=I,this._invViewProjMatrix=a.aq([],I);const P=[0,0,-1,1];a.aw(P,P,this._invViewProjMatrix),this._cameraPosition=[P[0]/P[3],P[1]/P[3],P[2]/P[3]],this._fogMatrix=new Float64Array(16),a.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,w,this._helper._farZ),this._fogMatrix[8]=2*-i.x/this.width,this._fogMatrix[9]=2*i.y/this.height,a.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),a.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),a.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),a.M(this._fogMatrix,this._fogMatrix,[-p,-m,0]),a.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,I);const k=this._helper._width%2/2,D=this._helper._height%2/2,z=Math.cos(this.bearingInRadians),L=Math.sin(-this.bearingInRadians),U=p-Math.round(p)+z*k+L*D,W=m-Math.round(m)+z*D+L*k,te=new Float64Array(I);if(a.M(te,te,[U>.5?U-1:U,W>.5?W-1:W,0]),this._alignedProjMatrix=te,I=a.aq(new Float64Array(16),this._pixelMatrix),!I)throw new Error("failed to invert matrix");this._pixelMatrixInverse=I,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const i=this.screenPointToMercatorCoordinate(new a.P(0,0)),h=[i.x*this.worldSize,i.y*this.worldSize,0,1];return a.aw(h,h,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const i=a.aj(1,this.center.lat)*this.worldSize;return Ie(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/i).toLngLat()}lngLatToCameraDepth(i,h){const p=a.a1.fromLngLat(i),m=[p.x*this.worldSize,p.y*this.worldSize,h,1];return a.aw(m,m,this._viewProjMatrix),m[2]/m[3]}getProjectionData(i){const{overscaledTileID:h,aligned:p,applyTerrainMatrix:m}=i,v=this._helper.getMercatorTileCoordinates(h),w=h?this.calculatePosMatrix(h,p,!0):null;let I;return I=h&&h.terrainRttPosMatrix32f&&m?h.terrainRttPosMatrix32f:w||a.b8(),{mainMatrix:I,tileMercatorCoords:v,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:I}}isLocationOccluded(i){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(i,h,p){return 1}transformLightDirection(i){return a.aT(i)}getRayDirectionFromPixel(i){throw new Error("Not implemented.")}projectTileCoordinates(i,h,p,m){const v=this.calculatePosMatrix(p);let w;m?(w=[i,h,m(i,h),1],a.aw(w,w,v)):(w=[i,h,0,1],Bs(w,w,v));const I=w[3];return{point:new a.P(w[0]/I,w[1]/I),signedDistanceFromCamera:I,isOccluded:!1}}populateCache(i){for(const h of i)this.calculatePosMatrix(h)}getMatrixForModel(i,h){const p=a.a1.fromLngLat(i,h),m=p.meterInMercatorCoordinateUnits(),v=a.b9();return a.M(v,v,[p.x,p.y,p.z]),a.b6(v,v,Math.PI),a.b7(v,v,Math.PI/2),a.N(v,v,[-m,m,m]),v}getProjectionDataForCustomLayer(i=!0){const h=new a.Z(0,0,0,0,0),p=this.getProjectionData({overscaledTileID:h,applyGlobeMatrix:i}),m=be(h,this.worldSize);a.O(m,this._viewProjMatrix,m),p.tileMercatorCoords=[0,0,1,1];const v=[a.$,a.$,this.worldSize/this._helper.pixelsPerMeter],w=a.ba();return a.N(w,m,v),p.fallbackMatrix=w,p.mainMatrix=w,p}getFastPathSimpleProjectionMatrix(i){return this.calculatePosMatrix(i)}}function Bp(){a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function mi(_){if(_.useSlerp)if(_.k<1){const i=a.bb(_.startEulerAngles.roll,_.startEulerAngles.pitch,_.startEulerAngles.bearing),h=a.bb(_.endEulerAngles.roll,_.endEulerAngles.pitch,_.endEulerAngles.bearing),p=new Float64Array(4);a.bc(p,i,h,_.k);const m=a.bd(p);_.tr.setRoll(m.roll),_.tr.setPitch(m.pitch),_.tr.setBearing(m.bearing)}else _.tr.setRoll(_.endEulerAngles.roll),_.tr.setPitch(_.endEulerAngles.pitch),_.tr.setBearing(_.endEulerAngles.bearing);else _.tr.setRoll(a.C.number(_.startEulerAngles.roll,_.endEulerAngles.roll,_.k)),_.tr.setPitch(a.C.number(_.startEulerAngles.pitch,_.endEulerAngles.pitch,_.k)),_.tr.setBearing(a.C.number(_.startEulerAngles.bearing,_.endEulerAngles.bearing,_.k))}function $i(_,i,h,p,m){const v=m.padding,w=K(m.worldSize,h.getNorthWest()),I=K(m.worldSize,h.getNorthEast()),P=K(m.worldSize,h.getSouthEast()),k=K(m.worldSize,h.getSouthWest()),D=a.ae(-p),z=w.rotate(D),L=I.rotate(D),U=P.rotate(D),W=k.rotate(D),te=new a.P(Math.max(z.x,L.x,W.x,U.x),Math.max(z.y,L.y,W.y,U.y)),ee=new a.P(Math.min(z.x,L.x,W.x,U.x),Math.min(z.y,L.y,W.y,U.y)),ne=te.sub(ee),ae=(m.width-(v.left+v.right+i.left+i.right))/ne.x,de=(m.height-(v.top+v.bottom+i.top+i.bottom))/ne.y;if(de<0||ae<0)return void Bp();const ue=Math.min(a.ak(m.scale*Math.min(ae,de)),_.maxZoom),ge=a.P.convert(_.offset),ye=new a.P((i.left-i.right)/2,(i.top-i.bottom)/2).rotate(a.ae(p)),he=ge.add(ye).mult(m.scale/a.af(ue));return{center:se(m.worldSize,w.add(P).div(2).sub(he)),zoom:ue,bearing:p}}class si{get useGlobeControls(){return!1}handlePanInertia(i,h){const p=i.mag(),m=Math.abs(pe(h));return{easingOffset:i.mult(Math.min(.75*m/p,1)),easingCenter:h.center}}handleMapControlsRollPitchBearingZoom(i,h){i.bearingDelta&&h.setBearing(h.bearing+i.bearingDelta),i.pitchDelta&&h.setPitch(h.pitch+i.pitchDelta),i.rollDelta&&h.setRoll(h.roll+i.rollDelta),i.zoomDelta&&h.setZoom(h.zoom+i.zoomDelta)}handleMapControlsPan(i,h,p){i.around.distSqr(h.centerPoint)<.01||h.setLocationAtPoint(p,i.around)}cameraForBoxAndBearing(i,h,p,m,v){return $i(i,h,p,m,v)}handleJumpToCenterZoom(i,h){i.zoom!==(h.zoom!==void 0?+h.zoom:i.zoom)&&i.setZoom(+h.zoom),h.center!==void 0&&i.setCenter(a.S.convert(h.center))}handleEaseTo(i,h){const p=i.zoom,m=i.padding,v={roll:i.roll,pitch:i.pitch,bearing:i.bearing},w={roll:h.roll===void 0?i.roll:h.roll,pitch:h.pitch===void 0?i.pitch:h.pitch,bearing:h.bearing===void 0?i.bearing:h.bearing},I=h.zoom!==void 0,P=!i.isPaddingEqual(h.padding);let k=!1;const D=I?+h.zoom:i.zoom;let z=i.centerPoint.add(h.offsetAsPoint);const L=i.screenPointToLocation(z),{center:U,zoom:W}=i.getConstrained(a.S.convert(h.center||L),D??p);cu(i,U);const te=K(i.worldSize,L),ee=K(i.worldSize,U).sub(te),ne=a.af(W-p);return k=W!==p,{easeFunc:ae=>{if(k&&i.setZoom(a.C.number(p,W,ae)),a.be(v,w)||mi({startEulerAngles:v,endEulerAngles:w,tr:i,k:ae,useSlerp:v.roll!=w.roll}),P&&(i.interpolatePadding(m,h.padding,ae),z=i.centerPoint.add(h.offsetAsPoint)),h.around)i.setLocationAtPoint(h.around,h.aroundPoint);else{const de=a.af(i.zoom-p),ue=W>p?Math.min(2,ne):Math.max(.5,ne),ge=Math.pow(ue,1-ae),ye=se(i.worldSize,te.add(ee.mult(ae*ge)).mult(de));i.setLocationAtPoint(i.renderWorldCopies?ye.wrap():ye,z)}},isZooming:k,elevationCenter:U}}handleFlyTo(i,h){const p=h.zoom!==void 0,m=i.zoom,v=i.getConstrained(a.S.convert(h.center||h.locationAtOffset),p?+h.zoom:m),w=v.center,I=v.zoom;cu(i,w);const P=K(i.worldSize,h.locationAtOffset),k=K(i.worldSize,w).sub(P),D=k.mag(),z=a.af(I-m);let L;if(h.minZoom!==void 0){const U=Math.min(+h.minZoom,m,I),W=i.getConstrained(w,U).zoom;L=a.af(W-m)}return{easeFunc:(U,W,te,ee)=>{i.setZoom(U===1?I:m+a.ak(W));const ne=U===1?w:se(i.worldSize,P.add(k.mult(te)).mult(W));i.setLocationAtPoint(i.renderWorldCopies?ne.wrap():ne,ee)},scaleOfZoom:z,targetCenter:w,scaleOfMinZoom:L,pixelPathLength:D}}}class Zr{constructor(i,h,p){this.blendFunction=i,this.blendColor=h,this.mask=p}}Zr.Replace=[1,0],Zr.disabled=new Zr(Zr.Replace,a.bf.transparent,[!1,!1,!1,!1]),Zr.unblended=new Zr(Zr.Replace,a.bf.transparent,[!0,!0,!0,!0]),Zr.alphaBlended=new Zr([1,771],a.bf.transparent,[!0,!0,!0,!0]);const la=2305;class Lt{constructor(i,h,p){this.enable=i,this.mode=h,this.frontFace=p}}Lt.disabled=new Lt(!1,1029,la),Lt.backCCW=new Lt(!0,1029,la),Lt.frontCCW=new Lt(!0,1028,la);class qt{constructor(i,h,p){this.func=i,this.mask=h,this.range=p}}qt.ReadOnly=!1,qt.ReadWrite=!0,qt.disabled=new qt(519,qt.ReadOnly,[0,1]);const oo=7680;class mr{constructor(i,h,p,m,v,w){this.test=i,this.ref=h,this.mask=p,this.fail=m,this.depthFail=v,this.pass=w}}mr.disabled=new mr({func:519,mask:0},0,0,oo,oo,oo);const Wi=new WeakMap;function Vs(_){var i;if(Wi.has(_))return Wi.get(_);{const h=(i=_.getParameter(_.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return Wi.set(_,h),h}}class js{get awaitingQuery(){return!!this._readbackQueue}constructor(i){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=i;const h=i.context,p=h.gl;this._texFormat=p.RGBA,this._texType=p.UNSIGNED_BYTE;const m=new a.aL;m.emplaceBack(-1,-1),m.emplaceBack(2,-1),m.emplaceBack(-1,2);const v=new a.aN;v.emplaceBack(0,1,2),this._fullscreenTriangle=new sa(h.createVertexBuffer(m,Do.members),h.createIndexBuffer(v),a.aM.simpleSegment(0,0,m.length,v.length)),this._resultBuffer=new Uint8Array(4),h.activeTexture.set(p.TEXTURE1);const w=p.createTexture();p.bindTexture(p.TEXTURE_2D,w),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texImage2D(p.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=h.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(w),Vs(p)&&(this._pbo=p.createBuffer(),p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.bufferData(p.PIXEL_PACK_BUFFER,4,p.STREAM_READ),p.bindBuffer(p.PIXEL_PACK_BUFFER,null))}destroy(){const i=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),i.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(i,h){const p=this._updateCount;return this._readbackQueue?p>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():p>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(i,h),this._updateCount++,this._measuredError}_bindFramebuffer(){const i=this._cachedRenderContext.context,h=i.gl;i.activeTexture.set(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,this._fbo.colorAttachment.get()),i.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(i,h){const p=this._cachedRenderContext.context,m=p.gl;if(this._bindFramebuffer(),p.viewport.set([0,0,this._texWidth,this._texHeight]),p.clear({color:a.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(p,m.TRIANGLES,qt.disabled,mr.disabled,Zr.unblended,Lt.disabled,((v,w)=>({u_input:v,u_output_expected:w}))(i,h),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Vs(m)){m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.readBuffer(m.COLOR_ATTACHMENT0),m.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),m.bindBuffer(m.PIXEL_PACK_BUFFER,null);const v=m.fenceSync(m.SYNC_GPU_COMMANDS_COMPLETE,0);m.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:v}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const i=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Vs(i)){const h=i.clientWaitSync(this._readbackQueue.sync,0,0);if(h===i.WAIT_FAILED)return a.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(h===i.TIMEOUT_EXPIRED)return;i.bindBuffer(i.PIXEL_PACK_BUFFER,this._pbo),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),i.bindBuffer(i.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),i.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=js._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(i){let h=0;return h+=i[0]/256,h+=i[1]/65536,h+=i[2]/16777216,i[3]<127&&(h=-h),h/128}}const hu=a.$/128;function ud(_,i){const h=_.granularity!==void 0?Math.max(_.granularity,1):1,p=h+(_.generateBorders?2:0),m=h+(_.extendToNorthPole||_.generateBorders?1:0)+(_.extendToSouthPole||_.generateBorders?1:0),v=p+1,w=m+1,I=_.generateBorders?-1:0,P=_.generateBorders||_.extendToNorthPole?-1:0,k=h+(_.generateBorders?1:0),D=h+(_.generateBorders||_.extendToSouthPole?1:0),z=v*w,L=p*m*6,U=v*w>65536;if(U&&i==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const W=U||i==="32bit",te=new Int16Array(2*z);let ee=0;for(let de=P;de<=D;de++)for(let ue=I;ue<=k;ue++){let ge=ue/h*a.$;ue===-1&&(ge=-hu),ue===h+1&&(ge=a.$+hu);let ye=de/h*a.$;de===-1&&(ye=_.extendToNorthPole?a.bh:-hu),de===h+1&&(ye=_.extendToSouthPole?a.bi:a.$+hu),te[ee++]=ge,te[ee++]=ye}const ne=W?new Uint32Array(L):new Uint16Array(L);let ae=0;for(let de=0;de<m;de++)for(let ue=0;ue<p;ue++){const ge=ue+1+de*v,ye=ue+(de+1)*v,he=ue+1+(de+1)*v;ne[ae++]=ue+de*v,ne[ae++]=ye,ne[ae++]=ge,ne[ae++]=ge,ne[ae++]=ye,ne[ae++]=he}return{vertices:te.buffer.slice(0),indices:ne.buffer.slice(0),uses32bitIndices:W}}const Xa=new a.aK({fill:new a.bj(128,2),line:new a.bj(512,0),tile:new a.bj(128,32),stencil:new a.bj(128,1),circle:3});class Ql{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return ji.projectionGlobe}get vertexShaderPreludeCode(){return ji.projectionMercator.vertexSource}get subdivisionGranularity(){return Xa}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(i){this._errorMeasurement||(this._errorMeasurement=new js(i));const h=a.U(this._errorQueryLatitudeDegrees),p=2*Math.atan(Math.exp(Math.PI-h*Math.PI*2))-.5*Math.PI,m=this._errorMeasurement.updateErrorLoop(h,p),v=F.now();m!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=m,this._errorMeasurementLastChangeTime=v);const w=Math.min(Math.max((v-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=a.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,a.bl(w))}_getMeshKey(i){return`${i.granularity.toString(36)}_${i.generateBorders?"b":""}${i.extendToNorthPole?"n":""}${i.extendToSouthPole?"s":""}`}getMeshFromTileID(i,h,p,m,v){const w=(v==="stencil"?Xa.stencil:Xa.tile).getGranularityForZoomLevel(h.z);return this._getMesh(i,{granularity:w,generateBorders:p,extendToNorthPole:h.y===0&&m,extendToSouthPole:h.y===(1<<h.z)-1&&m})}_getMesh(i,h){const p=this._getMeshKey(h);if(p in this._tileMeshCache)return this._tileMeshCache[p];const m=function(v,w){const I=ud(w,"16bit"),P=a.aL.deserialize({arrayBuffer:I.vertices,length:I.vertices.byteLength/2/2}),k=a.aN.deserialize({arrayBuffer:I.indices,length:I.indices.byteLength/2/3});return new sa(v.createVertexBuffer(P,Do.members),v.createIndexBuffer(k),a.aM.simpleSegment(0,0,P.length,k.length))}(i,h);return this._tileMeshCache[p]=m,m}recalculate(i){}hasTransition(){const i=F.now();let h=!1;return h=h||(i-this._errorMeasurementLastChangeTime)/1e3<.7,h=h||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,h}setErrorQueryLatitudeDegrees(i){this._errorQueryLatitudeDegrees=i}}const du=new a.r({type:new a.D(a.v.projection.type)});class fu extends a.E{constructor(i){super(),this._transitionable=new a.t(du),this.setProjection(i),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0)),this._mercatorProjection=new or,this._verticalPerspectiveProjection=new Ql}get transitionState(){const i=this.properties.get("type");if(typeof i=="string"&&i==="mercator")return 0;if(typeof i=="string"&&i==="vertical-perspective")return 1;if(i instanceof a.bm){if(i.from==="vertical-perspective"&&i.to==="mercator")return 1-i.transition;if(i.from==="mercator"&&i.to==="vertical-perspective")return i.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(i){this._mercatorProjection.updateGPUdependent(i),this._verticalPerspectiveProjection.updateGPUdependent(i)}getMeshFromTileID(i,h,p,m,v){return this.currentProjection.getMeshFromTileID(i,h,p,m,v)}setProjection(i){this._transitionable.setValue("type",(i==null?void 0:i.type)||"mercator")}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}setErrorQueryLatitudeDegrees(i){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(i),this._mercatorProjection.setErrorQueryLatitudeDegrees(i)}}function pu(_){const i=Za(_.worldSize,_.center.lat);return 2*Math.PI*i}function ps(_,i,h,p,m){const v=1/(1<<m),w=i/a.$*v+p*v,I=a.bo((_/a.$*v+h*v)*Math.PI*2+Math.PI,2*Math.PI),P=2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI,k=Math.cos(P),D=new Float64Array(3);return D[0]=Math.sin(I)*k,D[1]=Math.sin(P),D[2]=Math.cos(I)*k,D}function zn(_){return function(i,h){const p=Math.cos(h),m=new Float64Array(3);return m[0]=Math.sin(i)*p,m[1]=Math.sin(h),m[2]=Math.cos(i)*p,m}(_.lng*Math.PI/180,_.lat*Math.PI/180)}function Za(_,i){return _/(2*Math.PI)/Math.cos(i*Math.PI/180)}function Jl(_){const i=Math.asin(_[1])/Math.PI*180,h=Math.sqrt(_[0]*_[0]+_[2]*_[2]);if(h>1e-6){const p=_[0]/h,m=Math.acos(_[2]/h),v=(p>0?m:-m)/Math.PI*180;return new a.S(a.aO(v,-180,180),i)}return new a.S(0,i)}function ca(_){return Math.cos(_*Math.PI/180)}function hn(_,i){const h=ca(_),p=ca(i);return a.ak(p/h)}function Up(_,i){const h=_.rotate(i.bearingInRadians),p=i.zoom+hn(i.center.lat,0),m=a.bk(1/ca(i.center.lat),1/ca(Math.min(Math.abs(i.center.lat),60)),a.bn(p,7,3,0,1)),v=360/pu({worldSize:i.worldSize,center:{lat:i.center.lat}});return new a.S(i.center.lng-h.x*v*m,a.ah(i.center.lat+h.y*v,-a.ai,a.ai))}function ec(_){const i=.5*_,h=Math.sin(i),p=Math.cos(i);return Math.log(h+p)-Math.log(p-h)}function hd(_,i,h,p){const m=_.lat+h*p;if(Math.abs(h)>1){const v=(Math.sign(_.lat+h)!==Math.sign(_.lat)?-Math.abs(_.lat):Math.abs(_.lat))*Math.PI/180,w=Math.abs(_.lat+h)*Math.PI/180,I=ec(v+p*(w-v)),P=ec(v),k=ec(w);return new a.S(_.lng+i*((I-P)/(k-P)),m)}return new a.S(_.lng+i*p,m)}class Py{constructor(i){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=i}swapBuffers(){if(!this._hadAnyChanges)return;const i=this._cachePrevious;this._cachePrevious=this._cache,this._cache=i,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(i,h,p,m){const v=`${i.z}_${i.x}_${i.y}_${m!=null&&m.terrain?"t":""}`,w=this._cache.get(v);if(w)return w;const I=this._cachePrevious.get(v);if(I)return this._cache.set(v,I),I;const P=this._boundingVolumeFactory(i,h,p,m);return this._cache.set(v,P),this._hadAnyChanges=!0,P}}class qa{constructor(i,h,p,m){this.min=p,this.max=m,this.points=i,this.planes=h}static fromAabb(i,h){const p=[];for(let m=0;m<8;m++)p.push([1&~m?i[0]:h[0],(m>>1&1)==1?h[1]:i[1],(m>>2&1)==1?h[2]:i[2]]);return new qa(p,[[-1,0,0,h[0]],[1,0,0,-i[0]],[0,-1,0,h[1]],[0,1,0,-i[1]],[0,0,-1,h[2]],[0,0,1,-i[2]]],i,h)}static fromCenterSizeAngles(i,h,p){const m=a.br([],p[0],p[1],p[2]),v=a.bs([],[h[0],0,0],m),w=a.bs([],[0,h[1],0],m),I=a.bs([],[0,0,h[2]],m),P=[...i],k=[...i];for(let z=0;z<8;z++)for(let L=0;L<3;L++){const U=i[L]+v[L]*(1&~z?-1:1)+w[L]*((z>>1&1)==1?1:-1)+I[L]*((z>>2&1)==1?1:-1);P[L]=Math.min(P[L],U),k[L]=Math.max(k[L],U)}const D=[];for(let z=0;z<8;z++){const L=[...i];a.aS(L,L,a.aR([],v,1&~z?-1:1)),a.aS(L,L,a.aR([],w,(z>>1&1)==1?1:-1)),a.aS(L,L,a.aR([],I,(z>>2&1)==1?1:-1)),D.push(L)}return new qa(D,[[...v,-a.aX(v,D[0])],[...w,-a.aX(w,D[0])],[...I,-a.aX(I,D[0])],[-v[0],-v[1],-v[2],-a.aX(v,D[7])],[-w[0],-w[1],-w[2],-a.aX(w,D[7])],[-I[0],-I[1],-I[2],-a.aX(I,D[7])]],P,k)}intersectsFrustum(i){let h=!0;const p=this.points.length,m=this.planes.length,v=i.planes.length,w=i.points.length;for(let I=0;I<v;I++){const P=i.planes[I];let k=0;for(let D=0;D<p;D++){const z=this.points[D];P[0]*z[0]+P[1]*z[1]+P[2]*z[2]+P[3]>=0&&k++}if(k===0)return 0;k<p&&(h=!1)}if(h)return 2;for(let I=0;I<m;I++){const P=this.planes[I];let k=0;for(let D=0;D<w;D++){const z=i.points[D];P[0]*z[0]+P[1]*z[1]+P[2]*z[2]+P[3]>=0&&k++}if(k===0)return 0}return 1}intersectsPlane(i){const h=this.points.length;let p=0;for(let m=0;m<h;m++){const v=this.points[m];i[0]*v[0]+i[1]*v[1]+i[2]*v[2]+i[3]>=0&&p++}return p===h?2:p===0?0:1}}function Yn(_,i,h){const p=_-i;return p<0?-p:Math.max(0,p-h)}function tc(_,i,h,p,m){const v=_-h;let w;return w=v<0?Math.min(-v,1+v-m):v>1?Math.min(Math.max(v-m,0),1-v):0,Math.max(w,Yn(i,p,m))}class $s{constructor(){this._boundingVolumeCache=new Py(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(i,h,p,m){const v=1<<p.z,w=1/v,I=p.x/v,P=p.y/v;let k=2;return k=Math.min(k,tc(i,h,I,P,w)),k=Math.min(k,tc(i,h,I+.5,-P-w,w)),k=Math.min(k,tc(i,h,I+.5,2-P-w,w)),k}getWrap(i,h,p){const m=1<<h.z,v=1/m,w=h.x/m,I=Yn(i.x,w,v),P=Yn(i.x,w-1,v),k=Yn(i.x,w+1,v),D=Math.min(I,P,k);return D===k?1:D===P?-1:0}allowVariableZoom(i,h){return ft(i,h)>4}allowWorldCopies(){return!1}getTileBoundingVolume(i,h,p,m){return this._boundingVolumeCache.getTileBoundingVolume(i,h,p,m)}_computeTileBoundingVolume(i,h,p,m){var v,w;let I=0,P=0;if(m!=null&&m.terrain){const k=new a.Z(i.z,h,i.z,i.x,i.y),D=m.terrain.getMinMaxElevation(k);I=(v=D.minElevation)!==null&&v!==void 0?v:Math.min(0,p),P=(w=D.maxElevation)!==null&&w!==void 0?w:Math.max(0,p)}if(I/=a.bu,P/=a.bu,I+=1,P+=1,i.z<=0)return qa.fromAabb([-P,-P,-P],[P,P,P]);if(i.z===1)return qa.fromAabb([i.x===0?-P:0,i.y===0?0:-P,-P],[i.x===0?0:P,i.y===0?P:0,P]);{const k=[ps(0,0,i.x,i.y,i.z),ps(a.$,0,i.x,i.y,i.z),ps(a.$,a.$,i.x,i.y,i.z),ps(0,a.$,i.x,i.y,i.z)],D=[];for(const De of k)D.push(a.aR([],De,P));if(P!==I)for(const De of k)D.push(a.aR([],De,I));i.y===0&&D.push([0,1,0]),i.y===(1<<i.z)-1&&D.push([0,-1,0]);const z=[1,1,1],L=[-1,-1,-1];for(const De of D)for(let Ne=0;Ne<3;Ne++)z[Ne]=Math.min(z[Ne],De[Ne]),L[Ne]=Math.max(L[Ne],De[Ne]);const U=ps(a.$/2,a.$/2,i.x,i.y,i.z),W=a.aW([],[0,1,0],U);a.aV(W,W);const te=a.aW([],U,W);a.aV(te,te);const ee=a.aW([],k[2],k[1]);a.aV(ee,ee);const ne=a.aW([],k[0],k[3]);a.aV(ne,ne),D.push(a.aR([],U,P)),i.y>=(1<<i.z)/2&&D.push(a.aR([],ps(a.$/2,0,i.x,i.y,i.z),P)),i.y<(1<<i.z)/2&&D.push(a.aR([],ps(a.$/2,a.$,i.x,i.y,i.z),P));const ae=rc(U,D),de=rc(te,D),ue=[-U[0],-U[1],-U[2],ae.max],ge=[U[0],U[1],U[2],-ae.min],ye=[-te[0],-te[1],-te[2],de.max],he=[te[0],te[1],te[2],-de.min],Ee=[...ee,0],Le=[...ne,0],ke=[];return i.y===0?ke.push(a.bt(Le,Ee,ue),a.bt(Le,Ee,ge)):ke.push(a.bt(ye,Ee,ue),a.bt(ye,Ee,ge),a.bt(ye,Le,ue),a.bt(ye,Le,ge)),i.y===(1<<i.z)-1?ke.push(a.bt(Le,Ee,ue),a.bt(Le,Ee,ge)):ke.push(a.bt(he,Ee,ue),a.bt(he,Ee,ge),a.bt(he,Le,ue),a.bt(he,Le,ge)),new qa(ke,[ue,ge,ye,he,Ee,Le],z,L)}}}function rc(_,i){let h=1/0,p=-1/0;for(const m of i){const v=a.aX(_,m);h=Math.min(h,v),p=Math.max(p,v)}return{min:h,max:p}}class nc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,h,p){return this._helper.interpolatePadding(i,h,p)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,h){this._helper.resize(i,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}overrideNearFarZ(i,h){this._helper.overrideNearFarZ(i,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(i){}constructor(){this._cachedClippingPlane=a.bv(),this._projectionMatrix=a.b9(),this._globeViewProjMatrix32f=a.b8(),this._globeViewProjMatrixNoCorrection=a.b9(),this._globeViewProjMatrixNoCorrectionInverted=a.b9(),this._globeProjMatrixInverted=a.b9(),this._cameraPosition=a.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new pi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(i,h)=>this.getConstrained(i,h)}),this._coveringTilesDetailsProvider=new $s}clone(){const i=new nc;return i.apply(this),i}apply(i,h){this._globeLatitudeErrorCorrectionRadians=h||0,this._helper.apply(i)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const i=a.bp();return i[0]=this._cameraPosition[0],i[1]=this._cameraPosition[1],i[2]=this._cameraPosition[2],i}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(i){const{overscaledTileID:h,applyGlobeMatrix:p}=i,m=this._helper.getMercatorTileCoordinates(h);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:m,clippingPlane:this._cachedClippingPlane,projectionTransition:p?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(i){const h=this.pitchInRadians,p=this.cameraToCenterDistance/i,m=Math.sin(h)*p,v=Math.cos(h)*p+1,w=1/Math.sqrt(m*m+v*v)*1;let I=-m,P=v;const k=Math.sqrt(I*I+P*P);I/=k,P/=k;const D=[0,I,P];a.bw(D,D,[0,0,0],-this.bearingInRadians),a.bx(D,D,[0,0,0],-1*this.center.lat*Math.PI/180),a.by(D,D,[0,0,0],this.center.lng*Math.PI/180);const z=1/a.aZ(D);return a.aR(D,D,z),[...D,-w*z]}isLocationOccluded(i){return!this.isSurfacePointVisible(zn(i))}transformLightDirection(i){const h=this._helper._center.lng*Math.PI/180,p=this._helper._center.lat*Math.PI/180,m=Math.cos(p),v=[Math.sin(h)*m,Math.sin(p),Math.cos(h)*m],w=[v[2],0,-v[0]],I=[0,0,0];a.aW(I,w,v),a.aV(w,w),a.aV(I,I);const P=[0,0,0];return a.aV(P,[w[0]*i[0]+I[0]*i[1]+v[0]*i[2],w[1]*i[0]+I[1]*i[1]+v[1]*i[2],w[2]*i[0]+I[2]*i[1]+v[2]*i[2]]),P}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(i,h,p){const m=function(I,P,k){const D=1/(1<<k.z);return new a.a1(I/a.$*D+k.x*D,P/a.$*D+k.y*D)}(i,h,p.canonical),v=(w=m.y,[a.bo(m.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI]);var w;return this.getCircleRadiusCorrection()/Math.cos(v[1])}projectTileCoordinates(i,h,p,m){const v=p.canonical,w=ps(i,h,v.x,v.y,v.z),I=1+(m?m(i,h):0)/a.bu,P=[w[0]*I,w[1]*I,w[2]*I,1];a.aw(P,P,this._globeViewProjMatrixNoCorrection);const k=this._cachedClippingPlane,D=k[0]*w[0]+k[1]*w[1]+k[2]*w[2]+k[3]<0;return{point:new a.P(P[0]/P[3],P[1]/P[3]),signedDistanceFromCamera:P[3],isOccluded:D}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const i=Za(this.worldSize,this.center.lat),h=a.ba(),p=a.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*i),a.b4(h,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const m=this.centerOffset;h[8]=2*-m.x/this._helper._width,h[9]=2*m.y/this._helper._height,this._projectionMatrix=a.b5(h),this._globeProjMatrixInverted=a.ba(),a.aq(this._globeProjMatrixInverted,h),a.M(h,h,[0,0,-this.cameraToCenterDistance]),a.b6(h,h,this.rollInRadians),a.b7(h,h,-this.pitchInRadians),a.b6(h,h,this.bearingInRadians),a.M(h,h,[0,0,-i]);const v=a.bp();v[0]=i,v[1]=i,v[2]=i,a.b7(p,h,this.center.lat*Math.PI/180),a.bz(p,p,-this.center.lng*Math.PI/180),a.N(p,p,v),this._globeViewProjMatrixNoCorrection=p,a.b7(h,h,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),a.bz(h,h,-this.center.lng*Math.PI/180),a.N(h,h,v),this._globeViewProjMatrix32f=new Float32Array(h),this._globeViewProjMatrixNoCorrectionInverted=a.ba(),a.aq(this._globeViewProjMatrixNoCorrectionInverted,p);const w=a.bp();this._cameraPosition=a.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/i,a.bw(this._cameraPosition,this._cameraPosition,w,-this.rollInRadians),a.bx(this._cameraPosition,this._cameraPosition,w,this.pitchInRadians),a.bw(this._cameraPosition,this._cameraPosition,w,-this.bearingInRadians),a.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),a.bx(this._cameraPosition,this._cameraPosition,w,-this.center.lat*Math.PI/180),a.by(this._cameraPosition,this._cameraPosition,w,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(i);const I=a.b5(this._globeViewProjMatrixNoCorrectionInverted);a.N(I,I,[1,1,-1]),this._cachedFrustum=Sn.fromInvProjectionMatrix(I,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(i){a.w("calculateFogMatrix is not supported on globe projection.");const h=a.ba();return a.ag(h),h}getVisibleUnwrappedCoordinates(i){return[new a.b2(0,i)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(i){i&&a.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(i,h){if(!this._globeViewProjMatrixNoCorrection)return 1;const p=zn(i);a.aR(p,p,1+h/a.bu);const m=a.bv();return a.aw(m,[p[0],p[1],p[2],1],this._globeViewProjMatrixNoCorrection),m[2]/m[3]}populateCache(i){}getBounds(){const i=.5*this.width,h=.5*this.height,p=[new a.P(0,0),new a.P(i,0),new a.P(this.width,0),new a.P(this.width,h),new a.P(this.width,this.height),new a.P(i,this.height),new a.P(0,this.height),new a.P(0,h)],m=[];for(const z of p)m.push(this.unprojectScreenPoint(z));let v=0,w=0,I=0,P=0;const k=this.center;for(const z of m){const L=a.bA(k.lng,z.lng),U=a.bA(k.lat,z.lat);L<w&&(w=L),L>v&&(v=L),U<P&&(P=U),U>I&&(I=U)}const D=[k.lng+w,k.lat+P,k.lng+v,k.lat+I];return this.isSurfacePointOnScreen([0,1,0])&&(D[3]=90,D[0]=-180,D[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(D[1]=-90,D[0]=-180,D[2]=180),new er(D)}getConstrained(i,h){const p=a.ah(i.lat,-a.ai,a.ai),m=a.ah(+h,this.minZoom+hn(0,p),this.maxZoom);return{center:new a.S(i.lng,p),zoom:m}}calculateCenterFromCameraLngLatAlt(i,h,p,m){return this._helper.calculateCenterFromCameraLngLatAlt(i,h,p,m)}setLocationAtPoint(i,h){const p=zn(this.unprojectScreenPoint(h)),m=zn(i),v=a.bp();a.bB(v);const w=a.bp();a.by(w,p,v,-this.center.lng*Math.PI/180),a.bx(w,w,v,this.center.lat*Math.PI/180);const I=m[0]*m[0]+m[2]*m[2],P=w[0]*w[0];if(I<P)return;const k=Math.sqrt(I-P),D=-k,z=a.bC(m[0],m[2],w[0],k),L=a.bC(m[0],m[2],w[0],D),U=a.bp();a.by(U,m,v,-z);const W=a.bC(U[1],U[2],w[1],w[2]),te=a.bp();a.by(te,m,v,-L);const ee=a.bC(te[1],te[2],w[1],w[2]),ne=.5*Math.PI,ae=W>=-ne&&W<=ne,de=ee>=-ne&&ee<=ne;let ue,ge;if(ae&&de){const Le=this.center.lng*Math.PI/180,ke=this.center.lat*Math.PI/180;a.bD(z,Le)+a.bD(W,ke)<a.bD(L,Le)+a.bD(ee,ke)?(ue=z,ge=W):(ue=L,ge=ee)}else if(ae)ue=z,ge=W;else{if(!de)return;ue=L,ge=ee}const ye=ue/Math.PI*180,he=ge/Math.PI*180,Ee=this.center.lat;this.setCenter(new a.S(ye,a.ah(he,-90,90))),this.setZoom(this.zoom+hn(Ee,this.center.lat))}locationToScreenPoint(i,h){const p=zn(i);if(h){const m=h.getElevationForLngLatZoom(i,this._helper._tileZoom);a.aR(p,p,1+m/a.bu)}return this._projectSurfacePointToScreen(p)}_projectSurfacePointToScreen(i){const h=a.bv();return a.aw(h,[...i,1],this._globeViewProjMatrixNoCorrection),h[0]/=h[3],h[1]/=h[3],new a.P((.5*h[0]+.5)*this.width,(.5*-h[1]+.5)*this.height)}screenPointToMercatorCoordinate(i,h){if(h){const p=h.pointCoordinate(i);if(p)return p}return a.a1.fromLngLat(this.unprojectScreenPoint(i))}screenPointToLocation(i,h){var p;return(p=this.screenPointToMercatorCoordinate(i,h))===null||p===void 0?void 0:p.toLngLat()}isPointOnMapSurface(i,h){const p=this._cameraPosition,m=this.getRayDirectionFromPixel(i);return!!this.rayPlanetIntersection(p,m)}getRayDirectionFromPixel(i){const h=a.bv();h[0]=i.x/this.width*2-1,h[1]=-1*(i.y/this.height*2-1),h[2]=1,h[3]=1,a.aw(h,h,this._globeViewProjMatrixNoCorrectionInverted),h[0]/=h[3],h[1]/=h[3],h[2]/=h[3];const p=a.bp();p[0]=h[0]-this._cameraPosition[0],p[1]=h[1]-this._cameraPosition[1],p[2]=h[2]-this._cameraPosition[2];const m=a.bp();return a.aV(m,p),m}isSurfacePointVisible(i){const h=this._cachedClippingPlane;return h[0]*i[0]+h[1]*i[1]+h[2]*i[2]+h[3]>=0}isSurfacePointOnScreen(i){if(!this.isSurfacePointVisible(i))return!1;const h=a.bv();return a.aw(h,[...i,1],this._globeViewProjMatrixNoCorrection),h[0]/=h[3],h[1]/=h[3],h[2]/=h[3],h[0]>-1&&h[0]<1&&h[1]>-1&&h[1]<1&&h[2]>-1&&h[2]<1}rayPlanetIntersection(i,h){const p=a.aX(i,h),m=a.bp(),v=a.bp();a.aR(v,h,p),a.aU(m,i,v);const w=1-a.aX(m,m);if(w<0)return null;const I=a.aX(i,i)-1,P=-p+(p<0?1:-1)*Math.sqrt(w),k=I/P,D=P;return{tMin:Math.min(k,D),tMax:Math.max(k,D)}}unprojectScreenPoint(i){const h=this._cameraPosition,p=this.getRayDirectionFromPixel(i),m=this.rayPlanetIntersection(h,p);if(m){const D=a.bp();a.aS(D,h,[p[0]*m.tMin,p[1]*m.tMin,p[2]*m.tMin]);const z=a.bp();return a.aV(z,D),Jl(z)}const v=this._cachedClippingPlane,w=v[0]*p[0]+v[1]*p[1]+v[2]*p[2],I=-a.b1(v,h)/w,P=a.bp();if(I>0)a.aS(P,h,[p[0]*I,p[1]*I,p[2]*I]);else{const D=a.bp();a.aS(D,h,[2*p[0],2*p[1],2*p[2]]);const z=a.b1(this._cachedClippingPlane,D);a.aU(P,D,[this._cachedClippingPlane[0]*z,this._cachedClippingPlane[1]*z,this._cachedClippingPlane[2]*z])}const k=function(D){const z=a.bp();return z[0]=D[0]*-D[3],z[1]=D[1]*-D[3],z[2]=D[2]*-D[3],{center:z,radius:Math.sqrt(1-D[3]*D[3])}}(v);return Jl(function(D,z,L){const U=a.bp();a.aU(U,L,D);const W=a.bp();return a.bq(W,D,U,z/a.a$(U)),W}(k.center,k.radius,P))}getMatrixForModel(i,h){const p=a.S.convert(i),m=1/a.bu,v=a.b9();return a.bz(v,v,p.lng/180*Math.PI),a.b7(v,v,-p.lat/180*Math.PI),a.M(v,v,[0,0,1+h/a.bu]),a.b7(v,v,.5*Math.PI),a.N(v,v,[m,m,m]),v}getProjectionDataForCustomLayer(i=!0){const h=this.getProjectionData({overscaledTileID:new a.Z(0,0,0,0,0),applyGlobeMatrix:i});return h.tileMercatorCoords=[0,0,1,1],h}getFastPathSimpleProjectionMatrix(i){}}class ic{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,h,p){return this._helper.interpolatePadding(i,h,p)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,h,p=!0){this._helper.resize(i,h,p)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}overrideNearFarZ(i,h){this._helper.overrideNearFarZ(i,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(i,h){this._globeness=i,this._globeLatitudeErrorCorrectionRadians=h,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new pi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(i,h)=>this.getConstrained(i,h)}),this._globeness=1,this._mercatorTransform=new Vr,this._verticalPerspectiveTransform=new nc}clone(){const i=new ic;return i._globeness=this._globeness,i._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,i.apply(this),i}apply(i){this._helper.apply(i),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(i){const h=this._mercatorTransform.getProjectionData(i),p=this._verticalPerspectiveTransform.getProjectionData(i);return{mainMatrix:this.isGlobeRendering?p.mainMatrix:h.mainMatrix,clippingPlane:p.clippingPlane,tileMercatorCoords:p.tileMercatorCoords,projectionTransition:i.applyGlobeMatrix?this._globeness:0,fallbackMatrix:h.fallbackMatrix}}isLocationOccluded(i){return this.currentTransform.isLocationOccluded(i)}transformLightDirection(i){return this.currentTransform.transformLightDirection(i)}getPixelScale(){return a.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return a.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(i,h,p){const m=this._mercatorTransform.getPitchedTextCorrection(i,h,p),v=this._verticalPerspectiveTransform.getPitchedTextCorrection(i,h,p);return a.bk(m,v,this._globeness)}projectTileCoordinates(i,h,p,m){return this.currentTransform.projectTileCoordinates(i,h,p,m)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(i){return this.currentTransform.calculateFogMatrix(i)}getVisibleUnwrappedCoordinates(i){return this.currentTransform.getVisibleUnwrappedCoordinates(i)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(i){this._mercatorTransform.recalculateZoomAndCenter(i),this._verticalPerspectiveTransform.recalculateZoomAndCenter(i)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(i,h){return this.currentTransform.lngLatToCameraDepth(i,h)}populateCache(i){this._mercatorTransform.populateCache(i),this._verticalPerspectiveTransform.populateCache(i)}getBounds(){return this.currentTransform.getBounds()}getConstrained(i,h){return this.currentTransform.getConstrained(i,h)}calculateCenterFromCameraLngLatAlt(i,h,p,m){return this._helper.calculateCenterFromCameraLngLatAlt(i,h,p,m)}setLocationAtPoint(i,h){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(i,h),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(i,h),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(i,h){return this.currentTransform.locationToScreenPoint(i,h)}screenPointToMercatorCoordinate(i,h){return this.currentTransform.screenPointToMercatorCoordinate(i,h)}screenPointToLocation(i,h){return this.currentTransform.screenPointToLocation(i,h)}isPointOnMapSurface(i,h){return this.currentTransform.isPointOnMapSurface(i,h)}getRayDirectionFromPixel(i){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(i)}getMatrixForModel(i,h){return this.currentTransform.getMatrixForModel(i,h)}getProjectionDataForCustomLayer(i=!0){const h=this._mercatorTransform.getProjectionDataForCustomLayer(i);if(!this.isGlobeRendering)return h;const p=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(i);return p.fallbackMatrix=h.mainMatrix,p}getFastPathSimpleProjectionMatrix(i){return this.currentTransform.getFastPathSimpleProjectionMatrix(i)}}class oi{get useGlobeControls(){return!0}handlePanInertia(i,h){const p=Up(i,h);return Math.abs(p.lng-h.center.lng)>180&&(p.lng=h.center.lng+179.5*Math.sign(p.lng-h.center.lng)),{easingCenter:p,easingOffset:new a.P(0,0)}}handleMapControlsRollPitchBearingZoom(i,h){const p=i.around,m=h.screenPointToLocation(p);i.bearingDelta&&h.setBearing(h.bearing+i.bearingDelta),i.pitchDelta&&h.setPitch(h.pitch+i.pitchDelta),i.rollDelta&&h.setRoll(h.roll+i.rollDelta);const v=h.zoom;i.zoomDelta&&h.setZoom(h.zoom+i.zoomDelta);const w=h.zoom-v;if(w===0)return;const I=a.bA(h.center.lng,m.lng),P=I/(Math.abs(I/180)+1),k=a.bA(h.center.lat,m.lat),D=h.getRayDirectionFromPixel(p),z=h.cameraPosition,L=-1*a.aX(z,D),U=a.bp();a.aS(U,z,[D[0]*L,D[1]*L,D[2]*L]);const W=a.aZ(U)-1,te=Math.exp(.5*-Math.max(W-.3,0)),ee=Za(h.worldSize,h.center.lat)/Math.min(h.width,h.height),ne=a.bn(ee,.9,.5,1,.25),ae=(1-a.af(-w))*Math.min(te,ne),de=h.center.lat,ue=h.zoom,ge=new a.S(h.center.lng+P*ae,a.ah(h.center.lat+k*ae,-a.ai,a.ai));h.setLocationAtPoint(m,p);const ye=h.center,he=a.bn(Math.abs(I),45,85,0,1),Ee=a.bn(ee,.75,.35,0,1),Le=Math.pow(Math.max(he,Ee),.25),ke=a.bA(ye.lng,ge.lng),De=a.bA(ye.lat,ge.lat);h.setCenter(new a.S(ye.lng+ke*Le,ye.lat+De*Le).wrap()),h.setZoom(ue+hn(de,h.center.lat))}handleMapControlsPan(i,h,p){if(!i.panDelta)return;const m=h.center.lat,v=h.zoom;h.setCenter(Up(i.panDelta,h).wrap()),h.setZoom(v+hn(m,h.center.lat))}cameraForBoxAndBearing(i,h,p,m,v){const w=$i(i,h,p,m,v),I=h.left/v.width*2-1,P=(v.width-h.right)/v.width*2-1,k=h.top/v.height*-2+1,D=(v.height-h.bottom)/v.height*-2+1,z=a.bA(p.getWest(),p.getEast())<0,L=z?p.getEast():p.getWest(),U=z?p.getWest():p.getEast(),W=Math.max(p.getNorth(),p.getSouth()),te=Math.min(p.getNorth(),p.getSouth()),ee=L+.5*a.bA(L,U),ne=W+.5*a.bA(W,te),ae=v.clone();ae.setCenter(w.center),ae.setBearing(w.bearing),ae.setPitch(0),ae.setRoll(0),ae.setZoom(w.zoom);const de=ae.modelViewProjectionMatrix,ue=[zn(p.getNorthWest()),zn(p.getNorthEast()),zn(p.getSouthWest()),zn(p.getSouthEast()),zn(new a.S(U,ne)),zn(new a.S(L,ne)),zn(new a.S(ee,W)),zn(new a.S(ee,te))],ge=zn(w.center);let ye=Number.POSITIVE_INFINITY;for(const he of ue)I<0&&(ye=oi.getLesserNonNegativeNonNull(ye,oi.solveVectorScale(he,ge,de,"x",I))),P>0&&(ye=oi.getLesserNonNegativeNonNull(ye,oi.solveVectorScale(he,ge,de,"x",P))),k>0&&(ye=oi.getLesserNonNegativeNonNull(ye,oi.solveVectorScale(he,ge,de,"y",k))),D<0&&(ye=oi.getLesserNonNegativeNonNull(ye,oi.solveVectorScale(he,ge,de,"y",D)));if(Number.isFinite(ye)&&ye!==0)return w.zoom=ae.zoom+a.ak(ye),w;Bp()}handleJumpToCenterZoom(i,h){const p=i.center.lat,m=i.getConstrained(h.center?a.S.convert(h.center):i.center,i.zoom).center;i.setCenter(m.wrap());const v=h.zoom!==void 0?+h.zoom:i.zoom+hn(p,m.lat);i.zoom!==v&&i.setZoom(v)}handleEaseTo(i,h){const p=i.zoom,m=i.center,v=i.padding,w={roll:i.roll,pitch:i.pitch,bearing:i.bearing},I={roll:h.roll===void 0?i.roll:h.roll,pitch:h.pitch===void 0?i.pitch:h.pitch,bearing:h.bearing===void 0?i.bearing:h.bearing},P=h.zoom!==void 0,k=!i.isPaddingEqual(h.padding);let D=!1;const z=h.center?a.S.convert(h.center):m,L=i.getConstrained(z,p).center;cu(i,L);const U=i.clone();U.setCenter(L),U.setZoom(P?+h.zoom:p+hn(m.lat,z.lat)),U.setBearing(h.bearing);const W=new a.P(a.ah(i.centerPoint.x+h.offsetAsPoint.x,0,i.width),a.ah(i.centerPoint.y+h.offsetAsPoint.y,0,i.height));U.setLocationAtPoint(L,W);const te=(h.offset&&h.offsetAsPoint.mag())>0?U.center:L,ee=P?+h.zoom:p+hn(m.lat,te.lat),ne=p+hn(m.lat,0),ae=ee+hn(te.lat,0),de=a.bA(m.lng,te.lng),ue=a.bA(m.lat,te.lat),ge=a.af(ae-ne);return D=ee!==p,{easeFunc:ye=>{if(a.be(w,I)||mi({startEulerAngles:w,endEulerAngles:I,tr:i,k:ye,useSlerp:w.roll!=I.roll}),k&&i.interpolatePadding(v,h.padding,ye),h.around)a.w("Easing around a point is not supported under globe projection."),i.setLocationAtPoint(h.around,h.aroundPoint);else{const he=ae>ne?Math.min(2,ge):Math.max(.5,ge),Ee=Math.pow(he,1-ye),Le=hd(m,de,ue,ye*Ee);i.setCenter(Le.wrap())}if(D){const he=a.C.number(ne,ae,ye)+hn(0,i.center.lat);i.setZoom(he)}},isZooming:D,elevationCenter:te}}handleFlyTo(i,h){const p=h.zoom!==void 0,m=i.center,v=i.zoom,w=i.padding,I=!i.isPaddingEqual(h.padding),P=i.getConstrained(a.S.convert(h.center||h.locationAtOffset),v).center,k=p?+h.zoom:i.zoom+hn(i.center.lat,P.lat),D=i.clone();D.setCenter(P),D.setZoom(k),D.setBearing(h.bearing);const z=new a.P(a.ah(i.centerPoint.x+h.offsetAsPoint.x,0,i.width),a.ah(i.centerPoint.y+h.offsetAsPoint.y,0,i.height));D.setLocationAtPoint(P,z);const L=D.center;cu(i,L);const U=function(ue,ge,ye){const he=zn(ge),Ee=zn(ye),Le=a.aX(he,Ee),ke=Math.acos(Le),De=pu(ue);return ke/(2*Math.PI)*De}(i,m,L),W=v+hn(m.lat,0),te=k+hn(L.lat,0),ee=a.af(te-W);let ne;if(typeof h.minZoom=="number"){const ue=+h.minZoom+hn(L.lat,0),ge=Math.min(ue,W,te)+hn(0,L.lat),ye=i.getConstrained(L,ge).zoom+hn(L.lat,0);ne=a.af(ye-W)}const ae=a.bA(m.lng,L.lng),de=a.bA(m.lat,L.lat);return{easeFunc:(ue,ge,ye,he)=>{const Ee=hd(m,ae,de,ye);I&&i.interpolatePadding(w,h.padding,ue);const Le=ue===1?L:Ee;i.setCenter(Le.wrap());const ke=W+a.ak(ge);i.setZoom(ue===1?k:ke+hn(0,Le.lat))},scaleOfZoom:ee,targetCenter:L,scaleOfMinZoom:ne,pixelPathLength:U}}static solveVectorScale(i,h,p,m,v){const w=m==="x"?[p[0],p[4],p[8],p[12]]:[p[1],p[5],p[9],p[13]],I=[p[3],p[7],p[11],p[15]],P=i[0]*w[0]+i[1]*w[1]+i[2]*w[2],k=i[0]*I[0]+i[1]*I[1]+i[2]*I[2],D=h[0]*w[0]+h[1]*w[1]+h[2]*w[2],z=h[0]*I[0]+h[1]*I[1]+h[2]*I[2];return D+v*k===P+v*z||I[3]*(P-D)+w[3]*(z-k)+P*z==D*k?null:(D+w[3]-v*z-v*I[3])/(D-P-v*z+v*k)}static getLesserNonNegativeNonNull(i,h){return h!==null&&h>=0&&h<i?h:i}}class Vp{constructor(i){this._globe=i,this._mercatorCameraHelper=new si,this._verticalPerspectiveCameraHelper=new oi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(i,h){return this.currentHelper.handlePanInertia(i,h)}handleMapControlsRollPitchBearingZoom(i,h){return this.currentHelper.handleMapControlsRollPitchBearingZoom(i,h)}handleMapControlsPan(i,h,p){this.currentHelper.handleMapControlsPan(i,h,p)}cameraForBoxAndBearing(i,h,p,m,v){return this.currentHelper.cameraForBoxAndBearing(i,h,p,m,v)}handleJumpToCenterZoom(i,h){this.currentHelper.handleJumpToCenterZoom(i,h)}handleEaseTo(i,h){return this.currentHelper.handleEaseTo(i,h)}handleFlyTo(i,h){return this.currentHelper.handleFlyTo(i,h)}}const gu=(_,i)=>a.y(_,i&&i.filter(h=>h.identifier!=="source.canvas")),Cy=a.bE();class dd extends a.E{constructor(i,h={}){var p,m;super(),this._rtlPluginLoaded=()=>{for(const w in this.sourceCaches){const I=this.sourceCaches[w].getSource().type;I!=="vector"&&I!=="geojson"||this.sourceCaches[w].reload()}},this.map=i,this.dispatcher=new mt(bt(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",(w,I)=>this.getGlyphs(w,I)),this.dispatcher.registerMessageHandler("GI",(w,I)=>this.getImages(w,I)),this.imageManager=new Ze,this.imageManager.setEventedParent(this);const v=((p=i._container)===null||p===void 0?void 0:p.lang)||typeof document<"u"&&((m=document.documentElement)===null||m===void 0?void 0:m.lang)||void 0;this.glyphManager=new Pt(i._requestManager,h.localIdeographFontFamily,v),this.lineAtlas=new Qe(256,512),this.crossTileSymbolIndex=new ko,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",a.bG()),Mr().on(dr,this._rtlPluginLoaded),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const I=this.sourceCaches[w.sourceId];if(!I)return;const P=I.getSource();if(P&&P.vectorLayerIds)for(const k in this._layers){const D=this._layers[k];D.source===P.id&&this._validateLayer(D)}})}setGlobalStateProperty(i,h){var p,m,v;this._checkLoaded();const w=h===null?(v=(m=(p=this.stylesheet.state)===null||p===void 0?void 0:p[i])===null||m===void 0?void 0:m.default)!==null&&v!==void 0?v:null:h;if(a.bH(w,this._globalState[i]))return this;this._globalState[i]=w,this._applyGlobalStateChanges([i])}getGlobalState(){return this._globalState}setGlobalState(i){this._checkLoaded();const h=[];for(const p in i)!a.bH(this._globalState[p],i[p].default)&&(h.push(p),this._globalState[p]=i[p].default);this._applyGlobalStateChanges(h)}_applyGlobalStateChanges(i){if(i.length===0)return;const h=new Set;for(const p in this._layers){const m=this._layers[p],v=m.getLayoutAffectingGlobalStateRefs(),w=m.getPaintAffectingGlobalStateRefs();for(const I of i)if(v.has(I)&&h.add(m.source),w.has(I))for(const{name:P,value:k}of w.get(I))this._updatePaintProperty(m,P,k)}for(const p in this.sourceCaches)h.has(p)&&(this._reloadSource(p),this._changed=!0)}loadURL(i,h={},p){this.fire(new a.l("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const m=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController;const v=this._loadStyleRequest;a.j(m,this._loadStyleRequest).then(w=>{this._loadStyleRequest=null,this._load(w.data,h,p)}).catch(w=>{this._loadStyleRequest=null,w&&!v.signal.aborted&&this.fire(new a.k(w))})}loadJSON(i,h={},p){this.fire(new a.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,F.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(i,h,p)}).catch(()=>{})}loadEmpty(){this.fire(new a.l("dataloading",{dataType:"style"})),this._load(Cy,{validate:!1})}_load(i,h,p){var m,v;let w=h.transformStyle?h.transformStyle(p,i):i;if(!h.validate||!gu(this,a.z(w))){w=Object.assign({},w),this._loaded=!0,this.stylesheet=w;for(const I in w.sources)this.addSource(I,w.sources[I],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new Ot(this.stylesheet.light),this._setProjectionInternal(((m=this.stylesheet.projection)===null||m===void 0?void 0:m.type)||"mercator"),this.sky=new Je(this.stylesheet.sky),this.map.setTerrain((v=this.stylesheet.terrain)!==null&&v!==void 0?v:null),this.fire(new a.l("data",{dataType:"style"})),this.fire(new a.l("style.load"))}}_createLayers(){var i;const h=a.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",h),this._order=h.map(p=>p.id),this._layers={},this.setGlobalState((i=this.stylesheet.state)!==null&&i!==void 0?i:null),this._serializedLayers=null;for(const p of h){const m=a.bJ(p);m.setEventedParent(this,{layer:{id:p.id}}),m.setGlobalState(this._globalState),this._layers[p.id]=m}}_loadSprite(i,h=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(v,w,I,P){return a._(this,void 0,void 0,function*(){const k=we(v),D=I>1?"@2x":"",z={},L={};for(const{id:U,url:W}of k){const te=w.transformRequest(je(W,D,".json"),"SpriteJSON");z[U]=a.j(te,P);const ee=w.transformRequest(je(W,D,".png"),"SpriteImage");L[U]=le.getImage(ee,P)}return yield Promise.all([...Object.values(z),...Object.values(L)]),function(U,W){return a._(this,void 0,void 0,function*(){const te={};for(const ee in U){te[ee]={};const ne=F.getImageCanvasContext((yield W[ee]).data),ae=(yield U[ee]).data;for(const de in ae){const{width:ue,height:ge,x:ye,y:he,sdf:Ee,pixelRatio:Le,stretchX:ke,stretchY:De,content:Ne,textFitWidth:et,textFitHeight:nt}=ae[de];te[ee][de]={data:null,pixelRatio:Le,sdf:Ee,stretchX:ke,stretchY:De,content:Ne,textFitWidth:et,textFitHeight:nt,spriteData:{width:ue,height:ge,x:ye,y:he,context:ne}}}}return te})}(z,L)})}(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(v=>{if(this._spriteRequest=null,v)for(const w in v){this._spritesImagesIds[w]=[];const I=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter(P=>!(P in v)):[];for(const P of I)this.imageManager.removeImage(P),this._changedImages[P]=!0;for(const P in v[w]){const k=w==="default"?P:`${w}:${P}`;this._spritesImagesIds[w].push(k),k in this.imageManager.images?this.imageManager.updateImage(k,v[w][P],!1):this.imageManager.addImage(k,v[w][P]),h&&(this._changedImages[k]=!0)}}}).catch(v=>{this._spriteRequest=null,m=v,this.fire(new a.k(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}_validateLayer(i){const h=this.sourceCaches[i.source];if(!h)return;const p=i.sourceLayer;if(!p)return;const m=h.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.k(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i,h=!1){const p=this._serializedAllLayers();if(!i||i.length===0)return Object.values(h?a.bK(p):p);const m=[];for(const v of i)if(p[v]){const w=h?a.bK(p[v]):p[v];m.push(w)}return m}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const h=Object.keys(this._layers);for(const p of h){const m=this._layers[p];m.type!=="custom"&&(i[p]=m.serialize())}return i}hasTransitions(){var i,h,p;if(!((i=this.light)===null||i===void 0)&&i.hasTransition()||!((h=this.sky)===null||h===void 0)&&h.hasTransition()||!((p=this.projection)===null||p===void 0)&&p.hasTransition())return!0;for(const m in this.sourceCaches)if(this.sourceCaches[m].hasTransition())return!0;for(const m in this._layers)if(this._layers[m].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const h=this._changed;if(h){const m=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(m.length||v.length)&&this._updateWorkerLayers(m,v);for(const w in this._updatedSources){const I=this._updatedSources[w];if(I==="reload")this._reloadSource(w);else{if(I!=="clear")throw new Error(`Invalid action ${I}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(i);this.light.updateTransitions(i),this.sky.updateTransitions(i),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const v=this.sourceCaches[m];p[m]=v.used,v.used=!1}for(const m of this._order){const v=this._layers[m];v.recalculate(i,this._availableImages),!v.isHidden(i.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const m in p){const v=this.sourceCaches[m];!!p[m]!=!!v.used&&v.fire(new a.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(i),this.sky.recalculate(i),this.projection.recalculate(i),this.z=i.zoom,h&&this.fire(new a.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i,!1),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,h={}){var p;this._checkLoaded();const m=this.serialize();if(i=h.transformStyle?h.transformStyle(m,i):i,((p=h.validate)===null||p===void 0||p)&&gu(this,a.z(i)))return!1;(i=a.bK(i)).layers=a.bI(i.layers);const v=a.bL(m,i),w=this._getOperationsToPerform(v);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const I of w.operations)I();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const h=[],p=[];for(const m of i)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":h.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":h.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setSky":h.push(()=>this.setSky.apply(this,m.args));break;case"setProjection":this.setProjection.apply(this,m.args);break;case"setGlobalState":h.push(()=>this.setGlobalState.apply(this,m.args));break;case"setTransition":h.push(()=>{});break;default:p.push(m.command)}return{operations:h,unimplemented:p}}addImage(i,h){if(this.getImage(i))return this.fire(new a.k(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,h),this._afterImageUpdated(i)}updateImage(i,h){this.imageManager.updateImage(i,h)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new a.k(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,h,p={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.z.source,`sources.${i}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const m=this.sourceCaches[i]=new Bt(i,h,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:i})),m.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===i)return this.fire(new a.k(new Error(`Source "${i}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],h.fire(new a.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,h){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const p=this.sourceCaches[i].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,h,p={}){this._checkLoaded();const m=i.id;if(this.getLayer(m))return void this.fire(new a.k(new Error(`Layer "${m}" already exists on this map.`)));let v;if(i.type==="custom"){if(gu(this,a.bM(i)))return;v=a.bJ(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(m,i.source),i=a.bK(i),i=a.e(i,{source:m})),this._validate(a.z.layer,`layers.${m}`,i,{arrayIndex:-1},p))return;v=a.bJ(i),this._validateLayer(v),v.setEventedParent(this,{layer:{id:m}})}const w=h?this._order.indexOf(h):this._order.length;if(h&&w===-1)this.fire(new a.k(new Error(`Cannot add layer "${m}" before non-existing layer "${h}".`)));else{if(this._order.splice(w,0,m),this._layerOrderChanged=!0,this._layers[m]=v,this._removedLayers[m]&&v.source&&v.type!=="custom"){const I=this._removedLayers[m];delete this._removedLayers[m],I.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(i,h){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new a.k(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===h)return;const p=this._order.indexOf(i);this._order.splice(p,1);const m=h?this._order.indexOf(h):this._order.length;h&&m===-1?this.fire(new a.k(new Error(`Cannot move layer "${i}" before non-existing layer "${h}".`))):(this._order.splice(m,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const h=this._layers[i];if(!h)return void this.fire(new a.k(new Error(`Cannot remove non-existing layer "${i}".`)));h.setEventedParent(null);const p=this._order.indexOf(i);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=h,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],h.onRemove&&h.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,h,p){this._checkLoaded();const m=this.getLayer(i);m?m.minzoom===h&&m.maxzoom===p||(h!=null&&(m.minzoom=h),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new a.k(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,h,p={}){this._checkLoaded();const m=this.getLayer(i);if(m){if(!a.bH(m.filter,h))return h==null?(m.setFilter(void 0),void this._updateLayer(m)):void(this._validate(a.z.filter,`layers.${m.id}.filter`,h,null,p)||(m.setFilter(a.bK(h)),this._updateLayer(m)))}else this.fire(new a.k(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return a.bK(this.getLayer(i).filter)}setLayoutProperty(i,h,p,m={}){this._checkLoaded();const v=this.getLayer(i);v?a.bH(v.getLayoutProperty(h),p)||(v.setLayoutProperty(h,p,m),this._updateLayer(v)):this.fire(new a.k(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,h){const p=this.getLayer(i);if(p)return p.getLayoutProperty(h);this.fire(new a.k(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,h,p,m={}){this._checkLoaded();const v=this.getLayer(i);v?a.bH(v.getPaintProperty(h),p)||this._updatePaintProperty(v,h,p,m):this.fire(new a.k(new Error(`Cannot style non-existing layer "${i}".`)))}_updatePaintProperty(i,h,p,m={}){i.setPaintProperty(h,p,m)&&this._updateLayer(i),this._changed=!0,this._updatedPaintProps[i.id]=!0,this._serializedLayers=null}getPaintProperty(i,h){return this.getLayer(i).getPaintProperty(h)}setFeatureState(i,h){this._checkLoaded();const p=i.source,m=i.sourceLayer,v=this.sourceCaches[p];if(v===void 0)return void this.fire(new a.k(new Error(`The source '${p}' does not exist in the map's style.`)));const w=v.getSource().type;w==="geojson"&&m?this.fire(new a.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||m?(i.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),v.setFeatureState(m,i.id,h)):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,h){this._checkLoaded();const p=i.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new a.k(new Error(`The source '${p}' does not exist in the map's style.`)));const v=m.getSource().type,w=v==="vector"?i.sourceLayer:void 0;v!=="vector"||w?h&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new a.k(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(w,i.id,h):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const h=i.source,p=i.sourceLayer,m=this.sourceCaches[h];if(m!==void 0)return m.getSource().type!=="vector"||p?(i.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,i.id)):void this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.k(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=a.bN(this.sourceCaches,v=>v.serialize()),h=this._serializeByIds(this._order,!0),p=this.map.getTerrain()||void 0,m=this.stylesheet;return a.bO({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,projection:m.projection,sources:i,layers:h,terrain:p},v=>v!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const h=w=>this._layers[w].type==="fill-extrusion",p={},m=[];for(let w=this._order.length-1;w>=0;w--){const I=this._order[w];if(h(I)){p[I]=w;for(const P of i){const k=P[I];if(k)for(const D of k)m.push(D)}}}m.sort((w,I)=>I.intersectionZ-w.intersectionZ);const v=[];for(let w=this._order.length-1;w>=0;w--){const I=this._order[w];if(h(I))for(let P=m.length-1;P>=0;P--){const k=m[P].feature;if(p[k.layer.id]<w)break;v.push(k),m.pop()}else for(const P of i){const k=P[I];if(k)for(const D of k)v.push(D.feature)}}return v}queryRenderedFeatures(i,h,p){h&&h.filter&&this._validate(a.z.filter,"queryRenderedFeatures.filter",h.filter,null,h);const m={};if(h&&h.layers){if(!(Array.isArray(h.layers)||h.layers instanceof Set))return this.fire(new a.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const k of h.layers){const D=this._layers[k];if(!D)return this.fire(new a.k(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];m[D.source]=!0}}const v=[];h.availableImages=this._availableImages;const w=this._serializedAllLayers(),I=h.layers instanceof Set?h.layers:Array.isArray(h.layers)?new Set(h.layers):null,P=Object.assign(Object.assign({},h),{layers:I});for(const k in this.sourceCaches)h.layers&&!m[k]||v.push(fr(this.sourceCaches[k],this._layers,w,i,P,p,this.map.terrain?(D,z,L)=>this.map.terrain.getElevation(D,z,L):void 0));return this.placement&&v.push(function(k,D,z,L,U,W,te){const ee={},ne=W.queryRenderedSymbols(L),ae=[];for(const de of Object.keys(ne).map(Number))ae.push(te[de]);ae.sort(vr);for(const de of ae){const ue=de.featureIndex.lookupSymbolFeatures(ne[de.bucketInstanceId],D,de.bucketIndex,de.sourceLayerIndex,U.filter,U.layers,U.availableImages,k);for(const ge in ue){const ye=ee[ge]=ee[ge]||[],he=ue[ge];he.sort((Ee,Le)=>{const ke=de.featureSortOrder;if(ke){const De=ke.indexOf(Ee.featureIndex);return ke.indexOf(Le.featureIndex)-De}return Le.featureIndex-Ee.featureIndex});for(const Ee of he)ye.push(Ee)}}return function(de,ue,ge){for(const ye in de)for(const he of de[ye])en(he,ge[ue[ye].source]);return de}(ee,k,z)}(this._layers,w,this.sourceCaches,i,P,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(i,h){h&&h.filter&&this._validate(a.z.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[i];return p?function(m,v){const w=m.getRenderableIds().map(k=>m.getTileByID(k)),I=[],P={};for(let k=0;k<w.length;k++){const D=w[k],z=D.tileID.canonical.key;P[z]||(P[z]=!0,D.querySourceFeatures(I,v))}return I}(p,h):[]}getLight(){return this.light.getLight()}setLight(i,h={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const w in i)if(!a.bH(i[w],p[w])){m=!0;break}if(!m)return;const v={now:F.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,h),this.light.updateTransitions(v)}getProjection(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.projection}setProjection(i){if(this._checkLoaded(),this.projection){if(this.projection.name===i.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=i,this._setProjectionInternal(i.type)}getSky(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.sky}setSky(i,h={}){this._checkLoaded();const p=this.getSky();let m=!1;if(!i&&!p)return;if(i&&!p)m=!0;else if(!i&&p)m=!0;else for(const w in i)if(!a.bH(i[w],p[w])){m=!0;break}if(!m)return;const v={now:F.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=i,this.sky.setSky(i,h),this.sky.updateTransitions(v)}_setProjectionInternal(i){const h=function(p){if(Array.isArray(p)){const m=new fu({type:p});return{projection:m,transform:new ic,cameraHelper:new Vp(m)}}switch(p){case"mercator":return{projection:new or,transform:new Vr,cameraHelper:new si};case"globe":{const m=new fu({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:m,transform:new ic,cameraHelper:new Vp(m)}}case"vertical-perspective":return{projection:new Ql,transform:new nc,cameraHelper:new oi};default:return a.w(`Unknown projection name: ${p}. Falling back to mercator projection.`),{projection:new or,transform:new Vr,cameraHelper:new si}}}(i);this.projection=h.projection,this.map.migrateProjection(h.transform,h.cameraHelper);for(const p in this.sourceCaches)this.sourceCaches[p].reload()}_validate(i,h,p,m,v={}){return(!v||v.validate!==!1)&&gu(this,i.call(a.z,a.e({key:h,style:this.serialize(),value:p,styleSpec:a.v},m)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Mr().off(dr,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const p=this.sourceCaches[h];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const h in this.sourceCaches)this.sourceCaches[h].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,h,p,m,v=!1){let w=!1,I=!1;const P={};for(const k of this._order){const D=this._layers[k];if(D.type!=="symbol")continue;if(!P[D.source]){const L=this.sourceCaches[D.source];P[D.source]=L.getRenderableIds(!0).map(U=>L.getTileByID(U)).sort((U,W)=>W.tileID.overscaledZ-U.tileID.overscaledZ||(U.tileID.isLessThan(W.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(D,P[D.source],i.center.lng);w=w||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(F.now(),i.zoom))&&(this.pauseablePlacement=new Yl(i,this.map.terrain,this._order,v,h,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(F.now()),I=!0),w&&this.pauseablePlacement.placement.setStale()),I||w)for(const k of this._order){const D=this._layers[k];D.type==="symbol"&&this.placement.updateLayerOpacities(D,P[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(F.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,h){return a._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,h.icons),p})}getGlyphs(i,h){return a._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(h.stacks),m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,h={}){this._checkLoaded(),i&&this._validate(a.z.glyphs,"glyphs",i,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,h,p={},m){this._checkLoaded();const v=[{id:i,url:h}],w=[...we(this.stylesheet.sprite),...v];this._validate(a.z.sprite,"sprite",w,null,p)||(this.stylesheet.sprite=w,this._loadSprite(v,!0,m))}removeSprite(i){this._checkLoaded();const h=we(this.stylesheet.sprite);if(h.find(p=>p.id===i)){if(this._spritesImagesIds[i])for(const p of this._spritesImagesIds[i])this.imageManager.removeImage(p),this._changedImages[p]=!0;h.splice(h.findIndex(p=>p.id===i),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}else this.fire(new a.k(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return we(this.stylesheet.sprite)}setSprite(i,h={},p){this._checkLoaded(),i&&this._validate(a.z.sprite,"sprite",i,null,h)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,p):(this._unloadSprite(),p&&p(null)))}}var My=a.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ry{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,h,p,m,v,w,I,P,k){this.context=i;let D=this.boundPaintVertexBuffers.length!==m.length;for(let z=0;!D&&z<m.length;z++)this.boundPaintVertexBuffers[z]!==m[z]&&(D=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==p||D||this.boundIndexBuffer!==v||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==I||this.boundDynamicVertexBuffer2!==P||this.boundDynamicVertexBuffer3!==k?this.freshBind(h,p,m,v,w,I,P,k):(i.bindVertexArray.set(this.vao),I&&I.bind(),v&&v.dynamicDraw&&v.bind(),P&&P.bind(),k&&k.bind())}freshBind(i,h,p,m,v,w,I,P){const k=i.numAttributes,D=this.context,z=D.gl;this.vao&&this.destroy(),this.vao=D.createVertexArray(),D.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=I,this.boundDynamicVertexBuffer3=P,h.enableAttributes(z,i);for(const L of p)L.enableAttributes(z,i);w&&w.enableAttributes(z,i),I&&I.enableAttributes(z,i),P&&P.enableAttributes(z,i),h.bind(),h.setVertexAttribPointers(z,i,v);for(const L of p)L.bind(),L.setVertexAttribPointers(z,i,v);w&&(w.bind(),w.setVertexAttribPointers(z,i,v)),m&&m.bind(),I&&(I.bind(),I.setVertexAttribPointers(z,i,v)),P&&(P.bind(),P.setVertexAttribPointers(z,i,v)),D.currentNumAttributes=k}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const mu=(_,i,h,p,m)=>({u_texture:0,u_ele_delta:_,u_fog_matrix:i,u_fog_color:h?h.properties.get("fog-color"):a.bf.white,u_fog_ground_blend:h?h.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:m?0:h?h.calculateFogBlendOpacity(p):0,u_horizon_color:h?h.properties.get("horizon-color"):a.bf.white,u_horizon_fog_blend:h?h.properties.get("horizon-fog-blend"):1,u_is_globe_mode:m?1:0}),fd={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function ua(_){const i=[];for(let h=0;h<_.length;h++){if(_[h]===null)continue;const p=_[h].split(" ");i.push(p.pop())}return i}class pd{constructor(i,h,p,m,v,w,I,P,k=[]){const D=i.gl;this.program=D.createProgram();const z=ua(h.staticAttributes),L=p?p.getBinderAttributes():[],U=z.concat(L),W=ji.prelude.staticUniforms?ua(ji.prelude.staticUniforms):[],te=I.staticUniforms?ua(I.staticUniforms):[],ee=h.staticUniforms?ua(h.staticUniforms):[],ne=p?p.getBinderUniforms():[],ae=W.concat(te).concat(ee).concat(ne),de=[];for(const ke of ae)de.indexOf(ke)<0&&de.push(ke);const ue=p?p.defines():[];Vs(D)&&ue.unshift("#version 300 es"),v&&ue.push("#define OVERDRAW_INSPECTOR;"),w&&ue.push("#define TERRAIN3D;"),P&&ue.push(P),k&&ue.push(...k);let ge=ue.concat(ji.prelude.fragmentSource,I.fragmentSource,h.fragmentSource).join(`
`),ye=ue.concat(ji.prelude.vertexSource,I.vertexSource,h.vertexSource).join(`
`);Vs(D)||(ge=function(ke){return ke.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ge),ye=function(ke){return ke.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(ye));const he=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(he,ge),D.compileShader(he),!D.getShaderParameter(he,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(he)}`);D.attachShader(this.program,he);const Ee=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Ee,ye),D.compileShader(Ee),!D.getShaderParameter(Ee,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(Ee)}`);D.attachShader(this.program,Ee),this.attributes={};const Le={};this.numAttributes=U.length;for(let ke=0;ke<this.numAttributes;ke++)U[ke]&&(D.bindAttribLocation(this.program,ke,U[ke]),this.attributes[U[ke]]=ke);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(Ee),D.deleteShader(he);for(let ke=0;ke<de.length;ke++){const De=de[ke];if(De&&!Le[De]){const Ne=D.getUniformLocation(this.program,De);Ne&&(Le[De]=Ne)}}this.fixedUniforms=m(i,Le),this.terrainUniforms=((ke,De)=>({u_depth:new a.bP(ke,De.u_depth),u_terrain:new a.bP(ke,De.u_terrain),u_terrain_dim:new a.bg(ke,De.u_terrain_dim),u_terrain_matrix:new a.bR(ke,De.u_terrain_matrix),u_terrain_unpack:new a.bS(ke,De.u_terrain_unpack),u_terrain_exaggeration:new a.bg(ke,De.u_terrain_exaggeration)}))(i,Le),this.projectionUniforms=((ke,De)=>({u_projection_matrix:new a.bR(ke,De.u_projection_matrix),u_projection_tile_mercator_coords:new a.bS(ke,De.u_projection_tile_mercator_coords),u_projection_clipping_plane:new a.bS(ke,De.u_projection_clipping_plane),u_projection_transition:new a.bg(ke,De.u_projection_transition),u_projection_fallback_matrix:new a.bR(ke,De.u_projection_fallback_matrix)}))(i,Le),this.binderUniforms=p?p.getUniforms(i,Le):[]}draw(i,h,p,m,v,w,I,P,k,D,z,L,U,W,te,ee,ne,ae,de){const ue=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(p),i.setStencilMode(m),i.setColorMode(v),i.setCullFace(w),P){i.activeTexture.set(ue.TEXTURE2),ue.bindTexture(ue.TEXTURE_2D,P.depthTexture),i.activeTexture.set(ue.TEXTURE3),ue.bindTexture(ue.TEXTURE_2D,P.texture);for(const ye in this.terrainUniforms)this.terrainUniforms[ye].set(P[ye])}if(k)for(const ye in k)this.projectionUniforms[fd[ye]].set(k[ye]);if(I)for(const ye in this.fixedUniforms)this.fixedUniforms[ye].set(I[ye]);ee&&ee.setUniforms(i,this.binderUniforms,W,{zoom:te});let ge=0;switch(h){case ue.LINES:ge=2;break;case ue.TRIANGLES:ge=3;break;case ue.LINE_STRIP:ge=1}for(const ye of U.get()){const he=ye.vaos||(ye.vaos={});(he[D]||(he[D]=new Ry)).bind(i,this,z,ee?ee.getPaintVertexBuffers():[],L,ye.vertexOffset,ne,ae,de),ue.drawElements(h,ye.primitiveLength*ge,ue.UNSIGNED_SHORT,ye.primitiveOffset*ge*2)}}}function _u(_,i,h){const p=1/a.aC(h,1,i.transform.tileZoom),m=Math.pow(2,h.tileID.overscaledZ),v=h.tileSize*Math.pow(2,i.transform.tileZoom)/m,w=v*(h.tileID.canonical.x+h.tileID.wrap*m),I=v*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[w>>16,I>>16],u_pixel_coord_lower:[65535&w,65535&I]}}const gs=(_,i,h,p)=>{const m=_.style.light,v=m.properties.get("position"),w=[v.x,v.y,v.z],I=a.bV();m.properties.get("anchor")==="viewport"&&a.bW(I,_.transform.bearingInRadians),a.bX(w,w,I);const P=_.transform.transformLightDirection(w),k=m.properties.get("color");return{u_lightpos:w,u_lightpos_globe:P,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+i,u_opacity:h,u_fill_translate:p}},ky=(_,i,h,p,m,v,w)=>a.e(gs(_,i,h,p),_u(v,_,w),{u_height_factor:-Math.pow(2,m.overscaledZ)/w.tileSize/8}),yu=(_,i,h,p)=>a.e(_u(i,_,h),{u_fill_translate:p}),sc=(_,i)=>({u_world:_,u_fill_translate:i}),oc=(_,i,h,p,m)=>a.e(yu(_,i,h,m),{u_world:p}),Dy=(_,i,h,p,m)=>{const v=_.transform;let w,I,P=0;if(h.paint.get("circle-pitch-alignment")==="map"){const k=a.aC(i,1,v.zoom);w=!0,I=[k,k],P=k/(a.$*Math.pow(2,i.tileID.overscaledZ))*2*Math.PI*m}else w=!1,I=v.pixelsToGLUnits;return{u_camera_to_center_distance:v.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+w,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:I,u_globe_extrude_scale:P,u_translate:p}},vu=_=>({u_pixel_extrude_scale:[1/_.width,1/_.height]}),Oy=_=>({u_viewport_size:[_.width,_.height]}),ha=(_,i=1)=>({u_color:_,u_overlay:0,u_overlay_scale:i}),jp=(_,i,h,p)=>{const m=a.aC(_,1,i)/(a.$*Math.pow(2,_.tileID.overscaledZ))*2*Math.PI*p;return{u_extrude_scale:a.aC(_,1,i),u_intensity:h,u_globe_extrude_scale:m}},gd=(_,i,h,p)=>{const m=a.L();a.bY(m,0,_.width,_.height,0,0,1);const v=_.context.gl;return{u_matrix:m,u_world:[v.drawingBufferWidth,v.drawingBufferHeight],u_image:h,u_color_ramp:p,u_opacity:i.paint.get("heatmap-opacity")}},Fy=(_,i,h)=>{const p=h.paint.get("hillshade-accent-color");let m;switch(h.paint.get("hillshade-method")){case"basic":m=4;break;case"combined":m=1;break;case"igor":m=2;break;case"multidirectional":m=3;break;default:m=0}const v=h.getIlluminationProperties();for(let w=0;w<v.directionRadians.length;w++)h.paint.get("hillshade-illumination-anchor")==="viewport"&&(v.directionRadians[w]+=_.transform.bearingInRadians);return{u_image:0,u_latrange:md(0,i.tileID),u_exaggeration:h.paint.get("hillshade-exaggeration"),u_altitudes:v.altitudeRadians,u_azimuths:v.directionRadians,u_accent:p,u_method:m,u_highlights:v.highlightColor,u_shadows:v.shadowColor}},$p=(_,i)=>{const h=i.stride,p=a.L();return a.bY(p,0,a.$,-a.$,0,0,1),a.M(p,p,[0,-a.$,0]),{u_matrix:p,u_image:1,u_dimension:[h,h],u_zoom:_.overscaledZ,u_unpack:i.getUnpackVector()}};function md(_,i){const h=Math.pow(2,i.canonical.z),p=i.canonical.y;return[new a.a1(0,p/h).toLngLat().lat,new a.a1(0,(p+1)/h).toLngLat().lat]}const Wp=(_,i,h=0)=>({u_image:0,u_unpack:i.getUnpackVector(),u_dimension:[i.stride,i.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:h,u_opacity:_.paint.get("color-relief-opacity")}),xu=(_,i,h,p)=>{const m=_.transform;return{u_translation:yd(_,i,h),u_ratio:p/a.aC(i,1,m.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Hp=(_,i,h,p,m)=>a.e(xu(_,i,h,p),{u_image:0,u_image_height:m}),Xp=(_,i,h,p,m)=>{const v=_.transform,w=_d(i,v);return{u_translation:yd(_,i,h),u_texsize:i.imageAtlasTexture.size,u_ratio:p/a.aC(i,1,v.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[w,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},da=(_,i,h,p,m,v)=>{const w=_.lineAtlas,I=_d(i,_.transform),P=h.layout.get("line-cap")==="round",k=w.getDash(m.from,P),D=w.getDash(m.to,P),z=k.width*v.fromScale,L=D.width*v.toScale;return a.e(xu(_,i,h,p),{u_patternscale_a:[I/z,-k.height/2],u_patternscale_b:[I/L,-D.height/2],u_sdfgamma:w.width/(256*Math.min(z,L)*_.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:D.y,u_mix:v.t})};function _d(_,i){return 1/a.aC(_,1,i.tileZoom)}function yd(_,i,h){return a.aD(_.transform,i,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const ac=(_,i,h,p,m)=>{return{u_tl_parent:_,u_scale_parent:i,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(w=p.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(v=p.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Ny(p.paint.get("raster-hue-rotate")),u_coords_top:[m[0].x,m[0].y,m[1].x,m[1].y],u_coords_bottom:[m[3].x,m[3].y,m[2].x,m[2].y]};var v,w};function Ny(_){_*=Math.PI/180;const i=Math.sin(_),h=Math.cos(_);return[(2*h+1)/3,(-Math.sqrt(3)*i-h+1)/3,(Math.sqrt(3)*i-h+1)/3]}const lc=(_,i,h,p,m,v,w,I,P,k,D,z,L)=>{const U=w.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:U.cameraToCenterDistance,u_pitch:U.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:U.width/U.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_label_plane_matrix:I,u_coord_matrix:P,u_is_text:+D,u_pitch_with_map:+p,u_is_along_line:m,u_is_variable_anchor:v,u_texsize:z,u_texture:0,u_translation:k,u_pitched_scale:L}},Zp=(_,i,h,p,m,v,w,I,P,k,D,z,L,U)=>{const W=w.transform;return a.e(lc(_,i,h,p,m,v,w,I,P,k,D,z,U),{u_gamma_scale:p?Math.cos(W.pitch*Math.PI/180)*W.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:1})},Ly=(_,i,h,p,m,v,w,I,P,k,D,z,L)=>a.e(Zp(_,i,h,p,m,v,w,I,P,k,!0,D,0,L),{u_texsize_icon:z,u_texture_icon:1}),qp=(_,i)=>({u_opacity:_,u_color:i}),Yp=(_,i,h,p,m)=>a.e(function(v,w,I,P){const k=I.imageManager.getPattern(v.from.toString()),D=I.imageManager.getPattern(v.to.toString()),{width:z,height:L}=I.imageManager.getPixelSize(),U=Math.pow(2,P.tileID.overscaledZ),W=P.tileSize*Math.pow(2,I.transform.tileZoom)/U,te=W*(P.tileID.canonical.x+P.tileID.wrap*U),ee=W*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[z,L],u_mix:w.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/a.aC(P,1,I.transform.tileZoom),u_pixel_coord_upper:[te>>16,ee>>16],u_pixel_coord_lower:[65535&te,65535&ee]}}(h,m,i,p),{u_opacity:_}),vd=(_,i)=>{},xd={fillExtrusion:(_,i)=>({u_lightpos:new a.bT(_,i.u_lightpos),u_lightpos_globe:new a.bT(_,i.u_lightpos_globe),u_lightintensity:new a.bg(_,i.u_lightintensity),u_lightcolor:new a.bT(_,i.u_lightcolor),u_vertical_gradient:new a.bg(_,i.u_vertical_gradient),u_opacity:new a.bg(_,i.u_opacity),u_fill_translate:new a.bU(_,i.u_fill_translate)}),fillExtrusionPattern:(_,i)=>({u_lightpos:new a.bT(_,i.u_lightpos),u_lightpos_globe:new a.bT(_,i.u_lightpos_globe),u_lightintensity:new a.bg(_,i.u_lightintensity),u_lightcolor:new a.bT(_,i.u_lightcolor),u_vertical_gradient:new a.bg(_,i.u_vertical_gradient),u_height_factor:new a.bg(_,i.u_height_factor),u_opacity:new a.bg(_,i.u_opacity),u_fill_translate:new a.bU(_,i.u_fill_translate),u_image:new a.bP(_,i.u_image),u_texsize:new a.bU(_,i.u_texsize),u_pixel_coord_upper:new a.bU(_,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(_,i.u_pixel_coord_lower),u_scale:new a.bT(_,i.u_scale),u_fade:new a.bg(_,i.u_fade)}),fill:(_,i)=>({u_fill_translate:new a.bU(_,i.u_fill_translate)}),fillPattern:(_,i)=>({u_image:new a.bP(_,i.u_image),u_texsize:new a.bU(_,i.u_texsize),u_pixel_coord_upper:new a.bU(_,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(_,i.u_pixel_coord_lower),u_scale:new a.bT(_,i.u_scale),u_fade:new a.bg(_,i.u_fade),u_fill_translate:new a.bU(_,i.u_fill_translate)}),fillOutline:(_,i)=>({u_world:new a.bU(_,i.u_world),u_fill_translate:new a.bU(_,i.u_fill_translate)}),fillOutlinePattern:(_,i)=>({u_world:new a.bU(_,i.u_world),u_image:new a.bP(_,i.u_image),u_texsize:new a.bU(_,i.u_texsize),u_pixel_coord_upper:new a.bU(_,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(_,i.u_pixel_coord_lower),u_scale:new a.bT(_,i.u_scale),u_fade:new a.bg(_,i.u_fade),u_fill_translate:new a.bU(_,i.u_fill_translate)}),circle:(_,i)=>({u_camera_to_center_distance:new a.bg(_,i.u_camera_to_center_distance),u_scale_with_map:new a.bP(_,i.u_scale_with_map),u_pitch_with_map:new a.bP(_,i.u_pitch_with_map),u_extrude_scale:new a.bU(_,i.u_extrude_scale),u_device_pixel_ratio:new a.bg(_,i.u_device_pixel_ratio),u_globe_extrude_scale:new a.bg(_,i.u_globe_extrude_scale),u_translate:new a.bU(_,i.u_translate)}),collisionBox:(_,i)=>({u_pixel_extrude_scale:new a.bU(_,i.u_pixel_extrude_scale)}),collisionCircle:(_,i)=>({u_viewport_size:new a.bU(_,i.u_viewport_size)}),debug:(_,i)=>({u_color:new a.bQ(_,i.u_color),u_overlay:new a.bP(_,i.u_overlay),u_overlay_scale:new a.bg(_,i.u_overlay_scale)}),depth:vd,clippingMask:vd,heatmap:(_,i)=>({u_extrude_scale:new a.bg(_,i.u_extrude_scale),u_intensity:new a.bg(_,i.u_intensity),u_globe_extrude_scale:new a.bg(_,i.u_globe_extrude_scale)}),heatmapTexture:(_,i)=>({u_matrix:new a.bR(_,i.u_matrix),u_world:new a.bU(_,i.u_world),u_image:new a.bP(_,i.u_image),u_color_ramp:new a.bP(_,i.u_color_ramp),u_opacity:new a.bg(_,i.u_opacity)}),hillshade:(_,i)=>({u_image:new a.bP(_,i.u_image),u_latrange:new a.bU(_,i.u_latrange),u_exaggeration:new a.bg(_,i.u_exaggeration),u_altitudes:new a.b_(_,i.u_altitudes),u_azimuths:new a.b_(_,i.u_azimuths),u_accent:new a.bQ(_,i.u_accent),u_method:new a.bP(_,i.u_method),u_shadows:new a.bZ(_,i.u_shadows),u_highlights:new a.bZ(_,i.u_highlights)}),hillshadePrepare:(_,i)=>({u_matrix:new a.bR(_,i.u_matrix),u_image:new a.bP(_,i.u_image),u_dimension:new a.bU(_,i.u_dimension),u_zoom:new a.bg(_,i.u_zoom),u_unpack:new a.bS(_,i.u_unpack)}),colorRelief:(_,i)=>({u_image:new a.bP(_,i.u_image),u_unpack:new a.bS(_,i.u_unpack),u_dimension:new a.bU(_,i.u_dimension),u_elevation_stops:new a.bP(_,i.u_elevation_stops),u_color_stops:new a.bP(_,i.u_color_stops),u_color_ramp_size:new a.bP(_,i.u_color_ramp_size),u_opacity:new a.bg(_,i.u_opacity)}),line:(_,i)=>({u_translation:new a.bU(_,i.u_translation),u_ratio:new a.bg(_,i.u_ratio),u_device_pixel_ratio:new a.bg(_,i.u_device_pixel_ratio),u_units_to_pixels:new a.bU(_,i.u_units_to_pixels)}),lineGradient:(_,i)=>({u_translation:new a.bU(_,i.u_translation),u_ratio:new a.bg(_,i.u_ratio),u_device_pixel_ratio:new a.bg(_,i.u_device_pixel_ratio),u_units_to_pixels:new a.bU(_,i.u_units_to_pixels),u_image:new a.bP(_,i.u_image),u_image_height:new a.bg(_,i.u_image_height)}),linePattern:(_,i)=>({u_translation:new a.bU(_,i.u_translation),u_texsize:new a.bU(_,i.u_texsize),u_ratio:new a.bg(_,i.u_ratio),u_device_pixel_ratio:new a.bg(_,i.u_device_pixel_ratio),u_image:new a.bP(_,i.u_image),u_units_to_pixels:new a.bU(_,i.u_units_to_pixels),u_scale:new a.bT(_,i.u_scale),u_fade:new a.bg(_,i.u_fade)}),lineSDF:(_,i)=>({u_translation:new a.bU(_,i.u_translation),u_ratio:new a.bg(_,i.u_ratio),u_device_pixel_ratio:new a.bg(_,i.u_device_pixel_ratio),u_units_to_pixels:new a.bU(_,i.u_units_to_pixels),u_patternscale_a:new a.bU(_,i.u_patternscale_a),u_patternscale_b:new a.bU(_,i.u_patternscale_b),u_sdfgamma:new a.bg(_,i.u_sdfgamma),u_image:new a.bP(_,i.u_image),u_tex_y_a:new a.bg(_,i.u_tex_y_a),u_tex_y_b:new a.bg(_,i.u_tex_y_b),u_mix:new a.bg(_,i.u_mix)}),raster:(_,i)=>({u_tl_parent:new a.bU(_,i.u_tl_parent),u_scale_parent:new a.bg(_,i.u_scale_parent),u_buffer_scale:new a.bg(_,i.u_buffer_scale),u_fade_t:new a.bg(_,i.u_fade_t),u_opacity:new a.bg(_,i.u_opacity),u_image0:new a.bP(_,i.u_image0),u_image1:new a.bP(_,i.u_image1),u_brightness_low:new a.bg(_,i.u_brightness_low),u_brightness_high:new a.bg(_,i.u_brightness_high),u_saturation_factor:new a.bg(_,i.u_saturation_factor),u_contrast_factor:new a.bg(_,i.u_contrast_factor),u_spin_weights:new a.bT(_,i.u_spin_weights),u_coords_top:new a.bS(_,i.u_coords_top),u_coords_bottom:new a.bS(_,i.u_coords_bottom)}),symbolIcon:(_,i)=>({u_is_size_zoom_constant:new a.bP(_,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(_,i.u_is_size_feature_constant),u_size_t:new a.bg(_,i.u_size_t),u_size:new a.bg(_,i.u_size),u_camera_to_center_distance:new a.bg(_,i.u_camera_to_center_distance),u_pitch:new a.bg(_,i.u_pitch),u_rotate_symbol:new a.bP(_,i.u_rotate_symbol),u_aspect_ratio:new a.bg(_,i.u_aspect_ratio),u_fade_change:new a.bg(_,i.u_fade_change),u_label_plane_matrix:new a.bR(_,i.u_label_plane_matrix),u_coord_matrix:new a.bR(_,i.u_coord_matrix),u_is_text:new a.bP(_,i.u_is_text),u_pitch_with_map:new a.bP(_,i.u_pitch_with_map),u_is_along_line:new a.bP(_,i.u_is_along_line),u_is_variable_anchor:new a.bP(_,i.u_is_variable_anchor),u_texsize:new a.bU(_,i.u_texsize),u_texture:new a.bP(_,i.u_texture),u_translation:new a.bU(_,i.u_translation),u_pitched_scale:new a.bg(_,i.u_pitched_scale)}),symbolSDF:(_,i)=>({u_is_size_zoom_constant:new a.bP(_,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(_,i.u_is_size_feature_constant),u_size_t:new a.bg(_,i.u_size_t),u_size:new a.bg(_,i.u_size),u_camera_to_center_distance:new a.bg(_,i.u_camera_to_center_distance),u_pitch:new a.bg(_,i.u_pitch),u_rotate_symbol:new a.bP(_,i.u_rotate_symbol),u_aspect_ratio:new a.bg(_,i.u_aspect_ratio),u_fade_change:new a.bg(_,i.u_fade_change),u_label_plane_matrix:new a.bR(_,i.u_label_plane_matrix),u_coord_matrix:new a.bR(_,i.u_coord_matrix),u_is_text:new a.bP(_,i.u_is_text),u_pitch_with_map:new a.bP(_,i.u_pitch_with_map),u_is_along_line:new a.bP(_,i.u_is_along_line),u_is_variable_anchor:new a.bP(_,i.u_is_variable_anchor),u_texsize:new a.bU(_,i.u_texsize),u_texture:new a.bP(_,i.u_texture),u_gamma_scale:new a.bg(_,i.u_gamma_scale),u_device_pixel_ratio:new a.bg(_,i.u_device_pixel_ratio),u_is_halo:new a.bP(_,i.u_is_halo),u_translation:new a.bU(_,i.u_translation),u_pitched_scale:new a.bg(_,i.u_pitched_scale)}),symbolTextAndIcon:(_,i)=>({u_is_size_zoom_constant:new a.bP(_,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(_,i.u_is_size_feature_constant),u_size_t:new a.bg(_,i.u_size_t),u_size:new a.bg(_,i.u_size),u_camera_to_center_distance:new a.bg(_,i.u_camera_to_center_distance),u_pitch:new a.bg(_,i.u_pitch),u_rotate_symbol:new a.bP(_,i.u_rotate_symbol),u_aspect_ratio:new a.bg(_,i.u_aspect_ratio),u_fade_change:new a.bg(_,i.u_fade_change),u_label_plane_matrix:new a.bR(_,i.u_label_plane_matrix),u_coord_matrix:new a.bR(_,i.u_coord_matrix),u_is_text:new a.bP(_,i.u_is_text),u_pitch_with_map:new a.bP(_,i.u_pitch_with_map),u_is_along_line:new a.bP(_,i.u_is_along_line),u_is_variable_anchor:new a.bP(_,i.u_is_variable_anchor),u_texsize:new a.bU(_,i.u_texsize),u_texsize_icon:new a.bU(_,i.u_texsize_icon),u_texture:new a.bP(_,i.u_texture),u_texture_icon:new a.bP(_,i.u_texture_icon),u_gamma_scale:new a.bg(_,i.u_gamma_scale),u_device_pixel_ratio:new a.bg(_,i.u_device_pixel_ratio),u_is_halo:new a.bP(_,i.u_is_halo),u_translation:new a.bU(_,i.u_translation),u_pitched_scale:new a.bg(_,i.u_pitched_scale)}),background:(_,i)=>({u_opacity:new a.bg(_,i.u_opacity),u_color:new a.bQ(_,i.u_color)}),backgroundPattern:(_,i)=>({u_opacity:new a.bg(_,i.u_opacity),u_image:new a.bP(_,i.u_image),u_pattern_tl_a:new a.bU(_,i.u_pattern_tl_a),u_pattern_br_a:new a.bU(_,i.u_pattern_br_a),u_pattern_tl_b:new a.bU(_,i.u_pattern_tl_b),u_pattern_br_b:new a.bU(_,i.u_pattern_br_b),u_texsize:new a.bU(_,i.u_texsize),u_mix:new a.bg(_,i.u_mix),u_pattern_size_a:new a.bU(_,i.u_pattern_size_a),u_pattern_size_b:new a.bU(_,i.u_pattern_size_b),u_scale_a:new a.bg(_,i.u_scale_a),u_scale_b:new a.bg(_,i.u_scale_b),u_pixel_coord_upper:new a.bU(_,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(_,i.u_pixel_coord_lower),u_tile_units_to_pixels:new a.bg(_,i.u_tile_units_to_pixels)}),terrain:(_,i)=>({u_texture:new a.bP(_,i.u_texture),u_ele_delta:new a.bg(_,i.u_ele_delta),u_fog_matrix:new a.bR(_,i.u_fog_matrix),u_fog_color:new a.bQ(_,i.u_fog_color),u_fog_ground_blend:new a.bg(_,i.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.bg(_,i.u_fog_ground_blend_opacity),u_horizon_color:new a.bQ(_,i.u_horizon_color),u_horizon_fog_blend:new a.bg(_,i.u_horizon_fog_blend),u_is_globe_mode:new a.bg(_,i.u_is_globe_mode)}),terrainDepth:(_,i)=>({u_ele_delta:new a.bg(_,i.u_ele_delta)}),terrainCoords:(_,i)=>({u_texture:new a.bP(_,i.u_texture),u_terrain_coords_id:new a.bg(_,i.u_terrain_coords_id),u_ele_delta:new a.bg(_,i.u_ele_delta)}),projectionErrorMeasurement:(_,i)=>({u_input:new a.bg(_,i.u_input),u_output_expected:new a.bg(_,i.u_output_expected)}),atmosphere:(_,i)=>({u_sun_pos:new a.bT(_,i.u_sun_pos),u_atmosphere_blend:new a.bg(_,i.u_atmosphere_blend),u_globe_position:new a.bT(_,i.u_globe_position),u_globe_radius:new a.bg(_,i.u_globe_radius),u_inv_proj_matrix:new a.bR(_,i.u_inv_proj_matrix)}),sky:(_,i)=>({u_sky_color:new a.bQ(_,i.u_sky_color),u_horizon_color:new a.bQ(_,i.u_horizon_color),u_horizon:new a.bU(_,i.u_horizon),u_horizon_normal:new a.bU(_,i.u_horizon_normal),u_sky_horizon_blend:new a.bg(_,i.u_sky_horizon_blend),u_sky_blend:new a.bg(_,i.u_sky_blend)})};class Gp{constructor(i,h,p){this.context=i;const m=i.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ao{constructor(i,h,p,m){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=i;const v=i.gl;this.buffer=v.createBuffer(),i.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,h){for(let p=0;p<this.attributes.length;p++){const m=h.attributes[this.attributes[p].name];m!==void 0&&i.enableVertexAttribArray(m)}}setVertexAttribPointers(i,h,p){for(let m=0;m<this.attributes.length;m++){const v=this.attributes[m],w=h.attributes[v.name];w!==void 0&&i.vertexAttribPointer(w,v.components,i[bu[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Sr{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class bd extends Sr{getDefault(){return a.bf.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class wd extends Sr{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Kp extends Sr{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Td extends Sr{getDefault(){return[!0,!0,!0,!0]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class fa extends Sr{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Sd extends Sr{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class zy extends Sr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const h=this.current;(i.func!==h.func||i.ref!==h.ref||i.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class By extends Sr{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Uy extends Sr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=i,this.dirty=!1}}class Vy extends Sr{getDefault(){return[0,1]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Qp extends Sr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=i,this.dirty=!1}}class jy extends Sr{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Jp extends Sr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.BLEND):h.disable(h.BLEND),this.current=i,this.dirty=!1}}class wu extends Sr{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Tu extends Sr{getDefault(){return a.bf.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Su extends Sr{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Ed extends Sr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=i,this.dirty=!1}}class pa extends Sr{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class cc extends Sr{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class Ya extends Sr{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class is extends Sr{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class eg extends Sr{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class tg extends Sr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Ad extends Sr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class ga extends Sr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Eu extends Sr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Au extends Sr{getDefault(){return null}set(i){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class uc extends Sr{getDefault(){return null}set(i){var h;if(i===this.current&&!this.dirty)return;const p=this.gl;Vs(p)?p.bindVertexArray(i):(h=p.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class Iu extends Sr{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class rg extends Sr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Ga extends Sr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Oo extends Sr{constructor(i,h){super(i),this.context=i,this.parent=h}getDefault(){return null}}class ng extends Oo{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Id extends Oo{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class cr extends Oo{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}const hc="Framebuffer is not complete";class $y{constructor(i,h,p,m,v){this.context=i,this.width=h,this.height=p;const w=i.gl,I=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new ng(i,I),m)this.depthAttachment=v?new cr(i,I):new Id(i,I);else if(v)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error(hc)}destroy(){const i=this.context.gl,h=this.colorAttachment.get();if(h&&i.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&i.deleteRenderbuffer(p)}i.deleteFramebuffer(this.framebuffer)}}class ig{constructor(i){var h,p;if(this.gl=i,this.clearColor=new bd(this),this.clearDepth=new wd(this),this.clearStencil=new Kp(this),this.colorMask=new Td(this),this.depthMask=new fa(this),this.stencilMask=new Sd(this),this.stencilFunc=new zy(this),this.stencilOp=new By(this),this.stencilTest=new Uy(this),this.depthRange=new Vy(this),this.depthTest=new Qp(this),this.depthFunc=new jy(this),this.blend=new Jp(this),this.blendFunc=new wu(this),this.blendColor=new Tu(this),this.blendEquation=new Su(this),this.cullFace=new Ed(this),this.cullFaceSide=new pa(this),this.frontFace=new cc(this),this.program=new Ya(this),this.activeTexture=new is(this),this.viewport=new eg(this),this.bindFramebuffer=new tg(this),this.bindRenderbuffer=new Ad(this),this.bindTexture=new ga(this),this.bindVertexBuffer=new Eu(this),this.bindElementBuffer=new Au(this),this.bindVertexArray=new uc(this),this.pixelStoreUnpack=new Iu(this),this.pixelStoreUnpackPremultiplyAlpha=new rg(this),this.pixelStoreUnpackFlipY=new Ga(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),Vs(i)){this.HALF_FLOAT=i.HALF_FLOAT;const m=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=i.RGBA16F)!==null&&h!==void 0?h:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=i.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const m=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,h){return new Gp(this,i,h)}createVertexBuffer(i,h,p){return new ao(this,i,h,p)}createRenderbuffer(i,h,p){const m=this.gl,v=m.createRenderbuffer();return this.bindRenderbuffer.set(v),m.renderbufferStorage(m.RENDERBUFFER,i,h,p),this.bindRenderbuffer.set(null),v}createFramebuffer(i,h,p,m){return new $y(this,i,h,p,m)}clear({color:i,depth:h,stencil:p}){const m=this.gl;let v=0;i&&(v|=m.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(v|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p!==void 0&&(v|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(v)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){a.bH(i.blendFunction,Zr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return Vs(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var h;return Vs(this.gl)?this.gl.deleteVertexArray(i):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}let Fo;function sg(_,i,h,p,m){const v=_.context,w=_.transform,I=v.gl,P=_.useProgram("collisionBox"),k=[];let D=0,z=0;for(let ne=0;ne<p.length;ne++){const ae=p[ne],de=i.getTile(ae).getBucket(h);if(!de)continue;const ue=m?de.textCollisionBox:de.iconCollisionBox,ge=de.collisionCircleArray;ge.length>0&&(k.push({circleArray:ge,circleOffset:z,coord:ae}),D+=ge.length/4,z=D),ue&&P.draw(v,I.LINES,qt.disabled,mr.disabled,_.colorModeForRenderPass(),Lt.disabled,vu(_.transform),_.style.map.terrain&&_.style.map.terrain.getTerrainData(ae),w.getProjectionData({overscaledTileID:ae,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),h.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,null,_.transform.zoom,null,null,ue.collisionVertexBuffer)}if(!m||!k.length)return;const L=_.useProgram("collisionCircle"),U=new a.b$;U.resize(4*D),U._trim();let W=0;for(const ne of k)for(let ae=0;ae<ne.circleArray.length/4;ae++){const de=4*ae,ue=ne.circleArray[de+0],ge=ne.circleArray[de+1],ye=ne.circleArray[de+2],he=ne.circleArray[de+3];U.emplace(W++,ue,ge,ye,he,0),U.emplace(W++,ue,ge,ye,he,1),U.emplace(W++,ue,ge,ye,he,2),U.emplace(W++,ue,ge,ye,he,3)}(!Fo||Fo.length<2*D)&&(Fo=function(ne){const ae=2*ne,de=new a.c1;de.resize(ae),de._trim();for(let ue=0;ue<ae;ue++){const ge=6*ue;de.uint16[ge+0]=4*ue+0,de.uint16[ge+1]=4*ue+1,de.uint16[ge+2]=4*ue+2,de.uint16[ge+3]=4*ue+2,de.uint16[ge+4]=4*ue+3,de.uint16[ge+5]=4*ue+0}return de}(D));const te=v.createIndexBuffer(Fo,!0),ee=v.createVertexBuffer(U,a.c0.members,!0);for(const ne of k){const ae=Oy(_.transform);L.draw(v,I.TRIANGLES,qt.disabled,mr.disabled,_.colorModeForRenderPass(),Lt.disabled,ae,_.style.map.terrain&&_.style.map.terrain.getTerrainData(ne.coord),null,h.id,ee,te,a.aM.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,_.transform.zoom,null,null,null)}ee.destroy(),te.destroy()}const Wy=a.ag(new Float32Array(16));function og(_,i,h,p,m,v){const{horizontalAlign:w,verticalAlign:I}=a.aH(_);return new a.P((-(w-.5)*i/m+p[0])*v,(-(I-.5)*h/m+p[1])*v)}function Hy(_,i,h,p,m,v){const w=i.tileAnchorPoint.add(new a.P(i.translation[0],i.translation[1]));if(i.pitchWithMap){let I=p.mult(v);h||(I=I.rotate(-m));const P=w.add(I);return kr(P.x,P.y,i.pitchedLabelPlaneMatrix,i.getElevation).point}if(h){const I=Or(i.tileAnchorPoint.x+1,i.tileAnchorPoint.y,i).point.sub(_),P=Math.atan(I.y/I.x)+(I.x<0?Math.PI:0);return _.add(p.rotate(P))}return _.add(p)}function Pd(_,i,h,p,m,v,w,I,P,k,D,z){const L=_.text.placedSymbolArray,U=_.text.dynamicLayoutVertexArray,W=_.icon.dynamicLayoutVertexArray,te={};U.clear();for(let ee=0;ee<L.length;ee++){const ne=L.get(ee),ae=ne.hidden||!ne.crossTileID||_.allowVerticalPlacement&&!ne.placedOrientation?null:p[ne.crossTileID];if(ae){const de=new a.P(ne.anchorX,ne.anchorY),ue={getElevation:z,width:m.width,height:m.height,pitchedLabelPlaneMatrix:v,pitchWithMap:h,transform:m,tileAnchorPoint:de,translation:k,unwrappedTileID:D},ge=h?fi(de.x,de.y,ue):Or(de.x,de.y,ue),ye=$e(m.cameraToCenterDistance,ge.signedDistanceFromCamera);let he=a.ap(_.textSizeData,I,ne)*ye/a.aB;h&&(he*=_.tilePixelRatio/w);const{width:Ee,height:Le,anchor:ke,textOffset:De,textBoxScale:Ne}=ae,et=og(ke,Ee,Le,De,Ne,he),nt=m.getPitchedTextCorrection(de.x+k[0],de.y+k[1],D),Xe=Hy(ge.point,ue,i,et,-m.bearingInRadians,nt),wt=_.allowVerticalPlacement&&ne.placedOrientation===a.ao.vertical?Math.PI/2:0;for(let Kt=0;Kt<ne.numGlyphs;Kt++)a.av(U,Xe,wt);P&&ne.associatedIconIndex>=0&&(te[ne.associatedIconIndex]={shiftedAnchor:Xe,angle:wt})}else Pi(ne.numGlyphs,U)}if(P){W.clear();const ee=_.icon.placedSymbolArray;for(let ne=0;ne<ee.length;ne++){const ae=ee.get(ne);if(ae.hidden)Pi(ae.numGlyphs,W);else{const de=te[ne];if(de)for(let ue=0;ue<ae.numGlyphs;ue++)a.av(W,de.shiftedAnchor,de.angle);else Pi(ae.numGlyphs,W)}}_.icon.dynamicLayoutVertexBuffer.updateData(W)}_.text.dynamicLayoutVertexBuffer.updateData(U)}function Pu(_,i,h){return h.iconsInText&&i?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function dc(_,i,h,p,m,v,w,I,P,k,D,z,L){const U=_.context,W=U.gl,te=_.transform,ee=I==="map",ne=P==="map",ae=I!=="viewport"&&h.layout.get("symbol-placement")!=="point",de=ee&&!ne&&!ae,ue=!h.layout.get("symbol-sort-key").isConstant();let ge=!1;const ye=_.getDepthModeForSublayer(0,qt.ReadOnly),he=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ee=[],Le=te.getCircleRadiusCorrection();for(const ke of p){const De=i.getTile(ke),Ne=De.getBucket(h);if(!Ne)continue;const et=m?Ne.text:Ne.icon;if(!et||!et.segments.get().length||!et.hasVisibleVertices)continue;const nt=et.programConfigurations.get(h.id),Xe=m||Ne.sdfIcons,wt=m?Ne.textSizeData:Ne.iconSizeData,Kt=ne||te.pitch!==0,Ar=_.useProgram(Pu(Xe,m,Ne),nt),zr=a.an(wt,te.zoom),Fr=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ke);let tn,on,Yt,Br,En=[0,0],kn=null;if(m)on=De.glyphAtlasTexture,Yt=W.LINEAR,tn=De.glyphAtlasTexture.size,Ne.iconsInText&&(En=De.imageAtlasTexture.size,kn=De.imageAtlasTexture,Br=Kt||_.options.rotating||_.options.zooming||wt.kind==="composite"||wt.kind==="camera"?W.LINEAR:W.NEAREST);else{const An=h.layout.get("icon-size").constantOr(0)!==1||Ne.iconsNeedLinear;on=De.imageAtlasTexture,Yt=Xe||_.options.rotating||_.options.zooming||An||Kt?W.LINEAR:W.NEAREST,tn=De.imageAtlasTexture.size}const Bn=a.aC(De,1,_.transform.zoom),yi=it(ee,_.transform,Bn),bs=a.L();a.aq(bs,yi);const Lo=Dt(ne,ee,_.transform,Bn),zo=a.aD(te,De,v,w),ll=te.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),cl=he&&Ne.hasTextData(),wa=h.layout.get("icon-text-fit")!=="none"&&cl&&Ne.hasIconData();if(ae){const An=_.style.map.terrain?(as,In)=>_.style.map.terrain.getElevation(ke,as,In):null,Dn=h.layout.get("text-rotation-alignment")==="map";Dr(Ne,_,m,yi,bs,ne,k,Dn,ke.toUnwrapped(),te.width,te.height,zo,An)}const Ta=m&&he||wa,Ri=ae||Ta?Wy:ne?yi:_.transform.clipSpaceToPixelsMatrix,ws=Xe&&h.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let vi;vi=Xe?Ne.iconsInText?Ly(wt.kind,zr,de,ne,ae,Ta,_,Ri,Lo,zo,tn,En,Le):Zp(wt.kind,zr,de,ne,ae,Ta,_,Ri,Lo,zo,m,tn,0,Le):lc(wt.kind,zr,de,ne,ae,Ta,_,Ri,Lo,zo,m,tn,Le);const Bo={program:Ar,buffers:et,uniformValues:vi,projectionData:ll,atlasTexture:on,atlasTextureIcon:kn,atlasInterpolation:Yt,atlasInterpolationIcon:Br,isSDF:Xe,hasHalo:ws};if(ue&&Ne.canOverlap){ge=!0;const An=et.segments.get();for(const Dn of An)Ee.push({segments:new a.aM([Dn]),sortKey:Dn.sortKey,state:Bo,terrainData:Fr})}else Ee.push({segments:et.segments,sortKey:0,state:Bo,terrainData:Fr})}ge&&Ee.sort((ke,De)=>ke.sortKey-De.sortKey);for(const ke of Ee){const De=ke.state;if(U.activeTexture.set(W.TEXTURE0),De.atlasTexture.bind(De.atlasInterpolation,W.CLAMP_TO_EDGE),De.atlasTextureIcon&&(U.activeTexture.set(W.TEXTURE1),De.atlasTextureIcon&&De.atlasTextureIcon.bind(De.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),De.isSDF){const Ne=De.uniformValues;De.hasHalo&&(Ne.u_is_halo=1,fc(De.buffers,ke.segments,h,_,De.program,ye,D,z,Ne,De.projectionData,ke.terrainData)),Ne.u_is_halo=0}fc(De.buffers,ke.segments,h,_,De.program,ye,D,z,De.uniformValues,De.projectionData,ke.terrainData)}}function fc(_,i,h,p,m,v,w,I,P,k,D){const z=p.context;m.draw(z,z.gl.TRIANGLES,v,w,I,Lt.backCCW,P,D,k,h.id,_.layoutVertexBuffer,_.indexBuffer,i,h.paint,p.transform.zoom,_.programConfigurations.get(h.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function Cd(_,i,h,p,m){const v=_.context,w=v.gl,I=mr.disabled,P=new Zr([w.ONE,w.ONE],a.bf.transparent,[!0,!0,!0,!0]),k=i.getBucket(h);if(!k)return;const D=p.key;let z=h.heatmapFbos.get(D);z||(z=pc(v,i.tileSize,i.tileSize),h.heatmapFbos.set(D,z)),v.bindFramebuffer.set(z.framebuffer),v.viewport.set([0,0,i.tileSize,i.tileSize]),v.clear({color:a.bf.transparent});const L=k.programConfigurations.get(h.id),U=_.useProgram("heatmap",L,!m),W=_.transform.getProjectionData({overscaledTileID:i.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),te=_.style.map.terrain.getTerrainData(p);U.draw(v,w.TRIANGLES,qt.disabled,I,P,Lt.disabled,jp(i,_.transform.zoom,h.paint.get("heatmap-intensity"),1),te,W,h.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,h.paint,_.transform.zoom,L)}function ag(_,i,h,p,m){const v=_.context,w=v.gl,I=_.transform;v.setColorMode(_.colorModeForRenderPass());const P=gc(v,i),k=h.key,D=i.heatmapFbos.get(k);if(!D)return;v.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,D.colorAttachment.get()),v.activeTexture.set(w.TEXTURE1),P.bind(w.LINEAR,w.CLAMP_TO_EDGE);const z=I.getProjectionData({overscaledTileID:h,applyTerrainMatrix:m,applyGlobeMatrix:!p});_.useProgram("heatmapTexture").draw(v,w.TRIANGLES,qt.disabled,mr.disabled,_.colorModeForRenderPass(),Lt.disabled,gd(_,i,0,1),null,z,i.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments,i.paint,I.zoom),D.destroy(),i.heatmapFbos.delete(k)}function pc(_,i,h){var p,m;const v=_.gl,w=v.createTexture();v.bindTexture(v.TEXTURE_2D,w),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR);const I=(p=_.HALF_FLOAT)!==null&&p!==void 0?p:v.UNSIGNED_BYTE,P=(m=_.RGBA16F)!==null&&m!==void 0?m:v.RGBA;v.texImage2D(v.TEXTURE_2D,0,P,i,h,0,v.RGBA,I,null);const k=_.createFramebuffer(i,h,!1,!1);return k.colorAttachment.set(w),k}function gc(_,i){return i.colorRampTexture||(i.colorRampTexture=new a.T(_,i.colorRamp,_.gl.RGBA)),i.colorRampTexture}function mc(_,i,h,p,m){if(!h||!p||!p.imageAtlas)return;const v=p.imageAtlas.patternPositions;let w=v[h.to.toString()],I=v[h.from.toString()];if(!w&&I&&(w=I),!I&&w&&(I=w),!w||!I){const P=m.getPaintProperty(i);w=v[P],I=v[P]}w&&I&&_.setConstantPatternPositions(w,I)}function Cu(_,i,h,p,m,v,w,I){const P=_.context.gl,k="fill-pattern",D=h.paint.get(k),z=D&&D.constantOr(1),L=h.getCrossfadeParameters();let U,W,te,ee,ne;const ae=_.transform,de=h.paint.get("fill-translate"),ue=h.paint.get("fill-translate-anchor");w?(W=z&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=P.LINES):(W=z?"fillPattern":"fill",U=P.TRIANGLES);const ge=D.constantOr(null);for(const ye of p){const he=i.getTile(ye);if(z&&!he.patternsLoaded())continue;const Ee=he.getBucket(h);if(!Ee)continue;const Le=Ee.programConfigurations.get(h.id),ke=_.useProgram(W,Le),De=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ye);z&&(_.context.activeTexture.set(P.TEXTURE0),he.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Le.updatePaintBuffers(L)),mc(Le,k,ge,he,h);const Ne=ae.getProjectionData({overscaledTileID:ye,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),et=a.aD(ae,he,de,ue);if(w){ee=Ee.indexBuffer2,ne=Ee.segments2;const Xe=[P.drawingBufferWidth,P.drawingBufferHeight];te=W==="fillOutlinePattern"&&z?oc(_,L,he,Xe,et):sc(Xe,et)}else ee=Ee.indexBuffer,ne=Ee.segments,te=z?yu(_,L,he,et):{u_fill_translate:et};const nt=_.stencilModeForClipping(ye);ke.draw(_.context,U,m,nt,v,Lt.backCCW,te,De,Ne,h.id,Ee.layoutVertexBuffer,ee,ne,h.paint,_.transform.zoom,Le)}}function Md(_,i,h,p,m,v,w,I){const P=_.context,k=P.gl,D="fill-extrusion-pattern",z=h.paint.get(D),L=z.constantOr(1),U=h.getCrossfadeParameters(),W=h.paint.get("fill-extrusion-opacity"),te=z.constantOr(null),ee=_.transform;for(const ne of p){const ae=i.getTile(ne),de=ae.getBucket(h);if(!de)continue;const ue=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ne),ge=de.programConfigurations.get(h.id),ye=_.useProgram(L?"fillExtrusionPattern":"fillExtrusion",ge);L&&(_.context.activeTexture.set(k.TEXTURE0),ae.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ge.updatePaintBuffers(U));const he=ee.getProjectionData({overscaledTileID:ne,applyGlobeMatrix:!I,applyTerrainMatrix:!0});mc(ge,D,te,ae,h);const Ee=a.aD(ee,ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Le=h.paint.get("fill-extrusion-vertical-gradient"),ke=L?ky(_,Le,W,Ee,ne,U,ae):gs(_,Le,W,Ee);ye.draw(P,P.gl.TRIANGLES,m,v,w,Lt.backCCW,ke,ue,he,h.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,h.paint,_.transform.zoom,ge,_.style.map.terrain&&de.centroidVertexBuffer)}}function ma(_,i,h,p,m,v,w,I,P){var k;const D=_.style.projection,z=_.context,L=_.transform,U=z.gl,W=[`#define NUM_ILLUMINATION_SOURCES ${h.paint.get("hillshade-highlight-color").values.length}`],te=_.useProgram("hillshade",null,!1,W),ee=!_.options.moving;for(const ne of p){const ae=i.getTile(ne),de=ae.fbo;if(!de)continue;const ue=D.getMeshFromTileID(z,ne.canonical,I,!0,"raster"),ge=(k=_.style.map.terrain)===null||k===void 0?void 0:k.getTerrainData(ne);z.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,de.colorAttachment.get());const ye=L.getProjectionData({overscaledTileID:ne,aligned:ee,applyGlobeMatrix:!P,applyTerrainMatrix:!0});te.draw(z,U.TRIANGLES,v,m[ne.overscaledZ],w,Lt.backCCW,Fy(_,ae,h),ge,ye,h.id,ue.vertexBuffer,ue.indexBuffer,ue.segments)}}function Rd(_,i,h,p,m,v,w,I,P){var k;const D=_.style.projection,z=_.context,L=_.transform,U=z.gl,W=_.useProgram("colorRelief"),te=!_.options.moving;let ee=!0,ne=0;for(const ae of p){const de=i.getTile(ae),ue=de.dem;if(ee){const ke=U.getParameter(U.MAX_TEXTURE_SIZE),{elevationTexture:De,colorTexture:Ne}=h.getColorRampTextures(z,ke,ue.getUnpackVector());z.activeTexture.set(U.TEXTURE1),De.bind(U.NEAREST,U.CLAMP_TO_EDGE),z.activeTexture.set(U.TEXTURE4),Ne.bind(U.LINEAR,U.CLAMP_TO_EDGE),ee=!1,ne=De.size[0]}if(!ue||!ue.data)continue;const ge=ue.stride,ye=ue.getPixels();if(z.activeTexture.set(U.TEXTURE0),z.pixelStoreUnpackPremultiplyAlpha.set(!1),de.demTexture=de.demTexture||_.getTileTexture(ge),de.demTexture){const ke=de.demTexture;ke.update(ye,{premultiply:!1}),ke.bind(U.LINEAR,U.CLAMP_TO_EDGE)}else de.demTexture=new a.T(z,ye,U.RGBA,{premultiply:!1}),de.demTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const he=D.getMeshFromTileID(z,ae.canonical,I,!0,"raster"),Ee=(k=_.style.map.terrain)===null||k===void 0?void 0:k.getTerrainData(ae),Le=L.getProjectionData({overscaledTileID:ae,aligned:te,applyGlobeMatrix:!P,applyTerrainMatrix:!0});W.draw(z,U.TRIANGLES,v,m[ae.overscaledZ],w,Lt.backCCW,Wp(h,de.dem,ne),Ee,Le,h.id,he.vertexBuffer,he.indexBuffer,he.segments)}}const Mu=[new a.P(0,0),new a.P(a.$,0),new a.P(a.$,a.$),new a.P(0,a.$)];function _a(_,i,h,p,m,v,w,I,P=!1,k=!1){const D=p[p.length-1].overscaledZ,z=_.context,L=z.gl,U=_.useProgram("raster"),W=_.transform,te=_.style.projection,ee=_.colorModeForRenderPass(),ne=!_.options.moving;for(const ae of p){const de=_.getDepthModeForSublayer(ae.overscaledZ-D,h.paint.get("raster-opacity")===1?qt.ReadWrite:qt.ReadOnly,L.LESS),ue=i.getTile(ae);ue.registerFadeDuration(h.paint.get("raster-fade-duration"));const ge=i.findLoadedParent(ae,0),ye=i.findLoadedSibling(ae),he=kd(ue,ge||ye||null,i,h,_.transform,_.style.map.terrain);let Ee,Le;const ke=h.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;z.activeTexture.set(L.TEXTURE0),ue.texture.bind(ke,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),z.activeTexture.set(L.TEXTURE1),ge?(ge.texture.bind(ke,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),Ee=Math.pow(2,ge.tileID.overscaledZ-ue.tileID.overscaledZ),Le=[ue.tileID.canonical.x*Ee%1,ue.tileID.canonical.y*Ee%1]):ue.texture.bind(ke,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),ue.texture.useMipmap&&z.extTextureFilterAnisotropic&&_.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const De=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ae),Ne=W.getProjectionData({overscaledTileID:ae,aligned:ne,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),et=ac(Le||[0,0],Ee||1,he,h,I),nt=te.getMeshFromTileID(z,ae.canonical,v,w,"raster");U.draw(z,L.TRIANGLES,de,m?m[ae.overscaledZ]:mr.disabled,ee,P?Lt.frontCCW:Lt.backCCW,et,De,Ne,h.id,nt.vertexBuffer,nt.indexBuffer,nt.segments)}}function kd(_,i,h,p,m,v){const w=p.paint.get("raster-fade-duration");if(!v&&w>0){const I=F.now(),P=(I-_.timeAdded)/w,k=i?(I-i.timeAdded)/w:-1,D=h.getSource(),z=ft(m,{tileSize:D.tileSize,roundZoom:D.roundZoom}),L=!i||Math.abs(i.tileID.overscaledZ-z)>Math.abs(_.tileID.overscaledZ-z),U=L&&_.refreshedUponExpiration?1:a.ah(L?P:1-k,0,1);return _.refreshedUponExpiration&&P>=1&&(_.refreshedUponExpiration=!1),i?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}const lg=new a.bf(1,0,0,1),cg=new a.bf(0,1,0,1),Ru=new a.bf(0,0,1,1),Dd=new a.bf(1,0,1,1),Xy=new a.bf(0,1,1,1);function Od(_,i,h,p){Ws(_,0,i+h/2,_.transform.width,h,p)}function sn(_,i,h,p){Ws(_,i-h/2,0,h,_.transform.height,p)}function Ws(_,i,h,p,m,v){const w=_.context,I=w.gl;I.enable(I.SCISSOR_TEST),I.scissor(i*_.pixelRatio,h*_.pixelRatio,p*_.pixelRatio,m*_.pixelRatio),w.clear({color:v}),I.disable(I.SCISSOR_TEST)}function ss(_,i,h){const p=_.context,m=p.gl,v=_.useProgram("debug"),w=qt.disabled,I=mr.disabled,P=_.colorModeForRenderPass(),k="$debug",D=_.style.map.terrain&&_.style.map.terrain.getTerrainData(h);p.activeTexture.set(m.TEXTURE0);const z=i.getTileByID(h.key).latestRawTileData,L=Math.floor((z&&z.byteLength||0)/1024),U=i.getTile(h).tileSize,W=512/Math.min(U,512)*(h.overscaledZ/_.transform.zoom)*.5;let te=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(te+=` => ${h.overscaledZ}`),function(ne,ae){ne.initDebugOverlayCanvas();const de=ne.debugOverlayCanvas,ue=ne.context.gl,ge=ne.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,de.width,de.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(ae,5,5),ge.strokeText(ae,5,5),ne.debugOverlayTexture.update(de),ne.debugOverlayTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE)}(_,`${te} ${L}kB`);const ee=_.transform.getProjectionData({overscaledTileID:h,applyGlobeMatrix:!0,applyTerrainMatrix:!0});v.draw(p,m.TRIANGLES,w,I,Zr.alphaBlended,Lt.disabled,ha(a.bf.transparent,W),null,ee,k,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),v.draw(p,m.LINE_STRIP,w,I,P,Lt.disabled,ha(a.bf.red),D,ee,k,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function ku(_,i,h,p){const{isRenderingGlobe:m}=p,v=_.context,w=v.gl,I=_.transform,P=_.colorModeForRenderPass(),k=_.getDepthModeFor3D(),D=_.useProgram("terrain");v.bindFramebuffer.set(null),v.viewport.set([0,0,_.width,_.height]);for(const z of h){const L=i.getTerrainMesh(z.tileID),U=_.renderToTexture.getTexture(z),W=i.getTerrainData(z.tileID);v.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,U.texture);const te=i.getMeshFrameDelta(I.zoom),ee=I.calculateFogMatrix(z.tileID.toUnwrapped()),ne=mu(te,ee,_.style.sky,I.pitch,m),ae=I.getProjectionData({overscaledTileID:z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});D.draw(v,w.TRIANGLES,k,mr.disabled,P,Lt.backCCW,ne,W,ae,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}}function _c(_,i){if(!i.mesh){const h=new a.aL;h.emplaceBack(-1,-1),h.emplaceBack(1,-1),h.emplaceBack(1,1),h.emplaceBack(-1,1);const p=new a.aN;p.emplaceBack(0,1,2),p.emplaceBack(0,2,3),i.mesh=new sa(_.createVertexBuffer(h,Do.members),_.createIndexBuffer(p),a.aM.simpleSegment(0,0,h.length,p.length))}return i.mesh}class ug{constructor(i,h){this.context=new ig(i),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Bt.maxUnderzooming+Bt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ko}resize(i,h,p){if(this.width=Math.floor(i*p),this.height=Math.floor(h*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const i=this.context,h=new a.aL;h.emplaceBack(0,0),h.emplaceBack(a.$,0),h.emplaceBack(0,a.$),h.emplaceBack(a.$,a.$),this.tileExtentBuffer=i.createVertexBuffer(h,Do.members),this.tileExtentSegments=a.aM.simpleSegment(0,0,4,2);const p=new a.aL;p.emplaceBack(0,0),p.emplaceBack(a.$,0),p.emplaceBack(0,a.$),p.emplaceBack(a.$,a.$),this.debugBuffer=i.createVertexBuffer(p,Do.members),this.debugSegments=a.aM.simpleSegment(0,0,4,5);const m=new a.c6;m.emplaceBack(0,0,0,0),m.emplaceBack(a.$,0,a.$,0),m.emplaceBack(0,a.$,0,a.$),m.emplaceBack(a.$,a.$,a.$,a.$),this.rasterBoundsBuffer=i.createVertexBuffer(m,My.members),this.rasterBoundsSegments=a.aM.simpleSegment(0,0,4,2);const v=new a.aL;v.emplaceBack(0,0),v.emplaceBack(a.$,0),v.emplaceBack(0,a.$),v.emplaceBack(a.$,a.$),this.rasterBoundsBufferPosOnly=i.createVertexBuffer(v,Do.members),this.rasterBoundsSegmentsPosOnly=a.aM.simpleSegment(0,0,4,5);const w=new a.aL;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(w,Do.members),this.viewportSegments=a.aM.simpleSegment(0,0,4,2);const I=new a.c7;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(I);const P=new a.aN;P.emplaceBack(1,0,2),P.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(P);const k=this.context.gl;this.stencilClearMode=new mr({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.tileExtentMesh=new sa(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const i=this.context,h=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.L();a.bY(p,0,this.width,this.height,0,0,1),a.N(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]);const m={mainMatrix:p,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:p};this.useProgram("clippingMask",null,!0).draw(i,h.TRIANGLES,qt.disabled,this.stencilClearMode,Zr.disabled,Lt.disabled,null,null,m,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,h,p){if(this.currentStencilSource===i.source||!i.isTileClipped()||!h||!h.length)return;this.currentStencilSource=i.source,this.nextStencilID+h.length>256&&this.clearStencil();const m=this.context;m.setColorMode(Zr.disabled),m.setDepthMode(qt.disabled);const v={};for(const w of h)v[w.key]=this.nextStencilID++;this._renderTileMasks(v,h,p,!0),this._renderTileMasks(v,h,p,!1),this._tileClippingMaskIDs=v}_renderTileMasks(i,h,p,m){const v=this.context,w=v.gl,I=this.style.projection,P=this.transform,k=this.useProgram("clippingMask");for(const D of h){const z=i[D.key],L=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D),U=I.getMeshFromTileID(this.context,D.canonical,m,!0,"stencil"),W=P.getProjectionData({overscaledTileID:D,applyGlobeMatrix:!p,applyTerrainMatrix:!0});k.draw(v,w.TRIANGLES,qt.disabled,new mr({func:w.ALWAYS,mask:0},z,255,w.KEEP,w.KEEP,w.REPLACE),Zr.disabled,p?Lt.disabled:Lt.backCCW,null,L,W,"$clipping",U.vertexBuffer,U.indexBuffer,U.segments)}}_renderTilesDepthBuffer(){const i=this.context,h=i.gl,p=this.style.projection,m=this.transform,v=this.useProgram("depth"),w=this.getDepthModeFor3D(),I=Te(m,{tileSize:m.tileSize});for(const P of I){const k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P),D=p.getMeshFromTileID(this.context,P.canonical,!0,!0,"raster"),z=m.getProjectionData({overscaledTileID:P,applyGlobeMatrix:!0,applyTerrainMatrix:!0});v.draw(i,h.TRIANGLES,w,mr.disabled,Zr.disabled,Lt.backCCW,null,k,z,"$clipping",D.vertexBuffer,D.indexBuffer,D.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,h=this.context.gl;return new mr({func:h.NOTEQUAL,mask:255},i,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(i){const h=this.context.gl;return new mr({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,h.KEEP,h.KEEP,h.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(i){const h=this.context.gl,p=i.sort((w,I)=>I.overscaledZ-w.overscaledZ),m=p[p.length-1].overscaledZ,v=p[0].overscaledZ-m+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const w={};for(let I=0;I<v;I++)w[I+m]=new mr({func:h.GEQUAL,mask:255},I+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=v,[w,p]}return[{[m]:mr.disabled},p]}stencilConfigForOverlapTwoPass(i){const h=this.context.gl,p=i.sort((w,I)=>I.overscaledZ-w.overscaledZ),m=p[p.length-1].overscaledZ,v=p[0].overscaledZ-m+1;if(this.clearStencil(),v>1){const w={},I={};for(let P=0;P<v;P++)w[P+m]=new mr({func:h.GREATER,mask:255},v+1+P,255,h.KEEP,h.KEEP,h.REPLACE),I[P+m]=new mr({func:h.GREATER,mask:255},1+P,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID=2*v+1,[w,I,p]}return this.nextStencilID=3,[{[m]:new mr({func:h.GREATER,mask:255},2,255,h.KEEP,h.KEEP,h.REPLACE)},{[m]:new mr({func:h.GREATER,mask:255},1,255,h.KEEP,h.KEEP,h.REPLACE)},p]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Zr([i.CONSTANT_COLOR,i.ONE],new a.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Zr.unblended:Zr.alphaBlended}getDepthModeForSublayer(i,h,p){if(!this.opaquePassEnabledForLayer())return qt.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new qt(p||this.context.gl.LEQUAL,h,[m,m])}getDepthModeFor3D(){return new qt(this.context.gl.LEQUAL,qt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,h){var p,m;this.style=i,this.options=h,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(F.now()),this.imageManager.beginFrame();const v=this.style._order,w=this.style.sourceCaches,I={},P={},k={},D={isRenderingToTexture:!1,isRenderingGlobe:((p=i.projection)===null||p===void 0?void 0:p.transitionState)>0};for(const L in w){const U=w[L];U.used&&U.prepare(this.context),I[L]=U.getVisibleCoordinates(!1),P[L]=I[L].slice().reverse(),k[L]=U.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<v.length;L++)if(this.style._layers[v[L]].is3D()){this.opaquePassCutoff=L;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const L of v){const U=this.style._layers[L];if(!U.hasOffscreenPass()||U.isHidden(this.transform.zoom))continue;const W=P[U.source];(U.type==="custom"||W.length)&&this.renderLayer(this,w[U.source],U,W,D)}if((m=this.style.projection)===null||m===void 0||m.updateGPUdependent({context:this.context,useProgram:L=>this.useProgram(L)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.bf.black:a.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(L,U){const W=L.context,te=W.gl,ee=((ye,he,Ee)=>{const Le=Math.cos(he.rollInRadians),ke=Math.sin(he.rollInRadians),De=pe(he),Ne=he.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ye.properties.get("sky-color"),u_horizon_color:ye.properties.get("horizon-color"),u_horizon:[(he.width/2-De*ke)*Ee,(he.height/2+De*Le)*Ee],u_horizon_normal:[-ke,Le],u_sky_horizon_blend:ye.properties.get("sky-horizon-blend")*he.height/2*Ee,u_sky_blend:Ne}})(U,L.style.map.transform,L.pixelRatio),ne=new qt(te.LEQUAL,qt.ReadWrite,[0,1]),ae=mr.disabled,de=L.colorModeForRenderPass(),ue=L.useProgram("sky"),ge=_c(W,U);ue.draw(W,te.TRIANGLES,ne,ae,de,Lt.disabled,ee,null,void 0,"sky",ge.vertexBuffer,ge.indexBuffer,ge.segments)}(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[v[this.currentLayer]],U=w[L.source],W=I[L.source];this._renderTileClippingMasks(L,W,!1),this.renderLayer(this,U,L,W,D)}this.renderPass="translucent";let z=!1;for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const L=this.style._layers[v[this.currentLayer]],U=w[L.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(L,D))continue;this.opaquePassEnabledForLayer()||z||(z=!0,D.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const W=(L.type==="symbol"?k:P)[L.source];this._renderTileClippingMasks(L,I[L.source],!!this.renderToTexture),this.renderLayer(this,U,L,W,D)}if(D.isRenderingGlobe&&function(L,U,W){const te=L.context,ee=te.gl,ne=L.useProgram("atmosphere"),ae=new qt(ee.LEQUAL,qt.ReadOnly,[0,1]),de=L.transform,ue=function(Ne,et){const nt=Ne.properties.get("position"),Xe=[-nt.x,-nt.y,-nt.z],wt=a.ag(new Float64Array(16));return Ne.properties.get("anchor")==="map"&&(a.b6(wt,wt,et.rollInRadians),a.b7(wt,wt,-et.pitchInRadians),a.b6(wt,wt,et.bearingInRadians),a.b7(wt,wt,et.center.lat*Math.PI/180),a.bz(wt,wt,-et.center.lng*Math.PI/180)),a.c5(Xe,Xe,wt),Xe}(W,L.transform),ge=de.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ye=U.properties.get("atmosphere-blend")*ge.projectionTransition;if(ye===0)return;const he=Za(de.worldSize,de.center.lat),Ee=de.inverseProjectionMatrix,Le=new Float64Array(4);Le[3]=1,a.aw(Le,Le,de.modelViewProjectionMatrix),Le[0]/=Le[3],Le[1]/=Le[3],Le[2]/=Le[3],Le[3]=1,a.aw(Le,Le,Ee),Le[0]/=Le[3],Le[1]/=Le[3],Le[2]/=Le[3],Le[3]=1;const ke=((Ne,et,nt,Xe,wt)=>({u_sun_pos:Ne,u_atmosphere_blend:et,u_globe_position:nt,u_globe_radius:Xe,u_inv_proj_matrix:wt}))(ue,ye,[Le[0],Le[1],Le[2]],he,Ee),De=_c(te,U);ne.draw(te,ee.TRIANGLES,ae,mr.disabled,Zr.alphaBlended,Lt.disabled,ke,null,null,"atmosphere",De.vertexBuffer,De.indexBuffer,De.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const L=function(U,W){let te=null;const ee=Object.values(U._layers).flatMap(ue=>ue.source&&!ue.isHidden(W)?[U.sourceCaches[ue.source]]:[]),ne=ee.filter(ue=>ue.getSource().type==="vector"),ae=ee.filter(ue=>ue.getSource().type!=="vector"),de=ue=>{(!te||te.getSource().maxzoom<ue.getSource().maxzoom)&&(te=ue)};return ne.forEach(ue=>de(ue)),te||ae.forEach(ue=>de(ue)),te}(this.style,this.transform.zoom);L&&function(U,W,te){for(let ee=0;ee<te.length;ee++)ss(U,W,te[ee])}(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const U=L.transform.padding;Od(L,L.transform.height-(U.top||0),3,lg),Od(L,U.bottom||0,3,cg),sn(L,U.left||0,3,Ru),sn(L,L.transform.width-(U.right||0),3,Dd);const W=L.transform.centerPoint;(function(te,ee,ne,ae){Ws(te,ee-1,ne-10,2,20,ae),Ws(te,ee-10,ne-1,20,2,ae)})(L,W.x,L.transform.height-W.y,Xy)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,p=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=i?!a.c8(h,p):!a.c9(h,p)),m||(m=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),m&&(a.ca(h,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(v,w){const I=v.context,P=I.gl,k=v.transform,D=Zr.unblended,z=new qt(P.LEQUAL,qt.ReadWrite,[0,1]),L=w.sourceCache.getRenderableTiles(),U=v.useProgram("terrainDepth");I.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),I.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),I.clear({color:a.bf.transparent,depth:1});for(const W of L){const te=w.getTerrainMesh(W.tileID),ee=w.getTerrainData(W.tileID),ne=k.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ae={u_ele_delta:w.getMeshFrameDelta(k.zoom)};U.draw(I,P.TRIANGLES,z,mr.disabled,D,Lt.backCCW,ae,ee,ne,"terrain",te.vertexBuffer,te.indexBuffer,te.segments)}I.bindFramebuffer.set(null),I.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain),function(v,w){const I=v.context,P=I.gl,k=v.transform,D=Zr.unblended,z=new qt(P.LEQUAL,qt.ReadWrite,[0,1]),L=w.getCoordsTexture(),U=w.sourceCache.getRenderableTiles(),W=v.useProgram("terrainCoords");I.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),I.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),I.clear({color:a.bf.transparent,depth:1}),w.coordsIndex=[];for(const te of U){const ee=w.getTerrainMesh(te.tileID),ne=w.getTerrainData(te.tileID);I.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,L.texture);const ae={u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(k.zoom)},de=k.getProjectionData({overscaledTileID:te.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});W.draw(I,P.TRIANGLES,z,mr.disabled,D,Lt.backCCW,ae,ne,de,"terrain",ee.vertexBuffer,ee.indexBuffer,ee.segments),w.coordsIndex.push(te.tileID.key)}I.bindFramebuffer.set(null),I.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain))}renderLayer(i,h,p,m,v){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||(m||[]).length)&&(this.id=p.id,a.cb(p)?function(w,I,P,k,D,z){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:L}=z,U=mr.disabled,W=w.colorModeForRenderPass();(P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(te,ee,ne,ae,de,ue,ge,ye,he){const Ee=ee.transform,Le=ee.style.map.terrain,ke=de==="map",De=ue==="map";for(const Ne of te){const et=ae.getTile(Ne),nt=et.getBucket(ne);if(!nt||!nt.text||!nt.text.segments.get().length)continue;const Xe=a.an(nt.textSizeData,Ee.zoom),wt=a.aC(et,1,ee.transform.zoom),Kt=it(ke,ee.transform,wt),Ar=ne.layout.get("icon-text-fit")!=="none"&&nt.hasIconData();if(Xe){const zr=Math.pow(2,Ee.zoom-et.tileID.overscaledZ),Fr=Le?(tn,on)=>Le.getElevation(Ne,tn,on):null;Pd(nt,ke,De,he,Ee,Kt,zr,Xe,Ar,a.aD(Ee,et,ge,ye),Ne.toUnwrapped(),Fr)}}}(k,w,P,I,P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),D),P.paint.get("icon-opacity").constantOr(1)!==0&&dc(w,I,P,k,!1,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),P.layout.get("icon-rotation-alignment"),P.layout.get("icon-pitch-alignment"),P.layout.get("icon-keep-upright"),U,W,L),P.paint.get("text-opacity").constantOr(1)!==0&&dc(w,I,P,k,!0,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.layout.get("text-keep-upright"),U,W,L),I.map.showCollisionBoxes&&(sg(w,I,P,k,!0),sg(w,I,P,k,!1))}(i,h,p,m,this.style.placement.variableOffsets,v):a.cc(p)?function(w,I,P,k,D){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:z}=D,L=P.paint.get("circle-opacity"),U=P.paint.get("circle-stroke-width"),W=P.paint.get("circle-stroke-opacity"),te=!P.layout.get("circle-sort-key").isConstant();if(L.constantOr(1)===0&&(U.constantOr(1)===0||W.constantOr(1)===0))return;const ee=w.context,ne=ee.gl,ae=w.transform,de=w.getDepthModeForSublayer(0,qt.ReadOnly),ue=mr.disabled,ge=w.colorModeForRenderPass(),ye=[],he=ae.getCircleRadiusCorrection();for(let Ee=0;Ee<k.length;Ee++){const Le=k[Ee],ke=I.getTile(Le),De=ke.getBucket(P);if(!De)continue;const Ne=P.paint.get("circle-translate"),et=P.paint.get("circle-translate-anchor"),nt=a.aD(ae,ke,Ne,et),Xe=De.programConfigurations.get(P.id),wt=w.useProgram("circle",Xe),Kt=De.layoutVertexBuffer,Ar=De.indexBuffer,zr=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Le),Fr={programConfiguration:Xe,program:wt,layoutVertexBuffer:Kt,indexBuffer:Ar,uniformValues:Dy(w,ke,P,nt,he),terrainData:zr,projectionData:ae.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!z,applyTerrainMatrix:!0})};if(te){const tn=De.segments.get();for(const on of tn)ye.push({segments:new a.aM([on]),sortKey:on.sortKey,state:Fr})}else ye.push({segments:De.segments,sortKey:0,state:Fr})}te&&ye.sort((Ee,Le)=>Ee.sortKey-Le.sortKey);for(const Ee of ye){const{programConfiguration:Le,program:ke,layoutVertexBuffer:De,indexBuffer:Ne,uniformValues:et,terrainData:nt,projectionData:Xe}=Ee.state;ke.draw(ee,ne.TRIANGLES,de,ue,ge,Lt.backCCW,et,nt,Xe,P.id,De,Ne,Ee.segments,P.paint,w.transform.zoom,Le)}}(i,h,p,m,v):a.cd(p)?function(w,I,P,k,D){if(P.paint.get("heatmap-opacity")===0)return;const z=w.context,{isRenderingToTexture:L,isRenderingGlobe:U}=D;if(w.style.map.terrain){for(const W of k){const te=I.getTile(W);I.hasRenderableParent(W)||(w.renderPass==="offscreen"?Cd(w,te,P,W,U):w.renderPass==="translucent"&&ag(w,P,W,L,U))}z.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?function(W,te,ee,ne){const ae=W.context,de=ae.gl,ue=W.transform,ge=mr.disabled,ye=new Zr([de.ONE,de.ONE],a.bf.transparent,[!0,!0,!0,!0]);(function(he,Ee,Le){const ke=he.gl;he.activeTexture.set(ke.TEXTURE1),he.viewport.set([0,0,Ee.width/4,Ee.height/4]);let De=Le.heatmapFbos.get(a.c2);De?(ke.bindTexture(ke.TEXTURE_2D,De.colorAttachment.get()),he.bindFramebuffer.set(De.framebuffer)):(De=pc(he,Ee.width/4,Ee.height/4),Le.heatmapFbos.set(a.c2,De))})(ae,W,ee),ae.clear({color:a.bf.transparent});for(let he=0;he<ne.length;he++){const Ee=ne[he];if(te.hasRenderableParent(Ee))continue;const Le=te.getTile(Ee),ke=Le.getBucket(ee);if(!ke)continue;const De=ke.programConfigurations.get(ee.id),Ne=W.useProgram("heatmap",De),et=ue.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),nt=ue.getCircleRadiusCorrection();Ne.draw(ae,de.TRIANGLES,qt.disabled,ge,ye,Lt.backCCW,jp(Le,ue.zoom,ee.paint.get("heatmap-intensity"),nt),null,et,ee.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,ee.paint,ue.zoom,De)}ae.viewport.set([0,0,W.width,W.height])}(w,I,P,k):w.renderPass==="translucent"&&function(W,te){const ee=W.context,ne=ee.gl;ee.setColorMode(W.colorModeForRenderPass());const ae=te.heatmapFbos.get(a.c2);ae&&(ee.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_2D,ae.colorAttachment.get()),ee.activeTexture.set(ne.TEXTURE1),gc(ee,te).bind(ne.LINEAR,ne.CLAMP_TO_EDGE),W.useProgram("heatmapTexture").draw(ee,ne.TRIANGLES,qt.disabled,mr.disabled,W.colorModeForRenderPass(),Lt.disabled,gd(W,te,0,1),null,null,te.id,W.viewportBuffer,W.quadTriangleIndexBuffer,W.viewportSegments,te.paint,W.transform.zoom))}(w,P)}(i,h,p,m,v):a.ce(p)?function(w,I,P,k,D){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:z}=D,L=P.paint.get("line-opacity"),U=P.paint.get("line-width");if(L.constantOr(1)===0||U.constantOr(1)===0)return;const W=w.getDepthModeForSublayer(0,qt.ReadOnly),te=w.colorModeForRenderPass(),ee=P.paint.get("line-dasharray"),ne=P.paint.get("line-pattern"),ae=ne.constantOr(1),de=P.paint.get("line-gradient"),ue=P.getCrossfadeParameters(),ge=ae?"linePattern":ee?"lineSDF":de?"lineGradient":"line",ye=w.context,he=ye.gl,Ee=w.transform;let Le=!0;for(const ke of k){const De=I.getTile(ke);if(ae&&!De.patternsLoaded())continue;const Ne=De.getBucket(P);if(!Ne)continue;const et=Ne.programConfigurations.get(P.id),nt=w.context.program.get(),Xe=w.useProgram(ge,et),wt=Le||Xe.program!==nt,Kt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(ke),Ar=ne.constantOr(null);if(Ar&&De.imageAtlas){const Yt=De.imageAtlas,Br=Yt.patternPositions[Ar.to.toString()],En=Yt.patternPositions[Ar.from.toString()];Br&&En&&et.setConstantPatternPositions(Br,En)}const zr=Ee.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),Fr=Ee.getPixelScale(),tn=ae?Xp(w,De,P,Fr,ue):ee?da(w,De,P,Fr,ee,ue):de?Hp(w,De,P,Fr,Ne.lineClipsArray.length):xu(w,De,P,Fr);if(ae)ye.activeTexture.set(he.TEXTURE0),De.imageAtlasTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE),et.updatePaintBuffers(ue);else if(ee&&(wt||w.lineAtlas.dirty))ye.activeTexture.set(he.TEXTURE0),w.lineAtlas.bind(ye);else if(de){const Yt=Ne.gradients[P.id];let Br=Yt.texture;if(P.gradientVersion!==Yt.version){let En=256;if(P.stepInterpolant){const kn=I.getSource().maxzoom,Bn=ke.canonical.z===kn?Math.ceil(1<<w.transform.maxZoom-ke.canonical.z):1;En=a.ah(a.c3(Ne.maxLineLength/a.$*1024*Bn),256,ye.maxTextureSize)}Yt.gradient=a.c4({expression:P.gradientExpression(),evaluationKey:"lineProgress",resolution:En,image:Yt.gradient||void 0,clips:Ne.lineClipsArray}),Yt.texture?Yt.texture.update(Yt.gradient):Yt.texture=new a.T(ye,Yt.gradient,he.RGBA),Yt.version=P.gradientVersion,Br=Yt.texture}ye.activeTexture.set(he.TEXTURE0),Br.bind(P.stepInterpolant?he.NEAREST:he.LINEAR,he.CLAMP_TO_EDGE)}const on=w.stencilModeForClipping(ke);Xe.draw(ye,he.TRIANGLES,W,on,te,Lt.disabled,tn,Kt,zr,P.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,P.paint,w.transform.zoom,et,Ne.layoutVertexBuffer2),Le=!1}}(i,h,p,m,v):a.cf(p)?function(w,I,P,k,D){const z=P.paint.get("fill-color"),L=P.paint.get("fill-opacity");if(L.constantOr(1)===0)return;const{isRenderingToTexture:U}=D,W=w.colorModeForRenderPass(),te=P.paint.get("fill-pattern"),ee=w.opaquePassEnabledForLayer()&&!te.constantOr(1)&&z.constantOr(a.bf.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===ee){const ne=w.getDepthModeForSublayer(1,w.renderPass==="opaque"?qt.ReadWrite:qt.ReadOnly);Cu(w,I,P,k,ne,W,!1,U)}if(w.renderPass==="translucent"&&P.paint.get("fill-antialias")){const ne=w.getDepthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,qt.ReadOnly);Cu(w,I,P,k,ne,W,!0,U)}}(i,h,p,m,v):a.cg(p)?function(w,I,P,k,D){const z=P.paint.get("fill-extrusion-opacity");if(z===0)return;const{isRenderingToTexture:L}=D;if(w.renderPass==="translucent"){const U=new qt(w.context.gl.LEQUAL,qt.ReadWrite,w.depthRangeFor3D);if(z!==1||P.paint.get("fill-extrusion-pattern").constantOr(1))Md(w,I,P,k,U,mr.disabled,Zr.disabled,L),Md(w,I,P,k,U,w.stencilModeFor3D(),w.colorModeForRenderPass(),L);else{const W=w.colorModeForRenderPass();Md(w,I,P,k,U,mr.disabled,W,L)}}}(i,h,p,m,v):a.ch(p)?function(w,I,P,k,D){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const{isRenderingToTexture:z}=D,L=w.context,U=w.style.projection.useSubdivision,W=w.getDepthModeForSublayer(0,qt.ReadOnly),te=w.colorModeForRenderPass();if(w.renderPass==="offscreen")(function(ee,ne,ae,de,ue,ge,ye){const he=ee.context,Ee=he.gl;for(const Le of ae){const ke=ne.getTile(Le),De=ke.dem;if(!De||!De.data||!ke.needsHillshadePrepare)continue;const Ne=De.dim,et=De.stride,nt=De.getPixels();if(he.activeTexture.set(Ee.TEXTURE1),he.pixelStoreUnpackPremultiplyAlpha.set(!1),ke.demTexture=ke.demTexture||ee.getTileTexture(et),ke.demTexture){const wt=ke.demTexture;wt.update(nt,{premultiply:!1}),wt.bind(Ee.NEAREST,Ee.CLAMP_TO_EDGE)}else ke.demTexture=new a.T(he,nt,Ee.RGBA,{premultiply:!1}),ke.demTexture.bind(Ee.NEAREST,Ee.CLAMP_TO_EDGE);he.activeTexture.set(Ee.TEXTURE0);let Xe=ke.fbo;if(!Xe){const wt=new a.T(he,{width:Ne,height:Ne,data:null},Ee.RGBA);wt.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),Xe=ke.fbo=he.createFramebuffer(Ne,Ne,!0,!1),Xe.colorAttachment.set(wt.texture)}he.bindFramebuffer.set(Xe.framebuffer),he.viewport.set([0,0,Ne,Ne]),ee.useProgram("hillshadePrepare").draw(he,Ee.TRIANGLES,ue,ge,ye,Lt.disabled,$p(ke.tileID,De),null,null,de.id,ee.rasterBoundsBuffer,ee.quadTriangleIndexBuffer,ee.rasterBoundsSegments),ke.needsHillshadePrepare=!1}})(w,I,k,P,W,mr.disabled,te),L.viewport.set([0,0,w.width,w.height]);else if(w.renderPass==="translucent")if(U){const[ee,ne,ae]=w.stencilConfigForOverlapTwoPass(k);ma(w,I,P,ae,ee,W,te,!1,z),ma(w,I,P,ae,ne,W,te,!0,z)}else{const[ee,ne]=w.getStencilConfigForOverlapAndUpdateStencilID(k);ma(w,I,P,ne,ee,W,te,!1,z)}}(i,h,p,m,v):a.ci(p)?function(w,I,P,k,D){if(w.renderPass!=="translucent"||!k.length)return;const{isRenderingToTexture:z}=D,L=w.style.projection.useSubdivision,U=w.getDepthModeForSublayer(0,qt.ReadOnly),W=w.colorModeForRenderPass();if(L){const[te,ee,ne]=w.stencilConfigForOverlapTwoPass(k);Rd(w,I,P,ne,te,U,W,!1,z),Rd(w,I,P,ne,ee,U,W,!0,z)}else{const[te,ee]=w.getStencilConfigForOverlapAndUpdateStencilID(k);Rd(w,I,P,ee,te,U,W,!1,z)}}(i,h,p,m,v):a.cj(p)?function(w,I,P,k,D){if(w.renderPass!=="translucent"||P.paint.get("raster-opacity")===0||!k.length)return;const{isRenderingToTexture:z}=D,L=I.getSource(),U=w.style.projection.useSubdivision;if(L instanceof sr)_a(w,I,P,k,null,!1,!1,L.tileCoords,L.flippedWindingOrder,z);else if(U){const[W,te,ee]=w.stencilConfigForOverlapTwoPass(k);_a(w,I,P,ee,W,!1,!0,Mu,!1,z),_a(w,I,P,ee,te,!0,!0,Mu,!1,z)}else{const[W,te]=w.getStencilConfigForOverlapAndUpdateStencilID(k);_a(w,I,P,te,W,!1,!0,Mu,!1,z)}}(i,h,p,m,v):a.ck(p)?function(w,I,P,k,D){const z=P.paint.get("background-color"),L=P.paint.get("background-opacity");if(L===0)return;const{isRenderingToTexture:U}=D,W=w.context,te=W.gl,ee=w.style.projection,ne=w.transform,ae=ne.tileSize,de=P.paint.get("background-pattern");if(w.isPatternMissing(de))return;const ue=!de&&z.a===1&&L===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==ue)return;const ge=mr.disabled,ye=w.getDepthModeForSublayer(0,ue==="opaque"?qt.ReadWrite:qt.ReadOnly),he=w.colorModeForRenderPass(),Ee=w.useProgram(de?"backgroundPattern":"background"),Le=k||Te(ne,{tileSize:ae,terrain:w.style.map.terrain});de&&(W.activeTexture.set(te.TEXTURE0),w.imageManager.bind(w.context));const ke=P.getCrossfadeParameters();for(const De of Le){const Ne=ne.getProjectionData({overscaledTileID:De,applyGlobeMatrix:!U,applyTerrainMatrix:!0}),et=de?Yp(L,w,de,{tileID:De,tileSize:ae},ke):qp(L,z),nt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(De),Xe=ee.getMeshFromTileID(W,De.canonical,!1,!0,"raster");Ee.draw(W,te.TRIANGLES,ye,ge,he,Lt.backCCW,et,nt,Ne,P.id,Xe.vertexBuffer,Xe.indexBuffer,Xe.segments)}}(i,0,p,m,v):a.cl(p)&&function(w,I,P,k){const{isRenderingGlobe:D}=k,z=w.context,L=P.implementation,U=w.style.projection,W=w.transform,te=W.getProjectionDataForCustomLayer(D),ee={farZ:W.farZ,nearZ:W.nearZ,fov:W.fov*Math.PI/180,modelViewProjectionMatrix:W.modelViewProjectionMatrix,projectionMatrix:W.projectionMatrix,shaderData:{variantName:U.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${U.shaderPreludeCode.vertexSource}`,define:U.shaderDefine},defaultProjectionData:te},ne=L.renderingMode?L.renderingMode:"2d";if(w.renderPass==="offscreen"){const ae=L.prerender;ae&&(w.setCustomLayerDefaults(),z.setColorMode(w.colorModeForRenderPass()),ae.call(L,z.gl,ee),z.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),z.setColorMode(w.colorModeForRenderPass()),z.setStencilMode(mr.disabled);const ae=ne==="3d"?w.getDepthModeFor3D():w.getDepthModeForSublayer(0,qt.ReadOnly);z.setDepthMode(ae),L.render(z.gl,ee),z.setDirty(),w.setBaseState(),z.bindFramebuffer.set(null)}}(i,0,p,v))}saveTileTexture(i){const h=this._tileTextures[i.size[0]];h?h.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const h=this._tileTextures[i];return h&&h.length>0?h.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const h=this.imageManager.getPattern(i.from.toString()),p=this.imageManager.getPattern(i.to.toString());return!h||!p}useProgram(i,h,p=!1,m=[]){this.cache=this.cache||{};const v=!!this.style.map.terrain,w=this.style.projection,I=p?ji.projectionMercator:w.shaderPreludeCode,P=p?so:w.shaderDefine,k=i+(h?h.cacheKey:"")+`/${p?oa:w.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(v?"/terrain":"")+(m?`/${m.join("/")}`:"");return this.cache[k]||(this.cache[k]=new pd(this.context,ji[i],h,xd[i],this._showOverdrawInspector,v,I,P,m)),this.cache[k]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:h}=this.context.gl;return this.width!==i||this.height!==h}}function ya(_,i){let h,p=!1,m=null,v=null;const w=()=>{m=null,p&&(_.apply(v,h),m=setTimeout(w,i),p=!1)};return(...I)=>(p=!0,v=this,h=I,m||w(),m)}class Du{constructor(i){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let p;return h.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(!this._isValidHash(h))return!1;const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:p,pitch:+(h[4]||0)}),!0},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const p=h.join("/");let m=p;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${p}`);let v=window.location.hash.replace(m,"");v.startsWith("#&")?v=v.slice(0,1)+v.slice(2):v==="#"&&(v="");let w=window.location.href.replace(/(#.+)?$/,v);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=ya(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(i){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,m),w=Math.round(h.lng*v)/v,I=Math.round(h.lat*v)/v,P=this._map.getBearing(),k=this._map.getPitch();let D="";if(D+=i?`/${w}/${I}/${p}`:`${p}/${I}/${w}`,(P||k)&&(D+="/"+Math.round(10*P)/10),k&&(D+=`/${Math.round(k)}`),this._hashName){const z=this._hashName;let L=!1;const U=window.location.hash.slice(1).split("&").map(W=>{const te=W.split("=")[0];return te===z?(L=!0,`${te}=${D}`):W}).filter(W=>W);return L||U.push(`${z}=${D}`),`#${U.join("&")}`}return`#${D}`}_isValidHash(i){if(i.length<3||i.some(isNaN))return!1;try{new a.S(+i[2],+i[1])}catch{return!1}const h=+i[0],p=+(i[3]||0),m=+(i[4]||0);return h>=this._map.getMinZoom()&&h<=this._map.getMaxZoom()&&p>=-180&&p<=180&&m>=this._map.getMinPitch()&&m<=this._map.getMaxPitch()}}const lo={linearity:.3,easing:a.cm(0,0,.3,1)},Fd=a.e({deceleration:2500,maxSpeed:1400},lo),hg=a.e({deceleration:20,maxSpeed:1400},lo),dg=a.e({deceleration:1e3,maxSpeed:360},lo),fg=a.e({deceleration:1e3,maxSpeed:90},lo),pg=a.e({deceleration:1e3,maxSpeed:360},lo);class gg{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:F.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,h=F.now();for(;i.length>0&&h-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,roll:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)h.zoom+=v.zoomDelta||0,h.bearing+=v.bearingDelta||0,h.pitch+=v.pitchDelta||0,h.roll+=v.rollDelta||0,v.panDelta&&h.pan._add(v.panDelta),v.around&&(h.around=v.around),v.pinchAround&&(h.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(h.pan.mag()){const v=Ka(h.pan.mag(),p,a.e({},Fd,i||{})),w=h.pan.mult(v.amount/h.pan.mag()),I=this._map.cameraHelper.handlePanInertia(w,this._map.transform);m.center=I.easingCenter,m.offset=I.easingOffset,ms(m,v)}if(h.zoom){const v=Ka(h.zoom,p,hg);m.zoom=this._map.transform.zoom+v.amount,ms(m,v)}if(h.bearing){const v=Ka(h.bearing,p,dg);m.bearing=this._map.transform.bearing+a.ah(v.amount,-179,179),ms(m,v)}if(h.pitch){const v=Ka(h.pitch,p,fg);m.pitch=this._map.transform.pitch+v.amount,ms(m,v)}if(h.roll){const v=Ka(h.roll,p,pg);m.roll=this._map.transform.roll+a.ah(v.amount,-179,179),ms(m,v)}if(m.zoom||m.bearing){const v=h.pinchAround===void 0?h.around:h.pinchAround;m.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function ms(_,i){(!_.duration||_.duration<i.duration)&&(_.duration=i.duration,_.easing=i.easing)}function Ka(_,i,h){const{maxSpeed:p,linearity:m,deceleration:v}=h,w=a.ah(_*m/(i/1e3),-p,p),I=Math.abs(w)/(v*m);return{easing:h.easing,duration:1e3*I,amount:w*(I/2)}}class Ci extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,p,m={}){p=p instanceof MouseEvent?p:new MouseEvent(i,p);const v=N.mousePos(h.getCanvas(),p),w=h.unproject(v);super(i,a.e({point:v,lngLat:w,originalEvent:p},m)),this._defaultPrevented=!1,this.target=h}}class Qa extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,p){const m=i==="touchend"?p.changedTouches:p.touches,v=N.touchPos(h.getCanvasContainer(),m),w=v.map(P=>h.unproject(P)),I=v.reduce((P,k,D,z)=>P.add(k.div(z.length)),new a.P(0,0));super(i,{points:v,point:I,lngLats:w,lngLat:h.unproject(I),originalEvent:p}),this._defaultPrevented=!1}}class Nd extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,p){super(i,{originalEvent:p}),this._defaultPrevented=!1}}class mg{constructor(i,h){this._map=i,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Nd(i.type,this._map,i))}mousedown(i,h){return this._mousedownPos=h,this._firePreventable(new Ci(i.type,this._map,i))}mouseup(i){this._map.fire(new Ci(i.type,this._map,i))}click(i,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Ci(i.type,this._map,i))}dblclick(i){return this._firePreventable(new Ci(i.type,this._map,i))}mouseover(i){this._map.fire(new Ci(i.type,this._map,i))}mouseout(i){this._map.fire(new Ci(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Qa(i.type,this._map,i))}touchmove(i){this._map.fire(new Qa(i.type,this._map,i))}touchend(i){this._map.fire(new Qa(i.type,this._map,i))}touchcancel(i){this._map.fire(new Qa(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _g{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new Ci(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ci("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new Ci(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ja{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.screenPointToLocation(a.P.convert(i),this._map.terrain)}}class Ld{constructor(i,h){this._map=i,this._tr=new Ja(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,h){this.isEnabled()&&i.shiftKey&&i.button===0&&(N.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(i,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=N.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const v=Math.min(m.x,p.x),w=Math.max(m.x,p.x),I=Math.min(m.y,p.y),P=Math.max(m.y,p.y);N.setTransform(this._box,`translate(${v}px,${I}px)`),this._box.style.width=w-v+"px",this._box.style.height=P-I+"px"}mouseupWindow(i,h){if(!this._active||i.button!==0)return;const p=this._startPos,m=h;if(this.reset(),N.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new a.l("boxzoomend",{originalEvent:i})),{cameraAnimation:v=>v.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(N.remove(this._box),this._box=null),N.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,h){return this._map.fire(new a.l(i,{originalEvent:h}))}}function el(_,i){if(_.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${i.length}`);const h={};for(let p=0;p<_.length;p++)h[_[p].identifier]=i[p];return h}class yg{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const v=new a.P(0,0);for(const w of m)v._add(w);return v.div(m.length)}(h),this.touches=el(p,h)))}touchmove(i,h,p){if(this.aborted||!this.centroid)return;const m=el(p,h);for(const v in this.touches){const w=m[v];(!w||w.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(i,h,p){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Mi{constructor(i){this.singleTap=new yg(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,h,p){this.singleTap.touchstart(i,h,p)}touchmove(i,h,p){this.singleTap.touchmove(i,h,p)}touchend(i,h,p){const m=this.singleTap.touchend(i,h,p);if(m){const v=i.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(m)<30;if(v&&w||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class _s{constructor(i){this._tr=new Ja(i),this._zoomIn=new Mi({numTouches:1,numTaps:2}),this._zoomOut=new Mi({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,h,p){this._zoomIn.touchstart(i,h,p),this._zoomOut.touchstart(i,h,p)}touchmove(i,h,p){this._zoomIn.touchmove(i,h,p),this._zoomOut.touchmove(i,h,p)}touchend(i,h,p){const m=this._zoomIn.touchend(i,h,p),v=this._zoomOut.touchend(i,h,p),w=this._tr;return m?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(m)},{originalEvent:i})}):v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(v)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tl{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const h=this._moveFunction(...i);if(h.bearingDelta||h.pitchDelta||h.rollDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(i,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=Array.isArray(h)?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,h){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const m=Array.isArray(h)?h[0]:h;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&N.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ys=0,rl=2,Zy={[ys]:1,[rl]:2};class yc{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const h=N.mouseButton(i);this._eventButton=h}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(h,p){const m=Zy[p];return h.buttons===void 0||(h.buttons&m)!==m}(i,this._eventButton)}isValidEndEvent(i){return N.mouseButton(i)===this._eventButton}}class qy{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}class Yy{constructor(i=new yc({checkCorrectEvent:()=>!0}),h=new qy){this.mouseMoveStateManager=i,this.oneFingerTouchMoveStateManager=h}_executeRelevantHandler(i,h,p){return i instanceof MouseEvent?h(i):typeof TouchEvent<"u"&&i instanceof TouchEvent?p(i):void 0}startMove(i){this._executeRelevantHandler(i,h=>this.mouseMoveStateManager.startMove(h),h=>this.oneFingerTouchMoveStateManager.startMove(h))}endMove(i){this._executeRelevantHandler(i,h=>this.mouseMoveStateManager.endMove(h),h=>this.oneFingerTouchMoveStateManager.endMove(h))}isValidStartEvent(i){return this._executeRelevantHandler(i,h=>this.mouseMoveStateManager.isValidStartEvent(h),h=>this.oneFingerTouchMoveStateManager.isValidStartEvent(h))}isValidMoveEvent(i){return this._executeRelevantHandler(i,h=>this.mouseMoveStateManager.isValidMoveEvent(h),h=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(h))}isValidEndEvent(i){return this._executeRelevantHandler(i,h=>this.mouseMoveStateManager.isValidEndEvent(h),h=>this.oneFingerTouchMoveStateManager.isValidEndEvent(h))}}const vc=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=i=>{i.preventDefault()}};class xc{constructor(i,h){this._clickTolerance=i.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(i){return i<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(i,h,p){return this._calculateTransform(i,h,p)}touchmove(i,h,p){if(this._active){if(!this._shouldBePrevented(p.length))return i.preventDefault(),this._calculateTransform(i,h,p);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",i)}}touchend(i,h,p){this._calculateTransform(i,h,p),this._active&&this._shouldBePrevented(p.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,h,p){p.length>0&&(this._active=!0);const m=el(p,h),v=new a.P(0,0),w=new a.P(0,0);let I=0;for(const k in m){const D=m[k],z=this._touches[k];z&&(v._add(D),w._add(D.sub(z)),I++,m[k]=D)}if(this._touches=m,this._shouldBePrevented(I)||!w.mag())return;const P=w.div(I);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(I),panDelta:P}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vs{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(i,h,p){if(!this._firstTwoTouches)return;i.preventDefault();const[m,v]=this._firstTwoTouches,w=pt(p,h,m),I=pt(p,h,v);if(!w||!I)return;const P=this._aroundCenter?null:w.add(I).div(2);return this._move([w,I],P,i)}touchend(i,h,p){if(!this._firstTwoTouches)return;const[m,v]=this._firstTwoTouches,w=pt(p,h,m),I=pt(p,h,v);w&&I||(this._active&&N.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function pt(_,i,h){for(let p=0;p<_.length;p++)if(_[p].identifier===h)return i[p]}function zd(_,i){return Math.log(_/i)/Math.LN2}class Ou extends vs{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,h){const p=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(zd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zd(this._distance,p),pinchAround:h}}}function Bd(_,i){return 180*_.angleWith(i)/Math.PI}class nl extends vs{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,h,p){const m=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Bd(this._vector,m),pinchAround:h}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const h=25/(Math.PI*this._minDiameter)*360,p=Bd(i,this._startVector);return Math.abs(p)<h}}function va(_){return Math.abs(_.y)>Math.abs(_.x)}class Fu extends vs{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,h,p){super.touchstart(i,h,p),this._currentTouchCount=p.length}_start(i){this._lastPoints=i,va(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,h,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=i[0].sub(this._lastPoints[0]),v=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,v,p.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(m.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(i,h,p){if(this._valid!==void 0)return this._valid;const m=i.mag()>=2,v=h.mag()>=2;if(!m&&!v)return;if(!m||!v)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const w=i.y>0==h.y>0;return va(i)&&va(h)&&w}}const ur={panStep:100,bearingStep:15,pitchStep:10};class Nu{constructor(i){this._tr=new Ja(i);const h=ur;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let h=0,p=0,m=0,v=0,w=0;switch(i.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:i.shiftKey?p=-1:(i.preventDefault(),v=-1);break;case 39:i.shiftKey?p=1:(i.preventDefault(),v=1);break;case 38:i.shiftKey?m=1:(i.preventDefault(),w=-1);break;case 40:i.shiftKey?m=-1:(i.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:I=>{const P=this._tr;I.easeTo({duration:300,easeId:"keyboardHandler",easing:Gy,zoom:h?Math.round(P.zoom)+h*(i.shiftKey?2:1):P.zoom,bearing:P.bearing+p*this._bearingStep,pitch:P.pitch+m*this._pitchStep,offset:[-v*this._panStep,-w*this._panStep],center:P.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Gy(_){return _*(2-_)}const Lu=4.000244140625,Ky=1/450;class vg{constructor(i,h){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=i,this._tr=new Ja(i),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ky}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(i){return!!this._map.cooperativeGestures.isEnabled()&&!(i.ctrlKey||this._map.cooperativeGestures.isBypassed(i))}wheel(i){if(!this.isEnabled())return;if(this._shouldBePrevented(i))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",i);let h=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const p=F.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%Lu==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),i.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=i,this._delta-=h,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=N.mousePos(this._map.getCanvas(),i),p=this._tr;this._aroundPoint=this._aroundCenter?p.transform.locationToScreenPoint(a.S.convert(p.center)):h,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const I=i.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=I),typeof this._targetZoom=="number"&&(this._targetZoom+=I)}if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>Lu?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&P!==0&&(P=1/P);const k=typeof this._targetZoom!="number"?i.scale:a.af(this._targetZoom);this._targetZoom=i.getConstrained(i.getCameraLngLat(),a.ak(k*P)).zoom,this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom!="number"?i.zoom:this._targetZoom,p=this._startZoom,m=this._easing;let v,w=!1;if(this._type==="wheel"&&p&&m){const I=F.now()-this._lastWheelEventTime,P=Math.min((I+5)/200,1),k=m(P);v=a.C.number(p,h,k),P<1?this._frameId||(this._frameId=!0):w=!0}else v=h,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=v,{noInertia:!0,needsRenderFrame:!w,zoomDelta:v-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let h=a.co;if(this._prevEase){const p=this._prevEase,m=(F.now()-p.start)/p.duration,v=p.easing(m+.01)-p.easing(m),w=.27/Math.sqrt(v*v+1e-4)*.01,I=Math.sqrt(.0729-w*w);h=a.cm(w,I,.25,1)}return this._prevEase={start:F.now(),duration:i,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ud{constructor(i,h){this._clickZoom=i,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vd{constructor(i){this._tr=new Ja(i),this.reset()}reset(){this._active=!1}dblclick(i,h){return i.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xg{constructor(){this._tap=new Mi({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,h,p){if(!this._swipePoint)if(this._tapTime){const m=h[0],v=i.timeStamp-this._tapTime<500,w=this._tapPoint.dist(m)<30;v&&w?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(i,h,p)}touchmove(i,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=h[0],v=m.y-this._swipePoint.y;return this._swipePoint=m,i.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(i,h,p)}touchend(i,h,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(i,h,p);m&&(this._tapTime=i.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bg{constructor(i,h,p){this._el=i,this._mousePan=h,this._touchPan=p}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class jd{constructor(i,h,p,m){this._pitchWithRotate=i.pitchWithRotate,this._rollEnabled=i.rollEnabled,this._mouseRotate=h,this._mousePitch=p,this._mouseRoll=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class wg{constructor(i,h,p,m){this._el=i,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Tg{constructor(i,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=N.create("div","maplibregl-cooperative-gesture-screen",i);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=h,this._container.appendChild(m);const v=document.createElement("div");v.className="maplibregl-mobile-message",v.textContent=p,this._container.appendChild(v),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(N.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(i){return i[this._bypassKey]}notifyGestureBlocked(i,h){this._enabled&&(this._map.fire(new a.l("cooperativegestureprevented",{gestureType:i,originalEvent:h})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const xs=_=>_.zoom||_.drag||_.roll||_.pitch||_.rotate;class jr extends a.l{}function il(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta||_.rollDelta}class $d{constructor(i,h){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,v)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=m.type==="renderFrame"?void 0:m,I={needsRenderFrame:!1},P={},k={};for(const{handlerName:L,handler:U,allowed:W}of this._handlers){if(!U.isEnabled())continue;let te;if(this._blockedByActive(k,W,L))U.reset();else if(U[v||m.type]){if(a.cp(m,v||m.type)){const ee=N.mousePos(this._map.getCanvas(),m);te=U[v||m.type](m,ee)}else if(a.cq(m,v||m.type)){const ee=this._getMapTouches(m.touches),ne=N.touchPos(this._map.getCanvas(),ee);te=U[v||m.type](m,ne,ee)}else a.cr(v||m.type)||(te=U[v||m.type](m));this.mergeHandlerResult(I,P,te,L,w),te&&te.needsRenderFrame&&this._triggerRenderFrame()}(te||U.isActive())&&(k[L]=U)}const D={};for(const L in this._previousActiveHandlers)k[L]||(D[L]=w);this._previousActiveHandlers=k,(Object.keys(D).length||il(I))&&(this._changes.push([I,P,D]),this._triggerRenderFrame()),(Object.keys(k).length||il(I))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=I;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new gg(i),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,v,w]of this._listeners)N.addEventListener(m,v,m===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[i,h,p]of this._listeners)N.removeEventListener(i,h,i===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(i){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new mg(h,i));const m=h.boxZoom=new Ld(h,i);this._add("boxZoom",m),i.interactive&&i.boxZoom&&m.enable();const v=h.cooperativeGestures=new Tg(h,i.cooperativeGestures);this._add("cooperativeGestures",v),i.cooperativeGestures&&v.enable();const w=new _s(h),I=new Vd(h);h.doubleClickZoom=new Ud(I,w),this._add("tapZoom",w),this._add("clickZoom",I),i.interactive&&i.doubleClickZoom&&h.doubleClickZoom.enable();const P=new xg;this._add("tapDragZoom",P);const k=h.touchPitch=new Fu(h);this._add("touchPitch",k),i.interactive&&i.touchPitch&&h.touchPitch.enable(i.touchPitch);const D=()=>h.project(h.getCenter()),z=function({enable:ue,clickTolerance:ge,aroundCenter:ye=!0,minPixelCenterThreshold:he=100,rotateDegreesPerPixelMoved:Ee=.8},Le){const ke=new yc({checkCorrectEvent:De=>N.mouseButton(De)===0&&De.ctrlKey||N.mouseButton(De)===2&&!De.ctrlKey});return new tl({clickTolerance:ge,move:(De,Ne)=>{const et=Le();if(ye&&Math.abs(et.y-De.y)>he)return{bearingDelta:a.cn(new a.P(De.x,Ne.y),Ne,et)};let nt=(Ne.x-De.x)*Ee;return ye&&Ne.y<et.y&&(nt=-nt),{bearingDelta:nt}},moveStateManager:ke,enable:ue,assignEvents:vc})}(i,D),L=function({enable:ue,clickTolerance:ge,pitchDegreesPerPixelMoved:ye=-.5}){const he=new yc({checkCorrectEvent:Ee=>N.mouseButton(Ee)===0&&Ee.ctrlKey||N.mouseButton(Ee)===2});return new tl({clickTolerance:ge,move:(Ee,Le)=>({pitchDelta:(Le.y-Ee.y)*ye}),moveStateManager:he,enable:ue,assignEvents:vc})}(i),U=function({enable:ue,clickTolerance:ge,rollDegreesPerPixelMoved:ye=.3},he){const Ee=new yc({checkCorrectEvent:Le=>N.mouseButton(Le)===2&&Le.ctrlKey});return new tl({clickTolerance:ge,move:(Le,ke)=>{const De=he();let Ne=(ke.x-Le.x)*ye;return ke.y<De.y&&(Ne=-Ne),{rollDelta:Ne}},moveStateManager:Ee,enable:ue,assignEvents:vc})}(i,D);h.dragRotate=new jd(i,z,L,U),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",L,["mouseRotate","mouseRoll"]),this._add("mouseRoll",U,["mousePitch"]),i.interactive&&i.dragRotate&&h.dragRotate.enable();const W=function({enable:ue,clickTolerance:ge}){const ye=new yc({checkCorrectEvent:he=>N.mouseButton(he)===0&&!he.ctrlKey});return new tl({clickTolerance:ge,move:(he,Ee)=>({around:Ee,panDelta:Ee.sub(he)}),activateOnStart:!0,moveStateManager:ye,enable:ue,assignEvents:vc})}(i),te=new xc(i,h);h.dragPan=new bg(p,W,te),this._add("mousePan",W),this._add("touchPan",te,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&h.dragPan.enable(i.dragPan);const ee=new nl,ne=new Ou;h.touchZoomRotate=new wg(p,ne,ee,P),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",ne,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&h.touchZoomRotate.enable(i.touchZoomRotate);const ae=h.scrollZoom=new vg(h,()=>this._triggerRenderFrame());this._add("scrollZoom",ae,["mousePan"]),i.interactive&&i.scrollZoom&&h.scrollZoom.enable(i.scrollZoom);const de=h.keyboard=new Nu(h);this._add("keyboard",de),i.interactive&&i.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new _g(h))}_add(i,h,p){this._handlers.push({handlerName:i,handler:h,allowed:p}),this._handlersById[i]=h}stop(i){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!xs(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,h,p){for(const m in i)if(m!==p&&(!h||h.indexOf(m)<0))return!0;return!1}_getMapTouches(i){const h=[];for(const p of i)this._el.contains(p.target)&&h.push(p);return h}mergeHandlerResult(i,h,p,m,v){if(!p)return;a.e(i,p);const w={handlerName:m,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(h.zoom=w),p.panDelta!==void 0&&(h.drag=w),p.rollDelta!==void 0&&(h.roll=w),p.pitchDelta!==void 0&&(h.pitch=w),p.bearingDelta!==void 0&&(h.rotate=w)}_applyChanges(){const i={},h={},p={};for(const[m,v,w]of this._changes)m.panDelta&&(i.panDelta=(i.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+m.pitchDelta),m.rollDelta&&(i.rollDelta=(i.rollDelta||0)+m.rollDelta),m.around!==void 0&&(i.around=m.around),m.pinchAround!==void 0&&(i.pinchAround=m.pinchAround),m.noInertia&&(i.noInertia=m.noInertia),a.e(h,v),a.e(p,w);this._updateMapTransform(i,h,p),this._changes=[]}_updateMapTransform(i,h,p){const m=this._map,v=m._getTransformForUpdate(),w=m.terrain;if(!(il(i)||w&&this._terrainMovement))return this._fireEvents(h,p,!0);m._stop(!0);let{panDelta:I,zoomDelta:P,bearingDelta:k,pitchDelta:D,rollDelta:z,around:L,pinchAround:U}=i;U!==void 0&&(L=U),L=L||m.transform.centerPoint,w&&!v.isPointOnMapSurface(L)&&(L=v.centerPoint);const W={panDelta:I,zoomDelta:P,rollDelta:z,pitchDelta:D,bearingDelta:k,around:L};this._map.cameraHelper.useGlobeControls&&!v.isPointOnMapSurface(L)&&(L=v.centerPoint);const te=L.distSqr(v.centerPoint)<.01?v.center:v.screenPointToLocation(I?L.sub(I):L);w?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(W,v),this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?v.setCenter(v.screenPointToLocation(v.centerPoint.sub(I))):this._map.cameraHelper.handleMapControlsPan(W,v,te):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(W,v,te))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(W,v),this._map.cameraHelper.handleMapControlsPan(W,v,te)),m._applyUpdatedTransform(v),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(h,p,!0)}_fireEvents(i,h,p){const m=xs(this._eventsInProgress),v=xs(i),w={};for(const z in i){const{originalEvent:L}=i[z];this._eventsInProgress[z]||(w[`${z}start`]=L),this._eventsInProgress[z]=i[z]}!m&&v&&this._fireEvent("movestart",v.originalEvent);for(const z in w)this._fireEvent(z,w[z]);v&&this._fireEvent("move",v.originalEvent);for(const z in i){const{originalEvent:L}=i[z];this._fireEvent(z,L)}const I={};let P;for(const z in this._eventsInProgress){const{handlerName:L,originalEvent:U}=this._eventsInProgress[z];this._handlersById[L].isActive()||(delete this._eventsInProgress[z],P=h[L]||U,I[`${z}end`]=P)}for(const z in I)this._fireEvent(z,I[z]);const k=xs(this._eventsInProgress),D=(m||v)&&!k;if(D&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&z.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(z)}if(p&&D){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;!z||!z.essential&&F.prefersReducedMotion?(this._map.fire(new a.l("moveend",{originalEvent:P})),L(this._map.getBearing())&&this._map.resetNorth()):(L(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:P})),this._updatingCamera=!1}}_fireEvent(i,h){this._map.fire(new a.l(i,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new jr("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Sg extends a.E{constructor(i,h,p){super(),this._renderFrameCallback=()=>{const m=Math.min((F.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=p.bearingSnap,this.cameraHelper=h,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(i,h){i.apply(this.transform),this.transform=i,this.cameraHelper=h}getCenter(){return new a.S(this.transform.center.lng,this.transform.center.lat)}setCenter(i,h){return this.jumpTo({center:i},h)}getCenterElevation(){return this.transform.elevation}setCenterElevation(i,h){return this.jumpTo({elevation:i},h),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(i){this._centerClampedToGround=i}panBy(i,h,p){return i=a.P.convert(i).mult(-1),this.panTo(this.transform.center,a.e({offset:i},h),p)}panTo(i,h,p){return this.easeTo(a.e({center:i},h),p)}getZoom(){return this.transform.zoom}setZoom(i,h){return this.jumpTo({zoom:i},h),this}zoomTo(i,h,p){return this.easeTo(a.e({zoom:i},h),p)}zoomIn(i,h){return this.zoomTo(this.getZoom()+1,i,h),this}zoomOut(i,h){return this.zoomTo(this.getZoom()-1,i,h),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(i,h){return i!=this.transform.fov&&(this.transform.setFov(i),this.fire(new a.l("movestart",h)).fire(new a.l("move",h)).fire(new a.l("moveend",h))),this}getBearing(){return this.transform.bearing}setBearing(i,h){return this.jumpTo({bearing:i},h),this}getPadding(){return this.transform.padding}setPadding(i,h){return this.jumpTo({padding:i},h),this}rotateTo(i,h,p){return this.easeTo(a.e({bearing:i},h),p)}resetNorth(i,h){return this.rotateTo(0,a.e({duration:1e3},i),h),this}resetNorthPitch(i,h){return this.easeTo(a.e({bearing:0,pitch:0,roll:0,duration:1e3},i),h),this}snapToNorth(i,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,h):this}getPitch(){return this.transform.pitch}setPitch(i,h){return this.jumpTo({pitch:i},h),this}getRoll(){return this.transform.roll}setRoll(i,h){return this.jumpTo({roll:i},h),this}cameraForBounds(i,h){i=er.convert(i).adjustAntiMeridian();const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),p,h)}_cameraForBoxAndBearing(i,h,p,m){const v={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const k=m.padding;m.padding={top:k,bottom:k,right:k,left:k}}const w=a.e(v,m.padding);m.padding=w;const I=this.transform,P=new er(i,h);return this.cameraHelper.cameraForBoxAndBearing(m,w,P,p,I)}fitBounds(i,h,p){return this._fitInternal(this.cameraForBounds(i,h),h,p)}fitScreenCoordinates(i,h,p,m,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(a.P.convert(i)),this.transform.screenPointToLocation(a.P.convert(h)),p,m),m,v)}_fitInternal(i,h,p){return i?(delete(h=a.e(i,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(i,h){this.stop();const p=this._getTransformForUpdate();let m=!1,v=!1,w=!1;const I=p.zoom;this.cameraHelper.handleJumpToCenterZoom(p,i);const P=p.zoom!==I;return"elevation"in i&&p.elevation!==+i.elevation&&p.setElevation(+i.elevation),"bearing"in i&&p.bearing!==+i.bearing&&(m=!0,p.setBearing(+i.bearing)),"pitch"in i&&p.pitch!==+i.pitch&&(v=!0,p.setPitch(+i.pitch)),"roll"in i&&p.roll!==+i.roll&&(w=!0,p.setRoll(+i.roll)),i.padding==null||p.isPaddingEqual(i.padding)||p.setPadding(i.padding),this._applyUpdatedTransform(p),this.fire(new a.l("movestart",h)).fire(new a.l("move",h)),P&&this.fire(new a.l("zoomstart",h)).fire(new a.l("zoom",h)).fire(new a.l("zoomend",h)),m&&this.fire(new a.l("rotatestart",h)).fire(new a.l("rotate",h)).fire(new a.l("rotateend",h)),v&&this.fire(new a.l("pitchstart",h)).fire(new a.l("pitch",h)).fire(new a.l("pitchend",h)),w&&this.fire(new a.l("rollstart",h)).fire(new a.l("roll",h)).fire(new a.l("rollend",h)),this.fire(new a.l("moveend",h))}calculateCameraOptionsFromTo(i,h,p,m=0){const v=a.a1.fromLngLat(i,h),w=a.a1.fromLngLat(p,m),I=w.x-v.x,P=w.y-v.y,k=w.z-v.z,D=Math.hypot(I,P,k);if(D===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(I,P),L=a.ak(this.transform.cameraToCenterDistance/D/this.transform.tileSize),U=180*Math.atan2(I,-P)/Math.PI;let W=180*Math.acos(z/D)/Math.PI;return W=k<0?90-W:90+W,{center:w.toLngLat(),elevation:m,zoom:L,pitch:W,bearing:U}}calculateCameraOptionsFromCameraLngLatAltRotation(i,h,p,m,v){const w=this.transform.calculateCenterFromCameraLngLatAlt(i,h,p,m);return{center:w.center,elevation:w.elevation,zoom:w.zoom,bearing:p,pitch:m,roll:v}}easeTo(i,h){this._stop(!1,i.easeId),((i=a.e({offset:[0,0],duration:500,easing:a.co},i)).animate===!1||!i.essential&&F.prefersReducedMotion)&&(i.duration=0);const p=this._getTransformForUpdate(),m=this.getBearing(),v=p.pitch,w=p.roll,I="bearing"in i?this._normalizeBearing(i.bearing,m):m,P="pitch"in i?+i.pitch:v,k="roll"in i?this._normalizeBearing(i.roll,w):w,D="padding"in i?i.padding:p.padding,z=a.P.convert(i.offset);let L,U;i.around&&(L=a.S.convert(i.around),U=p.locationToScreenPoint(L));const W={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},te=this.cameraHelper.handleEaseTo(p,{bearing:I,pitch:P,roll:k,padding:D,around:L,aroundPoint:U,offsetAsPoint:z,offset:i.offset,zoom:i.zoom,center:i.center});return this._rotating=this._rotating||m!==I,this._pitching=this._pitching||P!==v,this._rolling=this._rolling||k!==w,this._padding=!p.isPaddingEqual(D),this._zooming=this._zooming||te.isZooming,this._easeId=i.easeId,this._prepareEase(h,i.noMoveStart,W),this.terrain&&this._prepareElevation(te.elevationCenter),this._ease(ee=>{te.easeFunc(ee),this.terrain&&!i.freezeElevation&&this._updateElevation(ee),this._applyUpdatedTransform(p),this._fireMoveEvents(h)},ee=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(h,ee)},i),this}_prepareEase(i,h,p={}){this._moving=!0,h||p.moving||this.fire(new a.l("movestart",i)),this._zooming&&!p.zooming&&this.fire(new a.l("zoomstart",i)),this._rotating&&!p.rotating&&this.fire(new a.l("rotatestart",i)),this._pitching&&!p.pitching&&this.fire(new a.l("pitchstart",i)),this._rolling&&!p.rolling&&this.fire(new a.l("rollstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&h!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(p-(h-(p*i+this._elevationStart))/(1-i)),this._elevationTarget=h}this.transform.setElevation(a.C.number(this._elevationStart,this._elevationTarget,i))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(i){if(!this.terrain&&i.elevation>=0&&i.pitch<=90)return{};const h=i.getCameraLngLat(),p=i.getCameraAltitude(),m=this.terrain?this.terrain.getElevationForLngLatZoom(h,i.zoom):0;if(p<m){const v=this.calculateCameraOptionsFromTo(h,m,i.center,i.elevation);return{pitch:v.pitch,zoom:v.zoom}}return{}}_applyUpdatedTransform(i){const h=[];if(h.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&h.push(m=>this.transformCameraUpdate(m)),!h.length)return;const p=i.clone();for(const m of h){const v=p.clone(),{center:w,zoom:I,roll:P,pitch:k,bearing:D,elevation:z}=m(v);w&&v.setCenter(w),z!==void 0&&v.setElevation(z),I!==void 0&&v.setZoom(I),P!==void 0&&v.setRoll(P),k!==void 0&&v.setPitch(k),D!==void 0&&v.setBearing(D),p.apply(v)}this.transform.apply(p)}_fireMoveEvents(i){this.fire(new a.l("move",i)),this._zooming&&this.fire(new a.l("zoom",i)),this._rotating&&this.fire(new a.l("rotate",i)),this._pitching&&this.fire(new a.l("pitch",i)),this._rolling&&this.fire(new a.l("roll",i))}_afterEase(i,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const p=this._zooming,m=this._rotating,v=this._pitching,w=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,p&&this.fire(new a.l("zoomend",i)),m&&this.fire(new a.l("rotateend",i)),v&&this.fire(new a.l("pitchend",i)),w&&this.fire(new a.l("rollend",i)),this.fire(new a.l("moveend",i))}flyTo(i,h){if(!i.essential&&F.prefersReducedMotion){const Ne=a.Q(i,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Ne,h)}this.stop(),i=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.co},i);const p=this._getTransformForUpdate(),m=p.bearing,v=p.pitch,w=p.roll,I=p.padding,P="bearing"in i?this._normalizeBearing(i.bearing,m):m,k="pitch"in i?+i.pitch:v,D="roll"in i?this._normalizeBearing(i.roll,w):w,z="padding"in i?i.padding:p.padding,L=a.P.convert(i.offset);let U=p.centerPoint.add(L);const W=p.screenPointToLocation(U),te=this.cameraHelper.handleFlyTo(p,{bearing:P,pitch:k,roll:D,padding:z,locationAtOffset:W,offsetAsPoint:L,center:i.center,minZoom:i.minZoom,zoom:i.zoom});let ee=i.curve;const ne=Math.max(p.width,p.height),ae=ne/te.scaleOfZoom,de=te.pixelPathLength;typeof te.scaleOfMinZoom=="number"&&(ee=Math.sqrt(ne/te.scaleOfMinZoom/de*2));const ue=ee*ee;function ge(Ne){const et=(ae*ae-ne*ne+(Ne?-1:1)*ue*ue*de*de)/(2*(Ne?ae:ne)*ue*de);return Math.log(Math.sqrt(et*et+1)-et)}function ye(Ne){return(Math.exp(Ne)-Math.exp(-Ne))/2}function he(Ne){return(Math.exp(Ne)+Math.exp(-Ne))/2}const Ee=ge(!1);let Le=function(Ne){return he(Ee)/he(Ee+ee*Ne)},ke=function(Ne){return ne*((he(Ee)*(ye(et=Ee+ee*Ne)/he(et))-ye(Ee))/ue)/de;var et},De=(ge(!0)-Ee)/ee;if(Math.abs(de)<2e-6||!isFinite(De)){if(Math.abs(ne-ae)<1e-6)return this.easeTo(i,h);const Ne=ae<ne?-1:1;De=Math.abs(Math.log(ae/ne))/ee,ke=()=>0,Le=et=>Math.exp(Ne*ee*et)}return i.duration="duration"in i?+i.duration:1e3*De/("screenSpeed"in i?+i.screenSpeed/ee:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=m!==P,this._pitching=k!==v,this._rolling=D!==w,this._padding=!p.isPaddingEqual(z),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(te.targetCenter),this._ease(Ne=>{const et=Ne*De,nt=1/Le(et),Xe=ke(et);this._rotating&&p.setBearing(a.C.number(m,P,Ne)),this._pitching&&p.setPitch(a.C.number(v,k,Ne)),this._rolling&&p.setRoll(a.C.number(w,D,Ne)),this._padding&&(p.interpolatePadding(I,z,Ne),U=p.centerPoint.add(L)),te.easeFunc(Ne,nt,Xe,U),this.terrain&&!i.freezeElevation&&this._updateElevation(Ne),this._applyUpdatedTransform(p),this._fireMoveEvents(h)},()=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(h)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,h){var p;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,h)}return i||(p=this.handlers)===null||p===void 0||p.stop(!1),this}_ease(i,h,p){p.animate===!1||p.duration===0?(i(1),h()):(this._easeStart=F.now(),this._easeOptions=p,this._onEaseFrame=i,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,h){i=a.aO(i,-180,180);const p=Math.abs(i-h);return Math.abs(i-360-h)<p&&(i-=360),Math.abs(i+360-h)<p&&(i+=360),i}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(a.S.convert(i),this.transform.tileZoom):null}}const Wd={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Hd{constructor(i=Wd){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=N.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=N.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){N.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,h){const p=this._map._getUIString(`AttributionControl.${h}`);i.title=p,i.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const h=this._map.style.sourceCaches;for(const m in h){const v=h[m];if(v.used||v.usedForTerrain){const w=v.getSource();w.attribution&&i.indexOf(w.attribution)<0&&i.push(w.attribution)}}i=i.filter(m=>String(m).trim()),i.sort((m,v)=>m.length-v.length),i=i.filter((m,v)=>{for(let w=v+1;w<i.length;w++)if(i[w].indexOf(m)>=0)return!1;return!0});const p=i.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,i.length?(this._innerContainer.innerHTML=N.sanitize(p),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Eg{constructor(i={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const p=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=N.create("div","maplibregl-ctrl");const h=N.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){N.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Hs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const h=++this._id;return this._queue.push({callback:i,id:h,cancelled:!1}),h}remove(i){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const m of p)if(m.id===i)return void(m.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var zu=a.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class St extends a.E{constructor(i){super(),this._lastTilesetChange=F.now(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=i._source.tileSize*2**this.deltaZoom,i.usedForTerrain=!0,i.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,h){this.sourceCache.update(i,h),this._renderableTilesKeys=[];const p={};for(const m of Te(i,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.terrainRttPosMatrix32f=new Float64Array(16),a.bY(m.terrainRttPosMatrix32f,0,a.$,a.$,0,0,1),this._tiles[m.key]=new Qr(m,this.tileSize),this._lastTilesetChange=F.now());for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(i){for(const h in this._tiles){const p=this._tiles[h];(!i||p.tileID.equals(i)||p.tileID.isChildOf(i)||i.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i,h){return h?this._getTerrainCoordsForTileRanges(i,h):this._getTerrainCoordsForRegularTile(i)}_getTerrainCoordsForRegularTile(i){const h={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID,v=i.clone(),w=a.ba();if(m.canonical.equals(i.canonical))a.bY(w,0,a.$,a.$,0,0,1);else if(m.canonical.isChildOf(i.canonical)){const I=m.canonical.z-i.canonical.z,P=m.canonical.x-(m.canonical.x>>I<<I),k=m.canonical.y-(m.canonical.y>>I<<I),D=a.$>>I;a.bY(w,0,D,D,0,0,1),a.M(w,w,[-P*D,-k*D,0])}else{if(!i.canonical.isChildOf(m.canonical))continue;{const I=i.canonical.z-m.canonical.z,P=i.canonical.x-(i.canonical.x>>I<<I),k=i.canonical.y-(i.canonical.y>>I<<I),D=a.$>>I;a.bY(w,0,a.$,a.$,0,0,1),a.M(w,w,[P*D,k*D,0]),a.N(w,w,[1/2**I,1/2**I,0])}}v.terrainRttPosMatrix32f=new Float32Array(w),h[p]=v}return h}_getTerrainCoordsForTileRanges(i,h){const p={};for(const m of this._renderableTilesKeys){const v=this._tiles[m].tileID;if(!this._isWithinTileRanges(v,h))continue;const w=i.clone(),I=a.ba();if(v.canonical.z===i.canonical.z){const P=i.canonical.x-v.canonical.x,k=i.canonical.y-v.canonical.y;a.bY(I,0,a.$,a.$,0,0,1),a.M(I,I,[P*a.$,k*a.$,0])}else if(v.canonical.z>i.canonical.z){const P=v.canonical.z-i.canonical.z,k=v.canonical.x-(v.canonical.x>>P<<P),D=v.canonical.y-(v.canonical.y>>P<<P),z=i.canonical.x-(v.canonical.x>>P),L=i.canonical.y-(v.canonical.y>>P),U=a.$>>P;a.bY(I,0,U,U,0,0,1),a.M(I,I,[-k*U+z*a.$,-D*U+L*a.$,0])}else{const P=i.canonical.z-v.canonical.z,k=i.canonical.x-(i.canonical.x>>P<<P),D=i.canonical.y-(i.canonical.y>>P<<P),z=(i.canonical.x>>P)-v.canonical.x,L=(i.canonical.y>>P)-v.canonical.y,U=a.$<<P;a.bY(I,0,U,U,0,0,1),a.M(I,I,[k*a.$+z*U,D*a.$+L*U,0])}w.terrainRttPosMatrix32f=new Float32Array(I),p[m]=w}return p}getSourceTile(i,h){const p=this.sourceCache._source;let m=i.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(m).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!v||!v.dem)&&h)for(;m>=p.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(i.scaledTo(m--).key);return v}anyTilesAfterTime(i=Date.now()){return this._lastTilesetChange>=i}_isWithinTileRanges(i,h){return h[i.canonical.z]&&i.canonical.x>=h[i.canonical.z].minTileX&&i.canonical.x<=h[i.canonical.z].maxTileX&&i.canonical.y>=h[i.canonical.z].minTileY&&i.canonical.y<=h[i.canonical.z].maxTileY}}class Nt{constructor(i,h,p){this._meshCache={},this.painter=i,this.sourceCache=new St(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,h,p,m=a.$){var v;if(!(h>=0&&h<m&&p>=0&&p<m))return 0;const w=this.getTerrainData(i),I=(v=w.tile)===null||v===void 0?void 0:v.dem;if(!I)return 0;const P=a.cs([],[h/m*a.$,p/m*a.$],w.u_terrain_matrix),k=[P[0]*I.dim,P[1]*I.dim],D=Math.floor(k[0]),z=Math.floor(k[1]),L=k[0]-D,U=k[1]-z;return I.get(D,z)*(1-L)*(1-U)+I.get(D+1,z)*L*(1-U)+I.get(D,z+1)*(1-L)*U+I.get(D+1,z+1)*L*U}getElevationForLngLatZoom(i,h){if(!a.ct(h,i.wrap()))return 0;const{tileID:p,mercatorX:m,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(i,h);return this.getElevation(p,m%a.$,v%a.$,a.$)}getElevation(i,h,p,m=a.$){return this.getDEMElevation(i,h,p,m)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const m=this.painter.context,v=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new a.T(m,v,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new a.T(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.ag([])}const h=this.sourceCache.getSourceTile(i,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const m=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new a.T(m,h.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),h.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+i.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let v=i.canonical.z-h.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=m?v=i.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=i.canonical.x-(i.canonical.x>>v<<v),I=i.canonical.y-(i.canonical.y>>v<<v),P=a.cu(new Float64Array(16),[1/(a.$<<v),1/(a.$<<v),0]);a.M(P,P,[w*a.$,I*a.$,0]),this._demMatrixCache[i.key]={matrix:P,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(i){const h=this.painter,p=h.width/devicePixelRatio,m=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new a.T(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new a.T(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,w=0;v<this._coordsTextureSize;v++)for(let I=0;I<this._coordsTextureSize;I++,w+=4)h[w+0]=255&I,h[w+1]=255&v,h[w+2]=I>>8<<4|v>>8,h[w+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),m=new a.T(i,p,i.gl.RGBA,{premultiply:!1});return m.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),p=this.painter.context,m=p.gl,v=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),I=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(v,I-w-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null);const P=h[0]+(h[2]>>4<<8),k=h[1]+((15&h[2])<<8),D=this.coordsIndex[255-h[3]],z=D&&this.sourceCache.getTileByID(D);if(!z)return null;const L=this._coordsTextureSize,U=(1<<z.tileID.canonical.z)*L;return new a.a1((z.tileID.canonical.x*L+P)/U+z.tileID.wrap,(z.tileID.canonical.y*L+k)/U,this.getElevation(z.tileID,P,k,L))}depthAtPoint(i){const h=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(i){var h;const p=((h=this.painter.style.projection)===null||h===void 0?void 0:h.transitionState)>0,m=p&&i.canonical.y===0,v=p&&i.canonical.y===(1<<i.canonical.z)-1,w=`m_${m?"n":""}_${v?"s":""}`;if(this._meshCache[w])return this._meshCache[w];const I=this.painter.context,P=new a.cv,k=new a.aN,D=this.meshSize,z=a.$/D,L=D*D;for(let he=0;he<=D;he++)for(let Ee=0;Ee<=D;Ee++)P.emplaceBack(Ee*z,he*z,0);for(let he=0;he<L;he+=D+1)for(let Ee=0;Ee<D;Ee++)k.emplaceBack(Ee+he,D+Ee+he+1,D+Ee+he+2),k.emplaceBack(Ee+he,D+Ee+he+2,Ee+he+1);const U=P.length,W=U+(D+1),te=(D+1)*D,ee=m?a.bh:0,ne=m?0:1,ae=v?a.bi:a.$,de=v?0:1;for(let he=0;he<=D;he++)P.emplaceBack(he*z,ee,ne);for(let he=0;he<=D;he++)P.emplaceBack(he*z,ae,de);for(let he=0;he<D;he++)k.emplaceBack(te+he,W+he,W+he+1),k.emplaceBack(te+he,W+he+1,te+he+1),k.emplaceBack(0+he,U+he+1,U+he),k.emplaceBack(0+he,0+he+1,U+he+1);const ue=P.length,ge=ue+2*(D+1);for(const he of[0,1])for(let Ee=0;Ee<=D;Ee++)for(const Le of[0,1])P.emplaceBack(he*a.$,Ee*z,Le);for(let he=0;he<2*D;he+=2)k.emplaceBack(ue+he,ue+he+1,ue+he+3),k.emplaceBack(ue+he,ue+he+3,ue+he+2),k.emplaceBack(ge+he,ge+he+3,ge+he+1),k.emplaceBack(ge+he,ge+he+2,ge+he+3);const ye=new sa(I.createVertexBuffer(P,zu.members),I.createIndexBuffer(k),a.aM.simpleSegment(0,0,P.length,k.length));return this._meshCache[w]=ye,ye}getMeshFrameDelta(i){return 2*Math.PI*a.bu/Math.pow(2,Math.max(i,0))/5}getMinTileElevationForLngLatZoom(i,h){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(i,h);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(i){const h=this.getTerrainData(i).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=h.dem.min*this.exaggeration,p.maxElevation=h.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(i,h){const p=a.a1.fromLngLat(i.wrap()),m=(1<<h)*a.$,v=p.x*m,w=p.y*m,I=Math.floor(v/a.$),P=Math.floor(w/a.$);return{tileID:new a.Z(h,0,h,I,P),mercatorX:v,mercatorY:w}}}class Bu{constructor(i,h,p){this._context=i,this._size=h,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new a.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(p.texture),{id:i,fbo:h,texture:p,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>i.id!==h),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const No={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Uu{constructor(i,h){this.painter=i,this.terrain=h,this.pool=new Bu(i.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(p=>!i._layers[p].isHidden(h)),this._coordsAscending={};for(const p in i.sourceCaches){this._coordsAscending[p]={};const m=i.sourceCaches[p].getVisibleCoordinates(),v=i.sourceCaches[p].getSource(),w=v instanceof sr?v.terrainTileRanges:null;for(const I of m){const P=this.terrain.sourceCache.getTerrainCoords(I,w);for(const k in P)this._coordsAscending[p][k]||(this._coordsAscending[p][k]=[]),this._coordsAscending[p][k].push(P[k])}}this._coordsAscendingStr={};for(const p of i._order){const m=i._layers[p],v=m.source;if(No[m.type]&&!this._coordsAscendingStr[v]){this._coordsAscendingStr[v]={};for(const w in this._coordsAscending[v])this._coordsAscendingStr[v][w]=this._coordsAscending[v][w].map(I=>I.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsAscendingStr){const v=this._coordsAscendingStr[m][p.tileID.key];v&&v!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(i,h){if(i.isHidden(this.painter.transform.zoom))return!1;const p=Object.assign(Object.assign({},h),{isRenderingToTexture:!0}),m=i.type,v=this.painter,w=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(No[m]&&(this._prevType&&No[this._prevType]||this._stacks.push([]),this._prevType=m,this._stacks[this._stacks.length-1].push(i.id),!w))return!0;if(No[this._prevType]||No[m]&&w){this._prevType=m;const I=this._stacks.length-1,P=this._stacks[I]||[];for(const k of this._renderableTiles){if(this.pool.isFull()&&(ku(this.painter,this.terrain,this._rttTiles,p),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(k),k.rtt[I]){const z=this.pool.getObjectForId(k.rtt[I].id);if(z.stamp===k.rtt[I].stamp){this.pool.useObject(z);continue}}const D=this.pool.getOrCreateFreeObject();this.pool.useObject(D),this.pool.stampObject(D),k.rtt[I]={id:D.id,stamp:D.stamp},v.context.bindFramebuffer.set(D.fbo.framebuffer),v.context.clear({color:a.bf.transparent,stencil:0}),v.currentStencilSource=void 0;for(let z=0;z<P.length;z++){const L=v.style._layers[P[z]],U=L.source?this._coordsAscending[L.source][k.tileID.key]:[k.tileID];v.context.viewport.set([0,0,D.fbo.width,D.fbo.height]),v._renderTileClippingMasks(L,U,!0),v.renderLayer(v,v.style.sourceCaches[L.source],L,U,p),L.source&&(k.rttCoords[L.source]=this._coordsAscendingStr[L.source][k.tileID.key])}}return ku(this.painter,this.terrain,this._rttTiles,p),this._rttTiles=[],this.pool.freeAllObjects(),No[m]}return!1}}const _i={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ag=y,os={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Wd,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Qy={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class bc{constructor(i,h,p=!1){this.mousedown=v=>{this.startMove(v,N.mousePos(this.element,v)),N.addEventListener(window,"mousemove",this.mousemove),N.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.move(v,N.mousePos(this.element,v))},this.mouseup=v=>{this._rotatePitchHandler.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=N.touchPos(this.element,v.targetTouches)[0],this.startMove(v,this._startPos),N.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=N.touchPos(this.element,v.targetTouches)[0],this.move(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=h;const m=new Yy;this._rotatePitchHandler=new tl({clickTolerance:3,move:(v,w)=>{const I=h.getBoundingClientRect(),P=new a.P((I.bottom-I.top)/2,(I.right-I.left)/2);return{bearingDelta:a.cn(new a.P(v.x,w.y),w,P),pitchDelta:p?-.5*(w.y-v.y):void 0}},moveStateManager:m,enable:!0,assignEvents:()=>{}}),this.map=i,N.addEventListener(h,"mousedown",this.mousedown),N.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),N.addEventListener(h,"touchcancel",this.reset)}startMove(i,h){this._rotatePitchHandler.dragStart(i,h),N.disableDrag()}move(i,h){const p=this.map,{bearingDelta:m,pitchDelta:v}=this._rotatePitchHandler.dragMove(i,h)||{};m&&p.setBearing(p.getBearing()+m),v&&p.setPitch(p.getPitch()+v)}off(){const i=this.element;N.removeEventListener(i,"mousedown",this.mousedown),N.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend),N.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){N.enableDrag(),N.removeEventListener(window,"mousemove",this.mousemove),N.removeEventListener(window,"mouseup",this.mouseup),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend)}}let Lr;function dn(_,i,h,p=!1){if(p||!h.getCoveringTilesDetailsProvider().allowWorldCopies())return _==null?void 0:_.wrap();const m=new a.S(_.lng,_.lat);if(_=new a.S(_.lng,_.lat),i){const v=new a.S(_.lng-360,_.lat),w=new a.S(_.lng+360,_.lat),I=h.locationToScreenPoint(_).distSqr(i);h.locationToScreenPoint(v).distSqr(i)<I?_=v:h.locationToScreenPoint(w).distSqr(i)<I&&(_=w)}for(;Math.abs(_.lng-h.center.lng)>180;){const v=h.locationToScreenPoint(_);if(v.x>=0&&v.y>=0&&v.x<=h.width&&v.y<=h.height)break;_.lng>h.center.lng?_.lng-=360:_.lng+=360}return _.lng!==m.lng&&h.isPointOnMapSurface(h.locationToScreenPoint(_))?_:m}const Vu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function sl(_,i,h){const p=_.classList;for(const m in Vu)p.remove(`maplibregl-${h}-anchor-${m}`);p.add(`maplibregl-${h}-anchor-${i}`)}class ol extends a.E{constructor(i){if(super(),this._onKeyPress=h=>{const p=h.code,m=h.charCode||h.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=h=>{const p=h.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=h=>{if(!this._map)return;const p=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!p)&&this._map.once("render",this._update),this._lngLat=dn(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),N.setTransform(this._element,`${Vu[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${m}`),F.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.l("dragstart"))),this.fire(new a.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.l("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._subpixelPositioning=i&&i.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(i==null?void 0:i.opacity,i==null?void 0:i.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=a.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=N.create("div");const h=N.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${p}px`),h.setAttributeNS(null,"width",`${m}px`),h.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const v=N.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const w=N.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const I=N.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ne of P){const ae=N.createNS("http://www.w3.org/2000/svg","ellipse");ae.setAttributeNS(null,"opacity","0.04"),ae.setAttributeNS(null,"cx","10.5"),ae.setAttributeNS(null,"cy","5.80029008"),ae.setAttributeNS(null,"rx",ne.rx),ae.setAttributeNS(null,"ry",ne.ry),I.appendChild(ae)}const k=N.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);const D=N.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(D);const z=N.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const L=N.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(L);const U=N.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(6.0, 7.0)"),U.setAttributeNS(null,"fill","#FFFFFF");const W=N.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const te=N.createNS("http://www.w3.org/2000/svg","circle");te.setAttributeNS(null,"fill","#000000"),te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"cx","5.5"),te.setAttributeNS(null,"cy","5.5"),te.setAttributeNS(null,"r","5.4999962");const ee=N.createNS("http://www.w3.org/2000/svg","circle");ee.setAttributeNS(null,"fill","#FFFFFF"),ee.setAttributeNS(null,"cx","5.5"),ee.setAttributeNS(null,"cy","5.5"),ee.setAttributeNS(null,"r","5.4999962"),W.appendChild(te),W.appendChild(ee),w.appendChild(I),w.appendChild(k),w.appendChild(z),w.appendChild(U),w.appendChild(W),h.appendChild(w),h.setAttributeNS(null,"height",p*this._scale+"px"),h.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),sl(this._element,this._anchor,"marker"),i&&i.className)for(const h of i.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(i){return this.remove(),this._map=i,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",i._getUIString("Marker.Title")),i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),i.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),N.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=a.S.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const m=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(i){return this._subpixelPositioning=i,this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var h,p;const m=(h=this._map)===null||h===void 0?void 0:h.terrain,v=this._map.transform.isLocationOccluded(this._lngLat);if(!m||v){const U=v?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==U&&(this._element.style.opacity=U))}if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const w=this._map,I=w.terrain.depthAtPoint(this._pos),P=w.terrain.getElevationForLngLatZoom(this._lngLat,w.transform.tileZoom);if(w.transform.lngLatToCameraDepth(this._lngLat,P)-I<.006)return void(this._element.style.opacity=this._opacity);const k=-this._offset.y/w.transform.pixelsPerMeter,D=Math.sin(w.getPitch()*Math.PI/180)*k,z=w.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),L=w.transform.lngLatToCameraDepth(this._lngLat,P+D)-z>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&L&&this._popup.remove(),this._element.style.opacity=L?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=a.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,h){return(this._opacity===void 0||i===void 0&&h===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Xd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let al=0,xa=!1;const wc={maxWidth:100,unit:"metric"};function ju(_,i,h){const p=h&&h.maxWidth||100,m=_._container.clientHeight/2,v=_._container.clientWidth/2,w=_.unproject([v-p/2,m]),I=_.unproject([v+p/2,m]),P=Math.round(_.project(I).x-_.project(w).x),k=Math.min(p,P,_._container.clientWidth),D=w.distanceTo(I);if(h&&h.unit==="imperial"){const z=3.2808*D;z>5280?ba(i,k,z/5280,_._getUIString("ScaleControl.Miles")):ba(i,k,z,_._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?ba(i,k,D/1852,_._getUIString("ScaleControl.NauticalMiles")):D>=1e3?ba(i,k,D/1e3,_._getUIString("ScaleControl.Kilometers")):ba(i,k,D,_._getUIString("ScaleControl.Meters"))}function ba(_,i,h,p){const m=function(v){const w=Math.pow(10,`${Math.floor(v)}`.length-1);let I=v/w;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(P){const k=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*k)/k}(I),w*I}(h);_.style.width=i*(m/h)+"px",_.innerHTML=`${m}&nbsp;${p}`}const Zd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},qd=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function $u(_){if(_){if(typeof _=="number"){const i=Math.round(Math.abs(_)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,_),"top-left":new a.P(i,i),"top-right":new a.P(-i,i),bottom:new a.P(0,-_),"bottom-left":new a.P(i,-i),"bottom-right":new a.P(-i,-i),left:new a.P(_,0),right:new a.P(-_,0)}}if(_ instanceof a.P||Array.isArray(_)){const i=a.P.convert(_);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:a.P.convert(_.center||[0,0]),top:a.P.convert(_.top||[0,0]),"top-left":a.P.convert(_["top-left"]||[0,0]),"top-right":a.P.convert(_["top-right"]||[0,0]),bottom:a.P.convert(_.bottom||[0,0]),"bottom-left":a.P.convert(_["bottom-left"]||[0,0]),"bottom-right":a.P.convert(_["bottom-right"]||[0,0]),left:a.P.convert(_.left||[0,0]),right:a.P.convert(_.right||[0,0])}}return $u(new a.P(0,0))}const Yd=y;d.AJAXError=a.cz,d.Event=a.l,d.Evented=a.E,d.LngLat=a.S,d.MercatorCoordinate=a.a1,d.Point=a.P,d.addProtocol=a.cA,d.config=a.a,d.removeProtocol=a.cB,d.AttributionControl=Hd,d.BoxZoomHandler=Ld,d.CanvasSource=ir,d.CooperativeGesturesHandler=Tg,d.DoubleClickZoomHandler=Ud,d.DragPanHandler=bg,d.DragRotateHandler=jd,d.EdgeInsets=aa,d.FullscreenControl=class extends a.E{constructor(_={}){super(),this._onFullscreenChange=()=>{var i;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=h==null?void 0:h.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){N.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=N.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);N.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},d.GeoJSONSource=Jt,d.GeolocateControl=class extends a.E{constructor(_){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new a.l("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.l("geolocate",i)),this._finish()}},this._updateCamera=i=>{const h=new a.S(i.coords.longitude,i.coords.latitude),p=i.coords.accuracy,m=this._map.getBearing(),v=a.e({bearing:m},this.options.fitBoundsOptions),w=er.fromLngLat(h,p);this._map.fitBounds(w,v,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const h=new a.S(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=i.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=i=>{if(this._map){if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&xa)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.l("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=N.create("button","maplibregl-ctrl-geolocate",this._container),N.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=i=>{if(this._map){if(i===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ol({element:this._dotElement}),this._circleElement=N.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ol({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{const p=(h==null?void 0:h[0])instanceof ResizeObserverEntry;h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||p||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.l("trackuserlocationend")),this.fire(new a.l("userlocationlostfocus")))})}},this.options=a.e({},Xd,_)}onAdd(_){return this._map=_,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(i=!1){if(Lr!==void 0&&!i)return Lr;if(window.navigator.permissions===void 0)return Lr=!!window.navigator.geolocation,Lr;try{Lr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Lr=!!window.navigator.geolocation}return Lr})}().then(i=>this._finishSetupUI(i)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),N.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,al=0,xa=!1}_isOutOfMapMaxBounds(_){const i=this._map.getMaxBounds(),h=_.coords;return i&&(h.longitude<i.getWest()||h.longitude>i.getEast()||h.latitude<i.getSouth()||h.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const _=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&_))return;const i=this._map.project(_),h=this._map.unproject([i.x+100,i.y]),p=_.distanceTo(h)/100,m=2*this._accuracy/p;this._circleElement.style.width=`${m.toFixed(2)}px`,this._circleElement.style.height=`${m.toFixed(2)}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":al--,xa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.l("trackuserlocationstart")),this.fire(new a.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),al++,al>1?(_={maximumAge:6e5,timeout:0},xa=!0):(_=this.options.positionOptions,xa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},d.GlobeControl=class{constructor(){this._toggleProjection=()=>{var _;const i=(_=this._map.getProjection())===null||_===void 0?void 0:_.type;this._map.setProjection(i!=="mercator"&&i?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var _;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((_=this._map.getProjection())===null||_===void 0?void 0:_.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(_){return this._map=_,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=N.create("button","maplibregl-ctrl-globe",this._container),N.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){N.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},d.Hash=Du,d.ImageSource=sr,d.KeyboardHandler=Nu,d.LngLatBounds=er,d.LogoControl=Eg,d.Map=class extends Sg{constructor(_){var i,h;a.cw.mark(a.cx.create);const p=Object.assign(Object.assign(Object.assign({},os),_),{canvasContextAttributes:Object.assign(Object.assign({},os.canvasContextAttributes),_.canvasContextAttributes)});if(p.minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const m=new Vr,v=new si;if(p.minZoom!==void 0&&m.setMinZoom(p.minZoom),p.maxZoom!==void 0&&m.setMaxZoom(p.maxZoom),p.minPitch!==void 0&&m.setMinPitch(p.minPitch),p.maxPitch!==void 0&&m.setMaxPitch(p.maxPitch),p.renderWorldCopies!==void 0&&m.setRenderWorldCopies(p.renderWorldCopies),super(m,v,{bearingSnap:p.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Hs,this._controls=[],this._mapId=a.a7(),this._contextLost=I=>{I.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.l("webglcontextlost",{originalEvent:I}))},this._contextRestored=I=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.l("webglcontextrestored",{originalEvent:I}))},this._onMapScroll=I=>{if(I.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},p.canvasContextAttributes),this._trackResize=p.trackResize===!0,this._bearingSnap=p.bearingSnap,this._centerClampedToGround=p.centerClampedToGround,this._refreshExpiredTiles=p.refreshExpiredTiles===!0,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions===!0,this._collectResourceTiming=p.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},_i),p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=p.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=le.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ae(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let I=!1;const P=ya(k=>{this._trackResize&&!this._removed&&(this.resize(k),this.redraw())},50);this._resizeObserver=new ResizeObserver(k=>{I?P(k):I=!0}),this._resizeObserver.observe(this._container)}this.handlers=new $d(this,p),this._hash=p.hash&&new Du(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,elevation:p.elevation,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,roll:p.roll}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,a.e({},p.fitBoundsOptions,{duration:0}))));const w=typeof p.style=="string"||((h=(i=p.style)===null||i===void 0?void 0:i.projection)===null||h===void 0?void 0:h.type)!=="globe";this.resize(null,w),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new Hd(typeof p.attributionControl=="boolean"?void 0:p.attributionControl)),p.maplibreLogo&&this.addControl(new Eg,p.logoPosition),this.on("style.load",()=>{if(w||this._resizeTransform(),this.transform.unmodified){const I=a.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(I)}}),this.on("data",I=>{this._update(I.dataType==="style"),this.fire(new a.l(`${I.dataType}data`,I))}),this.on("dataloading",I=>{this.fire(new a.l(`${I.dataType}dataloading`,I))}),this.on("dataabort",I=>{this.fire(new a.l("sourcedataabort",I))})}_getMapId(){return this._mapId}setGlobalStateProperty(_,i){return this.style.setGlobalStateProperty(_,i),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(_,i){if(i===void 0&&(i=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new a.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=_.onAdd(this);this._controls.push(_);const p=this._controlPositions[i];return i.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new a.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(_);return i>-1&&this._controls.splice(i,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}coveringTiles(_){return Te(this.transform,_)}calculateCameraOptionsFromTo(_,i,h,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(_,i,h,p)}resize(_,i=!0){const[h,p]=this._containerDimensions(),m=this._getClampedPixelRatio(h,p);if(this._resizeCanvas(h,p,m),this.painter.resize(h,p,m),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const I=this._getClampedPixelRatio(h,p);this._resizeCanvas(h,p,I),this.painter.resize(h,p,I)}this._resizeTransform(i);const v=!this._moving;return v&&(this.stop(),this.fire(new a.l("movestart",_)).fire(new a.l("move",_))),this.fire(new a.l("resize",_)),v&&this.fire(new a.l("moveend",_)),this}_resizeTransform(_=!0){var i;const[h,p]=this._containerDimensions();this.transform.resize(h,p,_),(i=this._requestedCameraState)===null||i===void 0||i.resize(h,p,_)}_getClampedPixelRatio(_,i){const{0:h,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),v=_*m,w=i*m;return Math.min(v>h?h/v:1,w>p?p/w:1)*m}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(er.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.setMinZoom(_),this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.setMaxZoom(_),this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.setMinPitch(_),this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(_>=this.transform.minPitch)return this.transform.setMaxPitch(_),this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.setRenderWorldCopies(_),this._update()}project(_){return this.transform.locationToScreenPoint(a.S.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.screenPointToLocation(a.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,i,h){if(_==="mouseenter"||_==="mouseover"){let p=!1;return{layers:i,listener:h,delegates:{mousemove:v=>{const w=i.filter(P=>this.getLayer(P)),I=w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[];I.length?p||(p=!0,h.call(this,new Ci(_,this,v.originalEvent,{features:I}))):p=!1},mouseout:()=>{p=!1}}}}if(_==="mouseleave"||_==="mouseout"){let p=!1;return{layers:i,listener:h,delegates:{mousemove:w=>{const I=i.filter(P=>this.getLayer(P));(I.length!==0?this.queryRenderedFeatures(w.point,{layers:I}):[]).length?p=!0:p&&(p=!1,h.call(this,new Ci(_,this,w.originalEvent)))},mouseout:w=>{p&&(p=!1,h.call(this,new Ci(_,this,w.originalEvent)))}}}}{const p=m=>{const v=i.filter(I=>this.getLayer(I)),w=v.length!==0?this.queryRenderedFeatures(m.point,{layers:v}):[];w.length&&(m.features=w,h.call(this,m),delete m.features)};return{layers:i,listener:h,delegates:{[_]:p}}}}_saveDelegatedListener(_,i){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(i)}_removeDelegatedListener(_,i,h){if(!this._delegatedListeners||!this._delegatedListeners[_])return;const p=this._delegatedListeners[_];for(let m=0;m<p.length;m++){const v=p[m];if(v.listener===h&&v.layers.length===i.length&&v.layers.every(w=>i.includes(w))){for(const w in v.delegates)this.off(w,v.delegates[w]);return void p.splice(m,1)}}}on(_,i,h){if(h===void 0)return super.on(_,i);const p=typeof i=="string"?[i]:i,m=this._createDelegatedListener(_,p,h);this._saveDelegatedListener(_,m);for(const v in m.delegates)this.on(v,m.delegates[v]);return{unsubscribe:()=>{this._removeDelegatedListener(_,p,h)}}}once(_,i,h){if(h===void 0)return super.once(_,i);const p=typeof i=="string"?[i]:i,m=this._createDelegatedListener(_,p,h);for(const v in m.delegates){const w=m.delegates[v];m.delegates[v]=(...I)=>{this._removeDelegatedListener(_,p,h),w(...I)}}this._saveDelegatedListener(_,m);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(_,i,h){return h===void 0?super.off(_,i):(this._removeDelegatedListener(_,typeof i=="string"?[i]:i,h),this)}queryRenderedFeatures(_,i){if(!this.style)return[];let h;const p=_ instanceof a.P||Array.isArray(_),m=p?_:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(p?{}:_)||{},m instanceof a.P||typeof m[0]=="number")h=[a.P.convert(m)];else{const v=a.P.convert(m[0]),w=a.P.convert(m[1]);h=[v,new a.P(w.x,v.y),w,new a.P(v.x,w.y),v]}return this.style.queryRenderedFeatures(h,i,this.transform)}querySourceFeatures(_,i){return this.style.querySourceFeatures(_,i)}setStyle(_,i){return(i=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(_,i))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const i=this._locale[_];if(i==null)throw new Error(`Missing UI string '${_}'`);return i}_updateStyle(_,i){var h,p;if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(_,i));const m=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new dd(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,i,m):this.style.loadJSON(_,i,m),this):((p=(h=this.style)===null||h===void 0?void 0:h.projection)===null||p===void 0||p.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new dd(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,i){if(typeof _=="string"){const h=this._requestManager.transformRequest(_,"Style");a.j(h,new AbortController).then(p=>{this._updateDiff(p.data,i)}).catch(p=>{p&&this.fire(new a.k(p))})}else typeof _=="object"&&this._updateDiff(_,i)}_updateDiff(_,i){try{this.style.setState(_,i)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(_,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(_,i){return this._lazyInitEmptyStyle(),this.style.addSource(_,i),this._update(!0)}isSourceLoaded(_){const i=this.style&&this.style.sourceCaches[_];if(i!==void 0)return i.loaded();this.fire(new a.k(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const i=this.style.sourceCaches[_.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);this.terrain===null&&i.reload();for(const h in this.style._layers){const p=this.style._layers[h];p.type==="hillshade"&&p.source===_.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),p.type==="color-relief"&&p.source===_.source&&a.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Nt(this.painter,i,_),this.painter.renderToTexture=new Uu(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=h=>{var p;h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==_.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((p=h.source)===null||p===void 0?void 0:p.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new a.l("terrain",{terrain:_})),this}getTerrain(){var _,i;return(i=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const _=this.style&&this.style.sourceCaches;for(const i in _){const h=_[i]._tiles;for(const p in h){const m=h[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}setSourceTileLodParams(_,i,h){if(h){const p=this.getSource(h);if(!p)throw new Error(`There is no source with ID "${h}", cannot set LOD parameters`);p.calculateTileZoom=We(Math.max(1,_),Math.max(1,i))}else for(const p in this.style.sourceCaches)this.style.sourceCaches[p].getSource().calculateTileZoom=We(Math.max(1,_),Math.max(1,i));return this._update(!0),this}refreshTiles(_,i){const h=this.style.sourceCaches[_];if(!h)throw new Error(`There is no source cache with ID "${_}", cannot refresh tile`);i===void 0?h.reload(!0):h.refreshTiles(i.map(p=>new a.a4(p.z,p.x,p.y)))}addImage(_,i,h={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:v,stretchY:w,content:I,textFitWidth:P,textFitHeight:k}=h;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||a.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:D,height:z,data:L}=i,U=i;return this.style.addImage(_,{data:new a.R({width:D,height:z},new Uint8Array(L)),pixelRatio:p,stretchX:v,stretchY:w,content:I,textFitWidth:P,textFitHeight:k,sdf:m,version:0,userImage:U}),U.onAdd&&U.onAdd(this,_),this}}{const{width:D,height:z,data:L}=F.getImageData(i);this.style.addImage(_,{data:new a.R({width:D,height:z},L),pixelRatio:p,stretchX:v,stretchY:w,content:I,textFitWidth:P,textFitHeight:k,sdf:m,version:0})}}updateImage(_,i){const h=this.style.getImage(_);if(!h)return this.fire(new a.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=i instanceof HTMLImageElement||a.b(i)?F.getImageData(i):i,{width:m,height:v,data:w}=p;if(m===void 0||v===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==h.data.width||v!==h.data.height)return this.fire(new a.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const I=!(i instanceof HTMLImageElement||a.b(i));return h.data.replace(w,I),this.style.updateImage(_,h),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new a.k(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_){return le.getImage(this._requestManager.transformRequest(_,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(_,i){return this._lazyInitEmptyStyle(),this.style.addLayer(_,i),this._update(!0)}moveLayer(_,i){return this.style.moveLayer(_,i),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,i,h){return this.style.setLayerZoomRange(_,i,h),this._update(!0)}setFilter(_,i,h={}){return this.style.setFilter(_,i,h),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,i,h,p={}){return this.style.setPaintProperty(_,i,h,p),this._update(!0)}getPaintProperty(_,i){return this.style.getPaintProperty(_,i)}setLayoutProperty(_,i,h,p={}){return this.style.setLayoutProperty(_,i,h,p),this._update(!0)}getLayoutProperty(_,i){return this.style.getLayoutProperty(_,i)}setGlyphs(_,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,i,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,i,h,p=>{p||this._update(!0)}),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,i,h=>{h||this._update(!0)}),this}setLight(_,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,i),this._update(!0)}getLight(){return this.style.getLight()}setSky(_,i={}){return this._lazyInitEmptyStyle(),this.style.setSky(_,i),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(_,i){return this.style.setFeatureState(_,i),this._update()}removeFeatureState(_,i){return this.style.removeFeatureState(_,i),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,i=0;return this._container&&(_=this._container.clientWidth||400,i=this._container.clientHeight||300),[_,i]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const i=this._canvasContainer=N.create("div","maplibregl-canvas-container",_);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=N.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),p=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],p);const m=this._controlContainer=N.create("div","maplibregl-control-container",_),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{v[w]=N.create("div",`maplibregl-ctrl-${w} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,i,h){this._canvas.width=Math.floor(h*_),this._canvas.height=Math.floor(h*i),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const _=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let i=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{i={requestedAttributes:_},p&&(i.statusMessage=p.statusMessage,i.type=p.type)},{once:!0});let h=null;if(h=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,_):this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_),!h){const p="Failed to initialize WebGL";throw i?(i.message=p,new Error(JSON.stringify(i))):new Error(p)}this.painter=new ug(h,this.transform),G.testSupport(h)}migrateProjection(_,i){super.migrateProjection(_,i),this.painter.transform=_,this.fire(new a.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){var i,h,p,m,v;const w=this._idleTriggered?this._fadeDuration:0,I=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let P=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,L=F.now();this.style.zoomHistory.update(z,L);const U=new a.F(z,{now:L,fadeDuration:w,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),W=U.crossFadingFactor();W===1&&W===this._crossFadingFactor||(P=!0,this._crossFadingFactor=W),this.style.update(U)}const k=((h=this.style.projection)===null||h===void 0?void 0:h.transitionState)>0!==I;(p=this.style.projection)===null||p===void 0||p.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((m=this.style.projection)===null||m===void 0?void 0:m.transitionState,(v=this.style.projection)===null||v===void 0?void 0:v.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||k)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,k),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,showPadding:this.showPadding}),this.fire(new a.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.cw.mark(a.cx.load),this.fire(new a.l("load"))),this.style&&(this.style.hasTransitions()||P)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const D=this._sourcesDirty||this._styleDirty||this._placementDirty;return D||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.l("idle")),!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,a.cw.mark(a.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),le.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i!=null&&i.loseContext&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),N.remove(this._canvasContainer),N.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),a.cw.clearMetrics(),this._removed=!0,this.fire(new a.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,F.frame(this._frameRequest,_=>{a.cw.frame(_),this._frameRequest=null;try{this._render(_)}catch(i){if(!a.cy(i)&&!function(h){return h.message===hc}(i))throw i}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return Ag}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(_){return this._lazyInitEmptyStyle(),this.style.setProjection(_),this._update(!0)}},d.MapMouseEvent=Ci,d.MapTouchEvent=Qa,d.MapWheelEvent=Nd,d.Marker=ol,d.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const i=this._map.getZoom(),h=i===this._map.getMaxZoom(),p=i===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(i,h)=>{const p=this._map._getUIString(`NavigationControl.${h}`);i.title=p,i.setAttribute("aria-label",p)},this.options=a.e({},Qy,_),this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),N.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),N.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=N.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new bc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){N.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,i){const h=N.create("button",_,this._container);return h.type="button",h.addEventListener("click",i),h}},d.Popup=class extends a.E{constructor(_){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&N.remove(this._content),this._container&&(N.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.l("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=N.create("div","maplibregl-popup",this._map.getContainer()),this._tip=N.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=dn(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!i)return;const h=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationToScreenPoint(this._lngLat));let p=this.options.anchor;const m=$u(this.options.offset);if(!p){const w=this._container.offsetWidth,I=this._container.offsetHeight;let P;P=h.y+m.bottom.y<I?["top"]:h.y>this._map.transform.height-I?["bottom"]:[],h.x<w/2?P.push("left"):h.x>this._map.transform.width-w/2&&P.push("right"),p=P.length===0?"bottom":P.join("-")}let v=h.add(m[p]);this.options.subpixelPositioning||(v=v.round()),N.setTransform(this._container,`${Vu[p]} translate(${v.x}px,${v.y}px)`),sl(this._container,p,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Zd),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=a.S.convert(_),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const i=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=_;p=h.firstChild,p;)i.appendChild(p);return this.setDOMContent(i)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=N.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){return this._container&&this._container.classList.add(_),this}removeClassName(_){return this._container&&this._container.classList.remove(_),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}setSubpixelPositioning(_){this.options.subpixelPositioning=_}_createCloseButton(){this.options.closeButton&&(this._closeButton=N.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(qd);_&&_.focus()}},d.RasterDEMTileSource=tr,d.RasterTileSource=xr,d.ScaleControl=class{constructor(_){this._onMove=()=>{ju(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,ju(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},wc),_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){N.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},d.ScrollZoomHandler=vg,d.Style=dd,d.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=_}onAdd(_){return this._map=_,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=N.create("button","maplibregl-ctrl-terrain",this._container),N.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){N.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},d.TwoFingersTouchPitchHandler=Fu,d.TwoFingersTouchRotateHandler=nl,d.TwoFingersTouchZoomHandler=Ou,d.TwoFingersTouchZoomRotateHandler=wg,d.VectorTileSource=Qt,d.VideoSource=Ht,d.addSourceType=(_,i)=>a._(void 0,void 0,void 0,function*(){if(Er(_))throw new Error(`A source type called "${_}" already exists.`);((h,p)=>{yr[h]=p})(_,i)}),d.clearPrewarmedResources=function(){const _=_r;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(gt),_r=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.createTileMesh=ud,d.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},d.getRTLTextPluginStatus=function(){return Mr().getRTLTextPluginStatus()},d.getVersion=function(){return Yd},d.getWorkerCount=function(){return dt.workerCount},d.getWorkerUrl=function(){return a.a.WORKER_URL},d.importScriptInWorkers=function(_){return nr().broadcast("IS",_)},d.prewarm=function(){bt().acquire(gt)},d.setMaxParallelImageRequests=function(_){a.a.MAX_PARALLEL_IMAGE_REQUESTS=_},d.setRTLTextPlugin=function(_,i){return Mr().setRTLTextPlugin(_,i)},d.setWorkerCount=function(_){dt.workerCount=_},d.setWorkerUrl=function(_){a.a.WORKER_URL=_}});var c=r;return c})})(bI);var ED=bI.exports;const JT=QR(ED);function y_(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const I1=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),eS=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);eS&&parseFloat(eS[1]);const lm=globalThis,lh=globalThis.process||{},AD=globalThis.navigator||{};function TI(t){var n,o;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((o=process.versions)!=null&&o.electron))return!0;const r=typeof navigator<"u"&&navigator.userAgent;return!!(r&&r.indexOf("Electron")>=0)}function ou(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||TI()}function ID(t){return ou()?TI()?"Electron":(AD.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const SI="4.1.0";function PD(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}class CD{constructor(e,r,n="sessionStorage"){this.storage=PD(n),this.id=e,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let e={};if(this.storage){const r=this.storage.getItem(this.id);e=r?JSON.parse(r):{}}return Object.assign(this.config,e),this}}function MD(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function RD(t,e=8){const r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var v_;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(v_||(v_={}));const kD=10;function tS(t){return typeof t!="string"?t:(t=t.toUpperCase(),v_[t]||v_.WHITE)}function DD(t,e,r){return!ou&&typeof t=="string"&&(e&&(t=`\x1B[${tS(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${tS(r)+kD}m${t}\x1B[49m`)),t}function OD(t,e=["constructor"]){const r=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(r),o=t;for(const c of n){const d=o[c];typeof d=="function"&&(e.find(a=>c===a)||(o[c]=d.bind(t)))}}function P1(t,e){if(!t)throw new Error("Assertion failed")}function ch(){var e,r,n;let t;if(ou()&&lm.performance)t=(r=(e=lm==null?void 0:lm.performance)==null?void 0:e.now)==null?void 0:r.call(e);else if("hrtime"in lh){const o=(n=lh==null?void 0:lh.hrtime)==null?void 0:n.call(lh);t=o[0]*1e3+o[1]/1e6}else t=Date.now();return t}const uh={debug:ou()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},FD={enabled:!0,level:0};function hh(){}const rS={},nS={once:!0};class Op{constructor({id:e}={id:""}){this.VERSION=SI,this._startTs=ch(),this._deltaTs=ch(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new CD(`__probe-${this.id}__`,FD),this.timeStamp(`${this.id} started`),OD(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ch()-this._startTs).toPrecision(10))}getDelta(){return Number((ch()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,r){this._storage.setConfiguration({[e]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,r){if(!e)throw new Error(r||"Assertion failed")}warn(e){return this._getLogFunction(0,e,uh.warn,arguments,nS)}error(e){return this._getLogFunction(0,e,uh.error,arguments)}deprecated(e,r){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(e,r){return this.error(`\`${e}\` has been removed. Use \`${r}\` instead`)}probe(e,r){return this._getLogFunction(e,r,uh.log,arguments,{time:!0,once:!0})}log(e,r){return this._getLogFunction(e,r,uh.debug,arguments)}info(e,r){return this._getLogFunction(e,r,console.info,arguments)}once(e,r){return this._getLogFunction(e,r,uh.debug||uh.info,arguments,nS)}table(e,r,n){return r?this._getLogFunction(e,r,console.table||hh,n&&[n],{tag:LD(r)}):hh}time(e,r){return this._getLogFunction(e,r,console.time?console.time:console.info)}timeEnd(e,r){return this._getLogFunction(e,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,r){return this._getLogFunction(e,r,console.timeStamp||hh)}group(e,r,n={collapsed:!1}){const o=iS({logLevel:e,message:r,opts:n}),{collapsed:c}=n;return o.method=(c?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}groupCollapsed(e,r,n={}){return this.group(e,r,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||hh)}withGroup(e,r,n){this.group(e,r)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=EI(e)}_getLogFunction(e,r,n,o,c){if(this._shouldLog(e)){c=iS({logLevel:e,message:r,args:o,opts:c}),n=n||c.method,P1(n),c.total=this.getTotal(),c.delta=this.getDelta(),this._deltaTs=ch();const d=c.tag||c.message;if(c.once&&d)if(!rS[d])rS[d]=ch();else return hh;return r=ND(this.id,c.message,c),n.bind(console,r,...c.args)}return hh}}Op.VERSION=SI;function EI(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return P1(Number.isFinite(e)&&e>=0),e}function iS(t){const{logLevel:e,message:r}=t;t.logLevel=EI(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&n.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const o=typeof t.message;return P1(o==="string"||o==="object"),Object.assign(t,{args:n},t.opts)}function ND(t,e,r){if(typeof e=="string"){const n=r.time?RD(MD(r.total)):"";e=r.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=DD(e,r.color,r.background)}return e}function LD(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}const u0="4.3.3",zD=u0[0]>="0"&&u0[0]<="9"?`v${u0}`:"";function BD(){const t=new Op({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=zD,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const UD=BD();function VD(t,e){return AI(t||{},e)}function AI(t,e,r=0){if(r>3)return e;const n={...t};for(const[o,c]of Object.entries(e))c&&typeof c=="object"&&!Array.isArray(c)?n[o]=AI(n[o]||{},e[o],r+1):n[o]=e[o];return n}const jD="latest";function $D(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const WD=$D();function Wl(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Wc=typeof process!="object"||String(process)!=="[object process]"||process.browser,HD=typeof window<"u"&&typeof window.orientation<"u",sS=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);sS&&parseFloat(sS[1]);class XD{constructor(e,r){Q(this,"name");Q(this,"workerThread");Q(this,"isRunning",!0);Q(this,"result");Q(this,"_resolve",()=>{});Q(this,"_reject",()=>{});this.name=e,this.workerThread=r,this.result=new Promise((n,o)=>{this._resolve=n,this._reject=o})}postMessage(e,r){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:r})}done(e){Wl(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Wl(this.isRunning),this.isRunning=!1,this._reject(e)}}class h0{terminate(){}}const d0=new Map;function ZD(t){Wl(t.source&&!t.url||!t.source&&t.url);let e=d0.get(t.source||t.url);return e||(t.url&&(e=qD(t.url),d0.set(t.url,e)),t.source&&(e=II(t.source),d0.set(t.source,e))),Wl(e),e}function qD(t){if(!t.startsWith("http"))return t;const e=YD(t);return II(e)}function II(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function YD(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function PI(t,e=!0,r){const n=r||new Set;if(t){if(oS(t))n.add(t);else if(oS(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const o in t)PI(t[o],e,n)}}return r===void 0?Array.from(n):[]}function oS(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const f0=()=>{};class jx{constructor(e){Q(this,"name");Q(this,"source");Q(this,"url");Q(this,"terminated",!1);Q(this,"worker");Q(this,"onMessage");Q(this,"onError");Q(this,"_loadableURL","");const{name:r,source:n,url:o}=e;Wl(n||o),this.name=r,this.source=n,this.url=o,this.onMessage=f0,this.onError=c=>console.log(c),this.worker=Wc?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Wc||typeof h0<"u"&&!Wc}destroy(){this.onMessage=f0,this.onError=f0,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,r){r=r||PI(e),this.worker.postMessage(e,r)}_getErrorFromErrorEvent(e){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,e.message&&(r+=`${e.message} in `),e.lineno&&(r+=`:${e.lineno}:${e.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=ZD({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},e.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},e.onmessageerror=r=>console.error(r),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new h0(n,{eval:!1})}else if(this.source)e=new h0(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",r=>{this.onMessage(r)}),e.on("error",r=>{this.onError(r)}),e.on("exit",r=>{}),e}}class GD{constructor(e){Q(this,"name","unnamed");Q(this,"source");Q(this,"url");Q(this,"maxConcurrency",1);Q(this,"maxMobileConcurrency",1);Q(this,"onDebug",()=>{});Q(this,"reuseWorkers",!0);Q(this,"props",{});Q(this,"jobQueue",[]);Q(this,"idleQueue",[]);Q(this,"count",0);Q(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return jx.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,r=(o,c,d)=>o.done(d),n=(o,c)=>o.error(c)){const o=new Promise(c=>(this.jobQueue.push({name:e,onMessage:r,onError:n,onStart:c}),this));return this._startQueuedJob(),await o}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:e,backlog:this.jobQueue.length});const n=new XD(r.name,e);e.onMessage=o=>r.onMessage(n,o.type,o.payload),e.onError=o=>r.onError(n,o),r.onStart(n);try{await n.result}catch(o){console.error(`Worker exception: ${o}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Wc||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new jx({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return HD?this.maxMobileConcurrency:this.maxConcurrency}}const KD={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Tl=class Tl{constructor(e){Q(this,"props");Q(this,"workerPools",new Map);this.props={...KD},this.setProps(e),this.workerPools=new Map}static isSupported(){return jx.isSupported()}static getWorkerFarm(e={}){return Tl._workerFarm=Tl._workerFarm||new Tl({}),Tl._workerFarm.setProps(e),Tl._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:r,source:n,url:o}=e;let c=this.workerPools.get(r);return c||(c=new GD({name:r,source:n,url:o}),c.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,c)),c}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};Q(Tl,"_workerFarm");let x_=Tl;function QD(t,e={}){const r=e[t.id]||{},n=Wc?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let o=r.workerUrl;if(!o&&t.id==="compression"&&(o=e.workerUrl),e._workerType==="test"&&(Wc?o=`modules/${t.module}/dist/${n}`:o=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!o){let c=t.version;c==="latest"&&(c=jD);const d=c?`@${c}`:"";o=`https://unpkg.com/@loaders.gl/${t.module}${d}/dist/${n}`}return Wl(o),o}function JD(t,e=WD){Wl(t,"no worker provided");const r=t.version;return!(!e||!r)}function eO(t,e){return!x_.isSupported()||!Wc&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function tO(t,e,r,n,o){const c=t.id,d=QD(t,r),y=x_.getWorkerFarm(r).getWorkerPool({name:c,url:d});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));const S=await y.startJob("process-on-worker",rO.bind(null,o));return S.postMessage("process",{input:e,options:r,context:n}),await(await S.result).result}async function rO(t,e,r,n){switch(r){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:o,input:c,options:d}=n;try{const a=await t(c,d);e.postMessage("done",{id:o,result:a})}catch(a){const y=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:o,error:y})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function nO(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;const n=new Uint8Array(t),o=new Uint8Array(e);for(let c=0;c<n.length;++c)if(n[c]!==o[c])return!1;return!0}function iO(...t){return sO(t)}function sO(t){const e=t.map(c=>c instanceof ArrayBuffer?new Uint8Array(c):c),r=e.reduce((c,d)=>c+d.byteLength,0),n=new Uint8Array(r);let o=0;for(const c of e)n.set(c,o),o+=c.byteLength;return n.buffer}async function oO(t){const e=[];for await(const r of t)e.push(r);return iO(...e)}function aS(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class lS{constructor(e,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=aS(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(aS()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class wy{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,r="count"){return this._getOrCreate({name:e,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const r of Object.values(this.stats))e(r)}getTable(){const e={};return this.forEach(r=>{e[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(r=>this._getOrCreate(r))}_getOrCreate(e){const{name:r,type:n}=e;let o=this.stats[r];return o||(e instanceof lS?o=e:o=new lS(r,n),this.stats[r]=o),o}}let aO="";const cS={};function lO(t){for(const e in cS)if(t.startsWith(e)){const r=cS[e];t=t.replace(e,r)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${aO}${t}`),t}function cO(t){return t&&typeof t=="object"&&t.isBuffer}function CI(t){if(cO(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function MI(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function uO(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const hO=t=>typeof t=="boolean",Hf=t=>typeof t=="function",Fp=t=>t!==null&&typeof t=="object",uS=t=>Fp(t)&&t.constructor==={}.constructor,dO=t=>!!t&&typeof t[Symbol.iterator]=="function",fO=t=>t&&typeof t[Symbol.asyncIterator]=="function",au=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,lu=t=>typeof Blob<"u"&&t instanceof Blob,pO=t=>t&&typeof t=="object"&&t.isBuffer,gO=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Fp(t)&&Hf(t.tee)&&Hf(t.cancel)&&Hf(t.getReader),mO=t=>Fp(t)&&Hf(t.read)&&Hf(t.pipe)&&hO(t.readable),RI=t=>gO(t)||mO(t);class _O extends Error{constructor(r,n){super(r);Q(this,"reason");Q(this,"url");Q(this,"response");this.reason=n.reason,this.url=n.url,this.response=n.response}}const yO=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,vO=/^([-\w.]+\/[-\w.+]+)/;function hS(t,e){return t.toLowerCase()===e.toLowerCase()}function xO(t){const e=vO.exec(t);return e?e[1]:t}function dS(t){const e=yO.exec(t);return e?e[1]:""}const kI=/\?.*/;function bO(t){const e=t.match(kI);return e&&e[0]}function C1(t){return t.replace(kI,"")}function wO(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Ty(t){return au(t)?t.url:lu(t)?t.name||"":typeof t=="string"?t:""}function M1(t){if(au(t)){const e=t,r=e.headers.get("content-type")||"",n=C1(e.url);return xO(r)||dS(n)}return lu(t)?t.type||"":typeof t=="string"?dS(t):""}function TO(t){return au(t)?t.headers["content-length"]||-1:lu(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function DI(t){if(au(t))return t;const e={},r=TO(t);r>=0&&(e["content-length"]=String(r));const n=Ty(t),o=M1(t);o&&(e["content-type"]=o);const c=await AO(t);c&&(e["x-first-bytes"]=c),typeof t=="string"&&(t=new TextEncoder().encode(t));const d=new Response(t,{headers:e});return Object.defineProperty(d,"url",{value:n}),d}async function SO(t){if(!t.ok)throw await EO(t)}async function EO(t){const e=wO(t.url);let r=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;r=r.length>100?`${r.slice(0,100)}...`:r;const n={reason:t.statusText,url:t.url,response:t};try{const o=t.headers.get("Content-Type");n.reason=!t.bodyUsed&&(o!=null&&o.includes("application/json"))?await t.json():await t.text()}catch{}return new _O(r,n)}async function AO(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const r=t.slice(0,5);return await new Promise(n=>{const o=new FileReader;o.onload=c=>{var d;return n((d=c==null?void 0:c.target)==null?void 0:d.result)},o.readAsDataURL(r)})}if(t instanceof ArrayBuffer){const r=t.slice(0,5);return`data:base64,${IO(r)}`}return null}function IO(t){let e="";const r=new Uint8Array(t);for(let n=0;n<r.byteLength;n++)e+=String.fromCharCode(r[n]);return btoa(e)}function PO(t){return!CO(t)&&!MO(t)}function CO(t){return t.startsWith("http:")||t.startsWith("https:")}function MO(t){return t.startsWith("data:")}async function fS(t,e){var r,n;if(typeof t=="string"){const o=lO(t);return PO(o)&&(r=globalThis.loaders)!=null&&r.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(o,e):await fetch(o,e)}return await DI(t)}const pS=new Op({id:"loaders.gl"});class RO{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class kO{constructor(){Q(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const OI={fetch:null,mimeType:void 0,nothrow:!1,log:new kO,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:I1,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},DO={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function FI(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function NI(){const t=FI();return t.globalOptions=t.globalOptions||{...OI},t.globalOptions}function OO(t,e,r,n){return r=r||[],r=Array.isArray(r)?r:[r],FO(t,r),LO(e,t,n)}function FO(t,e){gS(t,null,OI,DO,e);for(const r of e){const n=t&&t[r.id]||{},o=r.options&&r.options[r.id]||{},c=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};gS(n,r.id,o,c,e)}}function gS(t,e,r,n,o){const c=e||"Top level",d=e?`${e}.`:"";for(const a in t){const y=!e&&Fp(t[a]),S=a==="baseUri"&&!e,E=a==="workerUrl"&&e;if(!(a in r)&&!S&&!E){if(a in n)pS.warn(`${c} loader option '${d}${a}' no longer supported, use '${n[a]}'`)();else if(!y){const M=NO(a,o);pS.warn(`${c} loader option '${d}${a}' not recognized. ${M}`)()}}}}function NO(t,e){const r=t.toLowerCase();let n="";for(const o of e)for(const c in o.options){if(t===c)return`Did you mean '${o.id}.${c}'?`;const d=c.toLowerCase();(r.startsWith(d)||d.startsWith(r))&&(n=n||`Did you mean '${o.id}.${c}'?`)}return n}function LO(t,e,r){const o={...t.options||{}};return zO(o,r),o.log===null&&(o.log=new RO),mS(o,NI()),mS(o,e),o}function mS(t,e){for(const r in e)if(r in e){const n=e[r];uS(n)&&uS(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}function zO(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function R1(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function k1(t){y_(t,"null loader"),y_(R1(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const LI=()=>{const t=FI();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function BO(t){const e=LI();t=Array.isArray(t)?t:[t];for(const r of t){const n=k1(r);e.find(o=>n===o)||e.unshift(n)}}function UO(){return LI()}const VO=/\.([^.]+)$/;async function jO(t,e=[],r,n){if(!zI(t))return null;let o=_S(t,e,{...r,nothrow:!0},n);if(o)return o;if(lu(t)&&(t=await t.slice(0,10).arrayBuffer(),o=_S(t,e,r,n)),!o&&!(r!=null&&r.nothrow))throw new Error(BI(t));return o}function _S(t,e=[],r,n){if(!zI(t))return null;if(e&&!Array.isArray(e))return k1(e);let o=[];e&&(o=o.concat(e)),r!=null&&r.ignoreRegisteredLoaders||o.push(...UO()),WO(o);const c=$O(t,o,r,n);if(!c&&!(r!=null&&r.nothrow))throw new Error(BI(t));return c}function $O(t,e,r,n){const o=Ty(t),c=M1(t),d=C1(o)||(n==null?void 0:n.url);let a=null,y="";return r!=null&&r.mimeType&&(a=p0(e,r==null?void 0:r.mimeType),y=`match forced by supplied MIME type ${r==null?void 0:r.mimeType}`),a=a||HO(e,d),y=y||(a?`matched url ${d}`:""),a=a||p0(e,c),y=y||(a?`matched MIME type ${c}`:""),a=a||ZO(e,t),y=y||(a?`matched initial data ${UI(t)}`:""),r!=null&&r.fallbackMimeType&&(a=a||p0(e,r==null?void 0:r.fallbackMimeType),y=y||(a?`matched fallback MIME type ${c}`:"")),y&&UD.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${y}.`),a}function zI(t){return!(t instanceof Response&&t.status===204)}function BI(t){const e=Ty(t),r=M1(t);let n="No valid loader found (";n+=e?`${MI(e)}, `:"no url provided, ",n+=`MIME type: ${r?`"${r}"`:"not provided"}, `;const o=t?UI(t):"";return n+=o?` first bytes: "${o}"`:"first bytes: not available",n+=")",n}function WO(t){for(const e of t)k1(e)}function HO(t,e){const r=e&&VO.exec(e),n=r&&r[1];return n?XO(t,n):null}function XO(t,e){e=e.toLowerCase();for(const r of t)for(const n of r.extensions)if(n.toLowerCase()===e)return r;return null}function p0(t,e){var r;for(const n of t)if((r=n.mimeTypes)!=null&&r.some(o=>hS(e,o))||hS(e,`application/x.${n.id}`))return n;return null}function ZO(t,e){if(!e)return null;for(const r of t)if(typeof e=="string"){if(qO(e,r))return r}else if(ArrayBuffer.isView(e)){if(yS(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer&&yS(e,0,r))return r;return null}function qO(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>t.startsWith(n))}function yS(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(o=>YO(t,e,r,o))}function YO(t,e,r,n){if(n instanceof ArrayBuffer)return nO(n,t,n.byteLength);switch(typeof n){case"function":return n(t);case"string":const o=$x(t,e,n.length);return n===o;default:return!1}}function UI(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?$x(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?$x(t,0,e):""}function $x(t,e,r){if(t.byteLength<e+r)return"";const n=new DataView(t);let o="";for(let c=0;c<r;c++)o+=String.fromCharCode(n.getUint8(e+c));return o}const GO=256*1024;function*KO(t,e){const r=(e==null?void 0:e.chunkSize)||GO;let n=0;const o=new TextEncoder;for(;n<t.length;){const c=Math.min(t.length-n,r),d=t.slice(n,n+c);n+=c,yield o.encode(d)}}const QO=256*1024;function*JO(t,e={}){const{chunkSize:r=QO}=e;let n=0;for(;n<t.byteLength;){const o=Math.min(t.byteLength-n,r),c=new ArrayBuffer(o),d=new Uint8Array(t,n,o);new Uint8Array(c).set(d),n+=o,yield c}}const eF=1024*1024;async function*tF(t,e){const r=(e==null?void 0:e.chunkSize)||eF;let n=0;for(;n<t.size;){const o=n+r,c=await t.slice(n,o).arrayBuffer();n=o,yield c}}function vS(t,e){return I1?rF(t,e):nF(t)}async function*rF(t,e){const r=t.getReader();let n;try{for(;;){const o=n||r.read();e!=null&&e._streamReadAhead&&(n=r.read());const{done:c,value:d}=await o;if(c)return;yield CI(d)}}catch{r.releaseLock()}}async function*nF(t,e){for await(const r of t)yield CI(r)}function iF(t,e){if(typeof t=="string")return KO(t,e);if(t instanceof ArrayBuffer)return JO(t,e);if(lu(t))return tF(t,e);if(RI(t))return vS(t,e);if(au(t))return vS(t.body,e);throw new Error("makeIterator")}const VI="Cannot convert supplied data type";function sF(t,e,r){if(e.text&&typeof t=="string")return t;if(pO(t)&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const o=t.byteLength||t.length;return(t.byteOffset!==0||o!==n.byteLength)&&(n=n.slice(t.byteOffset,t.byteOffset+o)),n}throw new Error(VI)}async function oF(t,e,r){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||n)return sF(t,e);if(lu(t)&&(t=await DI(t)),au(t)){const o=t;return await SO(o),e.binary?await o.arrayBuffer():await o.text()}if(RI(t)&&(t=iF(t,r)),dO(t)||fO(t))return oO(t);throw new Error(VI)}function jI(t,e){const r=NI(),n=t||r;return typeof n.fetch=="function"?n.fetch:Fp(n.fetch)?o=>fS(o,n.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:fS}function aF(t,e,r){if(r)return r;const n={fetch:jI(e,t),...t};if(n.url){const o=C1(n.url);n.baseUrl=o,n.queryString=bO(n.url),n.filename=MI(o),n.baseUrl=uO(o)}return Array.isArray(n.loaders)||(n.loaders=null),n}function lF(t,e){if(t&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...n]:n}return r&&r.length?r:void 0}async function b_(t,e,r,n){e&&!Array.isArray(e)&&!R1(e)&&(n=void 0,r=e,e=void 0),t=await t,r=r||{};const o=Ty(t),d=lF(e,n),a=await jO(t,d,r);return a?(r=OO(r,a,d,o),n=aF({url:o,_parse:b_,loaders:d},r,n||null),await cF(a,t,r,n)):null}async function cF(t,e,r,n){if(JD(t),r=VD(t.options,r),au(e)){const c=e,{ok:d,redirected:a,status:y,statusText:S,type:E,url:M}=c,F=Object.fromEntries(c.headers.entries());n.response={headers:F,ok:d,redirected:a,status:y,statusText:S,type:E,url:M}}e=await oF(e,t,r);const o=t;if(o.parseTextSync&&typeof e=="string")return o.parseTextSync(e,r,n);if(eO(t,r))return await tO(t,e,r,n,b_);if(o.parseText&&typeof e=="string")return await o.parseText(e,r,n);if(o.parse)return await o.parse(e,r,n);throw Wl(!o.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}function uF(t){let e=1/0,r=1/0,n=1/0,o=-1/0,c=-1/0,d=-1/0;const a=t.POSITION?t.POSITION.value:[],y=a&&a.length;for(let S=0;S<y;S+=3){const E=a[S],M=a[S+1],F=a[S+2];e=E<e?E:e,r=M<r?M:r,n=F<n?F:n,o=E>o?E:o,c=M>c?M:c,d=F>d?F:d}return[[e,r,n],[o,c,d]]}async function Wx(t,e,r,n){let o,c;!Array.isArray(e)&&!R1(e)?(o=[],c=e):(o=e,c=r);const d=jI(c);let a=t;return typeof t=="string"&&(a=await d(t)),lu(t)&&(a=await d(t)),Array.isArray(o)?await b_(a,o,c):await b_(a,o,c)}const hF="4.3.3";var aE;const dF=(aE=globalThis.loaders)==null?void 0:aE.parseImageNode,Hx=typeof Image<"u",Xx=typeof ImageBitmap<"u",fF=!!dF,Zx=I1?!0:fF;function pF(t){switch(t){case"auto":return Xx||Hx||Zx;case"imagebitmap":return Xx;case"image":return Hx;case"data":return Zx;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function gF(){if(Xx)return"imagebitmap";if(Hx)return"image";if(Zx)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function mF(t){const e=yF(t);if(!e)throw new Error("Not an image");return e}function _F(t){switch(mF(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function yF(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const vF=/^data:image\/svg\+xml/,xF=/\.svg((\?|#).*)?$/;function D1(t){return t&&(vF.test(t)||xF.test(t))}function bF(t,e){if(D1(e)){let n=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(c){throw new Error(c.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return $I(t,e)}function $I(t,e){if(D1(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function WI(t,e,r){const n=bF(t,r),o=self.URL||self.webkitURL,c=typeof n!="string"&&o.createObjectURL(n);try{return await wF(c||n,e)}finally{c&&o.revokeObjectURL(c)}}async function wF(t,e){const r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((n,o)=>{try{r.onload=()=>n(r),r.onerror=c=>{const d=c instanceof Error?c.message:"error";o(new Error(d))}}catch(c){o(c)}})}const TF={};let xS=!0;async function SF(t,e,r){let n;D1(r)?n=await WI(t,e,r):n=$I(t,r);const o=e&&e.imagebitmap;return await EF(n,o)}async function EF(t,e=null){if((AF(e)||!xS)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(r){console.warn(r),xS=!1}return await createImageBitmap(t)}function AF(t){for(const e in t||TF)return!1;return!0}function IF(t){return!RF(t,"ftyp",4)||!(t[8]&96)?null:PF(t)}function PF(t){switch(CF(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function CF(t,e,r){return String.fromCharCode(...t.slice(e,r))}function MF(t){return[...t].map(e=>e.charCodeAt(0))}function RF(t,e,r=0){const n=MF(e);for(let o=0;o<n.length;++o)if(n[o]!==t[o+r])return!1;return!0}const Yo=!1,Xf=!0;function HI(t){const e=Np(t);return DF(e)||NF(e)||OF(e)||FF(e)||kF(e)}function kF(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),r=IF(e);return r?{mimeType:r.mimeType,width:0,height:0}:null}function DF(t){const e=Np(t);return e.byteLength>=24&&e.getUint32(0,Yo)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Yo),height:e.getUint32(20,Yo)}:null}function OF(t){const e=Np(t);return e.byteLength>=10&&e.getUint32(0,Yo)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Xf),height:e.getUint16(8,Xf)}:null}function FF(t){const e=Np(t);return e.byteLength>=14&&e.getUint16(0,Yo)===16973&&e.getUint32(2,Xf)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Xf),height:e.getUint32(22,Xf)}:null}function NF(t){const e=Np(t);if(!(e.byteLength>=3&&e.getUint16(0,Yo)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:o}=LF();let c=2;for(;c+9<e.byteLength;){const d=e.getUint16(c,Yo);if(o.has(d))return{mimeType:"image/jpeg",height:e.getUint16(c+5,Yo),width:e.getUint16(c+7,Yo)};if(!n.has(d))return null;c+=2,c+=e.getUint16(c,Yo)}return null}function LF(){const t=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)t.add(r);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Np(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function zF(t,e){var o;const{mimeType:r}=HI(t)||{},n=(o=globalThis.loaders)==null?void 0:o.parseImageNode;return y_(n),await n(t,r)}async function BF(t,e,r){e=e||{};const o=(e.image||{}).type||"auto",{url:c}=r||{},d=UF(o);let a;switch(d){case"imagebitmap":a=await SF(t,e,c);break;case"image":a=await WI(t,e,c);break;case"data":a=await zF(t);break;default:y_(!1)}return o==="data"&&(a=_F(a)),a}function UF(t){switch(t){case"auto":case"data":return gF();default:return pF(t),t}}const VF=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],jF=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],$F={image:{type:"auto",decode:!0}},WF={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:hF,mimeTypes:jF,extensions:VF,parse:BF,tests:[t=>!!HI(new DataView(t))],options:$F},Gr=new Op({id:"deck"});let qx={};function HF(t){qx=t}function Ki(t,e,r,n){Gr.level>0&&qx[t]&&qx[t].call(null,e,r,n)}function XF(t){const e=t[0],r=t[t.length-1];return e==="{"&&r==="}"||e==="["&&r==="]"}const ZF={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:XF,parseTextSync:JSON.parse};function qF(){const t="9.1.14",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(Gr.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Gr,_registerLoggers:HF},BO([ZF,[WF,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const YF=qF();function O1(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const g0={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function GF(t){const e={};for(const[r,n]of Object.entries(t))e[r]=KF(n);return e}function KF(t){let e=bS(t);if(e!=="object")return{value:t,...g0[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...g0[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=bS(t.value),{...t,...g0[e],type:e}):{type:"object",value:null};throw new Error("props")}function bS(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const QF=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,JF=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,eN={vertex:QF,fragment:JF},wS=/void\s+main\s*\([^)]*\)\s*\{\n?/,TS=/}\n?[^{}]*$/,m0=[],Lm="__LUMA_INJECT_DECLARATIONS__";function tN(t){const e={vertex:{},fragment:{}};for(const r in t){let n=t[r];const o=rN(r);typeof n=="string"&&(n={order:0,injection:n}),e[o][r]=n}return e}function rN(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function w_(t,e,r,n=!1){const o=e==="vertex";for(const c in r){const d=r[c];d.sort((y,S)=>y.order-S.order),m0.length=d.length;for(let y=0,S=d.length;y<S;++y)m0[y]=d[y].injection;const a=`${m0.join(`
`)}
`;switch(c){case"vs:#decl":o&&(t=t.replace(Lm,a));break;case"vs:#main-start":o&&(t=t.replace(wS,y=>y+a));break;case"vs:#main-end":o&&(t=t.replace(TS,y=>a+y));break;case"fs:#decl":o||(t=t.replace(Lm,a));break;case"fs:#main-start":o||(t=t.replace(wS,y=>y+a));break;case"fs:#main-end":o||(t=t.replace(TS,y=>a+y));break;default:t=t.replace(c,y=>y+a)}}return t=t.replace(Lm,""),n&&(t=t.replace(/\}\s*$/,c=>c+eN[e])),t}function T_(t){t.map(e=>nN(e))}function nN(t){if(t.instance)return;T_(t.dependencies||[]);const{propTypes:e={},deprecations:r=[],inject:n={}}=t,o={normalizedInjections:tN(n),parsedDeprecations:iN(r)};e&&(o.propValidators=GF(e)),t.instance=o;let c={};e&&(c=Object.entries(e).reduce((d,[a,y])=>{const S=y==null?void 0:y.value;return S&&(d[a]=S),d},{})),t.defaultUniforms={...t.defaultUniforms,...c}}function XI(t,e,r){var n;(n=t.deprecations)==null||n.forEach(o=>{var c;(c=o.regex)!=null&&c.test(e)&&(o.deprecated?r.deprecated(o.old,o.new)():r.removed(o.old,o.new)())})}function iN(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function F1(t){T_(t);const e={},r={};ZI({modules:t,level:0,moduleMap:e,moduleDepth:r});const n=Object.keys(r).sort((o,c)=>r[c]-r[o]).map(o=>e[o]);return T_(n),n}function ZI(t){const{modules:e,level:r,moduleMap:n,moduleDepth:o}=t;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(const c of e)n[c.name]=c,(o[c.name]===void 0||o[c.name]<r)&&(o[c.name]=r);for(const c of e)c.dependencies&&ZI({modules:c.dependencies,level:r+1,moduleMap:n,moduleDepth:o})}function sN(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function oN(t,e){var n;if(Number(((n=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:n[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=SS(t,aN),t;case"fragment":return t=SS(t,lN),t;default:throw new Error(e)}}const qI=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],aN=[...qI,[Yx("attribute"),"in $1"],[Yx("varying"),"out $1"]],lN=[...qI,[Yx("varying"),"in $1"]];function SS(t,e){for(const[r,n]of e)t=t.replace(r,n);return t}function Yx(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function YI(t,e){let r="";for(const n in t){const o=t[n];if(r+=`void ${o.signature} {
`,o.header&&(r+=`  ${o.header}`),e[n]){const c=e[n];c.sort((d,a)=>d.order-a.order);for(const d of c)r+=`  ${d.injection}
`}o.footer&&(r+=`  ${o.footer}`),r+=`}
`}return r}function GI(t){const e={vertex:{},fragment:{}};for(const r of t){let n,o;typeof r!="string"?(n=r,o=n.hook):(n={},o=r),o=o.trim();const[c,d]=o.split(":"),a=o.replace(/\(.+/,""),y=Object.assign(n,{signature:d});switch(c){case"vs":e.vertex[a]=y;break;case"fs":e.fragment[a]=y;break;default:throw new Error(c)}}return e}function cN(t,e){return{name:uN(t,e),language:"glsl",version:hN(t)}}function uN(t,e="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return n?n[1]:e}function hN(t){let e=100;const r=t.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){const n=parseInt(r[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const KI=`

${Lm}
`,dN=`precision highp float;
`;function fN(t){const e=F1(t.modules||[]);return{source:gN(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:QI(e)}}function pN(t){const{vs:e,fs:r}=t,n=F1(t.modules||[]);return{vs:ES(t.platformInfo,{...t,source:e,stage:"vertex",modules:n}),fs:ES(t.platformInfo,{...t,source:r,stage:"fragment",modules:n}),getUniforms:QI(n)}}function gN(t,e){var re;const{source:r,stage:n,modules:o,hookFunctions:c=[],inject:d={},log:a}=e;O1(typeof r=="string","shader source must be a string");const y=r;let S="";const E=GI(c),M={},F={},N={};for(const me in d){const Y=typeof d[me]=="string"?{injection:d[me],order:0}:d[me],q=/^(v|f)s:(#)?([\w-]+)$/.exec(me);if(q){const Z=q[2],le=q[3];Z?le==="decl"?F[me]=[Y]:N[me]=[Y]:M[me]=[Y]}else N[me]=[Y]}const G=o;for(const me of G){a&&XI(me,y,a);const Y=JI(me,"wgsl");S+=Y;const q=((re=me.injections)==null?void 0:re[n])||{};for(const Z in q){const le=/^(v|f)s:#([\w-]+)$/.exec(Z);if(le){const we=le[2]==="decl"?F:N;we[Z]=we[Z]||[],we[Z].push(q[Z])}else M[Z]=M[Z]||[],M[Z].push(q[Z])}}return S+=KI,S=w_(S,n,F),S+=YI(E[n],M),S+=y,S=w_(S,n,N),S}function ES(t,e){var je;const{id:r,source:n,stage:o,language:c="glsl",modules:d,defines:a={},hookFunctions:y=[],inject:S={},prologue:E=!0,log:M}=e;O1(typeof n=="string","shader source must be a string");const F=c==="glsl"?cN(n).version:-1,N=t.shaderLanguageVersion,G=F===100?"#version 100":"#version 300 es",me=n.split(`
`).slice(1).join(`
`),Y={};d.forEach(Ue=>{Object.assign(Y,Ue.defines)}),Object.assign(Y,a);let q="";switch(c){case"wgsl":break;case"glsl":q=E?`${G}

// ----- PROLOGUE -------------------------
${mN({id:r,source:n,stage:o})}
${`#define SHADER_TYPE_${o.toUpperCase()}`}

${sN(t)}
${o==="fragment"?dN:""}

// ----- APPLICATION DEFINES -------------------------

${_N(Y)}

`:`${G}
`;break}const Z=GI(y),le={},Ae={},we={};for(const Ue in S){const Ze=typeof S[Ue]=="string"?{injection:S[Ue],order:0}:S[Ue],qe=/^(v|f)s:(#)?([\w-]+)$/.exec(Ue);if(qe){const Ke=qe[2],ht=qe[3];Ke?ht==="decl"?Ae[Ue]=[Ze]:we[Ue]=[Ze]:le[Ue]=[Ze]}else we[Ue]=[Ze]}for(const Ue of d){M&&XI(Ue,me,M);const Ze=JI(Ue,o);q+=Ze;const qe=((je=Ue.instance)==null?void 0:je.normalizedInjections[o])||{};for(const Ke in qe){const ht=/^(v|f)s:#([\w-]+)$/.exec(Ke);if(ht){const xt=ht[2]==="decl"?Ae:we;xt[Ke]=xt[Ke]||[],xt[Ke].push(qe[Ke])}else le[Ke]=le[Ke]||[],le[Ke].push(qe[Ke])}}return q+="// ----- MAIN SHADER SOURCE -------------------------",q+=KI,q=w_(q,o,Ae),q+=YI(Z[o],le),q+=me,q=w_(q,o,we),c==="glsl"&&F!==N&&(q=oN(q,o)),q.trim()}function QI(t){return function(r){var o;const n={};for(const c of t){const d=(o=c.getUniforms)==null?void 0:o.call(c,r,n);Object.assign(n,d)}return n}}function mN(t){const{id:e,source:r,stage:n}=t;return e&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${n}`:""}function _N(t={}){let e="";for(const r in t){const n=t[r];(n||Number.isFinite(n))&&(e+=`#define ${r.toUpperCase()} ${t[r]}
`)}return e}function JI(t,e){let r;switch(e){case"vertex":r=t.vs||"";break;case"fragment":r=t.fs||"";break;case"wgsl":r=t.source||"";break;default:O1(!1)}if(!t.name)throw new Error("Shader module must have a name");const n=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let o=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(o+=`#define MODULE_${n}
`),o+=`${r}
`,o}const yN=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,vN=/^\s*\#\s*endif\s*$/;function xN(t,e){var d;const r=t.split(`
`),n=[];let o=!0,c=null;for(const a of r){const y=a.match(yN),S=a.match(vN);y?(c=y[1],o=!!((d=e==null?void 0:e.defines)!=null&&d[c])):S?o=!0:o&&n.push(a)}return n.join(`
`)}const Fc=class Fc{constructor(){Q(this,"_hookFunctions",[]);Q(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Fc.defaultShaderAssembler=Fc.defaultShaderAssembler||new Fc,Fc.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(r=>r.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const r=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==r)}addShaderHook(e,r){r&&(e=Object.assign(r,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const r=this._getModuleList(e.modules),n=this._hookFunctions,{source:o,getUniforms:c}=fN({...e,source:e.source,modules:r,hookFunctions:n});return{source:e.platformInfo.shaderLanguage==="wgsl"?xN(o):o,getUniforms:c,modules:r}}assembleGLSLShaderPair(e){const r=this._getModuleList(e.modules),n=this._hookFunctions;return{...pN({...e,vs:e.vs,fs:e.fs,modules:r,hookFunctions:n}),modules:r}}_getModuleList(e=[]){const r=new Array(this._defaultModules.length+e.length),n={};let o=0;for(let c=0,d=this._defaultModules.length;c<d;++c){const a=this._defaultModules[c],y=a.name;r[o++]=a,n[y]=!0}for(let c=0,d=e.length;c<d;++c){const a=e[c],y=a.name;n[y]||(r[o++]=a,n[y]=!0)}return r.length=o,T_(r),r}};Q(Fc,"defaultShaderAssembler");let S_=Fc;const bN=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,wN=`#version 300 es
${bN}`;function TN(t){const{input:e,inputChannels:r,output:n}={};if(!e)return wN;if(!r)throw new Error("inputChannels");const o=SN(r),c=EN(e,r);return`#version 300 es
in ${o} ${e};
out vec4 ${n};
void main() {
  ${n} = ${c};
}`}function SN(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function EN(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class AN{constructor(){Q(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new wy({id:e})),this.stats.get(e)}}const eP=new AN,lt=new Op({id:"luma.gl"}),_0={};function Sy(t="id"){_0[t]=_0[t]||1;const e=_0[t]++;return`${t}-${e}`}var Y0;let Kr=(Y0=class{constructor(e,r,n){Q(this,"id");Q(this,"props");Q(this,"userData",{});Q(this,"_device");Q(this,"destroyed",!1);Q(this,"allocatedBytes",0);Q(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=IN(r,n);const o=this.props.id!=="undefined"?this.props.id:Sy(this[Symbol.toStringTag]);this.props.id=o,this.id=o,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get(`${r}s Active`).decrementCount()}trackAllocatedMemory(e,r=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${r} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").subtractCount(this.allocatedBytes),r.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${r}s Created`).incrementCount(),e.get(`${r}s Active`).incrementCount()}},Q(Y0,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Y0);function IN(t,e){const r={...e};for(const n in t)t[n]!==void 0&&(r[n]=t[n]);return r}const bi=class bi extends Kr{constructor(r,n){const o={...n};(n.usage||0)&bi.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?o.indexType="uint32":n.data instanceof Uint16Array&&(o.indexType="uint16")),delete o.data;super(r,o,bi.defaultProps);Q(this,"usage");Q(this,"indexType");Q(this,"updateTimestamp");Q(this,"debugData",new ArrayBuffer(0));this.usage=o.usage||0,this.indexType=o.indexType,this.updateTimestamp=r.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(r){return this.device.createBuffer({...this.props,...r})}readSyncWebGL(r,n){throw new Error("not implemented")}_setDebugData(r,n,o){const c=ArrayBuffer.isView(r)?r.buffer:r,d=Math.min(r?r.byteLength:o,bi.DEBUG_DATA_MAX_LENGTH);c===null?this.debugData=new ArrayBuffer(d):n===0&&o===c.byteLength?this.debugData=c.slice(0,d):this.debugData=c.slice(n,n+d)}};Q(bi,"defaultProps",{...Kr.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),Q(bi,"MAP_READ",1),Q(bi,"MAP_WRITE",2),Q(bi,"COPY_SRC",4),Q(bi,"COPY_DST",8),Q(bi,"INDEX",16),Q(bi,"VERTEX",32),Q(bi,"UNIFORM",64),Q(bi,"STORAGE",128),Q(bi,"INDIRECT",256),Q(bi,"QUERY_RESOLVE",512),Q(bi,"DEBUG_DATA_MAX_LENGTH",32);let gn=bi;function tP(t){const e=AS[t],r=PN(e),n=t.includes("norm"),o=!n&&!t.startsWith("float"),c=t.startsWith("s");return{dataType:AS[t],byteLength:r,integer:o,signed:c,normalized:n}}function PN(t){return CN[t]}const AS={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},CN={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Fi="texture-compression-bc",Yr="texture-compression-astc",Wo="texture-compression-etc2",MN="texture-compression-etc1-webgl",cm="texture-compression-pvrtc-webgl",y0="texture-compression-atc-webgl",um="float32-renderable-webgl",v0="float16-renderable-webgl",RN="rgb9e5ufloat-renderable-webgl",x0="snorm8-renderable-webgl",wf="norm16-renderable-webgl",b0="snorm16-renderable-webgl",hm="float32-filterable",IS="float16-filterable-webgl";function rP(t){const e=kN[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const kN={r8unorm:{},r8snorm:{render:x0},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:x0},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:v0,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:wf},"r16snorm-webgl":{f:b0},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:x0},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:v0,filter:IS},"rg16unorm-webgl":{render:wf},"rg16snorm-webgl":{render:b0},r32uint:{},r32sint:{},r32float:{render:um,filter:hm},rgb9e5ufloat:{channels:"rgb",packed:!0,render:RN},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:um},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:wf},"rgb16snorm-webgl":{f:wf},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:hm},rgba16uint:{},rgba16sint:{},rgba16float:{render:v0,filter:IS},"rgba16unorm-webgl":{render:wf},"rgba16snorm-webgl":{render:b0},"rgb32float-webgl":{render:um,filter:hm},rgba32uint:{},rgba32sint:{},rgba32float:{render:um,filter:hm},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Fi},"bc1-rgb-unorm-srgb-webgl":{f:Fi},"bc1-rgba-unorm":{f:Fi},"bc1-rgba-unorm-srgb":{f:Fi},"bc2-rgba-unorm":{f:Fi},"bc2-rgba-unorm-srgb":{f:Fi},"bc3-rgba-unorm":{f:Fi},"bc3-rgba-unorm-srgb":{f:Fi},"bc4-r-unorm":{f:Fi},"bc4-r-snorm":{f:Fi},"bc5-rg-unorm":{f:Fi},"bc5-rg-snorm":{f:Fi},"bc6h-rgb-ufloat":{f:Fi},"bc6h-rgb-float":{f:Fi},"bc7-rgba-unorm":{f:Fi},"bc7-rgba-unorm-srgb":{f:Fi},"etc2-rgb8unorm":{f:Wo},"etc2-rgb8unorm-srgb":{f:Wo},"etc2-rgb8a1unorm":{f:Wo},"etc2-rgb8a1unorm-srgb":{f:Wo},"etc2-rgba8unorm":{f:Wo},"etc2-rgba8unorm-srgb":{f:Wo},"eac-r11unorm":{f:Wo},"eac-r11snorm":{f:Wo},"eac-rg11unorm":{f:Wo},"eac-rg11snorm":{f:Wo},"astc-4x4-unorm":{f:Yr},"astc-4x4-unorm-srgb":{f:Yr},"astc-5x4-unorm":{f:Yr},"astc-5x4-unorm-srgb":{f:Yr},"astc-5x5-unorm":{f:Yr},"astc-5x5-unorm-srgb":{f:Yr},"astc-6x5-unorm":{f:Yr},"astc-6x5-unorm-srgb":{f:Yr},"astc-6x6-unorm":{f:Yr},"astc-6x6-unorm-srgb":{f:Yr},"astc-8x5-unorm":{f:Yr},"astc-8x5-unorm-srgb":{f:Yr},"astc-8x6-unorm":{f:Yr},"astc-8x6-unorm-srgb":{f:Yr},"astc-8x8-unorm":{f:Yr},"astc-8x8-unorm-srgb":{f:Yr},"astc-10x5-unorm":{f:Yr},"astc-10x5-unorm-srgb":{f:Yr},"astc-10x6-unorm":{f:Yr},"astc-10x6-unorm-srgb":{f:Yr},"astc-10x8-unorm":{f:Yr},"astc-10x8-unorm-srgb":{f:Yr},"astc-10x10-unorm":{f:Yr},"astc-10x10-unorm-srgb":{f:Yr},"astc-12x10-unorm":{f:Yr},"astc-12x10-unorm-srgb":{f:Yr},"astc-12x12-unorm":{f:Yr},"astc-12x12-unorm-srgb":{f:Yr},"pvrtc-rgb4unorm-webgl":{f:cm},"pvrtc-rgba4unorm-webgl":{f:cm},"pvrtc-rbg2unorm-webgl":{f:cm},"pvrtc-rgba2unorm-webgl":{f:cm},"etc1-rbg-unorm-webgl":{f:MN},"atc-rgb-unorm-webgl":{f:y0},"atc-rgba-unorm-webgl":{f:y0},"atc-rgbai-unorm-webgl":{f:y0}},DN=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],ON=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function nP(t){return DN.some(e=>t.startsWith(e))}function N1(t){let e=FN(t);if(nP(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const n=NN(t);n&&(e.blockWidth=n.blockWidth,e.blockHeight=n.blockHeight)}const r=ON.exec(t);if(r){const[,n,o,c,d,a]=r,y=`${c}${o}`,S=tP(y),E=S.byteLength*8,M=n.length,F=[E,M>=2?E:0,M>=3?E:0,M>=4?E:0];e={format:t,attachment:e.attachment,dataType:S.dataType,components:M,channels:n,integer:S.integer,signed:S.signed,normalized:S.normalized,bitsPerChannel:F,bytesPerPixel:S.byteLength*n.length,packed:e.packed,srgb:e.srgb},a==="-webgl"&&(e.webgl=!0),d==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function FN(t){var c;const e=rP(t),r=e.bytesPerPixel||1,n=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((c=e.channels)==null?void 0:c.length)||1,bytesPerPixel:r,bitsPerChannel:n,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function NN(t){const r=/.*-(\d+)x(\d+)-.*/.exec(t);if(r){const[,n,o]=r;return{blockWidth:Number(n),blockHeight:Number(o)}}return null}function LN(t){const e=rP(t),r={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},n=N1(t),o=t.startsWith("depth")||t.startsWith("stencil"),c=n==null?void 0:n.signed,d=n==null?void 0:n.integer,a=n==null?void 0:n.webgl;return r.render&&(r.render=!c),r.filter&&(r.filter=!o&&!c&&!d&&!a),r}class zN{}class BN{constructor(e=[],r){Q(this,"features");Q(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(e){var r;return!((r=this.disabledFeatures)!=null&&r[e])&&this.features.has(e)}}const H_=class H_{constructor(e){Q(this,"id");Q(this,"props");Q(this,"userData",{});Q(this,"statsManager",eP);Q(this,"timestamp",0);Q(this,"_reused",!1);Q(this,"_lumaData",{});this.props={...H_.defaultProps,...e},this.id=this.props.id||Sy(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const r=LN(e),n=d=>(typeof d=="string"?this.features.has(d):d)??!0,o=n(r.create),c={format:e,create:o,render:o&&n(r.render),filter:o&&n(r.filter),blend:o&&n(r.blend),store:o&&n(r.store)};return this._getDeviceSpecificTextureFormatCapabilities(c)}isTextureFormatSupported(e,r){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return nP(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,r){throw new Error("not implemented")}readPixelsToBufferWebGL(e,r){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,r){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const r={...e};return(e.usage||0)&gn.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?r.indexType="uint32":e.data instanceof Uint16Array?r.indexType="uint16":lt.warn("indices buffer content must be of integer type")()),r}};Q(H_,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>lt.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:lt.get("debug")||void 0,debugShaders:lt.get("debug-shaders")||void 0,debugFramebuffers:!!lt.get("debug-framebuffers"),debugWebGL:!!lt.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let Ul=H_;const UN=ou()&&typeof document<"u",VN=()=>UN&&document.readyState==="complete",jN="set luma.log.level=1 (or higher) to trace rendering",PS="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Sl=class Sl{constructor(){Q(this,"stats",eP);Q(this,"log",lt);Q(this,"VERSION","9.1.9");Q(this,"spector");Q(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw lt.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),lt.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");lt.error("This version of luma.gl has already been initialized")()}lt.log(1,`${this.VERSION} - ${jN}`)(),globalThis.luma=this}registerAdapters(e){for(const r of e)this.preregisteredAdapters.set(r.type,r)}getSupportedAdapters(e=[]){const r=this.getAdapterMap(e);return Array.from(r).map(([,n])=>n).filter(n=>{var o;return(o=n.isSupported)==null?void 0:o.call(n)}).map(n=>n.type)}getBestAvailableAdapter(e=[]){var n,o,c,d;const r=this.getAdapterMap(e);return(o=(n=r.get("webgpu"))==null?void 0:n.isSupported)!=null&&o.call(n)?"webgpu":(d=(c=r.get("webgl"))==null?void 0:c.isSupported)!=null&&d.call(c)?"webgl":null}setDefaultDeviceProps(e){Object.assign(Sl.defaultProps,e)}async createDevice(e={}){var a;e={...Sl.defaultProps,...e},e.waitForPageLoad&&await Sl.pageLoaded;const r=this.getAdapterMap(e.adapters);let n=e.type||"";n==="best-available"&&(n=this.getBestAvailableAdapter(e.adapters)||n);const c=(this.getAdapterMap(e.adapters)||r).get(n),d=await((a=c==null?void 0:c.create)==null?void 0:a.call(c,e));if(d)return d;throw new Error(PS)}async attachDevice(e){var d;const r=this.getAdapterMap(e.adapters);let n="";e.handle instanceof WebGL2RenderingContext&&(n="webgl"),e.createCanvasContext&&await Sl.pageLoaded,e.handle===null&&(n="unknown");const o=r.get(n),c=await((d=o==null?void 0:o.attach)==null?void 0:d.call(o,null));if(c)return c;throw new Error(PS)}enforceWebGL2(e=!0,r=[]){var c;const o=this.getAdapterMap(r).get("webgl");o||lt.warn("enforceWebGL2: webgl adapter not found")(),(c=o==null?void 0:o.enforceWebGL2)==null||c.call(o,e)}getAdapterMap(e=[]){const r=new Map(this.preregisteredAdapters);for(const n of e)r.set(n.type,n);return r}registerDevices(e){lt.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const r of e){const n=r.adapter;n&&this.preregisteredAdapters.set(n.type,n)}}};Q(Sl,"defaultProps",{...Ul.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),Q(Sl,"pageLoaded",$N().then(()=>{lt.probe(2,"DOM is loaded")()}));let Gx=Sl;const Kx=new Gx;function $N(){return VN()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class WN{}const X_=class X_{constructor(e){Q(this,"id");Q(this,"props");Q(this,"canvas");Q(this,"htmlCanvas");Q(this,"offscreenCanvas");Q(this,"type");Q(this,"width",1);Q(this,"height",1);Q(this,"resizeObserver");Q(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...X_.defaultProps,...e},e=this.props,!ou()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=XN(e.canvas):this.canvas=e.canvas;else{const r=ZN(e),n=HN((e==null?void 0:e.container)||null);n.insertBefore(r,n.firstChild),this.canvas=r,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(r=>{for(const n of r)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),r=this.canvas;return r.parentElement?[r.clientWidth*e,r.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,r]=this.getPixelSize();return e/r}cssToDeviceRatio(){var e;try{const[r]=this.getDrawingBufferSize(),n=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return n?r/n:1}catch{return 1}}cssToDevicePixels(e,r=!0){const n=this.cssToDeviceRatio(),[o,c]=this.getDrawingBufferSize();return qN(e,n,o,c,r)}setDevicePixelRatio(e,r={}){if(!this.htmlCanvas)return;let n="width"in r?r.width:this.htmlCanvas.clientWidth,o="height"in r?r.height:this.htmlCanvas.clientHeight;(!n||!o)&&(lt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,o=this.htmlCanvas.height||1);const c=this._canvasSizeInfo;if(c.clientWidth!==n||c.clientHeight!==o||c.devicePixelRatio!==e){let d=e;const a=Math.floor(n*d),y=Math.floor(o*d);if(this.htmlCanvas.width=a,this.htmlCanvas.height=y,this.device.gl){const[E,M]=this.getDrawingBufferSize();(E!==a||M!==y)&&(d=Math.min(E/n,M/o),this.htmlCanvas.width=Math.floor(n*d),this.htmlCanvas.height=Math.floor(o*d),lt.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=o,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var r;((r=this.htmlCanvas)==null?void 0:r.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};Q(X_,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let Qx=X_;function HN(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function XN(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function ZN(t){const{width:e,height:r}=t,n=document.createElement("canvas");return n.id=Sy("lumagl-auto-created-canvas"),n.width=e||1,n.height=r||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(r)?`${r}px`:"100%",n}function qN(t,e,r,n,o){const c=t,d=CS(c[0],e,r);let a=MS(c[1],e,n,o),y=CS(c[0]+1,e,r);const S=y===r-1?y:y-1;y=MS(c[1]+1,e,n,o);let E;return o?(y=y===0?y:y+1,E=a,a=y):E=y===n-1?y:y-1,{x:d,y:a,width:Math.max(S-d+1,1),height:Math.max(E-a+1,1)}}function CS(t,e,r){return Math.min(Math.round(t*e),r-1)}function MS(t,e,r,n){return n?Math.max(0,r-1-Math.round(t*e)):Math.min(Math.round(t*e),r-1)}const wi=class wi extends Kr{constructor(r,n){n=wi.normalizeProps(r,n);super(r,n,wi.defaultProps);Q(this,"dimension");Q(this,"format");Q(this,"width");Q(this,"height");Q(this,"depth");Q(this,"mipLevels");Q(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const o=wi.getTextureDataSize(this.props.data);this.width=(o==null?void 0:o.width)||1,this.height=(o==null?void 0:o.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?wi.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=r.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(r){return this.device.createTexture({...this.props,...r})}static isExternalImage(r){return typeof ImageData<"u"&&r instanceof ImageData||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement||typeof VideoFrame<"u"&&r instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas}static getExternalImageSize(r){if(typeof ImageData<"u"&&r instanceof ImageData||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas)return{width:r.width,height:r.height};if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)return{width:r.naturalWidth,height:r.naturalHeight};if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)return{width:r.videoWidth,height:r.videoHeight};if(typeof VideoFrame<"u"&&r instanceof VideoFrame)return{width:r.displayWidth,height:r.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(r){const n=r==null?void 0:r.data;return ArrayBuffer.isView(n)}static getTextureDataSize(r){if(!r||ArrayBuffer.isView(r))return null;if(Array.isArray(r))return wi.getTextureDataSize(r[0]);if(wi.isExternalImage(r))return wi.getExternalImageSize(r);if(r&&typeof r=="object"&&r.constructor===Object){const o=Object.values(r)[0];return{width:o.width,height:o.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(r,n){let o;return ArrayBuffer.isView(r)?o=[{data:r,width:n.width,height:n.height}]:Array.isArray(r)?o=r:o=[r],o}static getMipLevelCount(r,n){return Math.floor(Math.log2(Math.max(r,n)))+1}static getCubeFaceDepth(r){switch(r){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(r)}}static normalizeProps(r,n){var y,S;const o={...n},c=((S=(y=r==null?void 0:r.props)==null?void 0:y._resourceDefaults)==null?void 0:S.texture)||{};Object.assign(o,c);const{width:d,height:a}=o;return typeof d=="number"&&(o.width=Math.max(1,Math.ceil(d))),typeof a=="number"&&(o.height=Math.max(1,Math.ceil(a))),o}};Q(wi,"COPY_SRC",1),Q(wi,"COPY_DST",2),Q(wi,"TEXTURE",4),Q(wi,"STORAGE",8),Q(wi,"RENDER_ATTACHMENT",16),Q(wi,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),Q(wi,"defaultProps",{...Kr.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),Q(wi,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let vn=wi;const Z_=class Z_ extends Kr{get[Symbol.toStringTag](){return"TextureView"}constructor(e,r){super(e,r,Z_.defaultProps)}};Q(Z_,"defaultProps",{...Kr.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let E_=Z_;function YN(t,e,r){let n="";const o=e.split(/\r?\n/),c=t.slice().sort((d,a)=>d.lineNum-a.lineNum);switch((r==null?void 0:r.showSourceCode)||"no"){case"all":let d=0;for(let a=1;a<=o.length;a++)for(n+=iP(o[a-1],a,r);c.length>d&&c[d].lineNum===a;){const y=c[d++];n+=RS(y,o,y.lineNum,{...r,inlineSource:!1})}return n;case"issues":case"no":for(const a of t)n+=RS(a,o,a.lineNum,{inlineSource:(r==null?void 0:r.showSourceCode)!=="no"});return n}}function RS(t,e,r,n){if(n!=null&&n.inlineSource){const c=GN(e,r),d=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${c}${d}${t.type.toUpperCase()}: ${t.message}

`}const o=t.type==="error"?"red":"#8B4000";return n!=null&&n.html?`<div class='luma-compiler-log-error' style="color:${o};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function GN(t,e,r){let n="";for(let o=e-2;o<=e;o++){const c=t[o-1];c!==void 0&&(n+=iP(c,e,r))}return n}function iP(t,e,r){const n=r!=null&&r.html?QN(t):t;return`${KN(String(e),4)}: ${n}${r!=null&&r.html?"<br/>":`
`}`}function KN(t,e){let r="";for(let n=t.length;n<e;++n)r+=" ";return r+t}function QN(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const q_=class q_ extends Kr{constructor(r,n){n={...n,debugShaders:n.debugShaders||r.props.debugShaders||"errors"};super(r,{id:JN(n),...n},q_.defaultProps);Q(this,"stage");Q(this,"source");Q(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const r=this.props.debugShaders;switch(r){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const n=await this.getCompilationInfo();r==="warnings"&&(n==null?void 0:n.length)===0||this._displayShaderLog(n)}_displayShaderLog(r){var S;if(typeof document>"u"||!(document!=null&&document.createElement))return;const n=sP(this.source),o=`${this.stage} ${n}`;let c=YN(r,this.source,{showSourceCode:"all",html:!0});const d=this.getTranslatedSource();d&&(c+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${d}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${o}</h1><br /><br />
<code style="user-select:text;"><pre>
${c}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a),(S=document.getElementsByClassName("luma-compiler-log-error")[0])==null||S.scrollIntoView(),a.onclick=()=>{const E=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(E)}}};Q(q_,"defaultProps",{...Kr.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let A_=q_;function JN(t){return sP(t.source)||t.id||Sy(`unnamed ${t.stage}-shader`)}function sP(t,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return n?n[1]:e}const Qf=class Qf extends Kr{get[Symbol.toStringTag](){return"Sampler"}constructor(e,r){r=Qf.normalizeProps(e,r),super(e,r,Qf.defaultProps)}static normalizeProps(e,r){var c,d;const n=((d=(c=e==null?void 0:e.props)==null?void 0:c._resourceDefaults)==null?void 0:d.sampler)||{};return{...r,...n}}};Q(Qf,"defaultProps",{...Kr.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let I_=Qf;const Y_=class Y_ extends Kr{constructor(r,n={}){super(r,n,Y_.defaultProps);Q(this,"width");Q(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(r){const n=this.colorAttachments.map(c=>c.texture.clone(r)),o=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(r);return this.device.createFramebuffer({...this.props,colorAttachments:n,depthStencilAttachment:o})}resize(r){let n=!r;if(r){const[o,c]=Array.isArray(r)?r:[r.width,r.height];n=n||c!==this.height||o!==this.width,this.width=o,this.height=c}n&&(lt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((n,o)=>{if(typeof n=="string"){const c=this.createColorTexture(n,o);return this.attachResource(c),c.view}return n instanceof vn?n.view:n});const r=this.props.depthStencilAttachment;if(r)if(typeof r=="string"){const n=this.createDepthStencilTexture(r);this.attachResource(n),this.depthStencilAttachment=n.view}else r instanceof vn?this.depthStencilAttachment=r.view:this.depthStencilAttachment=r}createColorTexture(r,n){return this.device.createTexture({id:`${this.id}-color-attachment-${n}`,usage:vn.RENDER_ATTACHMENT,format:r,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(r){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:vn.RENDER_ATTACHMENT,format:r,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(r,n){for(let o=0;o<this.colorAttachments.length;++o)if(this.colorAttachments[o]){const c=this.colorAttachments[o].texture.clone({width:r,height:n});this.destroyAttachedResource(this.colorAttachments[o]),this.colorAttachments[o]=c.view,this.attachResource(c.view)}if(this.depthStencilAttachment){const o=this.depthStencilAttachment.texture.clone({width:r,height:n});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=o.view,this.attachResource(o)}this.updateAttachments()}};Q(Y_,"defaultProps",{...Kr.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let P_=Y_;const G_=class G_ extends Kr{constructor(r,n){super(r,n,G_.defaultProps);Q(this,"shaderLayout");Q(this,"bufferLayout");Q(this,"linkStatus","pending");Q(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(r){throw new Error("Use uniform blocks")}};Q(G_,"defaultProps",{...Kr.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Gh=G_;const vo=class vo extends Kr{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,r){r=vo.normalizeProps(e,r),super(e,r,vo.defaultProps)}static normalizeProps(e,r){var c;return{...(c=e.props._resourceDefaults)==null?void 0:c.renderPass,...r}}};Q(vo,"defaultClearColor",[0,0,0,1]),Q(vo,"defaultClearDepth",1),Q(vo,"defaultClearStencil",0),Q(vo,"defaultProps",{...Kr.defaultProps,framebuffer:null,parameters:void 0,clearColor:vo.defaultClearColor,clearColors:void 0,clearDepth:vo.defaultClearDepth,clearStencil:vo.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Jx=vo;const K_=class K_ extends Kr{constructor(r,n){super(r,n,K_.defaultProps);Q(this,"hash","");Q(this,"shaderLayout");this.shaderLayout=n.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};Q(K_,"defaultProps",{...Kr.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let C_=K_;const Q_=class Q_ extends Kr{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,r){super(e,r,Q_.defaultProps)}};Q(Q_,"defaultProps",{...Kr.defaultProps,measureExecutionTime:void 0});let eb=Q_;const J_=class J_ extends Kr{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,r){super(e,r,J_.defaultProps)}};Q(J_,"defaultProps",{...Kr.defaultProps});let tb=J_;function eL(t){const[e,r]=rL[t],n=e==="i32"||e==="u32",o=e!=="u32",c=nL[e]*r,d=tL(e,r);return{dataType:e,components:r,defaultVertexFormat:d,byteLength:c,integer:n,signed:o}}function tL(t,e){let r;switch(t){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?r:`${r}x${e}`}const rL={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},nL={f32:4,f16:2,i32:4,u32:4};function oP(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[r,n]=t.split("x"),o=r,c=n?parseInt(n):1,d=tP(o),a={type:o,components:c,byteLength:d.byteLength*c,integer:d.integer,signed:d.signed,normalized:d.normalized};return e&&(a.webglOnly=!0),a}function aP(t,e){const r={};for(const n of t.attributes){const o=sL(t,e,n.name);o&&(r[n.name]=o)}return r}function iL(t,e,r=16){const n=aP(t,e),o=new Array(r).fill(null);for(const c of Object.values(n))o[c.location]=c;return o}function sL(t,e,r){const n=oL(t,r),o=aL(e,r);if(!n)return null;const c=eL(n.type),d=(o==null?void 0:o.vertexFormat)||c.defaultVertexFormat,a=oP(d);return{attributeName:(o==null?void 0:o.attributeName)||n.name,bufferName:(o==null?void 0:o.bufferName)||n.name,location:n.location,shaderType:n.type,shaderDataType:c.dataType,shaderComponents:c.components,vertexFormat:d,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:c.integer,stepMode:(o==null?void 0:o.stepMode)||n.stepMode||"vertex",byteOffset:(o==null?void 0:o.byteOffset)||0,byteStride:(o==null?void 0:o.byteStride)||0}}function oL(t,e){const r=t.attributes.find(n=>n.name===e);return r||lt.warn(`shader layout attribute "${e}" not present in shader`),r||null}function aL(t,e){lL(t);let r=cL(t,e);return r||(r=uL(t,e),r)?r:(lt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function lL(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&lt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function cL(t,e){for(const r of t)if(r.format&&r.name===e)return{attributeName:r.name,bufferName:e,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function uL(t,e){var r;for(const n of t){let o=n.byteStride;if(typeof n.byteStride!="number")for(const d of n.attributes||[]){const a=oP(d.format);o+=a.byteLength}const c=(r=n.attributes)==null?void 0:r.find(d=>d.attribute===e);if(c)return{attributeName:c.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:c.format,byteOffset:c.byteOffset,byteStride:o}}return null}const ey=class ey extends Kr{constructor(r,n){super(r,n,ey.defaultProps);Q(this,"maxVertexAttributes");Q(this,"attributeInfos");Q(this,"indexBuffer",null);Q(this,"attributes");this.maxVertexAttributes=r.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:o,bufferLayout:c}=n.renderPipeline||{};if(!o||!c)throw new Error("VertexArray");this.attributeInfos=iL(o,c,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(r,n){this.device.reportError(new Error("constant attributes not supported"))}};Q(ey,"defaultProps",{...Kr.defaultProps,renderPipeline:null});let rb=ey;const ty=class ty extends Kr{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,r){super(e,r,ty.defaultProps)}};Q(ty,"defaultProps",{...Kr.defaultProps,layout:void 0,buffers:{}});let nb=ty;const ry=class ry extends Kr{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,r){super(e,r,ry.defaultProps)}};Q(ry,"defaultProps",{...Kr.defaultProps,type:void 0,count:void 0});let ib=ry;const hL={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function dL(t){return hL[t]}function fL(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let dm;function lP(t){return(!dm||dm.byteLength<t)&&(dm=new ArrayBuffer(t)),dm}function pL(t,e){const r=lP(t.BYTES_PER_ELEMENT*e);return new t(r,0,e)}function gL(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function M_(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":gL(t)}const kS=1024;class mL{constructor(e){Q(this,"layout",{});Q(this,"byteLength");let r=0;for(const[o,c]of Object.entries(e)){const d=dL(c),{type:a,components:y}=d;r=fL(r,y);const S=r;r+=y,this.layout[o]={type:a,size:y,offset:S}}r+=(4-r%4)%4;const n=r*4;this.byteLength=Math.max(n,kS)}getData(e){const r=Math.max(this.byteLength,kS),n=lP(r),o={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[c,d]of Object.entries(e)){const a=this.layout[c];if(!a){lt.warn(`Supplied uniform value ${c} not present in uniform block layout`)();continue}const{type:y,size:S,offset:E}=a,M=o[y];if(S===1){if(typeof d!="number"&&typeof d!="boolean"){lt.warn(`Supplied value for single component uniform ${c} is not a number: ${d}`)();continue}M[E]=Number(d)}else{if(!M_(d)){lt.warn(`Supplied value for multi component / array uniform ${c} is not a numeric array: ${d}`)();continue}M.set(d,E)}}return new Uint8Array(n)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function _L(t,e,r=16){if(t!==e)return!1;const n=t,o=e;if(!M_(n))return!1;if(M_(o)&&n.length===o.length){for(let c=0;c<n.length;++c)if(o[c]!==n[c])return!1}return!0}function yL(t){return M_(t)?t.slice():t}class vL{constructor(e){Q(this,"name");Q(this,"uniforms",{});Q(this,"modifiedUniforms",{});Q(this,"modified",!0);Q(this,"bindingLayout",{});Q(this,"needsRedraw","initialized");var r;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const n=(r=e==null?void 0:e.shaderLayout.bindings)==null?void 0:r.find(c=>c.type==="uniform"&&c.name===(e==null?void 0:e.name));if(!n)throw new Error(e==null?void 0:e.name);const o=n;for(const c of o.uniforms||[])this.bindingLayout[c.name]=c}}setUniforms(e){for(const[r,n]of Object.entries(e))this._setUniform(r,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,r){_L(this.uniforms[e],r)||(this.uniforms[e]=yL(r),this.modifiedUniforms[e]=!0,this.modified=!0)}}class xL{constructor(e){Q(this,"uniformBlocks",new Map);Q(this,"uniformBufferLayouts",new Map);Q(this,"uniformBuffers",new Map);for(const[r,n]of Object.entries(e)){const o=r,c=new mL(n.uniformTypes||{});this.uniformBufferLayouts.set(o,c);const d=new vL({name:r});d.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(o,d)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var r;for(const[n,o]of Object.entries(e))(r=this.uniformBlocks.get(n))==null||r.setUniforms(o);this.updateUniformBuffers()}getUniformBufferByteLength(e){var r;return((r=this.uniformBufferLayouts.get(e))==null?void 0:r.byteLength)||0}getUniformBufferData(e){var n,o;const r=((n=this.uniformBlocks.get(e))==null?void 0:n.getAllUniforms())||{};return(o=this.uniformBufferLayouts.get(e))==null?void 0:o.getData(r)}createUniformBuffer(e,r,n){n&&this.setUniforms(n);const o=this.getUniformBufferByteLength(r),c=e.createBuffer({usage:gn.UNIFORM|gn.COPY_DST,byteLength:o}),d=this.getUniformBufferData(r);return c.write(d),c}getManagedUniformBuffer(e,r){if(!this.uniformBuffers.get(r)){const n=this.getUniformBufferByteLength(r),o=e.createBuffer({usage:gn.UNIFORM|gn.COPY_DST,byteLength:n});this.uniformBuffers.set(r,o)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let e=!1;for(const r of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(r);e||(e=n)}return e&&lt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var c;const r=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),o=!1;if(n&&(r!=null&&r.needsRedraw)){o||(o=r.needsRedraw);const d=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n==null||n.write(d);const a=(c=this.uniformBlocks.get(e))==null?void 0:c.getAllUniforms();lt.log(4,`Writing to uniform buffer ${String(e)}`,d,a)()}return o}}function cP(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function uP(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function bL(t,e,r){if(!e||e>4)throw new Error(`size ${e}`);const n=e;let o=cP(t);if(o==="uint8"&&r&&n===1)return"unorm8-webgl";if(o==="uint8"&&r&&n===3)return"unorm8x3-webgl";if(o==="uint8"||o==="sint8"){if(n===1||n===3)throw new Error(`size: ${e}`);return r&&(o=o.replace("int","norm")),`${o}x${n}`}if(o==="uint16"||o==="sint16"){if(n===1||n===3)throw new Error(`size: ${e}`);return r&&(o=o.replace("int","norm")),`${o}x${n}`}return n===1?o:`${o}x${n}`}class w0{constructor(e){Q(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(r=>r.name===e)||null}getAttributeNamesForBuffer(e){var r;return e.attributes?(r=e.attributes)==null?void 0:r.map(n=>n.attribute):[e.name]}mergeBufferLayouts(e,r){const n=[...e];for(const o of r){const c=n.findIndex(d=>d.name===o.name);c<0?n.push(o):n[c]=o}return n}getBufferIndex(e){const r=this.bufferLayouts.findIndex(n=>n.name===e);return r===-1&&lt.warn(`BufferLayout: Missing buffer for "${e}".`)(),r}}function wL(t,e){const r=Object.fromEntries(t.attributes.map(o=>[o.name,o.location])),n=e.slice();return n.sort((o,c)=>{const d=o.attributes?o.attributes.map(E=>E.attribute):[o.name],a=c.attributes?c.attributes.map(E=>E.attribute):[c.name],y=Math.min(...d.map(E=>r[E])),S=Math.min(...a.map(E=>r[E]));return y-S}),n}class Gs{constructor(e,r){this.name=e,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class DS{constructor(e,r,n){this.name=e,this.type=r,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Cl extends Gs{constructor(e,r){super(e,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Vl extends Gs{constructor(e,r){super(e,r),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class sb extends Gs{constructor(e,r,n){super(e,n),this.format=r}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class eu extends Gs{constructor(e,r,n,o){super(e,n),this.format=r,this.access=o}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var wl;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(wl||(wl={}));class fm{constructor(e,r,n,o,c,d,a){this.name=e,this.type=r,this.group=n,this.binding=o,this.attributes=c,this.resourceType=d,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class TL{constructor(e,r){this.name=e,this.type=r}}class SL{constructor(e,r,n,o){this.name=e,this.type=r,this.locationType=n,this.location=o,this.interpolation=null}}class OS{constructor(e,r,n,o){this.name=e,this.type=r,this.locationType=n,this.location=o}}class EL{constructor(e,r,n,o){this.name=e,this.type=r,this.attributes=n,this.id=o}}class AL{constructor(e,r,n){this.name=e,this.type=r,this.attributes=n}}class IL{constructor(e,r=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=r,this.attributes=n}}class PL{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function CL(t){var e=(32768&t)>>15,r=(31744&t)>>10,n=1023&t;return r==0?(e?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):r==31?n?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,r-15)*(1+n/Math.pow(2,10))}const hP=new Float32Array(1),ML=new Int32Array(hP.buffer),Ni=new Uint16Array(1);function RL(t){hP[0]=t;const e=ML[0],r=e>>31&1;let n=e>>23&255,o=8388607&e;if(n===255)return Ni[0]=r<<15|31744|(o!==0?512:0),Ni[0];if(n===0){if(o===0)return Ni[0]=r<<15,Ni[0];o|=8388608;let c=113;for(;!(8388608&o);)o<<=1,c--;return n=127-c,o&=8388607,n>0?(o=(o>>126-n)+(o>>127-n&1),Ni[0]=r<<15|n<<10|o>>13,Ni[0]):(Ni[0]=r<<15,Ni[0])}return n=n-127+15,n>=31?(Ni[0]=r<<15|31744,Ni[0]):n<=0?n<-10?(Ni[0]=r<<15,Ni[0]):(o=(8388608|o)>>1-n,Ni[0]=r<<15|o>>13,Ni[0]):(o>>=13,Ni[0]=r<<15|n<<10|o,Ni[0])}const L1=new Uint32Array(1),dP=new Float32Array(L1.buffer,0,1);function FS(t){const e=112+(t>>6&31)<<23|(63&t)<<17;return L1[0]=e,dP[0]}function kL(t,e,r,n,o,c,d,a,y){const S=n*(d>>=o)*(c>>=o)+r*d+e*a;switch(y){case"r8unorm":return[Ur(t,S,"8unorm",1)[0]];case"r8snorm":return[Ur(t,S,"8snorm",1)[0]];case"r8uint":return[Ur(t,S,"8uint",1)[0]];case"r8sint":return[Ur(t,S,"8sint",1)[0]];case"rg8unorm":{const E=Ur(t,S,"8unorm",2);return[E[0],E[1]]}case"rg8snorm":{const E=Ur(t,S,"8snorm",2);return[E[0],E[1]]}case"rg8uint":{const E=Ur(t,S,"8uint",2);return[E[0],E[1]]}case"rg8sint":{const E=Ur(t,S,"8sint",2);return[E[0],E[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const E=Ur(t,S,"8unorm",4);return[E[0],E[1],E[2],E[3]]}case"rgba8snorm":{const E=Ur(t,S,"8snorm",4);return[E[0],E[1],E[2],E[3]]}case"rgba8uint":{const E=Ur(t,S,"8uint",4);return[E[0],E[1],E[2],E[3]]}case"rgba8sint":{const E=Ur(t,S,"8sint",4);return[E[0],E[1],E[2],E[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const E=Ur(t,S,"8unorm",4);return[E[2],E[1],E[0],E[3]]}case"r16uint":return[Ur(t,S,"16uint",1)[0]];case"r16sint":return[Ur(t,S,"16sint",1)[0]];case"r16float":return[Ur(t,S,"16float",1)[0]];case"rg16uint":{const E=Ur(t,S,"16uint",2);return[E[0],E[1]]}case"rg16sint":{const E=Ur(t,S,"16sint",2);return[E[0],E[1]]}case"rg16float":{const E=Ur(t,S,"16float",2);return[E[0],E[1]]}case"rgba16uint":{const E=Ur(t,S,"16uint",4);return[E[0],E[1],E[2],E[3]]}case"rgba16sint":{const E=Ur(t,S,"16sint",4);return[E[0],E[1],E[2],E[3]]}case"rgba16float":{const E=Ur(t,S,"16float",4);return[E[0],E[1],E[2],E[3]]}case"r32uint":return[Ur(t,S,"32uint",1)[0]];case"r32sint":return[Ur(t,S,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Ur(t,S,"32float",1)[0]];case"rg32uint":{const E=Ur(t,S,"32uint",2);return[E[0],E[1]]}case"rg32sint":{const E=Ur(t,S,"32sint",2);return[E[0],E[1]]}case"rg32float":{const E=Ur(t,S,"32float",2);return[E[0],E[1]]}case"rgba32uint":{const E=Ur(t,S,"32uint",4);return[E[0],E[1],E[2],E[3]]}case"rgba32sint":{const E=Ur(t,S,"32sint",4);return[E[0],E[1],E[2],E[3]]}case"rgba32float":{const E=Ur(t,S,"32float",4);return[E[0],E[1],E[2],E[3]]}case"rg11b10ufloat":{const E=new Uint32Array(t.buffer,S,1)[0],M=(4192256&E)>>11,F=(4290772992&E)>>22;return[FS(2047&E),FS(M),function(N){const G=112+(N>>5&31)<<23|(31&N)<<18;return L1[0]=G,dP[0]}(F),1]}}return null}function Ur(t,e,r,n){const o=[0,0,0,0];for(let c=0;c<n;++c)switch(r){case"8unorm":o[c]=t[e]/255,e++;break;case"8snorm":o[c]=t[e]/255*2-1,e++;break;case"8uint":o[c]=t[e],e++;break;case"8sint":o[c]=t[e]-127,e++;break;case"16uint":o[c]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":o[c]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":o[c]=CL(t[e]|t[e+1]<<8),e+=2;break;case"32uint":case"32sint":o[c]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":o[c]=new Float32Array(t.buffer,e,1)[0],e+=4}return o}function $r(t,e,r,n,o){for(let c=0;c<n;++c)switch(r){case"8unorm":t[e]=255*o[c],e++;break;case"8snorm":t[e]=.5*(o[c]+1)*255,e++;break;case"8uint":t[e]=o[c],e++;break;case"8sint":t[e]=o[c]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=o[c],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=o[c],e+=2;break;case"16float":{const d=RL(o[c]);new Uint16Array(t.buffer,e,1)[0]=d,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=o[c],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=o[c],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=o[c],e+=4}return o}const T0={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class ro{constructor(){this.id=ro._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,r){if(e){r(R_.instance);for(const n of e)n instanceof Array?this.searchBlock(n,r):n.search(r);r(k_.instance)}}constEvaluate(e,r){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}ro._id=0;class R_ extends ro{}R_.instance=new R_;class k_ extends ro{}k_.instance=new k_;const fP=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class mn extends ro{constructor(){super()}}class _p extends mn{constructor(e,r,n,o,c,d){super(),this.calls=new Set,this.name=e,this.args=r,this.returnType=n,this.body=o,this.startLine=c,this.endLine=d}get astNodeType(){return"function"}search(e){if(this.attributes)for(const r of this.attributes)e(r);e(this);for(const r of this.args)e(r);this.searchBlock(this.body,e)}}class DL extends mn{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class pP extends mn{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class ob extends mn{constructor(e,r){super(),this.body=e,this.loopId=r}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class gP extends mn{constructor(e,r,n,o){super(),this.init=e,this.condition=r,this.increment=n,this.body=o}get astNodeType(){return"for"}search(e){var r,n,o;(r=this.init)===null||r===void 0||r.search(e),(n=this.condition)===null||n===void 0||n.search(e),(o=this.increment)===null||o===void 0||o.search(e),this.searchBlock(this.body,e)}}class Ma extends mn{constructor(e,r,n,o,c){super(),this.attributes=null,this.name=e,this.type=r,this.storage=n,this.access=o,this.value=c}get astNodeType(){return"var"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class z1 extends mn{constructor(e,r,n){super(),this.attributes=null,this.name=e,this.type=r,this.value=n}get astNodeType(){return"override"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class Zf extends mn{constructor(e,r,n,o,c){super(),this.attributes=null,this.name=e,this.type=r,this.storage=n,this.access=o,this.value=c}get astNodeType(){return"let"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class zm extends mn{constructor(e,r,n,o,c){super(),this.attributes=null,this.name=e,this.type=r,this.storage=n,this.access=o,this.value=c}get astNodeType(){return"const"}constEvaluate(e,r){return this.value.constEvaluate(e,r)}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}var Ph,Mf,Fe,Ce;(t=>{t.increment="++",t.decrement="--"})(Ph||(Ph={})),(t=>{t.parse=function(e){const r=e;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}})(Ph||(Ph={}));class mP extends mn{constructor(e,r){super(),this.operator=e,this.variable=r}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Mf||(Mf={})),(t=>{t.parse=function(e){const r=e;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}})(Mf||(Mf={}));class _P extends mn{constructor(e,r,n){super(),this.operator=e,this.variable=r,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class B1 extends mn{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"call"}isBuiltin(){return fP.has(this.name)}search(e){for(const r of this.args)r.search(e);e(this)}}class yP extends mn{constructor(e,r){super(),this.body=e,this.continuing=r}get astNodeType(){return"loop"}search(e){var r;this.searchBlock(this.body,e),(r=this.continuing)===null||r===void 0||r.search(e)}}class vP extends mn{constructor(e,r){super(),this.condition=e,this.cases=r}get astNodeType(){return"switch"}search(e){e(this);for(const r of this.cases)r.search(e)}}class xP extends mn{constructor(e,r,n,o){super(),this.condition=e,this.body=r,this.elseif=n,this.else=o}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class bP extends mn{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class OL extends mn{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class FL extends mn{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class wP extends mn{constructor(e,r){super(),this.severity=e,this.rule=r}get astNodeType(){return"diagnostic"}}class U1 extends mn{constructor(e,r){super(),this.name=e,this.type=r}get astNodeType(){return"alias"}}class NL extends mn{constructor(){super()}get astNodeType(){return"discard"}}class TP extends mn{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class SP extends mn{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Ge extends mn{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let r=e[0];if(r.name==="f32")return r;for(let n=1;n<e.length;++n){const o=Ge._priority.get(r.name);Ge._priority.get(e[n].name)<o&&(r=e[n])}return r.name==="x32"?Ge.i32:r}getTypeName(){return this.name}}Ge.x32=new Ge("x32"),Ge.f32=new Ge("f32"),Ge.i32=new Ge("i32"),Ge.u32=new Ge("u32"),Ge.f16=new Ge("f16"),Ge.bool=new Ge("bool"),Ge.void=new Ge("void"),Ge._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class NS extends Ge{constructor(e){super(e)}}class Pa extends Ge{constructor(e,r,n,o){super(e),this.members=r,this.startLine=n,this.endLine=o}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let r=0;r<this.members.length;r++)if(this.members[r].name==e)return r;return-1}search(e){for(const r of this.members)e(r)}}class Re extends Ge{constructor(e,r,n){super(e),this.format=r,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}Re.vec2f=new Re("vec2",Ge.f32,null),Re.vec3f=new Re("vec3",Ge.f32,null),Re.vec4f=new Re("vec4",Ge.f32,null),Re.vec2i=new Re("vec2",Ge.i32,null),Re.vec3i=new Re("vec3",Ge.i32,null),Re.vec4i=new Re("vec4",Ge.i32,null),Re.vec2u=new Re("vec2",Ge.u32,null),Re.vec3u=new Re("vec3",Ge.u32,null),Re.vec4u=new Re("vec4",Ge.u32,null),Re.vec2h=new Re("vec2",Ge.f16,null),Re.vec3h=new Re("vec3",Ge.f16,null),Re.vec4h=new Re("vec4",Ge.f16,null),Re.vec2b=new Re("vec2",Ge.bool,null),Re.vec3b=new Re("vec3",Ge.bool,null),Re.vec4b=new Re("vec4",Ge.bool,null),Re.mat2x2f=new Re("mat2x2",Ge.f32,null),Re.mat2x3f=new Re("mat2x3",Ge.f32,null),Re.mat2x4f=new Re("mat2x4",Ge.f32,null),Re.mat3x2f=new Re("mat3x2",Ge.f32,null),Re.mat3x3f=new Re("mat3x3",Ge.f32,null),Re.mat3x4f=new Re("mat3x4",Ge.f32,null),Re.mat4x2f=new Re("mat4x2",Ge.f32,null),Re.mat4x3f=new Re("mat4x3",Ge.f32,null),Re.mat4x4f=new Re("mat4x4",Ge.f32,null),Re.mat2x2h=new Re("mat2x2",Ge.f16,null),Re.mat2x3h=new Re("mat2x3",Ge.f16,null),Re.mat2x4h=new Re("mat2x4",Ge.f16,null),Re.mat3x2h=new Re("mat3x2",Ge.f16,null),Re.mat3x3h=new Re("mat3x3",Ge.f16,null),Re.mat3x4h=new Re("mat3x4",Ge.f16,null),Re.mat4x2h=new Re("mat4x2",Ge.f16,null),Re.mat4x3h=new Re("mat4x3",Ge.f16,null),Re.mat4x4h=new Re("mat4x4",Ge.f16,null),Re.mat2x2i=new Re("mat2x2",Ge.i32,null),Re.mat2x3i=new Re("mat2x3",Ge.i32,null),Re.mat2x4i=new Re("mat2x4",Ge.i32,null),Re.mat3x2i=new Re("mat3x2",Ge.i32,null),Re.mat3x3i=new Re("mat3x3",Ge.i32,null),Re.mat3x4i=new Re("mat3x4",Ge.i32,null),Re.mat4x2i=new Re("mat4x2",Ge.i32,null),Re.mat4x3i=new Re("mat4x3",Ge.i32,null),Re.mat4x4i=new Re("mat4x4",Ge.i32,null),Re.mat2x2u=new Re("mat2x2",Ge.u32,null),Re.mat2x3u=new Re("mat2x3",Ge.u32,null),Re.mat2x4u=new Re("mat2x4",Ge.u32,null),Re.mat3x2u=new Re("mat3x2",Ge.u32,null),Re.mat3x3u=new Re("mat3x3",Ge.u32,null),Re.mat3x4u=new Re("mat3x4",Ge.u32,null),Re.mat4x2u=new Re("mat4x2",Ge.u32,null),Re.mat4x3u=new Re("mat4x3",Ge.u32,null),Re.mat4x4u=new Re("mat4x4",Ge.u32,null);class Bm extends Ge{constructor(e,r,n,o){super(e),this.storage=r,this.type=n,this.access=o}get astNodeType(){return"pointer"}}class qf extends Ge{constructor(e,r,n,o){super(e),this.attributes=r,this.format=n,this.count=o}get astNodeType(){return"array"}get isArray(){return!0}}class Rf extends Ge{constructor(e,r,n){super(e),this.format=r,this.access=n}get astNodeType(){return"sampler"}}class Co extends ro{constructor(){super(),this.postfix=null}}class tu extends Co{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Zo extends Co{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const r of this.args)r.search(e)}constEvaluate(e,r){return r&&(r[0]=this.type),e.evalExpression(this,e.context)}}class V1 extends Co{constructor(e,r){super(),this.cachedReturnValue=null,this.name=e,this.args=r}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return fP.has(this.name)}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){for(const r of this.args)r.search(e);e(this)}}class Rs extends Co{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,r){return e.evalExpression(this,e.context)}}class EP extends Co{constructor(e,r){super(),this.name=e,this.initializer=r}get astNodeType(){return"constExpr"}constEvaluate(e,r){if(this.initializer){const n=e.evalExpression(this.initializer,e.context);return n!==null&&this.postfix?n.getSubData(e,this.postfix,e.context):n}return null}search(e){this.initializer.search(e)}}class Jn extends Co{constructor(e,r){super(),this.value=e,this.type=r}get astNodeType(){return"literalExpr"}constEvaluate(e,r){return r!==void 0&&(r[0]=this.type),this.value}get isScalar(){return this.value instanceof Pe}get isVector(){return this.value instanceof ce||this.value instanceof Xt}get scalarValue(){return this.value instanceof Pe?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof ce||this.value instanceof Xt?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class AP extends Co{constructor(e,r){super(),this.type=e,this.value=r}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Kh extends Co{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class IP extends Co{constructor(){super()}}class Xn extends IP{constructor(e,r){super(),this.operator=e,this.right=r}get astNodeType(){return"unaryOp"}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class yo extends IP{constructor(e,r,n){super(),this.operator=e,this.left=r,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,r){return e.name===r.name?e:e.name==="f32"||r.name==="f32"?Ge.f32:e.name==="u32"||r.name==="u32"?Ge.u32:Ge.i32}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class PP extends ro{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Um extends Co{constructor(){super()}get astNodeType(){return"default"}}class CP extends PP{constructor(e,r){super(r),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class MP extends PP{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class LS extends ro{constructor(e,r,n){super(),this.name=e,this.type=r,this.attributes=n}get astNodeType(){return"argument"}}class LL extends ro{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class zS extends ro{constructor(e,r,n){super(),this.name=e,this.type=r,this.attributes=n}get astNodeType(){return"member"}}class RP extends ro{constructor(e,r){super(),this.name=e,this.value=r}get astNodeType(){return"attribute"}}class to{constructor(e,r){this.parent=null,this.typeInfo=e,this.parent=r,this.id=to._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,r,n,o){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,r,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}to._id=0;class ab extends to{constructor(){super(new Gs("void",null),null)}toString(){return"void"}}ab.void=new ab;class dh extends to{constructor(e){super(new sb("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,r,n,o){this.reference.setDataValue(e,r,n,o)}getSubData(e,r,n){return r?this.reference.getSubData(e,r,n):this}toString(){return`&${this.reference.toString()}`}}class Pe extends to{constructor(e,r,n=null){super(r,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",r)}clone(){if(this.data instanceof Float32Array)return new Pe(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Pe(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Pe(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,r,n,o){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(r instanceof Pe))return void console.error("SetDataValue: Invalid value",r);let c=r.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?c=Math.floor(c):this.typeInfo.name==="bool"&&(c=c?1:0),this.data[0]=c}getSubData(e,r,n){return r?(console.error("getSubData: Scalar data does not support postfix",r),null):this}toString(){return`${this.value}`}}function zL(t,e,r){const n=e.length;return n===2?r==="f32"?new ce(new Float32Array(e),t.getTypeInfo("vec2f")):r==="i32"||r==="bool"?new ce(new Int32Array(e),t.getTypeInfo("vec2i")):r==="u32"?new ce(new Uint32Array(e),t.getTypeInfo("vec2u")):r==="f16"?new ce(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${r}`),null):n===3?r==="f32"?new ce(new Float32Array(e),t.getTypeInfo("vec3f")):r==="i32"||r==="bool"?new ce(new Int32Array(e),t.getTypeInfo("vec3i")):r==="u32"?new ce(new Uint32Array(e),t.getTypeInfo("vec3u")):r==="f16"?new ce(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${r}`),null):n===4?r==="f32"?new ce(new Float32Array(e),t.getTypeInfo("vec4f")):r==="i32"||r==="bool"?new ce(new Int32Array(e),t.getTypeInfo("vec4i")):r==="u32"?new ce(new Uint32Array(e),t.getTypeInfo("vec4u")):r==="f16"?new ce(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${r}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class ce extends to{constructor(e,r,n=null){if(super(r,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?this.data=new Float32Array(e):o==="vec2i"||o==="vec3i"||o==="vec4i"?this.data=new Int32Array(e):o==="vec2u"||o==="vec3u"||o==="vec4u"?this.data=new Uint32Array(e):o==="vec2h"||o==="vec3h"||o==="vec4h"?this.data=new Float32Array(e):o==="vec2b"||o==="vec3b"||o==="vec4b"?this.data=new Int32Array(e):o==="vec2"||o==="vec3"||o==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${o}`)}}clone(){if(this.data instanceof Float32Array)return new ce(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new ce(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new ce(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,r,n,o){n instanceof tu?console.error("TODO: Set vector postfix"):r instanceof ce?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(e,r,n){if(r===null)return this;let o=e.getTypeInfo("f32");if(this.typeInfo instanceof eu)o=this.typeInfo.format||o;else{const d=this.typeInfo.name;d==="vec2f"||d==="vec3f"||d==="vec4f"?o=e.getTypeInfo("f32"):d==="vec2i"||d==="vec3i"||d==="vec4i"?o=e.getTypeInfo("i32"):d==="vec2b"||d==="vec3b"||d==="vec4b"?o=e.getTypeInfo("bool"):d==="vec2u"||d==="vec3u"||d==="vec4u"?o=e.getTypeInfo("u32"):d==="vec2h"||d==="vec3h"||d==="vec4h"?o=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${d}`)}let c=this;for(;r!==null&&c!==null;){if(r instanceof Kh){const d=r.index;let a=-1;if(d instanceof Jn){if(!(d.value instanceof Pe))return console.error(`GetSubData: Invalid array index ${d.value}`),null;a=d.value.value}else{const y=e.evalExpression(d,n);if(!(y instanceof Pe))return console.error("GetSubData: Unknown index type",d),null;a=y.value}if(a<0||a>=c.data.length)return console.error("GetSubData: Index out of range",a),null;if(c.data instanceof Float32Array){const y=new Float32Array(c.data.buffer,c.data.byteOffset+4*a,1);return new Pe(y,o)}if(c.data instanceof Int32Array){const y=new Int32Array(c.data.buffer,c.data.byteOffset+4*a,1);return new Pe(y,o)}if(c.data instanceof Uint32Array){const y=new Uint32Array(c.data.buffer,c.data.byteOffset+4*a,1);return new Pe(y,o)}throw"GetSubData: Invalid data type"}if(!(r instanceof tu))return console.error("GetSubData: Unknown postfix",r),null;{const d=r.value.toLowerCase();if(d.length===1){let y=0;if(d==="x"||d==="r")y=0;else if(d==="y"||d==="g")y=1;else if(d==="z"||d==="b")y=2;else{if(d!=="w"&&d!=="a")return console.error(`GetSubData: Unknown member ${d}`),null;y=3}if(this.data instanceof Float32Array){let S=new Float32Array(this.data.buffer,this.data.byteOffset+4*y,1);return new Pe(S,o,this)}if(this.data instanceof Int32Array){let S=new Int32Array(this.data.buffer,this.data.byteOffset+4*y,1);return new Pe(S,o,this)}if(this.data instanceof Uint32Array){let S=new Uint32Array(this.data.buffer,this.data.byteOffset+4*y,1);return new Pe(S,o,this)}}const a=[];for(const y of d)y==="x"||y==="r"?a.push(this.data[0]):y==="y"||y==="g"?a.push(this.data[1]):y==="z"||y==="b"?a.push(this.data[2]):y==="w"||y==="a"?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${y}`);c=zL(e,a,o.name)}r=r.postfix}return c}toString(){let e=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)e+=`, ${this.data[r]}`;return e}}class Xt extends to{constructor(e,r,n=null){super(r,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Xt(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,r,n,o){n instanceof tu?console.error("TODO: Set matrix postfix"):r instanceof Xt?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(e,r,n){if(r===null)return this;const o=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof eu)this.typeInfo.format;else if(o.endsWith("f"))e.getTypeInfo("f32");else if(o.endsWith("i"))e.getTypeInfo("i32");else if(o.endsWith("u"))e.getTypeInfo("u32");else{if(!o.endsWith("h"))return console.error(`GetDataValue: Unknown type ${o}`),null;e.getTypeInfo("f16")}if(r instanceof Kh){const c=r.index;let d=-1;if(c instanceof Jn){if(!(c.value instanceof Pe))return console.error(`GetDataValue: Invalid array index ${c.value}`),null;d=c.value.value}else{const S=e.evalExpression(c,n);if(!(S instanceof Pe))return console.error("GetDataValue: Unknown index type",c),null;d=S.value}if(d<0||d>=this.data.length)return console.error("GetDataValue: Index out of range",d),null;const a=o.endsWith("h")?"h":"f";let y;if(o==="mat2x2"||o==="mat2x2f"||o==="mat2x2h"||o==="mat3x2"||o==="mat3x2f"||o==="mat3x2h"||o==="mat4x2"||o==="mat4x2f"||o==="mat4x2h")y=new ce(new Float32Array(this.data.buffer,this.data.byteOffset+2*d*4,2),e.getTypeInfo(`vec2${a}`));else if(o==="mat2x3"||o==="mat2x3f"||o==="mat2x3h"||o==="mat3x3"||o==="mat3x3f"||o==="mat3x3h"||o==="mat4x3"||o==="mat4x3f"||o==="mat4x3h")y=new ce(new Float32Array(this.data.buffer,this.data.byteOffset+3*d*4,3),e.getTypeInfo(`vec3${a}`));else{if(o!=="mat2x4"&&o!=="mat2x4f"&&o!=="mat2x4h"&&o!=="mat3x4"&&o!=="mat3x4f"&&o!=="mat3x4h"&&o!=="mat4x4"&&o!=="mat4x4f"&&o!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${o}`),null;y=new ce(new Float32Array(this.data.buffer,this.data.byteOffset+4*d*4,4),e.getTypeInfo(`vec4${a}`))}return r.postfix?y.getSubData(e,r.postfix,n):y}return console.error("GetDataValue: Invalid postfix",r),null}toString(){let e=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)e+=`, ${this.data[r]}`;return e}}class Mn extends to{constructor(e,r,n=0,o=null){super(r,o),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Mn(e.buffer,this.typeInfo,0,null)}setDataValue(e,r,n,o){if(r===null)return void console.log("setDataValue: NULL data.");let c=this.offset,d=this.typeInfo;for(;n;){if(n instanceof Kh)if(d instanceof Vl){const a=n.index;if(a instanceof Jn){if(!(a.value instanceof Pe))return void console.error(`SetDataValue: Invalid index type ${a.value}`);c+=a.value.value*d.stride}else{const y=e.evalExpression(a,o);if(!(y instanceof Pe))return void console.error("SetDataValue: Unknown index type",a);c+=y.value*d.stride}d=d.format}else console.error(`SetDataValue: Type ${d.getTypeName()} is not an array`);else{if(!(n instanceof tu))return void console.error("SetDataValue: Unknown postfix type",n);{const a=n.value;if(d instanceof Cl){let y=!1;for(const S of d.members)if(S.name===a){c+=S.offset,d=S.type,y=!0;break}if(!y)return void console.error(`SetDataValue: Member ${a} not found`)}else if(d instanceof Gs){const y=d.getTypeName();let S=0;if(a==="x"||a==="r")S=0;else if(a==="y"||a==="g")S=1;else if(a==="z"||a==="b")S=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);S=3}if(!(r instanceof Pe))return void console.error("SetDataValue: Invalid value",r);const E=r.value;return y==="vec2f"?void(new Float32Array(this.buffer,c,2)[S]=E):y==="vec3f"?void(new Float32Array(this.buffer,c,3)[S]=E):y==="vec4f"?void(new Float32Array(this.buffer,c,4)[S]=E):y==="vec2i"?void(new Int32Array(this.buffer,c,2)[S]=E):y==="vec3i"?void(new Int32Array(this.buffer,c,3)[S]=E):y==="vec4i"?void(new Int32Array(this.buffer,c,4)[S]=E):y==="vec2u"?void(new Uint32Array(this.buffer,c,2)[S]=E):y==="vec3u"?void(new Uint32Array(this.buffer,c,3)[S]=E):y==="vec4u"?void(new Uint32Array(this.buffer,c,4)[S]=E):void console.error(`SetDataValue: Type ${y} is not a struct`)}}}n=n.postfix}this.setData(e,r,d,c,o)}setData(e,r,n,o,c){const d=n.getTypeName();if(d!=="f32"&&d!=="f16")if(d!=="i32"&&d!=="atomic<i32>"&&d!=="x32")if(d!=="u32"&&d!=="atomic<u32>")if(d!=="bool"){if(d==="vec2f"||d==="vec2h"){const a=new Float32Array(this.buffer,o,2);return void(r instanceof ce?(a[0]=r.data[0],a[1]=r.data[1]):(a[0]=r[0],a[1]=r[1]))}if(d==="vec3f"||d==="vec3h"){const a=new Float32Array(this.buffer,o,3);return void(r instanceof ce?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2]):(a[0]=r[0],a[1]=r[1],a[2]=r[2]))}if(d==="vec4f"||d==="vec4h"){const a=new Float32Array(this.buffer,o,4);return void(r instanceof ce?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3]))}if(d==="vec2i"){const a=new Int32Array(this.buffer,o,2);return void(r instanceof ce?(a[0]=r.data[0],a[1]=r.data[1]):(a[0]=r[0],a[1]=r[1]))}if(d==="vec3i"){const a=new Int32Array(this.buffer,o,3);return void(r instanceof ce?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2]):(a[0]=r[0],a[1]=r[1],a[2]=r[2]))}if(d==="vec4i"){const a=new Int32Array(this.buffer,o,4);return void(r instanceof ce?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3]))}if(d==="vec2u"){const a=new Uint32Array(this.buffer,o,2);return void(r instanceof ce?(a[0]=r.data[0],a[1]=r.data[1]):(a[0]=r[0],a[1]=r[1]))}if(d==="vec3u"){const a=new Uint32Array(this.buffer,o,3);return void(r instanceof ce?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2]):(a[0]=r[0],a[1]=r[1],a[2]=r[2]))}if(d==="vec4u"){const a=new Uint32Array(this.buffer,o,4);return void(r instanceof ce?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3]))}if(d==="vec2b"){const a=new Uint32Array(this.buffer,o,2);return void(r instanceof ce?(a[0]=r.data[0],a[1]=r.data[1]):(a[0]=r[0],a[1]=r[1]))}if(d==="vec3b"){const a=new Uint32Array(this.buffer,o,3);return void(r instanceof ce?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2]):(a[0]=r[0],a[1]=r[1],a[2]=r[2]))}if(d==="vec4b"){const a=new Uint32Array(this.buffer,o,4);return void(r instanceof ce?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3]))}if(d==="mat2x2f"||d==="mat2x2h"){const a=new Float32Array(this.buffer,o,4);return void(r instanceof Xt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3]))}if(d==="mat2x3f"||d==="mat2x3h"){const a=new Float32Array(this.buffer,o,6);return void(r instanceof Xt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5]))}if(d==="mat2x4f"||d==="mat2x4h"){const a=new Float32Array(this.buffer,o,8);return void(r instanceof Xt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7]))}if(d==="mat3x2f"||d==="mat3x2h"){const a=new Float32Array(this.buffer,o,6);return void(r instanceof Xt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5]))}if(d==="mat3x3f"||d==="mat3x3h"){const a=new Float32Array(this.buffer,o,9);return void(r instanceof Xt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7],a[8]=r.data[8]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8]))}if(d==="mat3x4f"||d==="mat3x4h"){const a=new Float32Array(this.buffer,o,12);return void(r instanceof Xt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7],a[8]=r.data[8],a[9]=r.data[9],a[10]=r.data[10],a[11]=r.data[11]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11]))}if(d==="mat4x2f"||d==="mat4x2h"){const a=new Float32Array(this.buffer,o,8);return void(r instanceof Xt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7]))}if(d==="mat4x3f"||d==="mat4x3h"){const a=new Float32Array(this.buffer,o,12);return void(r instanceof Xt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7],a[8]=r.data[8],a[9]=r.data[9],a[10]=r.data[10],a[11]=r.data[11]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11]))}if(d==="mat4x4f"||d==="mat4x4h"){const a=new Float32Array(this.buffer,o,16);return void(r instanceof Xt?(a[0]=r.data[0],a[1]=r.data[1],a[2]=r.data[2],a[3]=r.data[3],a[4]=r.data[4],a[5]=r.data[5],a[6]=r.data[6],a[7]=r.data[7],a[8]=r.data[8],a[9]=r.data[9],a[10]=r.data[10],a[11]=r.data[11],a[12]=r.data[12],a[13]=r.data[13],a[14]=r.data[14],a[15]=r.data[15]):(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]))}if(r instanceof Mn){if(n===r.typeInfo)return void new Uint8Array(this.buffer,o,r.buffer.byteLength).set(new Uint8Array(r.buffer));console.error("SetDataValue: Type mismatch",d,r.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${d}`)}else r instanceof Pe&&(new Int32Array(this.buffer,o,1)[0]=r.value);else r instanceof Pe&&(new Uint32Array(this.buffer,o,1)[0]=r.value);else r instanceof Pe&&(new Int32Array(this.buffer,o,1)[0]=r.value);else r instanceof Pe&&(new Float32Array(this.buffer,o,1)[0]=r.value)}getSubData(e,r,n){var o,c,d;if(r===null)return this;let a=this.offset,y=this.typeInfo;for(;r;){if(r instanceof Kh){const E=r.index,M=E instanceof Co?e.evalExpression(E,n):E;let F=0;if(M instanceof Pe?F=M.value:typeof M=="number"?F=M:console.error("GetDataValue: Invalid index type",E),y instanceof Vl)a+=F*y.stride,y=y.format;else{const N=y.getTypeName();N==="mat4x4"||N==="mat4x4f"||N==="mat4x4h"?(a+=16*F,y=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${y.getTypeName()} is not an array`)}}else{if(!(r instanceof tu))return console.error("GetDataValue: Unknown postfix type",r),null;{const E=r.value;if(y instanceof Cl){let M=!1;for(const F of y.members)if(F.name===E){a+=F.offset,y=F.type,M=!0;break}if(!M)return console.error(`GetDataValue: Member ${E} not found`),null}else if(y instanceof Gs){const M=y.getTypeName();if(M==="vec2f"||M==="vec3f"||M==="vec4f"||M==="vec2i"||M==="vec3i"||M==="vec4i"||M==="vec2u"||M==="vec3u"||M==="vec4u"||M==="vec2b"||M==="vec3b"||M==="vec4b"||M==="vec2h"||M==="vec3h"||M==="vec4h"||M==="vec2"||M==="vec3"||M==="vec4"){if(E.length>0&&E.length<5){let F="f";const N=[];for(let G=0;G<E.length;++G){const re=E[G].toLowerCase();let me=0;if(re==="x"||re==="r")me=0;else if(re==="y"||re==="g")me=1;else if(re==="z"||re==="b")me=2;else{if(re!=="w"&&re!=="a")return console.error(`Unknown member ${E}`),null;me=3}if(E.length===1){if(M.endsWith("f"))return this.buffer.byteLength<a+4*me+4?(console.log("Insufficient buffer data"),null):new Pe(new Float32Array(this.buffer,a+4*me,1),e.getTypeInfo("f32"),this);if(M.endsWith("h"))return new Pe(new Float32Array(this.buffer,a+4*me,1),e.getTypeInfo("f16"),this);if(M.endsWith("i"))return new Pe(new Int32Array(this.buffer,a+4*me,1),e.getTypeInfo("i32"),this);if(M.endsWith("b"))return new Pe(new Int32Array(this.buffer,a+4*me,1),e.getTypeInfo("bool"),this);if(M.endsWith("u"))return new Pe(new Uint32Array(this.buffer,a+4*me,1),e.getTypeInfo("i32"),this)}if(M==="vec2f")N.push(new Float32Array(this.buffer,a,2)[me]);else if(M==="vec3f"){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const Y=new Float32Array(this.buffer,a,3);N.push(Y[me])}else if(M==="vec4f")N.push(new Float32Array(this.buffer,a,4)[me]);else if(M==="vec2i")F="i",N.push(new Int32Array(this.buffer,a,2)[me]);else if(M==="vec3i")F="i",N.push(new Int32Array(this.buffer,a,3)[me]);else if(M==="vec4i")F="i",N.push(new Int32Array(this.buffer,a,4)[me]);else if(M==="vec2u"){F="u";const Y=new Uint32Array(this.buffer,a,2);N.push(Y[me])}else M==="vec3u"?(F="u",N.push(new Uint32Array(this.buffer,a,3)[me])):M==="vec4u"&&(F="u",N.push(new Uint32Array(this.buffer,a,4)[me]))}return N.length===2?y=e.getTypeInfo(`vec2${F}`):N.length===3?y=e.getTypeInfo(`vec3${F}`):N.length===4?y=e.getTypeInfo(`vec4${F}`):console.error(`GetDataValue: Invalid vector length ${N.length}`),new ce(N,y,null)}return console.error(`GetDataValue: Unknown member ${E}`),null}return console.error(`GetDataValue: Type ${M} is not a struct`),null}}}r=r.postfix}const S=y.getTypeName();return S==="f32"?new Pe(new Float32Array(this.buffer,a,1),y,this):S==="i32"?new Pe(new Int32Array(this.buffer,a,1),y,this):S==="u32"?new Pe(new Uint32Array(this.buffer,a,1),y,this):S==="vec2f"?new ce(new Float32Array(this.buffer,a,2),y,this):S==="vec3f"?new ce(new Float32Array(this.buffer,a,3),y,this):S==="vec4f"?new ce(new Float32Array(this.buffer,a,4),y,this):S==="vec2i"?new ce(new Int32Array(this.buffer,a,2),y,this):S==="vec3i"?new ce(new Int32Array(this.buffer,a,3),y,this):S==="vec4i"?new ce(new Int32Array(this.buffer,a,4),y,this):S==="vec2u"?new ce(new Uint32Array(this.buffer,a,2),y,this):S==="vec3u"?new ce(new Uint32Array(this.buffer,a,3),y,this):S==="vec4u"?new ce(new Uint32Array(this.buffer,a,4),y,this):y instanceof eu&&y.name==="atomic"?((o=y.format)===null||o===void 0?void 0:o.name)==="u32"?new Pe(new Uint32Array(this.buffer,a,1)[0],y.format,this):((c=y.format)===null||c===void 0?void 0:c.name)==="i32"?new Pe(new Int32Array(this.buffer,a,1)[0],y.format,this):(console.error(`GetDataValue: Invalid atomic format ${(d=y.format)===null||d===void 0?void 0:d.name}`),null):new Mn(this.buffer,y,a,this)}toString(){let e="";if(this.typeInfo instanceof Vl)if(this.typeInfo.format.name==="f32"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let n=1;n<r.length;++n)e+=`, ${r[n]}`}else if(this.typeInfo.format.name==="i32"){const r=new Int32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let n=1;n<r.length;++n)e+=`, ${r[n]}`}else if(this.typeInfo.format.name==="u32"){const r=new Uint32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let n=1;n<r.length;++n)e+=`, ${r[n]}`}else if(this.typeInfo.format.name==="vec2f"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}]`;for(let n=1;n<r.length/2;++n)e+=`, [${r[2*n]}, ${r[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}, ${r[2]}]`;for(let n=4;n<r.length;n+=4)e+=`, [${r[n]}, ${r[n+1]}, ${r[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}, ${r[2]}, ${r[3]}]`;for(let n=4;n<r.length;n+=4)e+=`, [${r[n]}, ${r[n+1]}, ${r[n+2]}, ${r[n+3]}]`}else e="[...]";else this.typeInfo instanceof Cl?e+="{...}":e="[...]";return e}}class Ca extends to{constructor(e,r,n,o){super(r,null),this.data=e,this.descriptor=n,this.view=o}clone(){return new Ca(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,r;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(e=n[0])!==null&&e!==void 0?e:0:n instanceof Object&&(r=n.width)!==null&&r!==void 0?r:0}get height(){var e,r;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(e=n[1])!==null&&e!==void 0?e:0:n instanceof Object&&(r=n.height)!==null&&r!==void 0?r:0}get depthOrArrayLayers(){var e,r;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(e=n[2])!==null&&e!==void 0?e:0:n instanceof Object&&(r=n.depthOrArrayLayers)!==null&&r!==void 0?r:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const r=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<r.length;++n)r[n]=Math.max(1,r[n]>>e);return r}get texelByteSize(){const e=this.format,r=T0[e];return r?r.isDepthStencil?4:r.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,r=T0[e];return!!r&&r.isDepthStencil}getGpuSize(){const e=this.format,r=T0[e],n=this.width;if(!e||n<=0||!r)return-1;const o=this.height,c=this.depthOrArrayLayers,d=this.dimension;return n/r.blockWidth*(d==="1d"?1:o/r.blockHeight)*r.bytesPerBlock*c}getPixel(e,r,n=0,o=0){const c=this.texelByteSize,d=this.bytesPerRow,a=this.height,y=this.data[o];return kL(new Uint8Array(y),e,r,n,o,a,d,c,this.format)}setPixel(e,r,n,o,c){const d=this.texelByteSize,a=this.bytesPerRow,y=this.height,S=this.data[o];(function(E,M,F,N,G,re,me,Y,q,Z){const le=N*(me>>=G)*(re>>=G)+F*me+M*Y;switch(q){case"r8unorm":return void $r(E,le,"8unorm",1,Z);case"r8snorm":return void $r(E,le,"8snorm",1,Z);case"r8uint":return void $r(E,le,"8uint",1,Z);case"r8sint":return void $r(E,le,"8sint",1,Z);case"rg8unorm":return void $r(E,le,"8unorm",2,Z);case"rg8snorm":return void $r(E,le,"8snorm",2,Z);case"rg8uint":return void $r(E,le,"8uint",2,Z);case"rg8sint":return void $r(E,le,"8sint",2,Z);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void $r(E,le,"8unorm",4,Z);case"rgba8snorm":return void $r(E,le,"8snorm",4,Z);case"rgba8uint":return void $r(E,le,"8uint",4,Z);case"rgba8sint":return void $r(E,le,"8sint",4,Z);case"r16uint":return void $r(E,le,"16uint",1,Z);case"r16sint":return void $r(E,le,"16sint",1,Z);case"r16float":return void $r(E,le,"16float",1,Z);case"rg16uint":return void $r(E,le,"16uint",2,Z);case"rg16sint":return void $r(E,le,"16sint",2,Z);case"rg16float":return void $r(E,le,"16float",2,Z);case"rgba16uint":return void $r(E,le,"16uint",4,Z);case"rgba16sint":return void $r(E,le,"16sint",4,Z);case"rgba16float":return void $r(E,le,"16float",4,Z);case"r32uint":return void $r(E,le,"32uint",1,Z);case"r32sint":return void $r(E,le,"32sint",1,Z);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void $r(E,le,"32float",1,Z);case"rg32uint":return void $r(E,le,"32uint",2,Z);case"rg32sint":return void $r(E,le,"32sint",2,Z);case"rg32float":return void $r(E,le,"32float",2,Z);case"rgba32uint":return void $r(E,le,"32uint",4,Z);case"rgba32sint":return void $r(E,le,"32sint",4,Z);case"rgba32float":return void $r(E,le,"32float",4,Z);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(S),e,r,n,o,y,a,d,this.format,c)}}(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(Ce||(Ce={}));class Me{constructor(e,r,n){this.name=e,this.type=r,this.rule=n}toString(){return this.name}}class ie{}Fe=ie,ie.none=new Me("",Ce.reserved,""),ie.eof=new Me("EOF",Ce.token,""),ie.reserved={asm:new Me("asm",Ce.reserved,"asm"),bf16:new Me("bf16",Ce.reserved,"bf16"),do:new Me("do",Ce.reserved,"do"),enum:new Me("enum",Ce.reserved,"enum"),f16:new Me("f16",Ce.reserved,"f16"),f64:new Me("f64",Ce.reserved,"f64"),handle:new Me("handle",Ce.reserved,"handle"),i8:new Me("i8",Ce.reserved,"i8"),i16:new Me("i16",Ce.reserved,"i16"),i64:new Me("i64",Ce.reserved,"i64"),mat:new Me("mat",Ce.reserved,"mat"),premerge:new Me("premerge",Ce.reserved,"premerge"),regardless:new Me("regardless",Ce.reserved,"regardless"),typedef:new Me("typedef",Ce.reserved,"typedef"),u8:new Me("u8",Ce.reserved,"u8"),u16:new Me("u16",Ce.reserved,"u16"),u64:new Me("u64",Ce.reserved,"u64"),unless:new Me("unless",Ce.reserved,"unless"),using:new Me("using",Ce.reserved,"using"),vec:new Me("vec",Ce.reserved,"vec"),void:new Me("void",Ce.reserved,"void")},ie.keywords={array:new Me("array",Ce.keyword,"array"),atomic:new Me("atomic",Ce.keyword,"atomic"),bool:new Me("bool",Ce.keyword,"bool"),f32:new Me("f32",Ce.keyword,"f32"),i32:new Me("i32",Ce.keyword,"i32"),mat2x2:new Me("mat2x2",Ce.keyword,"mat2x2"),mat2x3:new Me("mat2x3",Ce.keyword,"mat2x3"),mat2x4:new Me("mat2x4",Ce.keyword,"mat2x4"),mat3x2:new Me("mat3x2",Ce.keyword,"mat3x2"),mat3x3:new Me("mat3x3",Ce.keyword,"mat3x3"),mat3x4:new Me("mat3x4",Ce.keyword,"mat3x4"),mat4x2:new Me("mat4x2",Ce.keyword,"mat4x2"),mat4x3:new Me("mat4x3",Ce.keyword,"mat4x3"),mat4x4:new Me("mat4x4",Ce.keyword,"mat4x4"),ptr:new Me("ptr",Ce.keyword,"ptr"),sampler:new Me("sampler",Ce.keyword,"sampler"),sampler_comparison:new Me("sampler_comparison",Ce.keyword,"sampler_comparison"),struct:new Me("struct",Ce.keyword,"struct"),texture_1d:new Me("texture_1d",Ce.keyword,"texture_1d"),texture_2d:new Me("texture_2d",Ce.keyword,"texture_2d"),texture_2d_array:new Me("texture_2d_array",Ce.keyword,"texture_2d_array"),texture_3d:new Me("texture_3d",Ce.keyword,"texture_3d"),texture_cube:new Me("texture_cube",Ce.keyword,"texture_cube"),texture_cube_array:new Me("texture_cube_array",Ce.keyword,"texture_cube_array"),texture_multisampled_2d:new Me("texture_multisampled_2d",Ce.keyword,"texture_multisampled_2d"),texture_storage_1d:new Me("texture_storage_1d",Ce.keyword,"texture_storage_1d"),texture_storage_2d:new Me("texture_storage_2d",Ce.keyword,"texture_storage_2d"),texture_storage_2d_array:new Me("texture_storage_2d_array",Ce.keyword,"texture_storage_2d_array"),texture_storage_3d:new Me("texture_storage_3d",Ce.keyword,"texture_storage_3d"),texture_depth_2d:new Me("texture_depth_2d",Ce.keyword,"texture_depth_2d"),texture_depth_2d_array:new Me("texture_depth_2d_array",Ce.keyword,"texture_depth_2d_array"),texture_depth_cube:new Me("texture_depth_cube",Ce.keyword,"texture_depth_cube"),texture_depth_cube_array:new Me("texture_depth_cube_array",Ce.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Me("texture_depth_multisampled_2d",Ce.keyword,"texture_depth_multisampled_2d"),texture_external:new Me("texture_external",Ce.keyword,"texture_external"),u32:new Me("u32",Ce.keyword,"u32"),vec2:new Me("vec2",Ce.keyword,"vec2"),vec3:new Me("vec3",Ce.keyword,"vec3"),vec4:new Me("vec4",Ce.keyword,"vec4"),bitcast:new Me("bitcast",Ce.keyword,"bitcast"),block:new Me("block",Ce.keyword,"block"),break:new Me("break",Ce.keyword,"break"),case:new Me("case",Ce.keyword,"case"),continue:new Me("continue",Ce.keyword,"continue"),continuing:new Me("continuing",Ce.keyword,"continuing"),default:new Me("default",Ce.keyword,"default"),diagnostic:new Me("diagnostic",Ce.keyword,"diagnostic"),discard:new Me("discard",Ce.keyword,"discard"),else:new Me("else",Ce.keyword,"else"),enable:new Me("enable",Ce.keyword,"enable"),fallthrough:new Me("fallthrough",Ce.keyword,"fallthrough"),false:new Me("false",Ce.keyword,"false"),fn:new Me("fn",Ce.keyword,"fn"),for:new Me("for",Ce.keyword,"for"),function:new Me("function",Ce.keyword,"function"),if:new Me("if",Ce.keyword,"if"),let:new Me("let",Ce.keyword,"let"),const:new Me("const",Ce.keyword,"const"),loop:new Me("loop",Ce.keyword,"loop"),while:new Me("while",Ce.keyword,"while"),private:new Me("private",Ce.keyword,"private"),read:new Me("read",Ce.keyword,"read"),read_write:new Me("read_write",Ce.keyword,"read_write"),return:new Me("return",Ce.keyword,"return"),requires:new Me("requires",Ce.keyword,"requires"),storage:new Me("storage",Ce.keyword,"storage"),switch:new Me("switch",Ce.keyword,"switch"),true:new Me("true",Ce.keyword,"true"),alias:new Me("alias",Ce.keyword,"alias"),type:new Me("type",Ce.keyword,"type"),uniform:new Me("uniform",Ce.keyword,"uniform"),var:new Me("var",Ce.keyword,"var"),override:new Me("override",Ce.keyword,"override"),workgroup:new Me("workgroup",Ce.keyword,"workgroup"),write:new Me("write",Ce.keyword,"write"),r8unorm:new Me("r8unorm",Ce.keyword,"r8unorm"),r8snorm:new Me("r8snorm",Ce.keyword,"r8snorm"),r8uint:new Me("r8uint",Ce.keyword,"r8uint"),r8sint:new Me("r8sint",Ce.keyword,"r8sint"),r16uint:new Me("r16uint",Ce.keyword,"r16uint"),r16sint:new Me("r16sint",Ce.keyword,"r16sint"),r16float:new Me("r16float",Ce.keyword,"r16float"),rg8unorm:new Me("rg8unorm",Ce.keyword,"rg8unorm"),rg8snorm:new Me("rg8snorm",Ce.keyword,"rg8snorm"),rg8uint:new Me("rg8uint",Ce.keyword,"rg8uint"),rg8sint:new Me("rg8sint",Ce.keyword,"rg8sint"),r32uint:new Me("r32uint",Ce.keyword,"r32uint"),r32sint:new Me("r32sint",Ce.keyword,"r32sint"),r32float:new Me("r32float",Ce.keyword,"r32float"),rg16uint:new Me("rg16uint",Ce.keyword,"rg16uint"),rg16sint:new Me("rg16sint",Ce.keyword,"rg16sint"),rg16float:new Me("rg16float",Ce.keyword,"rg16float"),rgba8unorm:new Me("rgba8unorm",Ce.keyword,"rgba8unorm"),rgba8unorm_srgb:new Me("rgba8unorm_srgb",Ce.keyword,"rgba8unorm_srgb"),rgba8snorm:new Me("rgba8snorm",Ce.keyword,"rgba8snorm"),rgba8uint:new Me("rgba8uint",Ce.keyword,"rgba8uint"),rgba8sint:new Me("rgba8sint",Ce.keyword,"rgba8sint"),bgra8unorm:new Me("bgra8unorm",Ce.keyword,"bgra8unorm"),bgra8unorm_srgb:new Me("bgra8unorm_srgb",Ce.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Me("rgb10a2unorm",Ce.keyword,"rgb10a2unorm"),rg11b10float:new Me("rg11b10float",Ce.keyword,"rg11b10float"),rg32uint:new Me("rg32uint",Ce.keyword,"rg32uint"),rg32sint:new Me("rg32sint",Ce.keyword,"rg32sint"),rg32float:new Me("rg32float",Ce.keyword,"rg32float"),rgba16uint:new Me("rgba16uint",Ce.keyword,"rgba16uint"),rgba16sint:new Me("rgba16sint",Ce.keyword,"rgba16sint"),rgba16float:new Me("rgba16float",Ce.keyword,"rgba16float"),rgba32uint:new Me("rgba32uint",Ce.keyword,"rgba32uint"),rgba32sint:new Me("rgba32sint",Ce.keyword,"rgba32sint"),rgba32float:new Me("rgba32float",Ce.keyword,"rgba32float"),static_assert:new Me("static_assert",Ce.keyword,"static_assert")},ie.tokens={decimal_float_literal:new Me("decimal_float_literal",Ce.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new Me("hex_float_literal",Ce.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new Me("int_literal",Ce.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Me("uint_literal",Ce.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new Me("name",Ce.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new Me("ident",Ce.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Me("and",Ce.token,"&"),and_and:new Me("and_and",Ce.token,"&&"),arrow:new Me("arrow ",Ce.token,"->"),attr:new Me("attr",Ce.token,"@"),forward_slash:new Me("forward_slash",Ce.token,"/"),bang:new Me("bang",Ce.token,"!"),bracket_left:new Me("bracket_left",Ce.token,"["),bracket_right:new Me("bracket_right",Ce.token,"]"),brace_left:new Me("brace_left",Ce.token,"{"),brace_right:new Me("brace_right",Ce.token,"}"),colon:new Me("colon",Ce.token,":"),comma:new Me("comma",Ce.token,","),equal:new Me("equal",Ce.token,"="),equal_equal:new Me("equal_equal",Ce.token,"=="),not_equal:new Me("not_equal",Ce.token,"!="),greater_than:new Me("greater_than",Ce.token,">"),greater_than_equal:new Me("greater_than_equal",Ce.token,">="),shift_right:new Me("shift_right",Ce.token,">>"),less_than:new Me("less_than",Ce.token,"<"),less_than_equal:new Me("less_than_equal",Ce.token,"<="),shift_left:new Me("shift_left",Ce.token,"<<"),modulo:new Me("modulo",Ce.token,"%"),minus:new Me("minus",Ce.token,"-"),minus_minus:new Me("minus_minus",Ce.token,"--"),period:new Me("period",Ce.token,"."),plus:new Me("plus",Ce.token,"+"),plus_plus:new Me("plus_plus",Ce.token,"++"),or:new Me("or",Ce.token,"|"),or_or:new Me("or_or",Ce.token,"||"),paren_left:new Me("paren_left",Ce.token,"("),paren_right:new Me("paren_right",Ce.token,")"),semicolon:new Me("semicolon",Ce.token,";"),star:new Me("star",Ce.token,"*"),tilde:new Me("tilde",Ce.token,"~"),underscore:new Me("underscore",Ce.token,"_"),xor:new Me("xor",Ce.token,"^"),plus_equal:new Me("plus_equal",Ce.token,"+="),minus_equal:new Me("minus_equal",Ce.token,"-="),times_equal:new Me("times_equal",Ce.token,"*="),division_equal:new Me("division_equal",Ce.token,"/="),modulo_equal:new Me("modulo_equal",Ce.token,"%="),and_equal:new Me("and_equal",Ce.token,"&="),or_equal:new Me("or_equal",Ce.token,"|="),xor_equal:new Me("xor_equal",Ce.token,"^="),shift_right_equal:new Me("shift_right_equal",Ce.token,">>="),shift_left_equal:new Me("shift_left_equal",Ce.token,"<<=")},ie.simpleTokens={"@":Fe.tokens.attr,"{":Fe.tokens.brace_left,"}":Fe.tokens.brace_right,":":Fe.tokens.colon,",":Fe.tokens.comma,"(":Fe.tokens.paren_left,")":Fe.tokens.paren_right,";":Fe.tokens.semicolon},ie.literalTokens={"&":Fe.tokens.and,"&&":Fe.tokens.and_and,"->":Fe.tokens.arrow,"/":Fe.tokens.forward_slash,"!":Fe.tokens.bang,"[":Fe.tokens.bracket_left,"]":Fe.tokens.bracket_right,"=":Fe.tokens.equal,"==":Fe.tokens.equal_equal,"!=":Fe.tokens.not_equal,">":Fe.tokens.greater_than,">=":Fe.tokens.greater_than_equal,">>":Fe.tokens.shift_right,"<":Fe.tokens.less_than,"<=":Fe.tokens.less_than_equal,"<<":Fe.tokens.shift_left,"%":Fe.tokens.modulo,"-":Fe.tokens.minus,"--":Fe.tokens.minus_minus,".":Fe.tokens.period,"+":Fe.tokens.plus,"++":Fe.tokens.plus_plus,"|":Fe.tokens.or,"||":Fe.tokens.or_or,"*":Fe.tokens.star,"~":Fe.tokens.tilde,_:Fe.tokens.underscore,"^":Fe.tokens.xor,"+=":Fe.tokens.plus_equal,"-=":Fe.tokens.minus_equal,"*=":Fe.tokens.times_equal,"/=":Fe.tokens.division_equal,"%=":Fe.tokens.modulo_equal,"&=":Fe.tokens.and_equal,"|=":Fe.tokens.or_equal,"^=":Fe.tokens.xor_equal,">>=":Fe.tokens.shift_right_equal,"<<=":Fe.tokens.shift_left_equal},ie.regexTokens={decimal_float_literal:Fe.tokens.decimal_float_literal,hex_float_literal:Fe.tokens.hex_float_literal,int_literal:Fe.tokens.int_literal,uint_literal:Fe.tokens.uint_literal,ident:Fe.tokens.ident},ie.storage_class=[Fe.keywords.function,Fe.keywords.private,Fe.keywords.workgroup,Fe.keywords.uniform,Fe.keywords.storage],ie.access_mode=[Fe.keywords.read,Fe.keywords.write,Fe.keywords.read_write],ie.sampler_type=[Fe.keywords.sampler,Fe.keywords.sampler_comparison],ie.sampled_texture_type=[Fe.keywords.texture_1d,Fe.keywords.texture_2d,Fe.keywords.texture_2d_array,Fe.keywords.texture_3d,Fe.keywords.texture_cube,Fe.keywords.texture_cube_array],ie.multisampled_texture_type=[Fe.keywords.texture_multisampled_2d],ie.storage_texture_type=[Fe.keywords.texture_storage_1d,Fe.keywords.texture_storage_2d,Fe.keywords.texture_storage_2d_array,Fe.keywords.texture_storage_3d],ie.depth_texture_type=[Fe.keywords.texture_depth_2d,Fe.keywords.texture_depth_2d_array,Fe.keywords.texture_depth_cube,Fe.keywords.texture_depth_cube_array,Fe.keywords.texture_depth_multisampled_2d],ie.texture_external_type=[Fe.keywords.texture_external],ie.any_texture_type=[...Fe.sampled_texture_type,...Fe.multisampled_texture_type,...Fe.storage_texture_type,...Fe.depth_texture_type,...Fe.texture_external_type],ie.texel_format=[Fe.keywords.r8unorm,Fe.keywords.r8snorm,Fe.keywords.r8uint,Fe.keywords.r8sint,Fe.keywords.r16uint,Fe.keywords.r16sint,Fe.keywords.r16float,Fe.keywords.rg8unorm,Fe.keywords.rg8snorm,Fe.keywords.rg8uint,Fe.keywords.rg8sint,Fe.keywords.r32uint,Fe.keywords.r32sint,Fe.keywords.r32float,Fe.keywords.rg16uint,Fe.keywords.rg16sint,Fe.keywords.rg16float,Fe.keywords.rgba8unorm,Fe.keywords.rgba8unorm_srgb,Fe.keywords.rgba8snorm,Fe.keywords.rgba8uint,Fe.keywords.rgba8sint,Fe.keywords.bgra8unorm,Fe.keywords.bgra8unorm_srgb,Fe.keywords.rgb10a2unorm,Fe.keywords.rg11b10float,Fe.keywords.rg32uint,Fe.keywords.rg32sint,Fe.keywords.rg32float,Fe.keywords.rgba16uint,Fe.keywords.rgba16sint,Fe.keywords.rgba16float,Fe.keywords.rgba32uint,Fe.keywords.rgba32sint,Fe.keywords.rgba32float],ie.const_literal=[Fe.tokens.int_literal,Fe.tokens.uint_literal,Fe.tokens.decimal_float_literal,Fe.tokens.hex_float_literal,Fe.keywords.true,Fe.keywords.false],ie.literal_or_ident=[Fe.tokens.ident,Fe.tokens.int_literal,Fe.tokens.uint_literal,Fe.tokens.decimal_float_literal,Fe.tokens.hex_float_literal,Fe.tokens.name],ie.element_count_expression=[Fe.tokens.int_literal,Fe.tokens.uint_literal,Fe.tokens.ident],ie.template_types=[Fe.keywords.vec2,Fe.keywords.vec3,Fe.keywords.vec4,Fe.keywords.mat2x2,Fe.keywords.mat2x3,Fe.keywords.mat2x4,Fe.keywords.mat3x2,Fe.keywords.mat3x3,Fe.keywords.mat3x4,Fe.keywords.mat4x2,Fe.keywords.mat4x3,Fe.keywords.mat4x4,Fe.keywords.atomic,Fe.keywords.bitcast,...Fe.any_texture_type],ie.attribute_name=[Fe.tokens.ident,Fe.keywords.block,Fe.keywords.diagnostic],ie.assignment_operators=[Fe.tokens.equal,Fe.tokens.plus_equal,Fe.tokens.minus_equal,Fe.tokens.times_equal,Fe.tokens.division_equal,Fe.tokens.modulo_equal,Fe.tokens.and_equal,Fe.tokens.or_equal,Fe.tokens.xor_equal,Fe.tokens.shift_right_equal,Fe.tokens.shift_left_equal],ie.increment_operators=[Fe.tokens.plus_plus,Fe.tokens.minus_minus];class BS{constructor(e,r,n,o,c){this.type=e,this.lexeme=r,this.line=n,this.start=o,this.end=c}toString(){return this.lexeme}isTemplateType(){return ie.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==ie.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class BL{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new BS(ie.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let d=1;for(;d>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),d--,d==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),d++)}return!0}}const r=ie.simpleTokens[e];if(r)return this._addToken(r),!0;let n=ie.none;const o=this._isAlpha(e),c=e==="_";if(this._isAlphaNumeric(e)){let d=this._peekAhead();for(;this._isAlphaNumeric(d);)e+=this._advance(),d=this._peekAhead()}if(o){const d=ie.keywords[e];if(d)return this._addToken(d),!0}if(o||c)return this._addToken(ie.tokens.ident),!0;for(;;){let d=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(ie.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(ie.tokens.minus_minus),!0;const y=this._tokens.length-1;if((ie.literal_or_ident.indexOf(this._tokens[y].type)!=-1||this._tokens[y].type==ie.tokens.paren_right)&&a!=">")return this._addToken(d),!0}if(e==">"&&(a==">"||a=="=")){let y=!1,S=this._tokens.length-1;for(let E=0;E<5&&S>=0&&ie.assignment_operators.indexOf(this._tokens[S].type)===-1;++E,--S)if(this._tokens[S].type===ie.tokens.less_than){S>0&&this._tokens[S-1].isArrayOrTemplateType()&&(y=!0);break}if(y)return this._addToken(d),!0}if(d===ie.none){let y=e,S=0;const E=2;for(let M=0;M<E;++M)if(y+=this._peekAhead(M),d=this._findType(y),d!==ie.none){S=M;break}if(d===ie.none)return n!==ie.none&&(this._current--,this._addToken(n),!0);e=y,this._current+=S+1}if(n=d,this._isAtEnd())break;e+=this._advance()}return n!==ie.none&&(this._addToken(n),!0)}_findType(e){for(const n in ie.regexTokens){const o=ie.regexTokens[n];if(this._match(e,o.rule))return o}return ie.literalTokens[e]||ie.none}_match(e,r){const n=r.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let r=this._source[this._current];return e=e||0,e++,this._current+=e,r}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const r=this._source.substring(this._start,this._current);this._tokens.push(new BS(e,r,this._line,this._start,this._current))}}function vt(t){return Array.isArray(t)||(t==null?void 0:t.buffer)instanceof ArrayBuffer}const D_=new Float32Array(1),UL=new Uint32Array(D_.buffer),VL=new Uint32Array(D_.buffer),O_=new Int32Array(1),jL=new Float32Array(O_.buffer),$L=new Uint32Array(O_.buffer),F_=new Uint32Array(1),WL=new Float32Array(F_.buffer),HL=new Int32Array(F_.buffer);function US(t,e,r){if(e===r)return t;if(e==="f32"){if(r==="i32"||r==="x32")return D_[0]=t,UL[0];if(r==="u32")return D_[0]=t,VL[0]}else if(e==="i32"||e==="x32"){if(r==="f32")return O_[0]=t,jL[0];if(r==="u32")return O_[0]=t,$L[0]}else if(e==="u32"){if(r==="f32")return F_[0]=t,WL[0];if(r==="i32"||r==="x32")return F_[0]=t,HL[0]}return console.error(`Unsupported cast from ${e} to ${r}`),t}class XL{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class pm{constructor(e,r){this.align=e,this.size=r}}class Go{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new PL,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const r of e)r instanceof _p&&this._functions.set(r.name,new XL(r));for(const r of e)if(r instanceof Pa){const n=this.getTypeInfo(r,null);n instanceof Cl&&this.structs.push(n)}for(const r of e)if(r instanceof U1)this.aliases.push(this._getAliasInfo(r));else{if(r instanceof z1){const n=r,o=this._getAttributeNum(n.attributes,"id",0),c=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new EL(n.name,c,n.attributes,o));continue}if(this._isUniformVar(r)){const n=r,o=this._getAttributeNum(n.attributes,"group",0),c=this._getAttributeNum(n.attributes,"binding",0),d=this.getTypeInfo(n.type,n.attributes),a=new fm(n.name,d,o,c,n.attributes,wl.Uniform,n.access);a.access||(a.access="read"),this.uniforms.push(a);continue}if(this._isStorageVar(r)){const n=r,o=this._getAttributeNum(n.attributes,"group",0),c=this._getAttributeNum(n.attributes,"binding",0),d=this.getTypeInfo(n.type,n.attributes),a=this._isStorageTexture(d),y=new fm(n.name,d,o,c,n.attributes,a?wl.StorageTexture:wl.Storage,n.access);y.access||(y.access="read"),this.storage.push(y);continue}if(this._isTextureVar(r)){const n=r,o=this._getAttributeNum(n.attributes,"group",0),c=this._getAttributeNum(n.attributes,"binding",0),d=this.getTypeInfo(n.type,n.attributes),a=this._isStorageTexture(d),y=new fm(n.name,d,o,c,n.attributes,a?wl.StorageTexture:wl.Texture,n.access);y.access||(y.access="read"),a?this.storage.push(y):this.textures.push(y);continue}if(this._isSamplerVar(r)){const n=r,o=this._getAttributeNum(n.attributes,"group",0),c=this._getAttributeNum(n.attributes,"binding",0),d=this.getTypeInfo(n.type,n.attributes),a=new fm(n.name,d,o,c,n.attributes,wl.Sampler,n.access);this.samplers.push(a);continue}}for(const r of e)if(r instanceof _p){const n=this._getAttribute(r,"vertex"),o=this._getAttribute(r,"fragment"),c=this._getAttribute(r,"compute"),d=n||o||c,a=new IL(r.name,d==null?void 0:d.name,r.attributes);a.attributes=r.attributes,a.startLine=r.startLine,a.endLine=r.endLine,this.functions.push(a),this._functions.get(r.name).info=a,d&&(this._functions.get(r.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(r,!!d),a.inputs=this._getInputs(r.args),a.outputs=this._getOutputs(r.returnType),this.entry[d.name].push(a)),a.arguments=r.args.map(y=>new AL(y.name,this.getTypeInfo(y.type,y.attributes),y.attributes)),a.returnType=r.returnType?this.getTypeInfo(r.returnType,r.attributes):null;continue}for(const r of this._functions.values())r.info&&(r.info.inUse=r.inUse,this._addCalls(r.node,r.info.calls));for(const r of this._functions.values())r.node.search(n=>{var o,c,d;if(n instanceof RP){if(n.value)if(vt(n.value))for(const a of n.value)for(const y of this.overrides)a===y.name&&((o=r.info)===null||o===void 0||o.overrides.push(y));else for(const a of this.overrides)n.value===a.name&&((c=r.info)===null||c===void 0||c.overrides.push(a))}else if(n instanceof Rs)for(const a of this.overrides)n.name===a.name&&((d=r.info)===null||d===void 0||d.overrides.push(a))});for(const r of this.uniforms)this._markStructsInUse(r.type);for(const r of this.storage)this._markStructsInUse(r.type)}getFunctionInfo(e){for(const r of this.functions)if(r.name==e)return r;return null}getStructInfo(e){for(const r of this.structs)if(r.name==e)return r;return null}getOverrideInfo(e){for(const r of this.overrides)if(r.name==e)return r;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const r of e.members)this._markStructsInUse(r.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const r=this._getAlias(e.name);r&&this._markStructsInUse(r)}}_addCalls(e,r){var n;for(const o of e.calls){const c=(n=this._functions.get(o.name))===null||n===void 0?void 0:n.info;c&&r.add(c)}}findResource(e,r,n){if(n){for(const o of this.entry.compute)if(o.name===n){for(const c of o.resources)if(c.group==e&&c.binding==r)return c}for(const o of this.entry.vertex)if(o.name===n){for(const c of o.resources)if(c.group==e&&c.binding==r)return c}for(const o of this.entry.fragment)if(o.name===n){for(const c of o.resources)if(c.group==e&&c.binding==r)return c}}for(const o of this.uniforms)if(o.group==e&&o.binding==r)return o;for(const o of this.storage)if(o.group==e&&o.binding==r)return o;for(const o of this.textures)if(o.group==e&&o.binding==r)return o;for(const o of this.samplers)if(o.group==e&&o.binding==r)return o;return null}_findResource(e){for(const r of this.uniforms)if(r.name==e)return r;for(const r of this.storage)if(r.name==e)return r;for(const r of this.textures)if(r.name==e)return r;for(const r of this.samplers)if(r.name==e)return r;return null}_markStructsFromAST(e){const r=this.getTypeInfo(e,null);this._markStructsInUse(r)}_findResources(e,r){const n=[],o=this,c=[];return e.search(d=>{if(d instanceof R_)c.push({});else if(d instanceof k_)c.pop();else if(d instanceof Ma){const a=d;r&&a.type!==null&&this._markStructsFromAST(a.type),c.length>0&&(c[c.length-1][a.name]=a)}else if(d instanceof Zo){const a=d;r&&a.type!==null&&this._markStructsFromAST(a.type)}else if(d instanceof Zf){const a=d;r&&a.type!==null&&this._markStructsFromAST(a.type),c.length>0&&(c[c.length-1][a.name]=a)}else if(d instanceof Rs){const a=d;if(c.length>0&&c[c.length-1][a.name])return;const y=o._findResource(a.name);y&&n.push(y)}else if(d instanceof V1){const a=d,y=o._functions.get(a.name);y&&(r&&(y.inUse=!0),e.calls.add(y.node),y.resources===null&&(y.resources=o._findResources(y.node,r)),n.push(...y.resources))}else if(d instanceof B1){const a=d,y=o._functions.get(a.name);y&&(r&&(y.inUse=!0),e.calls.add(y.node),y.resources===null&&(y.resources=o._findResources(y.node,r)),n.push(...y.resources))}}),[...new Map(n.map(d=>[d.name,d])).values()]}getBindGroups(){const e=[];function r(n,o){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),o>=e[n].length&&(e[n].length=o+1)}for(const n of this.uniforms)r(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)r(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)r(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)r(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,r=void 0){if(r===void 0&&(r=[]),e instanceof Pa)this._getStructOutputs(e,r);else{const n=this._getOutputInfo(e);n!==null&&r.push(n)}return r}_getStructOutputs(e,r){for(const n of e.members)if(n.type instanceof Pa)this._getStructOutputs(n.type,r);else{const o=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(o!==null){const c=this.getTypeInfo(n.type,n.type.attributes),d=this._parseInt(o.value),a=new OS(n.name,c,o.name,d);r.push(a)}}}_getOutputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const n=this.getTypeInfo(e,e.attributes),o=this._parseInt(r.value);return new OS("",n,r.name,o)}return null}_getInputs(e,r=void 0){r===void 0&&(r=[]);for(const n of e)if(n.type instanceof Pa)this._getStructInputs(n.type,r);else{const o=this._getInputInfo(n);o!==null&&r.push(o)}return r}_getStructInputs(e,r){for(const n of e.members)if(n.type instanceof Pa)this._getStructInputs(n.type,r);else{const o=this._getInputInfo(n);o!==null&&r.push(o)}}_getInputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const n=this._getAttribute(e,"interpolation"),o=this.getTypeInfo(e.type,e.attributes),c=this._parseInt(r.value),d=new SL(e.name,o,r.name,c);return n!==null&&(d.interpolation=this._parseString(n.value)),d}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const r=parseInt(e);return isNaN(r)?e:r}_getAlias(e){for(const r of this.aliases)if(r.name==e)return r.type;return null}_getAliasInfo(e){return new TL(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const r of this.structs)if(r.name==e)return r;for(const r of this.aliases)if(r.name==e)return r.type;return null}getTypeInfo(e,r=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Bm){const o=e.type?this.getTypeInfo(e.type,e.attributes):null,c=new sb(e.name,o,r);return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof qf){const o=e,c=o.format?this.getTypeInfo(o.format,o.attributes):null,d=new Vl(o.name,r);return d.format=c,d.count=o.count,this._types.set(e,d),this._updateTypeInfo(d),d}if(e instanceof Pa){const o=e,c=new Cl(o.name,r);c.startLine=o.startLine,c.endLine=o.endLine;for(const d of o.members){const a=this.getTypeInfo(d.type,d.attributes);c.members.push(new DS(d.name,a,d.attributes))}return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof Rf){const o=e,c=o.format instanceof Ge,d=o.format?c?this.getTypeInfo(o.format,null):new Gs(o.format,null):null,a=new eu(o.name,d,r,o.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof Re){const o=e,c=o.format?this.getTypeInfo(o.format,null):null,d=new eu(o.name,c,r,o.access);return this._types.set(e,d),this._updateTypeInfo(d),d}const n=new Gs(e.name,r);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var r,n,o;const c=this._getTypeSize(e);if(e.size=(r=c==null?void 0:c.size)!==null&&r!==void 0?r:0,e instanceof Vl&&e.format){const d=this._getTypeSize(e.format);e.stride=Math.max((n=d==null?void 0:d.size)!==null&&n!==void 0?n:0,(o=d==null?void 0:d.align)!==null&&o!==void 0?o:0),this._updateTypeInfo(e.format)}e instanceof sb&&this._updateTypeInfo(e.format),e instanceof Cl&&this._updateStructInfo(e)}_updateStructInfo(e){var r;let n=0,o=0,c=0,d=0;for(let a=0,y=e.members.length;a<y;++a){const S=e.members[a],E=this._getTypeSize(S);if(!E)continue;(r=this._getAlias(S.type.name))!==null&&r!==void 0||S.type;const M=E.align,F=E.size;n=this._roundUp(M,n+o),o=F,c=n,d=Math.max(d,M),S.offset=n,S.size=F,this._updateTypeInfo(S.type)}e.size=this._roundUp(d,c+o),e.align=d}_getTypeSize(e){var r,n;if(e==null)return null;const o=this._getAttributeNum(e.attributes,"size",0),c=this._getAttributeNum(e.attributes,"align",0);if(e instanceof DS&&(e=e.type),e instanceof Gs){const d=this._getAlias(e.name);d!==null&&(e=d)}{const d=Go._typeInfo[e.name];if(d!==void 0){const a=((r=e.format)===null||r===void 0?void 0:r.name)==="f16"?2:1;return new pm(Math.max(c,d.align/a),Math.max(o,d.size/a))}}{const d=Go._typeInfo[e.name.substring(0,e.name.length-1)];if(d){const a=e.name[e.name.length-1]==="h"?2:1;return new pm(Math.max(c,d.align/a),Math.max(o,d.size/a))}}if(e instanceof Vl){let d=e,a=8,y=8;const S=this._getTypeSize(d.format);return S!==null&&(y=S.size,a=S.align),y=d.count*this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(a,y)),o&&(y=o),new pm(Math.max(c,a),Math.max(o,y))}if(e instanceof Cl){let d=0,a=0,y=0,S=0,E=0;for(const M of e.members){const F=this._getTypeSize(M.type);F!==null&&(d=Math.max(F.align,d),y=this._roundUp(F.align,y+S),S=F.size,E=y)}return a=this._roundUp(d,E+S),new pm(Math.max(c,d),Math.max(o,a))}return null}_isUniformVar(e){return e instanceof Ma&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Ma&&e.storage=="storage"}_isTextureVar(e){return e instanceof Ma&&e.type!==null&&Go._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Ma&&e.type!==null&&Go._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,r){const n=e;if(!n||!n.attributes)return null;const o=n.attributes;for(let c of o)if(c.name==r)return c;return null}_getAttributeNum(e,r,n){if(e===null)return n;for(let o of e)if(o.name==r){let c=o!==null&&o.value!==null?o.value:n;return c instanceof Array&&(c=c[0]),typeof c=="number"?c:typeof c=="string"?parseInt(c):n}return n}_roundUp(e,r){return Math.ceil(r/e)*e}}Go._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Go._textureTypes=ie.any_texture_type.map(t=>t.name),Go._samplerTypes=ie.sampler_type.map(t=>t.name);let j1=0;class $1{constructor(e,r,n){this.id=j1++,this.name=e,this.value=r,this.node=n}clone(){return new $1(this.name,this.value,this.node)}}class W1{constructor(e){this.id=j1++,this.name=e.name,this.node=e}clone(){return new W1(this.node)}}class H1{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=j1++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var r;return this.variables.has(e)?(r=this.variables.get(e))!==null&&r!==void 0?r:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var r;return this.functions.has(e)?(r=this.functions.get(e))!==null&&r!==void 0?r:null:this.parent?this.parent.getFunction(e):null}createVariable(e,r,n){this.variables.set(e,new $1(e,r,n??null))}setVariable(e,r,n){const o=this.getVariable(e);o!==null?o.value=r:this.createVariable(e,r,n)}getVariableValue(e){var r;const n=this.getVariable(e);return(r=n==null?void 0:n.value)!==null&&r!==void 0?r:null}clone(){return new H1(this)}}class ZL{evalExpression(e,r){return null}getTypeInfo(e){return null}getVariableName(e,r){return""}}class qL{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,r){const n=this.exec.evalExpression(e.args[0],r);let o=!0;if(n instanceof ce)return n.data.forEach(c=>{c||(o=!1)}),new Pe(o?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce){const o=n.data.some(c=>c);return new Pe(o?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,r){const n=this.exec.evalExpression(e.args[2],r);if(!(n instanceof Pe))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],r):this.exec.evalExpression(e.args[0],r)}ArrayLength(e,r){let n=e.args[0];n instanceof Xn&&(n=n.right);const o=this.exec.evalExpression(n,r);if(o instanceof Mn&&o.typeInfo.size===0){const c=o.typeInfo,d=o.buffer.byteLength/c.stride;return new Pe(d,this.getTypeInfo("u32"))}return new Pe(o.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.abs(c)),n.typeInfo);const o=n;return new Pe(Math.abs(o.value),o.typeInfo)}Acos(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.acos(c)),n.typeInfo);const o=n;return new Pe(Math.acos(o.value),n.typeInfo)}Acosh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.acosh(c)),n.typeInfo);const o=n;return new Pe(Math.acosh(o.value),n.typeInfo)}Asin(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.asin(c)),n.typeInfo);const o=n;return new Pe(Math.asin(o.value),n.typeInfo)}Asinh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.asinh(c)),n.typeInfo);const o=n;return new Pe(Math.asinh(o.value),n.typeInfo)}Atan(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.atan(c)),n.typeInfo);const o=n;return new Pe(Math.atan(o.value),n.typeInfo)}Atanh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.atanh(c)),n.typeInfo);const o=n;return new Pe(Math.atanh(o.value),n.typeInfo)}Atan2(e,r){const n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r);if(n instanceof ce&&o instanceof ce)return new ce(n.data.map((a,y)=>Math.atan2(a,o.data[y])),n.typeInfo);const c=n,d=o;return new Pe(Math.atan2(c.value,d.value),n.typeInfo)}Ceil(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.ceil(c)),n.typeInfo);const o=n;return new Pe(Math.ceil(o.value),n.typeInfo)}_clamp(e,r,n){return Math.min(Math.max(e,r),n)}Clamp(e,r){const n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r),c=this.exec.evalExpression(e.args[2],r);if(n instanceof ce&&o instanceof ce&&c instanceof ce)return new ce(n.data.map((S,E)=>this._clamp(S,o.data[E],c.data[E])),n.typeInfo);const d=n,a=o,y=c;return new Pe(this._clamp(d.value,a.value,y.value),n.typeInfo)}Cos(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.cos(c)),n.typeInfo);const o=n;return new Pe(Math.cos(o.value),n.typeInfo)}Cosh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.cosh(c)),n.typeInfo);const o=n;return new Pe(Math.cos(o.value),n.typeInfo)}CountLeadingZeros(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.clz32(c)),n.typeInfo);const o=n;return new Pe(Math.clz32(o.value),n.typeInfo)}_countOneBits(e){let r=0;for(;e!==0;)1&e&&r++,e>>=1;return r}CountOneBits(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>this._countOneBits(c)),n.typeInfo);const o=n;return new Pe(this._countOneBits(o.value),n.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let r=0;for(;!(1&e);)e>>=1,r++;return r}CountTrailingZeros(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>this._countTrailingZeros(c)),n.typeInfo);const o=n;return new Pe(this._countTrailingZeros(o.value),n.typeInfo)}Cross(e,r){const n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r);if(n instanceof ce&&o instanceof ce){if(n.data.length!==3||o.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const c=n.data,d=o.data;return new ce([c[1]*d[2]-d[1]*c[2],c[2]*d[0]-d[2]*c[0],c[0]*d[1]-d[0]*c[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,r){const n=this.exec.evalExpression(e.args[0],r),o=180/Math.PI;return n instanceof ce?new ce(n.data.map(c=>c*o),n.typeInfo):new Pe(n.value*o,this.getTypeInfo("f32"))}Determinant(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Xt){const o=n.data,c=n.typeInfo.getTypeName(),d=c.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(c==="mat2x2"||c==="mat2x2f"||c==="mat2x2h")return new Pe(o[0]*o[3]-o[1]*o[2],d);if(c==="mat2x3"||c==="mat2x3f"||c==="mat2x3h")return new Pe(o[0]*(o[4]*o[8]-o[5]*o[7])-o[1]*(o[3]*o[8]-o[5]*o[6])+o[2]*(o[3]*o[7]-o[4]*o[6]),d);if(c==="mat2x4"||c==="mat2x4f"||c==="mat2x4h")console.error(`TODO: Determinant for ${c}`);else if(c==="mat3x2"||c==="mat3x2f"||c==="mat3x2h")console.error(`TODO: Determinant for ${c}`);else{if(c==="mat3x3"||c==="mat3x3f"||c==="mat3x3h")return new Pe(o[0]*(o[4]*o[8]-o[5]*o[7])-o[1]*(o[3]*o[8]-o[5]*o[6])+o[2]*(o[3]*o[7]-o[4]*o[6]),d);c==="mat3x4"||c==="mat3x4f"||c==="mat3x4h"||c==="mat4x2"||c==="mat4x2f"||c==="mat4x2h"||c==="mat4x3"||c==="mat4x3f"||c==="mat4x3h"?console.error(`TODO: Determinant for ${c}`):c!=="mat4x4"&&c!=="mat4x4f"&&c!=="mat4x4h"||console.error(`TODO: Determinant for ${c}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,r){const n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r);if(n instanceof ce&&o instanceof ce){let a=0;for(let y=0;y<n.data.length;++y)a+=(n.data[y]-o.data[y])*(n.data[y]-o.data[y]);return new Pe(Math.sqrt(a),this.getTypeInfo("f32"))}const c=n,d=o;return new Pe(Math.abs(c.value-d.value),n.typeInfo)}_dot(e,r){let n=0;for(let o=0;o<e.length;++o)n+=r[o]*e[o];return n}Dot(e,r){const n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r);return n instanceof ce&&o instanceof ce?new Pe(this._dot(n.data,o.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,r){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,r){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.exp(c)),n.typeInfo);const o=n;return new Pe(Math.exp(o.value),n.typeInfo)}Exp2(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.pow(2,c)),n.typeInfo);const o=n;return new Pe(Math.pow(2,o.value),n.typeInfo)}ExtractBits(e,r){const n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r),c=this.exec.evalExpression(e.args[2],r);if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(c.typeInfo.name!=="u32"&&c.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const d=o.value,a=c.value;if(n instanceof ce)return new ce(n.data.map(S=>S>>d&(1<<a)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const y=n.value;return new Pe(y>>d&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,r){const n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r),c=this.exec.evalExpression(e.args[2],r);if(n instanceof ce&&o instanceof ce&&c instanceof ce){const d=this._dot(o.data,c.data);return new ce(d<0?Array.from(n.data):n.data.map(a=>-a),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>this._firstLeadingBit(c)),n.typeInfo);const o=n;return new Pe(this._firstLeadingBit(o.value),n.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>this._firstTrailingBit(c)),n.typeInfo);const o=n;return new Pe(this._firstTrailingBit(o.value),n.typeInfo)}Floor(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.floor(c)),n.typeInfo);const o=n;return new Pe(Math.floor(o.value),n.typeInfo)}Fma(e,r){const n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r),c=this.exec.evalExpression(e.args[2],r);if(n instanceof ce&&o instanceof ce&&c instanceof ce)return n.data.length!==o.data.length||n.data.length!==c.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new ce(n.data.map((S,E)=>S*o.data[E]+c.data[E]),n.typeInfo);const d=n,a=o,y=c;return new Pe(d.value*a.value+y.value,d.typeInfo)}Fract(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>c-Math.floor(c)),n.typeInfo);const o=n;return new Pe(o.value-Math.floor(o.value),n.typeInfo)}Frexp(e,r){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,r){const n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r),c=this.exec.evalExpression(e.args[2],r),d=this.exec.evalExpression(e.args[3],r);if(c.typeInfo.name!=="u32"&&c.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const a=c.value,y=(1<<d.value)-1<<a,S=~y;if(n instanceof ce&&o instanceof ce)return new ce(n.data.map((F,N)=>F&S|o.data[N]<<a&y),n.typeInfo);const E=n.value,M=o.value;return new Pe(E&S|M<<a&y,n.typeInfo)}InverseSqrt(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>1/Math.sqrt(c)),n.typeInfo);const o=n;return new Pe(1/Math.sqrt(o.value),n.typeInfo)}Ldexp(e,r){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce){let c=0;return n.data.forEach(d=>{c+=d*d}),new Pe(Math.sqrt(c),this.getTypeInfo("f32"))}const o=n;return new Pe(Math.abs(o.value),n.typeInfo)}Log(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.log(c)),n.typeInfo);const o=n;return new Pe(Math.log(o.value),n.typeInfo)}Log2(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.log2(c)),n.typeInfo);const o=n;return new Pe(Math.log2(o.value),n.typeInfo)}Max(e,r){const n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r);if(n instanceof ce&&o instanceof ce)return new ce(n.data.map((a,y)=>Math.max(a,o.data[y])),n.typeInfo);const c=n,d=o;return new Pe(Math.max(c.value,d.value),n.typeInfo)}Min(e,r){const n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r);if(n instanceof ce&&o instanceof ce)return new ce(n.data.map((a,y)=>Math.min(a,o.data[y])),n.typeInfo);const c=n,d=o;return new Pe(Math.min(c.value,d.value),n.typeInfo)}Mix(e,r){const n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r),c=this.exec.evalExpression(e.args[2],r);if(n instanceof ce&&o instanceof ce&&c instanceof ce)return new ce(n.data.map((y,S)=>n.data[S]*(1-c.data[S])+o.data[S]*c.data[S]),n.typeInfo);const d=o,a=c;return new Pe(n.value*(1-a.value)+d.value*a.value,n.typeInfo)}Modf(e,r){const n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r);if(n instanceof ce&&o instanceof ce)return new ce(n.data.map((d,a)=>d%o.data[a]),n.typeInfo);const c=o;return new Pe(n.value%c.value,n.typeInfo)}Normalize(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce){const o=this.Length(e,r).value;return new ce(n.data.map(c=>c/o),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,r){const n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r);if(n instanceof ce&&o instanceof ce)return new ce(n.data.map((a,y)=>Math.pow(a,o.data[y])),n.typeInfo);const c=n,d=o;return new Pe(Math.pow(c.value,d.value),n.typeInfo)}QuantizeToF16(e,r){const n=this.exec.evalExpression(e.args[0],r);return n instanceof ce?new ce(n.data.map(o=>o),n.typeInfo):new Pe(n.value,n.typeInfo)}Radians(e,r){const n=this.exec.evalExpression(e.args[0],r);return n instanceof ce?new ce(n.data.map(o=>o*Math.PI/180),n.typeInfo):new Pe(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,r){let n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r);if(n instanceof ce&&o instanceof ce){const c=this._dot(n.data,o.data);return new ce(n.data.map((d,a)=>d-2*c*o.data[a]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,r){let n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r),c=this.exec.evalExpression(e.args[2],r);if(n instanceof ce&&o instanceof ce&&c instanceof Pe){const d=this._dot(o.data,n.data);return new ce(n.data.map((a,y)=>{const S=1-c.value*c.value*(1-d*d);if(S<0)return 0;const E=Math.sqrt(S);return c.value*a-(c.value*d+E)*o.data[y]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,r){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.round(c)),n.typeInfo);const o=n;return new Pe(Math.round(o.value),n.typeInfo)}Saturate(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.min(Math.max(c,0),1)),n.typeInfo);const o=n;return new Pe(Math.min(Math.max(o.value,0),1),n.typeInfo)}Sign(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.sign(c)),n.typeInfo);const o=n;return new Pe(Math.sign(o.value),n.typeInfo)}Sin(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.sin(c)),n.typeInfo);const o=n;return new Pe(Math.sin(o.value),n.typeInfo)}Sinh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.sinh(c)),n.typeInfo);const o=n;return new Pe(Math.sinh(o.value),n.typeInfo)}_smoothstep(e,r,n){const o=Math.min(Math.max((n-e)/(r-e),0),1);return o*o*(3-2*o)}SmoothStep(e,r){const n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r),c=this.exec.evalExpression(e.args[2],r);if(c instanceof ce&&n instanceof ce&&o instanceof ce)return new ce(c.data.map((S,E)=>this._smoothstep(n.data[E],o.data[E],S)),c.typeInfo);const d=n,a=o,y=c;return new Pe(this._smoothstep(d.value,a.value,y.value),c.typeInfo)}Sqrt(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.sqrt(c)),n.typeInfo);const o=n;return new Pe(Math.sqrt(o.value),n.typeInfo)}Step(e,r){const n=this.exec.evalExpression(e.args[0],r),o=this.exec.evalExpression(e.args[1],r);if(o instanceof ce&&n instanceof ce)return new ce(o.data.map((d,a)=>d<n.data[a]?0:1),o.typeInfo);const c=n;return new Pe(o.value<c.value?0:1,c.typeInfo)}Tan(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.tan(c)),n.typeInfo);const o=n;return new Pe(Math.tan(o.value),n.typeInfo)}Tanh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.tanh(c)),n.typeInfo);const o=n;return new Pe(Math.tanh(o.value),n.typeInfo)}_getTransposeType(e){const r=e.getTypeName();return r==="mat2x2f"||r==="mat2x2h"?e:r==="mat2x3f"?this.getTypeInfo("mat3x2f"):r==="mat2x3h"?this.getTypeInfo("mat3x2h"):r==="mat2x4f"?this.getTypeInfo("mat4x2f"):r==="mat2x4h"?this.getTypeInfo("mat4x2h"):r==="mat3x2f"?this.getTypeInfo("mat2x3f"):r==="mat3x2h"?this.getTypeInfo("mat2x3h"):r==="mat3x3f"||r==="mat3x3h"?e:r==="mat3x4f"?this.getTypeInfo("mat4x3f"):r==="mat3x4h"?this.getTypeInfo("mat4x3h"):r==="mat4x2f"?this.getTypeInfo("mat2x4f"):r==="mat4x2h"?this.getTypeInfo("mat2x4h"):r==="mat4x3f"?this.getTypeInfo("mat3x4f"):r==="mat4x3h"?this.getTypeInfo("mat3x4h"):(r==="mat4x4f"||r==="mat4x4h"||console.error(`Invalid matrix type ${r}`),e)}Transpose(e,r){const n=this.exec.evalExpression(e.args[0],r);if(!(n instanceof Xt))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const o=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const c=n.data;return new Xt([c[0],c[2],c[1],c[3]],o)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const c=n.data;return new Xt([c[0],c[3],c[6],c[1],c[4],c[7]],o)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const c=n.data;return new Xt([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13]],o)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const c=n.data;return new Xt([c[0],c[3],c[1],c[4],c[2],c[5]],o)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const c=n.data;return new Xt([c[0],c[3],c[6],c[1],c[4],c[7],c[2],c[5],c[8]],o)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const c=n.data;return new Xt([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13],c[2],c[6],c[10],c[14]],o)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const c=n.data;return new Xt([c[0],c[4],c[1],c[5],c[2],c[6]],o)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const c=n.data;return new Xt([c[0],c[4],c[8],c[1],c[5],c[9],c[2],c[6],c[10]],o)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const c=n.data;return new Xt([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13],c[2],c[6],c[10],c[14],c[3],c[7],c[11],c[15]],o)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof ce)return new ce(n.data.map(c=>Math.trunc(c)),n.typeInfo);const o=n;return new Pe(Math.trunc(o.value),n.typeInfo)}Dpdx(e,r){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,r){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,r){return console.error("TODO: dpdxFine"),null}Dpdy(e,r){return console.error("TODO: dpdy"),null}DpdyCoarse(e,r){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,r){return console.error("TODO: dpdyFine"),null}Fwidth(e,r){return console.error("TODO: fwidth"),null}FwidthCoarse(e,r){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,r){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,r){const n=e.args[0],o=e.args.length>1?this.exec.evalExpression(e.args[1],r).value:0;if(n instanceof Rs){const c=n.name,d=r.getVariableValue(c);if(d instanceof Ca){if(o<0||o>=d.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const a=d.getMipLevelSize(o),y=d.dimension;return y==="1d"?new Pe(a[0],this.getTypeInfo("u32")):y==="3d"?new ce(a,this.getTypeInfo("vec3u")):y==="2d"?new ce(a.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${y} not found. Line ${e.line}`),null)}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,r){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,r){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,r){const n=e.args[0],o=this.exec.evalExpression(e.args[1],r),c=e.args.length>2?this.exec.evalExpression(e.args[2],r).value:0;if(!(o instanceof ce)||o.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof Rs){const d=n.name,a=r.getVariableValue(d);if(a instanceof Ca){const y=Math.floor(o.data[0]),S=Math.floor(o.data[1]);if(y<0||y>=a.width||S<0||S>=a.height)return console.error(`Texture ${d} out of bounds. Line ${e.line}`),null;const E=a.getPixel(y,S,0,c);return E===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new ce(E,this.getTypeInfo("vec4f"))}return console.error(`Texture ${d} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,r){const n=e.args[0];if(n instanceof Rs){const o=n.name,c=r.getVariableValue(o);return c instanceof Ca?new Pe(c.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${o} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,r){const n=e.args[0];if(n instanceof Rs){const o=n.name,c=r.getVariableValue(o);return c instanceof Ca?new Pe(c.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${o} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,r){const n=e.args[0];if(n instanceof Rs){const o=n.name,c=r.getVariableValue(o);return c instanceof Ca?new Pe(c.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${o} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,r){return console.error("TODO: textureSample"),null}TextureSampleBias(e,r){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,r){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,r){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,r){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,r){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,r){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,r){const n=e.args[0],o=this.exec.evalExpression(e.args[1],r),c=e.args.length===4?this.exec.evalExpression(e.args[2],r).value:0,d=e.args.length===4?this.exec.evalExpression(e.args[3],r).data:this.exec.evalExpression(e.args[2],r).data;if(d.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(o instanceof ce)||o.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof Rs){const a=n.name,y=r.getVariableValue(a);if(y instanceof Ca){const S=y.getMipLevelSize(0),E=Math.floor(o.data[0]),M=Math.floor(o.data[1]);return E<0||E>=S[0]||M<0||M>=S[1]?(console.error(`Texture ${a} out of bounds. Line ${e.line}`),null):(y.setPixel(E,M,0,c,Array.from(d)),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,r){let n=e.args[0];n instanceof Xn&&(n=n.right);const o=this.exec.getVariableName(n,r);return r.getVariable(o).value.getSubData(this.exec,n.postfix,r)}AtomicStore(e,r){let n=e.args[0];n instanceof Xn&&(n=n.right);const o=this.exec.getVariableName(n,r),c=r.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,r),y=c.value.getSubData(this.exec,n.postfix,r);return y instanceof Pe&&a instanceof Pe&&(y.value=a.value),c.value instanceof Mn&&c.value.setDataValue(this.exec,y,n.postfix,r),null}AtomicAdd(e,r){let n=e.args[0];n instanceof Xn&&(n=n.right);const o=this.exec.getVariableName(n,r),c=r.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,r),y=c.value.getSubData(this.exec,n.postfix,r),S=new Pe(y.value,y.typeInfo);return y instanceof Pe&&a instanceof Pe&&(y.value+=a.value),c.value instanceof Mn&&c.value.setDataValue(this.exec,y,n.postfix,r),S}AtomicSub(e,r){let n=e.args[0];n instanceof Xn&&(n=n.right);const o=this.exec.getVariableName(n,r),c=r.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,r),y=c.value.getSubData(this.exec,n.postfix,r),S=new Pe(y.value,y.typeInfo);return y instanceof Pe&&a instanceof Pe&&(y.value-=a.value),c.value instanceof Mn&&c.value.setDataValue(this.exec,y,n.postfix,r),S}AtomicMax(e,r){let n=e.args[0];n instanceof Xn&&(n=n.right);const o=this.exec.getVariableName(n,r),c=r.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,r),y=c.value.getSubData(this.exec,n.postfix,r),S=new Pe(y.value,y.typeInfo);return y instanceof Pe&&a instanceof Pe&&(y.value=Math.max(y.value,a.value)),c.value instanceof Mn&&c.value.setDataValue(this.exec,y,n.postfix,r),S}AtomicMin(e,r){let n=e.args[0];n instanceof Xn&&(n=n.right);const o=this.exec.getVariableName(n,r),c=r.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,r),y=c.value.getSubData(this.exec,n.postfix,r),S=new Pe(y.value,y.typeInfo);return y instanceof Pe&&a instanceof Pe&&(y.value=Math.min(y.value,a.value)),c.value instanceof Mn&&c.value.setDataValue(this.exec,y,n.postfix,r),S}AtomicAnd(e,r){let n=e.args[0];n instanceof Xn&&(n=n.right);const o=this.exec.getVariableName(n,r),c=r.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,r),y=c.value.getSubData(this.exec,n.postfix,r),S=new Pe(y.value,y.typeInfo);return y instanceof Pe&&a instanceof Pe&&(y.value=y.value&a.value),c.value instanceof Mn&&c.value.setDataValue(this.exec,y,n.postfix,r),S}AtomicOr(e,r){let n=e.args[0];n instanceof Xn&&(n=n.right);const o=this.exec.getVariableName(n,r),c=r.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,r),y=c.value.getSubData(this.exec,n.postfix,r),S=new Pe(y.value,y.typeInfo);return y instanceof Pe&&a instanceof Pe&&(y.value=y.value|a.value),c.value instanceof Mn&&c.value.setDataValue(this.exec,y,n.postfix,r),S}AtomicXor(e,r){let n=e.args[0];n instanceof Xn&&(n=n.right);const o=this.exec.getVariableName(n,r),c=r.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,r),y=c.value.getSubData(this.exec,n.postfix,r),S=new Pe(y.value,y.typeInfo);return y instanceof Pe&&a instanceof Pe&&(y.value=y.value^a.value),c.value instanceof Mn&&c.value.setDataValue(this.exec,y,n.postfix,r),S}AtomicExchange(e,r){let n=e.args[0];n instanceof Xn&&(n=n.right);const o=this.exec.getVariableName(n,r),c=r.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,r),y=c.value.getSubData(this.exec,n.postfix,r),S=new Pe(y.value,y.typeInfo);return y instanceof Pe&&a instanceof Pe&&(y.value=a.value),c.value instanceof Mn&&c.value.setDataValue(this.exec,y,n.postfix,r),S}AtomicCompareExchangeWeak(e,r){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,r){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,r){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,r){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,r){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,r){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,r){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,r){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,r){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,r){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,r){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,r){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,r){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,r){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,r){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,r){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,r){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,r){return null}TextureBarrier(e,r){return null}WorkgroupBarrier(e,r){return null}WorkgroupUniformLoad(e,r){return null}SubgroupAdd(e,r){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,r){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,r){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,r){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,r){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,r){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,r){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,r){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,r){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,r){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,r){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,r){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,r){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,r){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,r){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,r){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,r){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,r){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,r){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,r){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,r){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,r){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,r){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,r){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,r){return console.error("TODO: quadSwapY"),null}}const S0={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Yi={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Li extends ZL{constructor(e,r){var n;super(),this.ast=e??[],this.reflection=new Go,this.reflection.updateAST(this.ast),this.context=(n=r==null?void 0:r.clone())!==null&&n!==void 0?n:new H1,this.builtins=new qL(this),this.typeInfo={bool:this.getTypeInfo(Ge.bool),i32:this.getTypeInfo(Ge.i32),u32:this.getTypeInfo(Ge.u32),f32:this.getTypeInfo(Ge.f32),f16:this.getTypeInfo(Ge.f16),vec2f:this.getTypeInfo(Re.vec2f),vec2u:this.getTypeInfo(Re.vec2u),vec2i:this.getTypeInfo(Re.vec2i),vec2h:this.getTypeInfo(Re.vec2h),vec3f:this.getTypeInfo(Re.vec3f),vec3u:this.getTypeInfo(Re.vec3u),vec3i:this.getTypeInfo(Re.vec3i),vec3h:this.getTypeInfo(Re.vec3h),vec4f:this.getTypeInfo(Re.vec4f),vec4u:this.getTypeInfo(Re.vec4u),vec4i:this.getTypeInfo(Re.vec4i),vec4h:this.getTypeInfo(Re.vec4h),mat2x2f:this.getTypeInfo(Re.mat2x2f),mat2x3f:this.getTypeInfo(Re.mat2x3f),mat2x4f:this.getTypeInfo(Re.mat2x4f),mat3x2f:this.getTypeInfo(Re.mat3x2f),mat3x3f:this.getTypeInfo(Re.mat3x3f),mat3x4f:this.getTypeInfo(Re.mat3x4f),mat4x2f:this.getTypeInfo(Re.mat4x2f),mat4x3f:this.getTypeInfo(Re.mat4x3f),mat4x4f:this.getTypeInfo(Re.mat4x4f)}}getVariableValue(e){var r,n;const o=(n=(r=this.context.getVariable(e))===null||r===void 0?void 0:r.value)!==null&&n!==void 0?n:null;if(o===null)return null;if(o instanceof Pe)return o.value;if(o instanceof ce||o instanceof Xt)return Array.from(o.data);if(o instanceof Mn&&o.typeInfo instanceof Vl){if(o.typeInfo.format.name==="u32")return Array.from(new Uint32Array(o.buffer,o.offset,o.typeInfo.count));if(o.typeInfo.format.name==="i32")return Array.from(new Int32Array(o.buffer,o.offset,o.typeInfo.count));if(o.typeInfo.format.name==="f32")return Array.from(new Float32Array(o.buffer,o.offset,o.typeInfo.count))}return console.error(`Unsupported return variable type ${o.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,r,n,o){const c=this.context.clone();(o=o??{}).constants&&this._setOverrides(o.constants,c),this._execStatements(this.ast,c);const d=c.getFunction(e);if(!d)return void console.error(`Function ${e} not found`);if(typeof r=="number")r=[r,1,1];else{if(r.length===0)return void console.error("Invalid dispatch count");r.length===1?r=[r[0],1,1]:r.length===2?r=[r[0],r[1],1]:r.length>3&&(r=[r[0],r[1],r[2]])}const a=r[0],y=r[1],S=r[2],E=this.getTypeInfo("vec3u");c.setVariable("@num_workgroups",new ce(r,E));const M=this.reflection.getFunctionInfo(e);M===null&&console.error(`Function ${e} not found in reflection data`);for(const F in n)for(const N in n[F]){const G=n[F][N];c.variables.forEach(re=>{var me;const Y=re.node;if(Y!=null&&Y.attributes){let q=null,Z=null;for(const le of Y.attributes)le.name==="binding"?q=le.value:le.name==="group"&&(Z=le.value);if(N==q&&F==Z){let le=!1;for(const Ae of M.resources)if(Ae.name===re.name&&Ae.group===parseInt(F)&&Ae.binding===parseInt(N)){le=!0;break}if(le)if(G.texture!==void 0&&G.descriptor!==void 0){const Ae=new Ca(G.texture,this.getTypeInfo(Y.type),G.descriptor,(me=G.texture.view)!==null&&me!==void 0?me:null);re.value=Ae}else G.uniform!==void 0?re.value=new Mn(G.uniform,this.getTypeInfo(Y.type)):re.value=new Mn(G,this.getTypeInfo(Y.type))}}})}for(let F=0;F<S;++F)for(let N=0;N<y;++N)for(let G=0;G<a;++G)c.setVariable("@workgroup_id",new ce([G,N,F],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(d,[G,N,F],c)}execStatement(e,r){if(e instanceof bP)return this.evalExpression(e.value,r);if(e instanceof TP){if(e.condition){const n=this.evalExpression(e.condition,r);if(!(n instanceof Pe))throw new Error("Invalid break-if condition");if(!n.value)return null}return Li._breakObj}if(e instanceof SP)return Li._continueObj;if(e instanceof Zf)this._let(e,r);else if(e instanceof Ma)this._var(e,r);else if(e instanceof zm)this._const(e,r);else if(e instanceof _p)this._function(e,r);else{if(e instanceof xP)return this._if(e,r);if(e instanceof vP)return this._switch(e,r);if(e instanceof gP)return this._for(e,r);if(e instanceof pP)return this._while(e,r);if(e instanceof yP)return this._loop(e,r);if(e instanceof ob){const n=r.clone();return n.currentFunctionName=r.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof _P)this._assign(e,r);else if(e instanceof mP)this._increment(e,r);else{if(e instanceof Pa)return null;if(e instanceof z1){const n=e.name;r.getVariable(n)===null&&r.setVariable(n,new Pe(0,this.getTypeInfo("u32")))}else if(e instanceof B1)this._call(e,r);else{if(e instanceof wP||e instanceof U1)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,r){return e instanceof yo?this._evalBinaryOp(e,r):e instanceof Jn?this._evalLiteral(e,r):e instanceof Rs?this._evalVariable(e,r):e instanceof V1?this._evalCall(e,r):e instanceof Zo?this._evalCreate(e,r):e instanceof EP?this._evalConst(e,r):e instanceof AP?this._evalBitcast(e,r):e instanceof Xn?this._evalUnaryOp(e,r):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var r;if(e instanceof Ge){const o=this.reflection.getTypeInfo(e);if(o!==null)return o}let n=(r=this.typeInfo[e])!==null&&r!==void 0?r:null;return n!==null||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,r){for(const n in e){const o=e[n],c=this.reflection.getOverrideInfo(n);c!==null?(c.type===null&&(c.type=this.getTypeInfo("u32")),c.type.name==="u32"||c.type.name==="i32"||c.type.name==="f32"||c.type.name==="f16"?r.setVariable(n,new Pe(o,c.type)):c.type.name==="bool"?r.setVariable(n,new Pe(o?1:0,c.type)):c.type.name==="vec2"||c.type.name==="vec3"||c.type.name==="vec4"||c.type.name==="vec2f"||c.type.name==="vec3f"||c.type.name==="vec4f"||c.type.name==="vec2i"||c.type.name==="vec3i"||c.type.name==="vec4i"||c.type.name==="vec2u"||c.type.name==="vec3u"||c.type.name==="vec4u"||c.type.name==="vec2h"||c.type.name==="vec3h"||c.type.name==="vec4h"?r.setVariable(n,new ce(o,c.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,r,n){const o=[1,1,1];for(const E of e.node.attributes)if(E.name==="workgroup_size"){if(E.value.length>0){const M=n.getVariableValue(E.value[0]);o[0]=M instanceof Pe?M.value:parseInt(E.value[0])}if(E.value.length>1){const M=n.getVariableValue(E.value[1]);o[1]=M instanceof Pe?M.value:parseInt(E.value[1])}if(E.value.length>2){const M=n.getVariableValue(E.value[2]);o[2]=M instanceof Pe?M.value:parseInt(E.value[2])}}const c=this.getTypeInfo("vec3u"),d=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new ce(o,c));const a=o[0],y=o[1],S=o[2];for(let E=0,M=0;E<S;++E)for(let F=0;F<y;++F)for(let N=0;N<a;++N,++M){const G=[N,F,E],re=[N+r[0]*o[0],F+r[1]*o[1],E+r[2]*o[2]];n.setVariable("@local_invocation_id",new ce(G,c)),n.setVariable("@global_invocation_id",new ce(re,c)),n.setVariable("@local_invocation_index",new Pe(M,d)),this._dispatchExec(e,n)}}_dispatchExec(e,r){for(const n of e.node.args)for(const o of n.attributes)if(o.name==="builtin"){const c=`@${o.value}`,d=r.getVariable(c);d!==void 0&&r.variables.set(n.name,d)}this._execStatements(e.node.body,r)}getVariableName(e,r){for(;e instanceof Xn;)e=e.right;return e instanceof Rs?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,r){for(const n of e){if(n instanceof Array){const c=r.clone(),d=this._execStatements(n,c);if(d)return d;continue}const o=this.execStatement(n,r);if(o)return o}return null}_call(e,r){const n=r.clone();n.currentFunctionName=e.name;const o=r.getFunction(e.name);if(o){for(let c=0;c<o.node.args.length;++c){const d=o.node.args[c],a=this.evalExpression(e.args[c],n);n.setVariable(d.name,a,d)}this._execStatements(o.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,r)}_increment(e,r){const n=this.getVariableName(e.variable,r),o=r.getVariable(n);o?e.operator==="++"?o.value instanceof Pe?o.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):e.operator==="--"?o.value instanceof Pe?o.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_getVariableData(e,r){if(e instanceof Rs){const n=this.getVariableName(e,r),o=r.getVariable(n);return o===null?(console.error(`Variable ${n} not found. Line ${e.line}`),null):o.value.getSubData(this,e.postfix,r)}if(e instanceof Xn){if(e.operator==="*"){const n=this._getVariableData(e.right,r);return n instanceof dh?n.reference.getSubData(this,e.postfix,r):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const n=this._getVariableData(e.right,r);return new dh(n)}}return null}_assign(e,r){let n=null,o="<var>",c=null;if(e.variable instanceof Xn){const y=this._getVariableData(e.variable,r),S=this.evalExpression(e.value,r),E=e.operator;if(E==="="){if(y instanceof Pe||y instanceof ce||y instanceof Xt){if(S instanceof Pe||S instanceof ce||S instanceof Xt&&y.data.length===S.data.length)return void y.data.set(S.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(y instanceof Mn&&S instanceof Mn&&y.buffer.byteLength-y.offset>=S.buffer.byteLength-S.offset)return void(y.buffer.byteLength%4==0?new Uint32Array(y.buffer,y.offset,y.typeInfo.size/4).set(new Uint32Array(S.buffer,S.offset,S.typeInfo.size/4)):new Uint8Array(y.buffer,y.offset,y.typeInfo.size).set(new Uint8Array(S.buffer,S.offset,S.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(E==="+=")return y instanceof Pe||y instanceof ce||y instanceof Xt?S instanceof Pe||S instanceof ce||S instanceof Xt?void y.data.set(S.data.map((M,F)=>y.data[F]+M)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(E==="-=")return(y instanceof Pe||y instanceof ce||y instanceof Xt)&&(S instanceof Pe||S instanceof ce||S instanceof Xt)?void y.data.set(S.data.map((M,F)=>y.data[F]-M)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Xn){if(e.variable.operator==="*"){o=this.getVariableName(e.variable.right,r);const y=r.getVariable(o);if(!(y&&y.value instanceof dh))return void console.error(`Variable ${o} is not a pointer. Line ${e.line}`);n=y.value.reference;let S=e.variable.postfix;if(!S){let E=e.variable.right;for(;E instanceof Xn;){if(E.postfix){S=E.postfix;break}E=E.right}}S&&(n=n.getSubData(this,S,r))}}else{c=e.variable.postfix,o=this.getVariableName(e.variable,r);const y=r.getVariable(o);if(y===null)return void console.error(`Variable ${o} not found. Line ${e.line}`);n=y.value}if(n instanceof dh&&(n=n.reference),n===null)return void console.error(`Variable ${o} not found. Line ${e.line}`);const d=this.evalExpression(e.value,r),a=e.operator;if(a!=="="){const y=n.getSubData(this,c,r);if(y instanceof ce&&d instanceof Pe){const S=y.data,E=d.value;if(a==="+=")for(let M=0;M<S.length;++M)S[M]+=E;else if(a==="-=")for(let M=0;M<S.length;++M)S[M]-=E;else if(a==="*=")for(let M=0;M<S.length;++M)S[M]*=E;else if(a==="/=")for(let M=0;M<S.length;++M)S[M]/=E;else if(a==="%=")for(let M=0;M<S.length;++M)S[M]%=E;else if(a==="&=")for(let M=0;M<S.length;++M)S[M]&=E;else if(a==="|=")for(let M=0;M<S.length;++M)S[M]|=E;else if(a==="^=")for(let M=0;M<S.length;++M)S[M]^=E;else if(a==="<<=")for(let M=0;M<S.length;++M)S[M]<<=E;else if(a===">>=")for(let M=0;M<S.length;++M)S[M]>>=E;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(y instanceof ce&&d instanceof ce){const S=y.data,E=d.data;if(S.length!==E.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(a==="+=")for(let M=0;M<S.length;++M)S[M]+=E[M];else if(a==="-=")for(let M=0;M<S.length;++M)S[M]-=E[M];else if(a==="*=")for(let M=0;M<S.length;++M)S[M]*=E[M];else if(a==="/=")for(let M=0;M<S.length;++M)S[M]/=E[M];else if(a==="%=")for(let M=0;M<S.length;++M)S[M]%=E[M];else if(a==="&=")for(let M=0;M<S.length;++M)S[M]&=E[M];else if(a==="|=")for(let M=0;M<S.length;++M)S[M]|=E[M];else if(a==="^=")for(let M=0;M<S.length;++M)S[M]^=E[M];else if(a==="<<=")for(let M=0;M<S.length;++M)S[M]<<=E[M];else if(a===">>=")for(let M=0;M<S.length;++M)S[M]>>=E[M];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(y instanceof Pe&&d instanceof Pe))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);a==="+="?y.value+=d.value:a==="-="?y.value-=d.value:a==="*="?y.value*=d.value:a==="/="?y.value/=d.value:a==="%="?y.value%=d.value:a==="&="?y.value&=d.value:a==="|="?y.value|=d.value:a==="^="?y.value^=d.value:a==="<<="?y.value<<=d.value:a===">>="?y.value>>=d.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}return void(n instanceof Mn&&n.setDataValue(this,y,c,r))}if(n instanceof Mn)n.setDataValue(this,d,c,r);else if(c){if(!(n instanceof ce||n instanceof Xt))return void console.error(`Variable ${o} is not a vector or matrix. Line ${e.line}`);if(c instanceof Kh){const y=this.evalExpression(c.index,r).value;if(n instanceof ce){if(!(d instanceof Pe))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);n.data[y]=d.value}else{if(!(n instanceof Xt))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);{const S=this.evalExpression(c.index,r).value;if(S<0)return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);if(!(d instanceof ce))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);{const E=n.typeInfo.getTypeName();if(E==="mat2x2"||E==="mat2x2f"||E==="mat2x2h"){if(!(S<2&&d.data.length===2))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);n.data[2*S]=d.data[0],n.data[2*S+1]=d.data[1]}else if(E==="mat2x3"||E==="mat2x3f"||E==="mat2x3h"){if(!(S<2&&d.data.length===3))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);n.data[3*S]=d.data[0],n.data[3*S+1]=d.data[1],n.data[3*S+2]=d.data[2]}else if(E==="mat2x4"||E==="mat2x4f"||E==="mat2x4h"){if(!(S<2&&d.data.length===4))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);n.data[4*S]=d.data[0],n.data[4*S+1]=d.data[1],n.data[4*S+2]=d.data[2],n.data[4*S+3]=d.data[3]}else if(E==="mat3x2"||E==="mat3x2f"||E==="mat3x2h"){if(!(S<3&&d.data.length===2))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);n.data[2*S]=d.data[0],n.data[2*S+1]=d.data[1]}else if(E==="mat3x3"||E==="mat3x3f"||E==="mat3x3h"){if(!(S<3&&d.data.length===3))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);n.data[3*S]=d.data[0],n.data[3*S+1]=d.data[1],n.data[3*S+2]=d.data[2]}else if(E==="mat3x4"||E==="mat3x4f"||E==="mat3x4h"){if(!(S<3&&d.data.length===4))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);n.data[4*S]=d.data[0],n.data[4*S+1]=d.data[1],n.data[4*S+2]=d.data[2],n.data[4*S+3]=d.data[3]}else if(E==="mat4x2"||E==="mat4x2f"||E==="mat4x2h"){if(!(S<4&&d.data.length===2))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);n.data[2*S]=d.data[0],n.data[2*S+1]=d.data[1]}else if(E==="mat4x3"||E==="mat4x3f"||E==="mat4x3h"){if(!(S<4&&d.data.length===3))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);n.data[3*S]=d.data[0],n.data[3*S+1]=d.data[1],n.data[3*S+2]=d.data[2]}else{if(E!=="mat4x4"&&E!=="mat4x4f"&&E!=="mat4x4h")return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);if(!(S<4&&d.data.length===4))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);n.data[4*S]=d.data[0],n.data[4*S+1]=d.data[1],n.data[4*S+2]=d.data[2],n.data[4*S+3]=d.data[3]}}}}}else if(c instanceof tu){const y=c.value;if(!(n instanceof ce))return void console.error(`Invalid assignment to ${y}. Variable ${o} is not a vector. Line ${e.line}`);if(d instanceof Pe){if(y.length>1)return void console.error(`Invalid assignment to ${y} for variable ${o}. Line ${e.line}`);if(y==="x")n.data[0]=d.value;else if(y==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${y} for variable ${o}. Line ${e.line}`);n.data[1]=d.value}else if(y==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${y} for variable ${o}. Line ${e.line}`);n.data[2]=d.value}else if(y==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${y} for variable ${o}. Line ${e.line}`);n.data[3]=d.value}}else{if(!(d instanceof ce))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);if(y.length!==d.data.length)return void console.error(`Invalid assignment to ${y} for variable ${o}. Line ${e.line}`);for(let S=0;S<y.length;++S){const E=y[S];if(E==="x"||E==="r")n.data[0]=d.data[S];else if(E==="y"||E==="g"){if(d.data.length<2)return void console.error(`Invalid assignment to ${E} for variable ${o}. Line ${e.line}`);n.data[1]=d.data[S]}else if(E==="z"||E==="b"){if(d.data.length<3)return void console.error(`Invalid assignment to ${E} for variable ${o}. Line ${e.line}`);n.data[2]=d.data[S]}else{if(E!=="w"&&E!=="a")return void console.error(`Invalid assignment to ${E} for variable ${o}. Line ${e.line}`);if(d.data.length<4)return void console.error(`Invalid assignment to ${E} for variable ${o}. Line ${e.line}`);n.data[3]=d.data[S]}}}}}else n instanceof Pe&&d instanceof Pe?n.value=d.value:n instanceof ce&&d instanceof ce||n instanceof Xt&&d instanceof Xt?n.data.set(d.data):console.error(`Invalid assignment to ${o}. Line ${e.line}`)}_function(e,r){const n=new W1(e);r.functions.set(e.name,n)}_const(e,r){let n=null;e.value!==null&&(n=this.evalExpression(e.value,r)),r.createVariable(e.name,n,e)}_let(e,r){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,r),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Xn||(n=n.clone())}else{const o=e.type.name;if(o==="f32"||o==="i32"||o==="u32"||o==="bool"||o==="f16"||o==="vec2"||o==="vec3"||o==="vec4"||o==="vec2f"||o==="vec3f"||o==="vec4f"||o==="vec2i"||o==="vec3i"||o==="vec4i"||o==="vec2u"||o==="vec3u"||o==="vec4u"||o==="vec2h"||o==="vec3h"||o==="vec4h"||o==="vec2b"||o==="vec3b"||o==="vec4b"||o==="mat2x2"||o==="mat2x3"||o==="mat2x4"||o==="mat3x2"||o==="mat3x3"||o==="mat3x4"||o==="mat4x2"||o==="mat4x3"||o==="mat4x4"||o==="mat2x2f"||o==="mat2x3f"||o==="mat2x4f"||o==="mat3x2f"||o==="mat3x3f"||o==="mat3x4f"||o==="mat4x2f"||o==="mat4x3f"||o==="mat4x4f"||o==="mat2x2h"||o==="mat2x3h"||o==="mat2x4h"||o==="mat3x2h"||o==="mat3x3h"||o==="mat3x4h"||o==="mat4x2h"||o==="mat4x3h"||o==="mat4x4h"||o==="array"){const c=new Zo(e.type,[]);n=this._evalCreate(c,r)}}r.createVariable(e.name,n,e)}_var(e,r){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,r),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Xn||(n=n.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const o=e.type.name;if(o==="f32"||o==="i32"||o==="u32"||o==="bool"||o==="f16"||o==="vec2"||o==="vec3"||o==="vec4"||o==="vec2f"||o==="vec3f"||o==="vec4f"||o==="vec2i"||o==="vec3i"||o==="vec4i"||o==="vec2u"||o==="vec3u"||o==="vec4u"||o==="vec2h"||o==="vec3h"||o==="vec4h"||o==="vec2b"||o==="vec3b"||o==="vec4b"||o==="mat2x2"||o==="mat2x3"||o==="mat2x4"||o==="mat3x2"||o==="mat3x3"||o==="mat3x4"||o==="mat4x2"||o==="mat4x3"||o==="mat4x4"||o==="mat2x2f"||o==="mat2x3f"||o==="mat2x4f"||o==="mat3x2f"||o==="mat3x3f"||o==="mat3x4f"||o==="mat4x2f"||o==="mat4x3f"||o==="mat4x4f"||o==="mat2x2h"||o==="mat2x3h"||o==="mat2x4h"||o==="mat3x2h"||o==="mat3x3h"||o==="mat3x4h"||o==="mat4x2h"||o==="mat4x3h"||o==="mat4x4h"||e.type instanceof qf||e.type instanceof Pa||e.type instanceof Re){const c=new Zo(e.type,[]);n=this._evalCreate(c,r)}}r.createVariable(e.name,n,e)}_switch(e,r){r=r.clone();const n=this.evalExpression(e.condition,r);if(!(n instanceof Pe))return console.error(`Invalid if condition. Line ${e.line}`),null;let o=null;for(const c of e.cases)if(c instanceof CP)for(const d of c.selectors){if(d instanceof Um){o=c;continue}const a=this.evalExpression(d,r);if(!(a instanceof Pe))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===n.value)return this._execStatements(c.body,r)}else c instanceof MP&&(o=c);return o?this._execStatements(o.body,r):null}_if(e,r){r=r.clone();const n=this.evalExpression(e.condition,r);if(!(n instanceof Pe))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,r);for(const o of e.elseif){const c=this.evalExpression(o.condition,r);if(!(c instanceof Pe))return console.error(`Invalid if condition. Line ${e.line}`),null;if(c.value)return this._execStatements(o.body,r)}return e.else?this._execStatements(e.else,r):null}_getScalarValue(e){return e instanceof Pe?e.value:(console.error("Expected scalar value.",e),0)}_for(e,r){for(r=r.clone(),this.execStatement(e.init,r);this._getScalarValue(this.evalExpression(e.condition,r));){const n=this._execStatements(e.body,r);if(n===Li._breakObj)break;if(n!==null&&n!==Li._continueObj)return n;this.execStatement(e.increment,r)}return null}_loop(e,r){for(r=r.clone();;){const n=this._execStatements(e.body,r);if(n===Li._breakObj)break;if(n===Li._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,r)===Li._breakObj)break}else if(n!==null)return n}return null}_while(e,r){for(r=r.clone();this._getScalarValue(this.evalExpression(e.condition,r));){const n=this._execStatements(e.body,r);if(n===Li._breakObj)break;if(n!==Li._continueObj&&n!==null)return n}return null}_evalBitcast(e,r){const n=this.evalExpression(e.value,r),o=e.type;if(n instanceof Pe){const c=US(n.value,n.typeInfo.name,o.name);return new Pe(c,this.getTypeInfo(o))}if(n instanceof ce){const c=n.typeInfo.getTypeName();let d="";if(c.endsWith("f"))d="f32";else if(c.endsWith("i"))d="i32";else if(c.endsWith("u"))d="u32";else if(c.endsWith("b"))d="bool";else{if(!c.endsWith("h"))return console.error(`Unknown vector type ${c}. Line ${e.line}`),null;d="f16"}const a=o.getTypeName();let y="";if(a.endsWith("f"))y="f32";else if(a.endsWith("i"))y="i32";else if(a.endsWith("u"))y="u32";else if(a.endsWith("b"))y="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${y}. Line ${e.line}`),null;y="f16"}const S=function(E,M,F){if(M===F)return E;const N=new Array(E.length);for(let G=0;G<E.length;G++)N[G]=US(E[G],M,F);return N}(Array.from(n.data),d,y);return new ce(S,this.getTypeInfo(o))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,r){return r.getVariableValue(e.name).clone().getSubData(this,e.postfix,r)}_evalCreate(e,r){var n;if(e instanceof Zo){if(e.type===null)return ab.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,r);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,r);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,r)}}const o=e instanceof Zo?e.type.name:e.name,c=e instanceof Zo?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(c===null)return console.error(`Unknown type ${o}. Line ${e.line}`),null;if(c.size===0)return null;const d=new Mn(new ArrayBuffer(c.size),c,0);if(c instanceof Cl){if(e.args)for(let a=0;a<e.args.length;++a){const y=c.members[a],S=e.args[a],E=this.evalExpression(S,r);d.setData(this,E,y.type,y.offset,r)}}else if(c instanceof Vl){let a=0;if(e.args)for(let y=0;y<e.args.length;++y){const S=e.args[y],E=this.evalExpression(S,r);c.format===null&&(((n=E.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?c.format=this.getTypeInfo("i32"):c.format=E.typeInfo),d.setData(this,E,c.format,a,r),a+=c.stride}}else console.error(`Unknown type "${o}". Line ${e.line}`);return e instanceof Zo?d.getSubData(this,e.postfix,r):d}_evalLiteral(e,r){const n=this.getTypeInfo(e.type),o=n.name;return o==="x32"||o==="u32"||o==="f32"||o==="f16"||o==="i32"||o==="bool"?new Pe(e.scalarValue,n):o==="vec2"||o==="vec3"||o==="vec4"||o==="vec2f"||o==="vec3f"||o==="vec4f"||o==="vec2h"||o==="vec3h"||o==="vec4h"||o==="vec2i"||o==="vec3i"||o==="vec4i"||o==="vec2u"||o==="vec3u"||o==="vec4u"?this._callConstructorVec(e,r):o==="mat2x2"||o==="mat2x3"||o==="mat2x4"||o==="mat3x2"||o==="mat3x3"||o==="mat3x4"||o==="mat4x2"||o==="mat4x3"||o==="mat4x4"||o==="mat2x2f"||o==="mat2x3f"||o==="mat2x4f"||o==="mat3x2f"||o==="mat3x3f"||o==="mat3x4f"||o==="mat4x2f"||o==="mat4x3f"||o==="mat4x4f"||o==="mat2x2h"||o==="mat2x3h"||o==="mat2x4h"||o==="mat3x2h"||o==="mat3x3h"||o==="mat3x4h"||o==="mat4x2h"||o==="mat4x3h"||o==="mat4x4h"?this._callConstructorMatrix(e,r):e.value}_evalVariable(e,r){const n=r.getVariableValue(e.name);return n===null?n:n.getSubData(this,e.postfix,r)}_maxFormatTypeInfo(e){let r=e[0];if(r.name==="f32")return r;for(let n=1;n<e.length;++n){const o=Li._priority.get(r.name);Li._priority.get(e[n].name)<o&&(r=e[n])}return r.name==="x32"?this.getTypeInfo("i32"):r}_evalUnaryOp(e,r){const n=this.evalExpression(e.right,r);if(e.operator==="&")return new dh(n);if(e.operator==="*")return n instanceof dh?n.reference.getSubData(this,e.postfix,r):(console.error(`Invalid dereference. Line ${e.line}`),null);const o=n instanceof Pe?n.value:n instanceof ce?Array.from(n.data):null;switch(e.operator){case"+":{if(vt(o)){const a=o.map((y,S)=>+y);return new ce(a,n.typeInfo)}const c=o,d=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Pe(+c,d)}case"-":{if(vt(o)){const a=o.map((y,S)=>-y);return new ce(a,n.typeInfo)}const c=o,d=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Pe(-c,d)}case"!":{if(vt(o)){const a=o.map((y,S)=>y?0:1);return new ce(a,n.typeInfo)}const c=o,d=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Pe(c?0:1,d)}case"~":{if(vt(o)){const a=o.map((y,S)=>~y);return new ce(a,n.typeInfo)}const c=o,d=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Pe(~c,d)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,r){const n=this.evalExpression(e.left,r),o=this.evalExpression(e.right,r),c=n instanceof Pe?n.value:n instanceof ce||n instanceof Xt?Array.from(n.data):null,d=o instanceof Pe?o.value:o instanceof ce||o instanceof Xt?Array.from(o.data):null;switch(e.operator){case"+":{if(vt(c)&&vt(d)){const E=c,M=d;if(E.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map((N,G)=>N+M[G]);return new ce(F,n.typeInfo)}if(vt(c)){const E=d,M=c.map((F,N)=>F+E);return new ce(M,n.typeInfo)}if(vt(d)){const E=c,M=d.map((F,N)=>E+F);return new ce(M,o.typeInfo)}const a=c,y=d,S=this._maxFormatTypeInfo([n.typeInfo,o.typeInfo]);return new Pe(a+y,S)}case"-":{if(vt(c)&&vt(d)){const E=c,M=d;if(E.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map((N,G)=>N-M[G]);return new ce(F,n.typeInfo)}if(vt(c)){const E=d,M=c.map((F,N)=>F-E);return new ce(M,n.typeInfo)}if(vt(d)){const E=c,M=d.map((F,N)=>E-F);return new ce(M,o.typeInfo)}const a=c,y=d,S=this._maxFormatTypeInfo([n.typeInfo,o.typeInfo]);return new Pe(a-y,S)}case"*":{if(vt(c)&&vt(d)){const E=c,M=d;if(n instanceof Xt&&o instanceof Xt){const F=function(me,Y,q,Z){if(Yi[Y.name]===void 0||Yi[Z.name]===void 0)return null;const le=Yi[Y.name][0],Ae=Yi[Y.name][1],we=Yi[Z.name][0];if(le!==Yi[Z.name][1])return null;const je=new Array(we*Ae);for(let Ue=0;Ue<Ae;Ue++)for(let Ze=0;Ze<we;Ze++){let qe=0;for(let Ke=0;Ke<le;Ke++)qe+=me[Ke*Ae+Ue]*q[Ze*le+Ke];je[Ue*we+Ze]=qe}return je}(E,n.typeInfo,M,o.typeInfo);if(F===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const N=Yi[o.typeInfo.name][0],G=Yi[n.typeInfo.name][1],re=this.getTypeInfo(`mat${N}x${G}f`);return new Xt(F,re)}if(n instanceof Xt&&o instanceof ce){const F=function(N,G,re,me){if(Yi[G.name]===void 0||S0[me.name]===void 0)return null;const Y=Yi[G.name][0],q=Yi[G.name][1];if(Y!==re.length)return null;const Z=new Array(q);for(let le=0;le<q;le++){let Ae=0;for(let we=0;we<Y;we++)Ae+=N[we*q+le]*re[we];Z[le]=Ae}return Z}(E,n.typeInfo,M,o.typeInfo);return F===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new ce(F,o.typeInfo)}if(n instanceof ce&&o instanceof Xt){const F=function(N,G,re,me){if(S0[G.name]===void 0||Yi[me.name]===void 0)return null;const Y=Yi[me.name][0],q=Yi[me.name][1];if(q!==N.length)return null;const Z=[];for(let le=0;le<Y;le++){let Ae=0;for(let we=0;we<q;we++)Ae+=N[we]*re[we*Y+le];Z[le]=Ae}return Z}(E,n.typeInfo,M,o.typeInfo);return F===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new ce(F,n.typeInfo)}{if(E.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map((N,G)=>N*M[G]);return new ce(F,n.typeInfo)}}if(vt(c)){const E=d,M=c.map((F,N)=>F*E);return n instanceof Xt?new Xt(M,n.typeInfo):new ce(M,n.typeInfo)}if(vt(d)){const E=c,M=d.map((F,N)=>E*F);return o instanceof Xt?new Xt(M,o.typeInfo):new ce(M,o.typeInfo)}const a=c,y=d,S=this._maxFormatTypeInfo([n.typeInfo,o.typeInfo]);return new Pe(a*y,S)}case"%":{if(vt(c)&&vt(d)){const E=c,M=d;if(E.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map((N,G)=>N%M[G]);return new ce(F,n.typeInfo)}if(vt(c)){const E=d,M=c.map((F,N)=>F%E);return new ce(M,n.typeInfo)}if(vt(d)){const E=c,M=d.map((F,N)=>E%F);return new ce(M,o.typeInfo)}const a=c,y=d,S=this._maxFormatTypeInfo([n.typeInfo,o.typeInfo]);return new Pe(a%y,S)}case"/":{if(vt(c)&&vt(d)){const E=c,M=d;if(E.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map((N,G)=>N/M[G]);return new ce(F,n.typeInfo)}if(vt(c)){const E=d,M=c.map((F,N)=>F/E);return new ce(M,n.typeInfo)}if(vt(d)){const E=c,M=d.map((F,N)=>E/F);return new ce(M,o.typeInfo)}const a=c,y=d,S=this._maxFormatTypeInfo([n.typeInfo,o.typeInfo]);return new Pe(a/y,S)}case"&":{if(vt(c)&&vt(d)){const E=c,M=d;if(E.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map((N,G)=>N&M[G]);return new ce(F,n.typeInfo)}if(vt(c)){const E=d,M=c.map((F,N)=>F&E);return new ce(M,n.typeInfo)}if(vt(d)){const E=c,M=d.map((F,N)=>E&F);return new ce(M,o.typeInfo)}const a=c,y=d,S=this._maxFormatTypeInfo([n.typeInfo,o.typeInfo]);return new Pe(a&y,S)}case"|":{if(vt(c)&&vt(d)){const E=c,M=d;if(E.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map((N,G)=>N|M[G]);return new ce(F,n.typeInfo)}if(vt(c)){const E=d,M=c.map((F,N)=>F|E);return new ce(M,n.typeInfo)}if(vt(d)){const E=c,M=d.map((F,N)=>E|F);return new ce(M,o.typeInfo)}const a=c,y=d,S=this._maxFormatTypeInfo([n.typeInfo,o.typeInfo]);return new Pe(a|y,S)}case"^":{if(vt(c)&&vt(d)){const E=c,M=d;if(E.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map((N,G)=>N^M[G]);return new ce(F,n.typeInfo)}if(vt(c)){const E=d,M=c.map((F,N)=>F^E);return new ce(M,n.typeInfo)}if(vt(d)){const E=c,M=d.map((F,N)=>E^F);return new ce(M,o.typeInfo)}const a=c,y=d,S=this._maxFormatTypeInfo([n.typeInfo,o.typeInfo]);return new Pe(a^y,S)}case"<<":{if(vt(c)&&vt(d)){const E=c,M=d;if(E.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map((N,G)=>N<<M[G]);return new ce(F,n.typeInfo)}if(vt(c)){const E=d,M=c.map((F,N)=>F<<E);return new ce(M,n.typeInfo)}if(vt(d)){const E=c,M=d.map((F,N)=>E<<F);return new ce(M,o.typeInfo)}const a=c,y=d,S=this._maxFormatTypeInfo([n.typeInfo,o.typeInfo]);return new Pe(a<<y,S)}case">>":{if(vt(c)&&vt(d)){const E=c,M=d;if(E.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const F=E.map((N,G)=>N>>M[G]);return new ce(F,n.typeInfo)}if(vt(c)){const E=d,M=c.map((F,N)=>F>>E);return new ce(M,n.typeInfo)}if(vt(d)){const E=c,M=d.map((F,N)=>E>>F);return new ce(M,o.typeInfo)}const a=c,y=d,S=this._maxFormatTypeInfo([n.typeInfo,o.typeInfo]);return new Pe(a>>y,S)}case">":if(vt(c)&&vt(d)){const a=c,y=d;if(a.length!==y.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=a.map((E,M)=>E>y[M]?1:0);return new ce(S,n.typeInfo)}if(vt(c)){const a=d,y=c.map((S,E)=>S>a?1:0);return new ce(y,n.typeInfo)}if(vt(d)){const a=c,y=d.map((S,E)=>a>S?1:0);return new ce(y,o.typeInfo)}return new Pe(c>d?1:0,this.getTypeInfo("bool"));case"<":if(vt(c)&&vt(d)){const a=c,y=d;if(a.length!==y.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=a.map((E,M)=>E<y[M]?1:0);return new ce(S,n.typeInfo)}if(vt(c)){const a=d,y=c.map((S,E)=>S<a?1:0);return new ce(y,n.typeInfo)}if(vt(d)){const a=c,y=d.map((S,E)=>a<S?1:0);return new ce(y,o.typeInfo)}return new Pe(c<d?1:0,this.getTypeInfo("bool"));case"==":if(vt(c)&&vt(d)){const a=c,y=d;if(a.length!==y.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=a.map((E,M)=>E===y[M]?1:0);return new ce(S,n.typeInfo)}if(vt(c)){const a=d,y=c.map((S,E)=>S==a?1:0);return new ce(y,n.typeInfo)}if(vt(d)){const a=c,y=d.map((S,E)=>a==S?1:0);return new ce(y,o.typeInfo)}return new Pe(c===d?1:0,this.getTypeInfo("bool"));case"!=":if(vt(c)&&vt(d)){const a=c,y=d;if(a.length!==y.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=a.map((E,M)=>E!==y[M]?1:0);return new ce(S,n.typeInfo)}if(vt(c)){const a=d,y=c.map((S,E)=>S!==a?1:0);return new ce(y,n.typeInfo)}if(vt(d)){const a=c,y=d.map((S,E)=>a!==S?1:0);return new ce(y,o.typeInfo)}return new Pe(c!==d?1:0,this.getTypeInfo("bool"));case">=":if(vt(c)&&vt(d)){const a=c,y=d;if(a.length!==y.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=a.map((E,M)=>E>=y[M]?1:0);return new ce(S,n.typeInfo)}if(vt(c)){const a=d,y=c.map((S,E)=>S>=a?1:0);return new ce(y,n.typeInfo)}if(vt(d)){const a=c,y=d.map((S,E)=>a>=S?1:0);return new ce(y,o.typeInfo)}return new Pe(c>=d?1:0,this.getTypeInfo("bool"));case"<=":if(vt(c)&&vt(d)){const a=c,y=d;if(a.length!==y.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=a.map((E,M)=>E<=y[M]?1:0);return new ce(S,n.typeInfo)}if(vt(c)){const a=d,y=c.map((S,E)=>S<=a?1:0);return new ce(y,n.typeInfo)}if(vt(d)){const a=c,y=d.map((S,E)=>a<=S?1:0);return new ce(y,o.typeInfo)}return new Pe(c<=d?1:0,this.getTypeInfo("bool"));case"&&":if(vt(c)&&vt(d)){const a=c,y=d;if(a.length!==y.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=a.map((E,M)=>E&&y[M]?1:0);return new ce(S,n.typeInfo)}if(vt(c)){const a=d,y=c.map((S,E)=>S&&a?1:0);return new ce(y,n.typeInfo)}if(vt(d)){const a=c,y=d.map((S,E)=>a&&S?1:0);return new ce(y,o.typeInfo)}return new Pe(c&&d?1:0,this.getTypeInfo("bool"));case"||":if(vt(c)&&vt(d)){const a=c,y=d;if(a.length!==y.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const S=a.map((E,M)=>E||y[M]?1:0);return new ce(S,n.typeInfo)}if(vt(c)){const a=d,y=c.map((S,E)=>S||a?1:0);return new ce(y,n.typeInfo)}if(vt(d)){const a=c,y=d.map((S,E)=>a||S?1:0);return new ce(y,o.typeInfo)}return new Pe(c||d?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,r){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const n=r.clone();n.currentFunctionName=e.name;const o=r.getFunction(e.name);if(!o)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,r):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let c=0;c<o.node.args.length;++c){const d=o.node.args[c],a=this.evalExpression(e.args[c],n);n.createVariable(d.name,a,d)}return this._execStatements(o.node.body,n)}_callBuiltinFunction(e,r){switch(e.name){case"all":return this.builtins.All(e,r);case"any":return this.builtins.Any(e,r);case"select":return this.builtins.Select(e,r);case"arrayLength":return this.builtins.ArrayLength(e,r);case"abs":return this.builtins.Abs(e,r);case"acos":return this.builtins.Acos(e,r);case"acosh":return this.builtins.Acosh(e,r);case"asin":return this.builtins.Asin(e,r);case"asinh":return this.builtins.Asinh(e,r);case"atan":return this.builtins.Atan(e,r);case"atanh":return this.builtins.Atanh(e,r);case"atan2":return this.builtins.Atan2(e,r);case"ceil":return this.builtins.Ceil(e,r);case"clamp":return this.builtins.Clamp(e,r);case"cos":return this.builtins.Cos(e,r);case"cosh":return this.builtins.Cosh(e,r);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,r);case"countOneBits":return this.builtins.CountOneBits(e,r);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,r);case"cross":return this.builtins.Cross(e,r);case"degrees":return this.builtins.Degrees(e,r);case"determinant":return this.builtins.Determinant(e,r);case"distance":return this.builtins.Distance(e,r);case"dot":return this.builtins.Dot(e,r);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,r);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,r);case"exp":return this.builtins.Exp(e,r);case"exp2":return this.builtins.Exp2(e,r);case"extractBits":return this.builtins.ExtractBits(e,r);case"faceForward":return this.builtins.FaceForward(e,r);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,r);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,r);case"floor":return this.builtins.Floor(e,r);case"fma":return this.builtins.Fma(e,r);case"fract":return this.builtins.Fract(e,r);case"frexp":return this.builtins.Frexp(e,r);case"insertBits":return this.builtins.InsertBits(e,r);case"inverseSqrt":return this.builtins.InverseSqrt(e,r);case"ldexp":return this.builtins.Ldexp(e,r);case"length":return this.builtins.Length(e,r);case"log":return this.builtins.Log(e,r);case"log2":return this.builtins.Log2(e,r);case"max":return this.builtins.Max(e,r);case"min":return this.builtins.Min(e,r);case"mix":return this.builtins.Mix(e,r);case"modf":return this.builtins.Modf(e,r);case"normalize":return this.builtins.Normalize(e,r);case"pow":return this.builtins.Pow(e,r);case"quantizeToF16":return this.builtins.QuantizeToF16(e,r);case"radians":return this.builtins.Radians(e,r);case"reflect":return this.builtins.Reflect(e,r);case"refract":return this.builtins.Refract(e,r);case"reverseBits":return this.builtins.ReverseBits(e,r);case"round":return this.builtins.Round(e,r);case"saturate":return this.builtins.Saturate(e,r);case"sign":return this.builtins.Sign(e,r);case"sin":return this.builtins.Sin(e,r);case"sinh":return this.builtins.Sinh(e,r);case"smoothstep":return this.builtins.SmoothStep(e,r);case"sqrt":return this.builtins.Sqrt(e,r);case"step":return this.builtins.Step(e,r);case"tan":return this.builtins.Tan(e,r);case"tanh":return this.builtins.Tanh(e,r);case"transpose":return this.builtins.Transpose(e,r);case"trunc":return this.builtins.Trunc(e,r);case"dpdx":return this.builtins.Dpdx(e,r);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,r);case"dpdxFine":return this.builtins.DpdxFine(e,r);case"dpdy":return this.builtins.Dpdy(e,r);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,r);case"dpdyFine":return this.builtins.DpdyFine(e,r);case"fwidth":return this.builtins.Fwidth(e,r);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,r);case"fwidthFine":return this.builtins.FwidthFine(e,r);case"textureDimensions":return this.builtins.TextureDimensions(e,r);case"textureGather":return this.builtins.TextureGather(e,r);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,r);case"textureLoad":return this.builtins.TextureLoad(e,r);case"textureNumLayers":return this.builtins.TextureNumLayers(e,r);case"textureNumLevels":return this.builtins.TextureNumLevels(e,r);case"textureNumSamples":return this.builtins.TextureNumSamples(e,r);case"textureSample":return this.builtins.TextureSample(e,r);case"textureSampleBias":return this.builtins.TextureSampleBias(e,r);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,r);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,r);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,r);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,r);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,r);case"textureStore":return this.builtins.TextureStore(e,r);case"atomicLoad":return this.builtins.AtomicLoad(e,r);case"atomicStore":return this.builtins.AtomicStore(e,r);case"atomicAdd":return this.builtins.AtomicAdd(e,r);case"atomicSub":return this.builtins.AtomicSub(e,r);case"atomicMax":return this.builtins.AtomicMax(e,r);case"atomicMin":return this.builtins.AtomicMin(e,r);case"atomicAnd":return this.builtins.AtomicAnd(e,r);case"atomicOr":return this.builtins.AtomicOr(e,r);case"atomicXor":return this.builtins.AtomicXor(e,r);case"atomicExchange":return this.builtins.AtomicExchange(e,r);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,r);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,r);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,r);case"pack4xI8":return this.builtins.Pack4xI8(e,r);case"pack4xU8":return this.builtins.Pack4xU8(e,r);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,r);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,r);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,r);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,r);case"pack2x16float":return this.builtins.Pack2x16float(e,r);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,r);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,r);case"unpack4xI8":return this.builtins.Unpack4xI8(e,r);case"unpack4xU8":return this.builtins.Unpack4xU8(e,r);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,r);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,r);case"unpack2x16float":return this.builtins.Unpack2x16float(e,r);case"storageBarrier":return this.builtins.StorageBarrier(e,r);case"textureBarrier":return this.builtins.TextureBarrier(e,r);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,r);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,r);case"subgroupAdd":return this.builtins.SubgroupAdd(e,r);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,r);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,r);case"subgroupAll":return this.builtins.SubgroupAll(e,r);case"subgroupAnd":return this.builtins.SubgroupAnd(e,r);case"subgroupAny":return this.builtins.SubgroupAny(e,r);case"subgroupBallot":return this.builtins.SubgroupBallot(e,r);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,r);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,r);case"subgroupElect":return this.builtins.SubgroupElect(e,r);case"subgroupMax":return this.builtins.SubgroupMax(e,r);case"subgroupMin":return this.builtins.SubgroupMin(e,r);case"subgroupMul":return this.builtins.SubgroupMul(e,r);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,r);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,r);case"subgroupOr":return this.builtins.SubgroupOr(e,r);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,r);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,r);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,r);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,r);case"subgroupXor":return this.builtins.SubgroupXor(e,r);case"quadBroadcast":return this.builtins.QuadBroadcast(e,r);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,r);case"quadSwapX":return this.builtins.QuadSwapX(e,r);case"quadSwapY":return this.builtins.QuadSwapY(e,r)}const n=r.getFunction(e.name);if(n){const o=r.clone();for(let c=0;c<n.node.args.length;++c){const d=n.node.args[c],a=this.evalExpression(e.args[c],o);o.setVariable(d.name,a,d)}return this._execStatements(n.node.body,o)}return null}_callConstructorValue(e,r){if(!e.args||e.args.length===0)return new Pe(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],r);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,r).clone()}_callConstructorVec(e,r){const n=this.getTypeInfo(e.type),o=e.type.getTypeName(),c=S0[o];if(c===void 0)return console.error(`Invalid vec constructor ${o}. Line ${e.line}`),null;const d=[];if(e instanceof Jn)if(e.isVector){const a=e.vectorValue;for(const y of a)d.push(y)}else d.push(e.scalarValue);else if(e.args)for(const a of e.args){const y=this.evalExpression(a,r);if(y instanceof ce){const S=y.data;for(let E=0;E<S.length;++E){let M=S[E];d.push(M)}}else if(y instanceof Pe){let S=y.value;d.push(S)}}if(e.type instanceof Re&&e.type.format===null&&(e.type.format=Re.f32),d.length===0){const a=new Array(c).fill(0);return new ce(a,n).getSubData(this,e.postfix,r)}if(d.length===1)for(;d.length<c;)d.push(d[0]);return d.length<c?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new ce(d.length>c?d.slice(0,c):d,n).getSubData(this,e.postfix,r)}_callConstructorMatrix(e,r){const n=this.getTypeInfo(e.type),o=e.type.getTypeName(),c=Yi[o];if(c===void 0)return console.error(`Invalid matrix constructor ${o}. Line ${e.line}`),null;const d=[];if(e instanceof Jn)if(e.isVector){const a=e.vectorValue;for(const y of a)d.push(y)}else d.push(e.scalarValue);else if(e.args)for(const a of e.args){const y=this.evalExpression(a,r);y instanceof ce?d.push(...y.data):y instanceof Pe?d.push(y.value):y instanceof Xt&&d.push(...y.data)}if(n instanceof eu&&n.format===null&&(n.format=this.getTypeInfo("f32")),d.length===0){const a=new Array(c[2]).fill(0);return new Xt(a,n).getSubData(this,e.postfix,r)}return d.length!==c[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Xt(d,n).getSubData(this,e.postfix,r)}}Li._breakObj=new to(new Gs("BREAK",null),null),Li._continueObj=new to(new Gs("CONTINUE",null),null),Li._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class YL{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class GL{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new YL,this._exec=new Li,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const r=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;r.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const o=n.arrayType,c=n.countNode;if(c instanceof Rs){const d=c.name,a=this._context.constants.get(d);if(a)try{const y=a.constEvaluate(this._exec);o.count=y}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of r)n.search(o=>{o instanceof zS||o instanceof Bm?o.type=this._forwardType(o.type):o instanceof qf?o.format=this._forwardType(o.format):o instanceof Ma||o instanceof Zf||o instanceof zm?o.type=this._forwardType(o.type):o instanceof _p?o.returnType=this._forwardType(o.returnType):o instanceof LS&&(o.type=this._forwardType(o.type))});return r}_forwardType(e){if(e instanceof NS){const r=this._getType(e.name);if(r)return r}else e instanceof Bm?e.type=this._forwardType(e.type):e instanceof qf&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const r=new BL(e);this._tokens=r.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,r){return e.line=r??this._currentLine,e}_error(e,r){return{token:e,message:r,toString:()=>`${r}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ie.eof}_match(e){if(e instanceof Me)return!!this._check(e)&&(this._advance(),!0);for(let r=0,n=e.length;r<n;++r){const o=e[r];if(this._check(o))return this._advance(),!0}return!1}_consume(e,r){if(this._check(e))return this._advance();throw this._error(this._peek(),`${r}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const r=this._peek();if(e instanceof Array){const n=r.type;let o=!1;for(const c of e){if(n===c)return!0;c===ie.tokens.name&&(o=!0)}if(o){const c=ie.tokens.name.rule.exec(r.lexeme);if(c&&c.index==0&&c[0]==r.lexeme)return!0}return!1}if(r.type===e)return!0;if(e===ie.tokens.name){const n=ie.tokens.name.rule.exec(r.lexeme);return n&&n.index==0&&n[0]==r.lexeme}return!1}_advance(){var e,r;return this._currentLine=(r=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ie.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ie.keywords.alias)){const r=this._type_alias();return this._consume(ie.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(ie.keywords.diagnostic)){const r=this._diagnostic();return this._consume(ie.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(ie.keywords.requires)){const r=this._requires_directive();return this._consume(ie.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(ie.keywords.enable)){const r=this._enable_directive();return this._consume(ie.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}const e=this._attribute();if(this._check(ie.keywords.var)){const r=this._global_variable_decl();return r!=null&&(r.attributes=e),this._consume(ie.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(ie.keywords.override)){const r=this._override_variable_decl();return r!=null&&(r.attributes=e),this._consume(ie.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(ie.keywords.let)){const r=this._global_let_decl();return r!=null&&(r.attributes=e),this._consume(ie.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(ie.keywords.const)){const r=this._global_const_decl();return r!=null&&(r.attributes=e),this._consume(ie.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(ie.keywords.struct)){const r=this._struct_decl();return r!=null&&(r.attributes=e),this._exec.reflection.updateAST([r]),r}if(this._check(ie.keywords.fn)){const r=this._function_decl();return r!=null&&(r.attributes=e),this._exec.reflection.updateAST([r]),r}return null}_function_decl(){if(!this._match(ie.keywords.fn))return null;const e=this._currentLine,r=this._consume(ie.tokens.ident,"Expected function name.").toString();this._consume(ie.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(ie.tokens.paren_right))do{if(this._check(ie.tokens.paren_right))break;const a=this._attribute(),y=this._consume(ie.tokens.name,"Expected argument name.").toString();this._consume(ie.tokens.colon,"Expected ':' for argument type.");const S=this._attribute(),E=this._type_decl();E!=null&&(E.attributes=S,n.push(this._updateNode(new LS(y,E,a))))}while(this._match(ie.tokens.comma));this._consume(ie.tokens.paren_right,"Expected ')' after function arguments.");let o=null;if(this._match(ie.tokens.arrow)){const a=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=a)}const c=this._compound_statement(),d=this._currentLine;return this._updateNode(new _p(r,n,o,c,e,d),e)}_compound_statement(){const e=[];for(this._consume(ie.tokens.brace_left,"Expected '{' for block.");!this._check(ie.tokens.brace_right);){const r=this._statement();r!==null&&e.push(r)}return this._consume(ie.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(ie.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ie.tokens.attr)&&this._attribute(),this._check(ie.keywords.if))return this._if_statement();if(this._check(ie.keywords.switch))return this._switch_statement();if(this._check(ie.keywords.loop))return this._loop_statement();if(this._check(ie.keywords.for))return this._for_statement();if(this._check(ie.keywords.while))return this._while_statement();if(this._check(ie.keywords.continuing))return this._continuing_statement();if(this._check(ie.keywords.static_assert))return this._static_assert_statement();if(this._check(ie.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(ie.keywords.return))e=this._return_statement();else if(this._check([ie.keywords.var,ie.keywords.let,ie.keywords.const]))e=this._variable_statement();else if(this._match(ie.keywords.discard))e=this._updateNode(new NL);else if(this._match(ie.keywords.break)){const r=this._updateNode(new TP);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];r.loopId=n.id}e=r,this._check(ie.keywords.if)&&(this._advance(),r.condition=this._optional_paren_expression())}else if(this._match(ie.keywords.continue)){const r=this._updateNode(new SP);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${r.line}`);{const n=this._currentLoop[this._currentLoop.length-1];r.loopId=n.id}e=r}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(ie.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(ie.keywords.static_assert))return null;const e=this._currentLine,r=this._optional_paren_expression();return this._updateNode(new DL(r),e)}_while_statement(){if(!this._match(ie.keywords.while))return null;const e=this._updateNode(new pP(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ie.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(ie.keywords.continuing))return null;const r=this._currentLine,n=this._compound_statement();return this._updateNode(new ob(n,e),r)}_for_statement(){if(!this._match(ie.keywords.for))return null;this._consume(ie.tokens.paren_left,"Expected '('.");const e=this._updateNode(new gP(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(ie.tokens.semicolon)?null:this._for_init(),this._consume(ie.tokens.semicolon,"Expected ';'."),e.condition=this._check(ie.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(ie.tokens.semicolon,"Expected ';'."),e.increment=this._check(ie.tokens.paren_right)?null:this._for_increment(),this._consume(ie.tokens.paren_right,"Expected ')'."),this._check(ie.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ie.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(ie.tokens.equal)&&(r=this._short_circuit_or_expression()),this._updateNode(new Ma(e.name,e.type,e.storage,e.access,r),e.line)}if(this._match(ie.keywords.let)){const e=this._currentLine,r=this._consume(ie.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(ie.tokens.colon)){const c=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=c)}this._consume(ie.tokens.equal,"Expected '=' for let.");const o=this._short_circuit_or_expression();return this._updateNode(new Zf(r,n,null,null,o),e)}if(this._match(ie.keywords.const)){const e=this._currentLine,r=this._consume(ie.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(ie.tokens.colon)){const c=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=c)}this._consume(ie.tokens.equal,"Expected '=' for const.");const o=this._short_circuit_or_expression();return n===null&&o instanceof Jn&&(n=o.type),this._updateNode(new zm(r,n,null,null,o),e)}return null}_increment_decrement_statement(){const e=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(ie.increment_operators))return this._current=e,null;const n=this._consume(ie.increment_operators,"Expected increment operator");return this._updateNode(new mP(n.type===ie.tokens.plus_plus?Ph.increment:Ph.decrement,r))}_assignment_statement(){let e=null;const r=this._currentLine;if(this._check(ie.tokens.brace_right))return null;let n=this._match(ie.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const o=this._consume(ie.assignment_operators,"Expected assignment operator."),c=this._short_circuit_or_expression();return this._updateNode(new _P(Mf.parse(o.lexeme),e,c),r)}_func_call_statement(){if(!this._check(ie.tokens.ident))return null;const e=this._currentLine,r=this._current,n=this._consume(ie.tokens.ident,"Expected function name."),o=this._argument_expression_list();return o===null?(this._current=r,null):this._updateNode(new B1(n.lexeme,o),e)}_loop_statement(){if(!this._match(ie.keywords.loop))return null;this._check(ie.tokens.attr)&&this._attribute(),this._consume(ie.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new yP([],null));this._currentLoop.push(e);let r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let n of r)e.body.push(n);else e.body.push(r);if(r instanceof ob){e.continuing=r;break}r=this._statement()}return this._currentLoop.pop(),this._consume(ie.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(ie.keywords.switch))return null;const e=this._updateNode(new vP(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ie.tokens.attr)&&this._attribute(),this._consume(ie.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ie.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let r=!1;for(;this._check([ie.keywords.default,ie.keywords.case]);){if(this._match(ie.keywords.case)){const n=this._case_selectors();for(const c of n)if(c instanceof Um){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");r=!0;break}this._match(ie.tokens.colon),this._check(ie.tokens.attr)&&this._attribute(),this._consume(ie.tokens.brace_left,"Exected '{' for switch case.");const o=this._case_body();this._consume(ie.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new CP(n,o)))}if(this._match(ie.keywords.default)){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(ie.tokens.colon),this._check(ie.tokens.attr)&&this._attribute(),this._consume(ie.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(ie.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new MP(n)))}}return e}_case_selectors(){const e=[];for(this._match(ie.keywords.default)?e.push(this._updateNode(new Um)):e.push(this._shift_expression());this._match(ie.tokens.comma);)this._match(ie.keywords.default)?e.push(this._updateNode(new Um)):e.push(this._shift_expression());return e}_case_body(){if(this._match(ie.keywords.fallthrough))return this._consume(ie.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const r=this._case_body();return r.length==0?e:[...e,r[0]]}_if_statement(){if(!this._match(ie.keywords.if))return null;const e=this._currentLine,r=this._optional_paren_expression();this._check(ie.tokens.attr)&&this._attribute();const n=this._compound_statement();let o=[];this._match_elseif()&&(this._check(ie.tokens.attr)&&this._attribute(),o=this._elseif_statement(o));let c=null;return this._match(ie.keywords.else)&&(this._check(ie.tokens.attr)&&this._attribute(),c=this._compound_statement()),this._updateNode(new xP(r,n,o,c),e)}_match_elseif(){return this._tokens[this._current].type===ie.keywords.else&&this._tokens[this._current+1].type===ie.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const r=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new LL(r,n))),this._match_elseif()&&(this._check(ie.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(ie.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new bP(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(ie.tokens.or_or);)e=this._updateNode(new yo(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(ie.tokens.and_and);)e=this._updateNode(new yo(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(ie.tokens.or);)e=this._updateNode(new yo(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(ie.tokens.xor);)e=this._updateNode(new yo(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(ie.tokens.and);)e=this._updateNode(new yo(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([ie.tokens.equal_equal,ie.tokens.not_equal])?this._updateNode(new yo(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([ie.tokens.less_than,ie.tokens.greater_than,ie.tokens.less_than_equal,ie.tokens.greater_than_equal]);)e=this._updateNode(new yo(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([ie.tokens.shift_left,ie.tokens.shift_right]);)e=this._updateNode(new yo(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([ie.tokens.plus,ie.tokens.minus]);)e=this._updateNode(new yo(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([ie.tokens.star,ie.tokens.forward_slash,ie.tokens.modulo]);)e=this._updateNode(new yo(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([ie.tokens.minus,ie.tokens.bang,ie.tokens.tilde,ie.tokens.star,ie.tokens.and])?this._updateNode(new Xn(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),r=this._postfix_expression();return r&&(e.postfix=r),e}_postfix_expression(){if(this._match(ie.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(ie.tokens.bracket_right,"Expected ']'.");const r=this._updateNode(new Kh(e)),n=this._postfix_expression();return n&&(r.postfix=n),r}if(this._match(ie.tokens.period)){const e=this._consume(ie.tokens.name,"Expected member name."),r=this._postfix_expression(),n=this._updateNode(new tu(e.lexeme));return r&&(n.postfix=r),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const r=this._getStruct(e);if(r!==null)return r;switch(e){case"void":return Ge.void;case"bool":return Ge.bool;case"i32":return Ge.i32;case"u32":return Ge.u32;case"f32":return Ge.f32;case"f16":return Ge.f16;case"vec2f":return Re.vec2f;case"vec3f":return Re.vec3f;case"vec4f":return Re.vec4f;case"vec2i":return Re.vec2i;case"vec3i":return Re.vec3i;case"vec4i":return Re.vec4i;case"vec2u":return Re.vec2u;case"vec3u":return Re.vec3u;case"vec4u":return Re.vec4u;case"vec2h":return Re.vec2h;case"vec3h":return Re.vec3h;case"vec4h":return Re.vec4h;case"mat2x2f":return Re.mat2x2f;case"mat2x3f":return Re.mat2x3f;case"mat2x4f":return Re.mat2x4f;case"mat3x2f":return Re.mat3x2f;case"mat3x3f":return Re.mat3x3f;case"mat3x4f":return Re.mat3x4f;case"mat4x2f":return Re.mat4x2f;case"mat4x3f":return Re.mat4x3f;case"mat4x4f":return Re.mat4x4f;case"mat2x2h":return Re.mat2x2h;case"mat2x3h":return Re.mat2x3h;case"mat2x4h":return Re.mat2x4h;case"mat3x2h":return Re.mat3x2h;case"mat3x3h":return Re.mat3x3h;case"mat3x4h":return Re.mat3x4h;case"mat4x2h":return Re.mat4x2h;case"mat4x3h":return Re.mat4x3h;case"mat4x4h":return Re.mat4x4h;case"mat2x2i":return Re.mat2x2i;case"mat2x3i":return Re.mat2x3i;case"mat2x4i":return Re.mat2x4i;case"mat3x2i":return Re.mat3x2i;case"mat3x3i":return Re.mat3x3i;case"mat3x4i":return Re.mat3x4i;case"mat4x2i":return Re.mat4x2i;case"mat4x3i":return Re.mat4x3i;case"mat4x4i":return Re.mat4x4i;case"mat2x2u":return Re.mat2x2u;case"mat2x3u":return Re.mat2x3u;case"mat2x4u":return Re.mat2x4u;case"mat3x2u":return Re.mat3x2u;case"mat3x3u":return Re.mat3x3u;case"mat3x4u":return Re.mat3x4u;case"mat4x2u":return Re.mat4x2u;case"mat4x3u":return Re.mat4x3u;case"mat4x4u":return Re.mat4x4u}return null}_validateTypeRange(e,r){if(r.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(r.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(ie.tokens.ident)){const n=this._previous().toString();if(this._check(ie.tokens.paren_left)){const o=this._argument_expression_list(),c=this._getType(n);return c!==null?this._updateNode(new Zo(c,o)):this._updateNode(new V1(n,o))}if(this._context.constants.has(n)){const o=this._context.constants.get(n);return this._updateNode(new EP(n,o.value))}return this._updateNode(new Rs(n))}if(this._match(ie.tokens.int_literal)){const n=this._previous().toString();let o=n.endsWith("i")||n.endsWith("i")?Ge.i32:n.endsWith("u")||n.endsWith("U")?Ge.u32:Ge.x32;const c=parseInt(n);return this._validateTypeRange(c,o),this._updateNode(new Jn(new Pe(c,this._exec.getTypeInfo(o)),o))}if(this._match(ie.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,Ge.u32),this._updateNode(new Jn(new Pe(n,this._exec.getTypeInfo(Ge.u32)),Ge.u32))}if(this._match([ie.tokens.decimal_float_literal,ie.tokens.hex_float_literal])){let n=this._previous().toString(),o=n.endsWith("h");o&&(n=n.substring(0,n.length-1));const c=parseFloat(n);this._validateTypeRange(c,o?Ge.f16:Ge.f32);const d=o?Ge.f16:Ge.f32;return this._updateNode(new Jn(new Pe(c,this._exec.getTypeInfo(d)),d))}if(this._match([ie.keywords.true,ie.keywords.false])){let n=this._previous().toString()===ie.keywords.true.rule;return this._updateNode(new Jn(new Pe(n?1:0,this._exec.getTypeInfo(Ge.bool)),Ge.bool))}if(this._check(ie.tokens.paren_left))return this._paren_expression();if(this._match(ie.keywords.bitcast)){this._consume(ie.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(ie.tokens.greater_than,"Expected '>'.");const o=this._paren_expression();return this._updateNode(new AP(n,o))}const e=this._type_decl(),r=this._argument_expression_list();return this._updateNode(new Zo(e,r))}_argument_expression_list(){if(!this._match(ie.tokens.paren_left))return null;const e=[];do{if(this._check(ie.tokens.paren_right))break;const r=this._short_circuit_or_expression();e.push(r)}while(this._match(ie.tokens.comma));return this._consume(ie.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(ie.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(ie.tokens.paren_right),e}_paren_expression(){this._consume(ie.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(ie.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(ie.keywords.struct))return null;const e=this._currentLine,r=this._consume(ie.tokens.ident,"Expected name for struct.").toString();this._consume(ie.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(ie.tokens.brace_right);){const d=this._attribute(),a=this._consume(ie.tokens.name,"Expected variable name.").toString();this._consume(ie.tokens.colon,"Expected ':' for struct member type.");const y=this._attribute(),S=this._type_decl();S!=null&&(S.attributes=y),this._check(ie.tokens.brace_right)?this._match(ie.tokens.comma):this._consume(ie.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new zS(a,S,d)))}this._consume(ie.tokens.brace_right,"Expected '}' after struct body.");const o=this._currentLine,c=this._updateNode(new Pa(r,n,e,o),e);return this._context.structs.set(r,c),c}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(ie.tokens.equal)){const r=this._const_expression();e.value=r}if(e.type!==null&&e.value instanceof Jn){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Jn&&(e.type=e.value.type.name==="x32"?Ge.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(ie.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(ie.keywords.const))return null;const r=this._consume(ie.tokens.name,"Expected variable name"),n=this._currentLine;let o=null;if(this._match(ie.tokens.colon)){const y=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=y)}let c=null;this._consume(ie.tokens.equal,"const declarations require an assignment");const d=this._short_circuit_or_expression();try{let y=[Ge.f32],S=d.constEvaluate(this._exec,y);S instanceof Pe&&this._validateTypeRange(S.value,y[0]),y[0]instanceof Re&&y[0].format===null&&S.typeInfo instanceof eu&&S.typeInfo.format!==null&&(S.typeInfo.format.name==="f16"?y[0].format=Ge.f16:S.typeInfo.format.name==="f32"?y[0].format=Ge.f32:S.typeInfo.format.name==="i32"?y[0].format=Ge.i32:S.typeInfo.format.name==="u32"?y[0].format=Ge.u32:S.typeInfo.format.name==="bool"?y[0].format=Ge.bool:console.error(`TODO: impelement template format type ${S.typeInfo.format.name}`)),c=this._updateNode(new Jn(S,y[0])),this._exec.context.setVariable(r.toString(),S)}catch{c=d}if(o!==null&&c instanceof Jn){if(c.type.name!=="x32"&&o.getTypeName()!==c.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${c.type.name} to ${o.name}. Line:${this._currentLine}`);c.type=o,c.isScalar&&this._validateTypeRange(c.scalarValue,c.type)}else o===null&&c instanceof Jn&&(o=(e=c==null?void 0:c.type)!==null&&e!==void 0?e:Ge.f32,o===Ge.x32&&(o=Ge.i32));const a=this._updateNode(new zm(r.toString(),o,"","",c),n);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(ie.keywords.let))return null;const e=this._currentLine,r=this._consume(ie.tokens.name,"Expected variable name");let n=null;if(this._match(ie.tokens.colon)){const c=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=c)}let o=null;if(this._match(ie.tokens.equal)&&(o=this._const_expression()),n!==null&&o instanceof Jn){if(o.type.name!=="x32"&&n.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${n.name}. Line:${this._currentLine}`);o.type=n}else n===null&&o instanceof Jn&&(n=o.type.name==="x32"?Ge.i32:o.type);return o instanceof Jn&&o.isScalar&&this._validateTypeRange(o.scalarValue,n),this._updateNode(new Zf(r.toString(),n,"","",o),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(ie.keywords.var))return null;const e=this._currentLine;let r="",n="";this._match(ie.tokens.less_than)&&(r=this._consume(ie.storage_class,"Expected storage_class.").toString(),this._match(ie.tokens.comma)&&(n=this._consume(ie.access_mode,"Expected access_mode.").toString()),this._consume(ie.tokens.greater_than,"Expected '>'."));const o=this._consume(ie.tokens.name,"Expected variable name");let c=null;if(this._match(ie.tokens.colon)){const d=this._attribute();c=this._type_decl(),c!=null&&(c.attributes=d)}return this._updateNode(new Ma(o.toString(),c,r,n,null),e)}_override_decl(){if(!this._match(ie.keywords.override))return null;const e=this._consume(ie.tokens.name,"Expected variable name");let r=null;if(this._match(ie.tokens.colon)){const n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}return this._updateNode(new z1(e.toString(),r,null))}_diagnostic(){this._consume(ie.tokens.paren_left,"Expected '('");const e=this._consume(ie.tokens.ident,"Expected severity control name.");this._consume(ie.tokens.comma,"Expected ','");let r=this._consume(ie.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(ie.tokens.period)&&(r+=`.${this._consume(ie.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(ie.tokens.paren_right,"Expected ')'"),this._updateNode(new wP(e.toString(),r))}_enable_directive(){const e=this._consume(ie.tokens.ident,"identity expected.");return this._updateNode(new OL(e.toString()))}_requires_directive(){const e=[this._consume(ie.tokens.ident,"identity expected.").toString()];for(;this._match(ie.tokens.comma);){const r=this._consume(ie.tokens.ident,"identity expected.");e.push(r.toString())}return this._updateNode(new FL(e))}_type_alias(){const e=this._consume(ie.tokens.ident,"identity expected.");this._consume(ie.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);const n=this._updateNode(new U1(e.toString(),r));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([ie.tokens.ident,...ie.texel_format,ie.keywords.bool,ie.keywords.f32,ie.keywords.i32,ie.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const o=this._updateNode(new NS(n));return this._forwardTypeCount++,o}return this._updateNode(new Ge(n))}let e=this._texture_sampler_types();if(e)return e;if(this._check(ie.template_types)){let n=this._advance().toString(),o=null,c=null;return this._match(ie.tokens.less_than)&&(o=this._type_decl(),c=null,this._match(ie.tokens.comma)&&(c=this._consume(ie.access_mode,"Expected access_mode for pointer").toString()),this._consume(ie.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new Re(n,o,c))}if(this._match(ie.keywords.ptr)){let n=this._previous().toString();this._consume(ie.tokens.less_than,"Expected '<' for pointer.");const o=this._consume(ie.storage_class,"Expected storage_class for pointer");this._consume(ie.tokens.comma,"Expected ',' for pointer.");const c=this._type_decl();let d=null;return this._match(ie.tokens.comma)&&(d=this._consume(ie.access_mode,"Expected access_mode for pointer").toString()),this._consume(ie.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Bm(n,o.toString(),c,d))}const r=this._attribute();if(this._match(ie.keywords.array)){let n=null,o=-1;const c=this._previous();let d=null;if(this._match(ie.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let y="";if(this._match(ie.tokens.comma)){d=this._shift_expression();try{y=d.constEvaluate(this._exec).toString(),d=null}catch{y="1"}}this._consume(ie.tokens.greater_than,"Expected '>' for array."),o=y?parseInt(y):0}const a=this._updateNode(new qf(c.toString(),r,n,o));return d&&this._deferArrayCountEval.push({arrayType:a,countNode:d}),a}return null}_texture_sampler_types(){if(this._match(ie.sampler_type))return this._updateNode(new Rf(this._previous().toString(),null,null));if(this._match(ie.depth_texture_type))return this._updateNode(new Rf(this._previous().toString(),null,null));if(this._match(ie.sampled_texture_type)||this._match(ie.multisampled_texture_type)){const e=this._previous();this._consume(ie.tokens.less_than,"Expected '<' for sampler type.");const r=this._type_decl();return this._consume(ie.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Rf(e.toString(),r,null))}if(this._match(ie.storage_texture_type)){const e=this._previous();this._consume(ie.tokens.less_than,"Expected '<' for sampler type.");const r=this._consume(ie.texel_format,"Invalid texel format.").toString();this._consume(ie.tokens.comma,"Expected ',' after texel format.");const n=this._consume(ie.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ie.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Rf(e.toString(),r,n))}return null}_attribute(){let e=[];for(;this._match(ie.tokens.attr);){const r=this._consume(ie.attribute_name,"Expected attribute name"),n=this._updateNode(new RP(r.toString(),null));if(this._match(ie.tokens.paren_left)){if(n.value=this._consume(ie.literal_or_ident,"Expected attribute value").toString(),this._check(ie.tokens.comma)){this._advance();do{const o=this._consume(ie.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(o)}while(this._match(ie.tokens.comma))}this._consume(ie.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class KL extends Go{constructor(e){super(),e&&this.update(e)}update(e){const r=new GL().parse(e);this.updateAST(r)}}function QL(t){var c;const e={attributes:[],bindings:[]};let r;try{r=JL(t)}catch(d){return lt.error(d.message)(),e}for(const d of r.uniforms){const a=[];for(const y of((c=d.type)==null?void 0:c.members)||[])a.push({name:y.name,type:VS(y.type)});e.bindings.push({type:"uniform",name:d.name,group:d.group,location:d.binding,members:a})}for(const d of r.textures)e.bindings.push({type:"texture",name:d.name,group:d.group,location:d.binding});for(const d of r.samplers)e.bindings.push({type:"sampler",name:d.name,group:d.group,location:d.binding});const n=r.entry.vertex[0],o=(n==null?void 0:n.inputs.length)||0;for(let d=0;d<o;d++){const a=n.inputs[d];if(a.locationType==="location"){const y=VS(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:y})}}return e}function VS(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function JL(t){try{return new KL(t)}catch(e){if(e instanceof Error)throw e;let r="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(r+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(r+=e.token.line||""),new Error(r,{cause:e})}}const ez={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...ez}};const Ks=globalThis.mathgl.config;function tz(t,{precision:e=Ks.precision}={}){return t=rz(t),`${parseFloat(t.toPrecision(e))}`}function Qh(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Ko(t,e,r){return iz(t,n=>Math.max(e,Math.min(r,n)))}function N_(t,e,r){return Qh(t)?t.map((n,o)=>N_(n,e[o],r)):r*e+(1-r)*t}function yp(t,e,r){const n=Ks.EPSILON;try{if(t===e)return!0;if(Qh(t)&&Qh(e)){if(t.length!==e.length)return!1;for(let o=0;o<t.length;++o)if(!yp(t[o],e[o]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Ks.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Ks.EPSILON=n}}function rz(t){return Math.round(t/Ks.EPSILON)*Ks.EPSILON}function nz(t){return t.clone?t.clone():new Array(t.length)}function iz(t,e,r){if(Qh(t)){const n=t;r=r||nz(n);for(let o=0;o<r.length&&o<n.length;++o){const c=typeof t=="number"?t:t[o];r[o]=e(c,o,r)}return r}return e(t)}class kP extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+r];return this.check()}toArray(e=[],r=0){for(let n=0;n<this.ELEMENTS;++n)e[r+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Qh(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ks)}formatString(e){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+tz(this[n],e);return`${e.printTypes?this.constructor.name:""}[${r}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!yp(this[r],e[r]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==e[r])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,r,n){if(n===void 0)return this.lerp(this,e,r);for(let o=0;o<this.ELEMENTS;++o){const c=e[o],d=typeof r=="number"?r:r[o];this[o]=c+n*(d-c)}return this.check()}min(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(e[r],this[r]);return this.check()}max(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(e[r],this[r]);return this.check()}clamp(e,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),r[n]);return this.check()}add(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(e){if(typeof e=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;else for(let r=0;r<this.ELEMENTS&&r<e.length;++r)this[r]*=e[r];return this.check()}multiplyByScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}check(){if(Ks.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)e=e&&Number.isFinite(this[r]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=e;return this.check()}addScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),r);return this.check()}get elements(){return this}}function sz(t,e){if(t.length!==e)return!1;for(let r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}function Ms(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function E0(t,e,r=""){if(Ks.debug&&!sz(t,e))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return t}function jS(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class oz extends kP{get x(){return this[0]}set x(e){this[0]=Ms(e)}get y(){return this[1]}set y(e){this[1]=Ms(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*this[r];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let r=0;for(let n=0;n<this.ELEMENTS;++n){const o=this[n]-e[n];r+=o*o}return Ms(r)}dot(e){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*e[n];return Ms(r)}normalize(){const e=this.magnitude();if(e!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=e;return this.check()}multiply(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return jS(e>=0&&e<this.ELEMENTS,"index is out of range"),Ms(this[e])}setComponent(e,r){return jS(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=r,this.check()}addVectors(e,r){return this.copy(e).add(r)}subVectors(e,r){return this.copy(e).subtract(r)}multiplyVectors(e,r){return this.copy(e).multiply(r)}addScaledVector(e,r){return this.add(new this.constructor(e).multiplyScalar(r))}}const Vm=1e-6;let Jh=typeof Float32Array<"u"?Float32Array:Array;function az(){const t=new Jh(2);return Jh!=Float32Array&&(t[0]=0,t[1]=0),t}function $S(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function lz(t,e){return t[0]=-e[0],t[1]=-e[1],t}function DP(t,e,r,n){const o=e[0],c=e[1];return t[0]=o+n*(r[0]-o),t[1]=c+n*(r[1]-c),t}function cz(t,e,r){const n=e[0],o=e[1];return t[0]=r[0]*n+r[4]*o+r[12],t[1]=r[1]*n+r[5]*o+r[13],t}(function(){const t=az();return function(e,r,n,o,c,d){let a,y;for(r||(r=2),n||(n=0),o?y=Math.min(o*r+n,e.length):y=e.length,a=n;a<y;a+=r)t[0]=e[a],t[1]=e[a+1],c(t,t,d),e[a]=t[0],e[a+1]=t[1];return e}})();function uz(t,e,r){const n=e[0],o=e[1],c=r[3]*n+r[7]*o||1;return t[0]=(r[0]*n+r[4]*o)/c,t[1]=(r[1]*n+r[5]*o)/c,t}function OP(t,e,r){const n=e[0],o=e[1],c=e[2],d=r[3]*n+r[7]*o+r[11]*c||1;return t[0]=(r[0]*n+r[4]*o+r[8]*c)/d,t[1]=(r[1]*n+r[5]*o+r[9]*c)/d,t[2]=(r[2]*n+r[6]*o+r[10]*c)/d,t}function hz(t,e,r){const n=e[0],o=e[1];return t[0]=r[0]*n+r[2]*o,t[1]=r[1]*n+r[3]*o,t[2]=e[2],t}function dz(){const t=new Jh(3);return Jh!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function fz(t){const e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)}function pz(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function gz(t){const e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function mz(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function _z(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function yz(t,e,r){const n=e[0],o=e[1],c=e[2],d=r[0],a=r[1],y=r[2];return t[0]=o*y-c*a,t[1]=c*d-n*y,t[2]=n*a-o*d,t}function vz(t,e,r,n){const o=e[0],c=e[1],d=e[2];return t[0]=o+n*(r[0]-o),t[1]=c+n*(r[1]-c),t[2]=d+n*(r[2]-d),t}function FP(t,e,r){const n=e[0],o=e[1],c=e[2];let d=r[3]*n+r[7]*o+r[11]*c+r[15];return d=d||1,t[0]=(r[0]*n+r[4]*o+r[8]*c+r[12])/d,t[1]=(r[1]*n+r[5]*o+r[9]*c+r[13])/d,t[2]=(r[2]*n+r[6]*o+r[10]*c+r[14])/d,t}function xz(t,e,r){const n=e[0],o=e[1],c=e[2];return t[0]=n*r[0]+o*r[3]+c*r[6],t[1]=n*r[1]+o*r[4]+c*r[7],t[2]=n*r[2]+o*r[5]+c*r[8],t}function bz(t,e,r){const n=r[0],o=r[1],c=r[2],d=r[3],a=e[0],y=e[1],S=e[2];let E=o*S-c*y,M=c*a-n*S,F=n*y-o*a,N=o*F-c*M,G=c*E-n*F,re=n*M-o*E;const me=d*2;return E*=me,M*=me,F*=me,N*=2,G*=2,re*=2,t[0]=a+E+N,t[1]=y+M+G,t[2]=S+F+re,t}function wz(t,e,r,n){const o=[],c=[];return o[0]=e[0]-r[0],o[1]=e[1]-r[1],o[2]=e[2]-r[2],c[0]=o[0],c[1]=o[1]*Math.cos(n)-o[2]*Math.sin(n),c[2]=o[1]*Math.sin(n)+o[2]*Math.cos(n),t[0]=c[0]+r[0],t[1]=c[1]+r[1],t[2]=c[2]+r[2],t}function Tz(t,e,r,n){const o=[],c=[];return o[0]=e[0]-r[0],o[1]=e[1]-r[1],o[2]=e[2]-r[2],c[0]=o[2]*Math.sin(n)+o[0]*Math.cos(n),c[1]=o[1],c[2]=o[2]*Math.cos(n)-o[0]*Math.sin(n),t[0]=c[0]+r[0],t[1]=c[1]+r[1],t[2]=c[2]+r[2],t}function Sz(t,e,r,n){const o=[],c=[];return o[0]=e[0]-r[0],o[1]=e[1]-r[1],o[2]=e[2]-r[2],c[0]=o[0]*Math.cos(n)-o[1]*Math.sin(n),c[1]=o[0]*Math.sin(n)+o[1]*Math.cos(n),c[2]=o[2],t[0]=c[0]+r[0],t[1]=c[1]+r[1],t[2]=c[2]+r[2],t}function Ez(t,e){const r=t[0],n=t[1],o=t[2],c=e[0],d=e[1],a=e[2],y=Math.sqrt((r*r+n*n+o*o)*(c*c+d*d+a*a)),S=y&&_z(t,e)/y;return Math.acos(Math.min(Math.max(S,-1),1))}const NP=pz,Az=fz,A0=gz;(function(){const t=dz();return function(e,r,n,o,c,d){let a,y;for(r||(r=3),n||(n=0),o?y=Math.min(o*r+n,e.length):y=e.length,a=n;a<y;a+=r)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],c(t,t,d),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const I0=[0,0,0];let gm;class ea extends oz{static get ZERO(){return gm||(gm=new ea(0,0,0),Object.freeze(gm)),gm}constructor(e=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&Qh(e)?this.copy(e):(Ks.debug&&(Ms(e),Ms(r),Ms(n)),this[0]=e,this[1]=r,this[2]=n)}set(e,r,n){return this[0]=e,this[1]=r,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Ks.debug&&(Ms(e.x),Ms(e.y),Ms(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Ms(e)}angle(e){return Ez(this,e)}cross(e){return yz(this,this,e),this.check()}rotateX({radians:e,origin:r=I0}){return wz(this,this,r,e),this.check()}rotateY({radians:e,origin:r=I0}){return Tz(this,this,r,e),this.check()}rotateZ({radians:e,origin:r=I0}){return Sz(this,this,r,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return FP(this,this,e),this.check()}transformAsVector(e){return OP(this,this,e),this.check()}transformByMatrix3(e){return xz(this,this,e),this.check()}transformByMatrix2(e){return hz(this,this,e),this.check()}transformByQuaternion(e){return bz(this,this,e),this.check()}}class Iz extends kP{toString(){let e="[";if(Ks.printRowMajor){e+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+r]}`}else{e+="column-major:";for(let r=0;r<this.ELEMENTS;++r)e+=` ${this[r]}`}return e+="]",e}getElementIndex(e,r){return r*this.RANK+e}getElement(e,r){return this[r*this.RANK+e]}setElement(e,r,n){return this[r*this.RANK+e]=Ms(n),this}getColumn(e,r=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let o=0;o<this.RANK;++o)r[o]=this[n+o];return r}setColumn(e,r){const n=e*this.RANK;for(let o=0;o<this.RANK;++o)this[n+o]=r[o];return this}}function Pz(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Cz(t,e){if(t===e){const r=e[1],n=e[2],o=e[3],c=e[6],d=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=c,t[11]=e[14],t[12]=o,t[13]=d,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function lb(t,e){const r=e[0],n=e[1],o=e[2],c=e[3],d=e[4],a=e[5],y=e[6],S=e[7],E=e[8],M=e[9],F=e[10],N=e[11],G=e[12],re=e[13],me=e[14],Y=e[15],q=r*a-n*d,Z=r*y-o*d,le=r*S-c*d,Ae=n*y-o*a,we=n*S-c*a,je=o*S-c*y,Ue=E*re-M*G,Ze=E*me-F*G,qe=E*Y-N*G,Ke=M*me-F*re,ht=M*Y-N*re,Pt=F*Y-N*me;let xt=q*Pt-Z*ht+le*Ke+Ae*qe-we*Ze+je*Ue;return xt?(xt=1/xt,t[0]=(a*Pt-y*ht+S*Ke)*xt,t[1]=(o*ht-n*Pt-c*Ke)*xt,t[2]=(re*je-me*we+Y*Ae)*xt,t[3]=(F*we-M*je-N*Ae)*xt,t[4]=(y*qe-d*Pt-S*Ze)*xt,t[5]=(r*Pt-o*qe+c*Ze)*xt,t[6]=(me*le-G*je-Y*Z)*xt,t[7]=(E*je-F*le+N*Z)*xt,t[8]=(d*ht-a*qe+S*Ue)*xt,t[9]=(n*qe-r*ht-c*Ue)*xt,t[10]=(G*we-re*le+Y*q)*xt,t[11]=(M*le-E*we-N*q)*xt,t[12]=(a*Ze-d*Ke-y*Ue)*xt,t[13]=(r*Ke-n*Ze+o*Ue)*xt,t[14]=(re*Z-G*Ae-me*q)*xt,t[15]=(E*Ae-M*Z+F*q)*xt,t):null}function Mz(t){const e=t[0],r=t[1],n=t[2],o=t[3],c=t[4],d=t[5],a=t[6],y=t[7],S=t[8],E=t[9],M=t[10],F=t[11],N=t[12],G=t[13],re=t[14],me=t[15],Y=e*d-r*c,q=e*a-n*c,Z=r*a-n*d,le=S*G-E*N,Ae=S*re-M*N,we=E*re-M*G,je=e*we-r*Ae+n*le,Ue=c*we-d*Ae+a*le,Ze=S*Z-E*q+M*Y,qe=N*Z-G*q+re*Y;return y*je-o*Ue+me*Ze-F*qe}function Hc(t,e,r){const n=e[0],o=e[1],c=e[2],d=e[3],a=e[4],y=e[5],S=e[6],E=e[7],M=e[8],F=e[9],N=e[10],G=e[11],re=e[12],me=e[13],Y=e[14],q=e[15];let Z=r[0],le=r[1],Ae=r[2],we=r[3];return t[0]=Z*n+le*a+Ae*M+we*re,t[1]=Z*o+le*y+Ae*F+we*me,t[2]=Z*c+le*S+Ae*N+we*Y,t[3]=Z*d+le*E+Ae*G+we*q,Z=r[4],le=r[5],Ae=r[6],we=r[7],t[4]=Z*n+le*a+Ae*M+we*re,t[5]=Z*o+le*y+Ae*F+we*me,t[6]=Z*c+le*S+Ae*N+we*Y,t[7]=Z*d+le*E+Ae*G+we*q,Z=r[8],le=r[9],Ae=r[10],we=r[11],t[8]=Z*n+le*a+Ae*M+we*re,t[9]=Z*o+le*y+Ae*F+we*me,t[10]=Z*c+le*S+Ae*N+we*Y,t[11]=Z*d+le*E+Ae*G+we*q,Z=r[12],le=r[13],Ae=r[14],we=r[15],t[12]=Z*n+le*a+Ae*M+we*re,t[13]=Z*o+le*y+Ae*F+we*me,t[14]=Z*c+le*S+Ae*N+we*Y,t[15]=Z*d+le*E+Ae*G+we*q,t}function L_(t,e,r){const n=r[0],o=r[1],c=r[2];let d,a,y,S,E,M,F,N,G,re,me,Y;return e===t?(t[12]=e[0]*n+e[4]*o+e[8]*c+e[12],t[13]=e[1]*n+e[5]*o+e[9]*c+e[13],t[14]=e[2]*n+e[6]*o+e[10]*c+e[14],t[15]=e[3]*n+e[7]*o+e[11]*c+e[15]):(d=e[0],a=e[1],y=e[2],S=e[3],E=e[4],M=e[5],F=e[6],N=e[7],G=e[8],re=e[9],me=e[10],Y=e[11],t[0]=d,t[1]=a,t[2]=y,t[3]=S,t[4]=E,t[5]=M,t[6]=F,t[7]=N,t[8]=G,t[9]=re,t[10]=me,t[11]=Y,t[12]=d*n+E*o+G*c+e[12],t[13]=a*n+M*o+re*c+e[13],t[14]=y*n+F*o+me*c+e[14],t[15]=S*n+N*o+Y*c+e[15]),t}function X1(t,e,r){const n=r[0],o=r[1],c=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Rz(t,e,r,n){let o=n[0],c=n[1],d=n[2],a=Math.sqrt(o*o+c*c+d*d),y,S,E,M,F,N,G,re,me,Y,q,Z,le,Ae,we,je,Ue,Ze,qe,Ke,ht,Pt,xt,Zt;return a<Vm?null:(a=1/a,o*=a,c*=a,d*=a,S=Math.sin(r),y=Math.cos(r),E=1-y,M=e[0],F=e[1],N=e[2],G=e[3],re=e[4],me=e[5],Y=e[6],q=e[7],Z=e[8],le=e[9],Ae=e[10],we=e[11],je=o*o*E+y,Ue=c*o*E+d*S,Ze=d*o*E-c*S,qe=o*c*E-d*S,Ke=c*c*E+y,ht=d*c*E+o*S,Pt=o*d*E+c*S,xt=c*d*E-o*S,Zt=d*d*E+y,t[0]=M*je+re*Ue+Z*Ze,t[1]=F*je+me*Ue+le*Ze,t[2]=N*je+Y*Ue+Ae*Ze,t[3]=G*je+q*Ue+we*Ze,t[4]=M*qe+re*Ke+Z*ht,t[5]=F*qe+me*Ke+le*ht,t[6]=N*qe+Y*Ke+Ae*ht,t[7]=G*qe+q*Ke+we*ht,t[8]=M*Pt+re*xt+Z*Zt,t[9]=F*Pt+me*xt+le*Zt,t[10]=N*Pt+Y*xt+Ae*Zt,t[11]=G*Pt+q*xt+we*Zt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function LP(t,e,r){const n=Math.sin(r),o=Math.cos(r),c=e[4],d=e[5],a=e[6],y=e[7],S=e[8],E=e[9],M=e[10],F=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*o+S*n,t[5]=d*o+E*n,t[6]=a*o+M*n,t[7]=y*o+F*n,t[8]=S*o-c*n,t[9]=E*o-d*n,t[10]=M*o-a*n,t[11]=F*o-y*n,t}function kz(t,e,r){const n=Math.sin(r),o=Math.cos(r),c=e[0],d=e[1],a=e[2],y=e[3],S=e[8],E=e[9],M=e[10],F=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*o-S*n,t[1]=d*o-E*n,t[2]=a*o-M*n,t[3]=y*o-F*n,t[8]=c*n+S*o,t[9]=d*n+E*o,t[10]=a*n+M*o,t[11]=y*n+F*o,t}function zP(t,e,r){const n=Math.sin(r),o=Math.cos(r),c=e[0],d=e[1],a=e[2],y=e[3],S=e[4],E=e[5],M=e[6],F=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*o+S*n,t[1]=d*o+E*n,t[2]=a*o+M*n,t[3]=y*o+F*n,t[4]=S*o-c*n,t[5]=E*o-d*n,t[6]=M*o-a*n,t[7]=F*o-y*n,t}function Dz(t,e){const r=e[0],n=e[1],o=e[2],c=e[3],d=r+r,a=n+n,y=o+o,S=r*d,E=n*d,M=n*a,F=o*d,N=o*a,G=o*y,re=c*d,me=c*a,Y=c*y;return t[0]=1-M-G,t[1]=E+Y,t[2]=F-me,t[3]=0,t[4]=E-Y,t[5]=1-S-G,t[6]=N+re,t[7]=0,t[8]=F+me,t[9]=N-re,t[10]=1-S-M,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Oz(t,e,r,n,o,c,d){const a=1/(r-e),y=1/(o-n),S=1/(c-d);return t[0]=c*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c*2*y,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(o+n)*y,t[10]=(d+c)*S,t[11]=-1,t[12]=0,t[13]=0,t[14]=d*c*2*S,t[15]=0,t}function Fz(t,e,r,n,o){const c=1/Math.tan(e/2);if(t[0]=c/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0){const d=1/(n-o);t[10]=(o+n)*d,t[14]=2*o*n*d}else t[10]=-1,t[14]=-2*n;return t}const Nz=Fz;function Lz(t,e,r,n,o,c,d){const a=1/(e-r),y=1/(n-o),S=1/(c-d);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*S,t[11]=0,t[12]=(e+r)*a,t[13]=(o+n)*y,t[14]=(d+c)*S,t[15]=1,t}const zz=Lz;function Bz(t,e,r,n){let o,c,d,a,y,S,E,M,F,N;const G=e[0],re=e[1],me=e[2],Y=n[0],q=n[1],Z=n[2],le=r[0],Ae=r[1],we=r[2];return Math.abs(G-le)<Vm&&Math.abs(re-Ae)<Vm&&Math.abs(me-we)<Vm?Pz(t):(M=G-le,F=re-Ae,N=me-we,o=1/Math.sqrt(M*M+F*F+N*N),M*=o,F*=o,N*=o,c=q*N-Z*F,d=Z*M-Y*N,a=Y*F-q*M,o=Math.sqrt(c*c+d*d+a*a),o?(o=1/o,c*=o,d*=o,a*=o):(c=0,d=0,a=0),y=F*a-N*d,S=N*c-M*a,E=M*d-F*c,o=Math.sqrt(y*y+S*S+E*E),o?(o=1/o,y*=o,S*=o,E*=o):(y=0,S=0,E=0),t[0]=c,t[1]=y,t[2]=M,t[3]=0,t[4]=d,t[5]=S,t[6]=F,t[7]=0,t[8]=a,t[9]=E,t[10]=N,t[11]=0,t[12]=-(c*G+d*re+a*me),t[13]=-(y*G+S*re+E*me),t[14]=-(M*G+F*re+N*me),t[15]=1,t)}function Uz(){const t=new Jh(4);return Jh!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function BP(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function od(t,e,r){const n=e[0],o=e[1],c=e[2],d=e[3];return t[0]=r[0]*n+r[4]*o+r[8]*c+r[12]*d,t[1]=r[1]*n+r[5]*o+r[9]*c+r[13]*d,t[2]=r[2]*n+r[6]*o+r[10]*c+r[14]*d,t[3]=r[3]*n+r[7]*o+r[11]*c+r[15]*d,t}(function(){const t=Uz();return function(e,r,n,o,c,d){let a,y;for(r||(r=4),n||(n=0),o?y=Math.min(o*r+n,e.length):y=e.length,a=n;a<y;a+=r)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],c(t,t,d),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var cb;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(cb||(cb={}));const Vz=45*Math.PI/180,jz=1,P0=.1,C0=500,$z=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Po extends Iz{static get IDENTITY(){return Hz()}static get ZERO(){return Wz()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return cb}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,r,n,o,c,d,a,y,S,E,M,F,N,G,re,me){return this[0]=e,this[1]=r,this[2]=n,this[3]=o,this[4]=c,this[5]=d,this[6]=a,this[7]=y,this[8]=S,this[9]=E,this[10]=M,this[11]=F,this[12]=N,this[13]=G,this[14]=re,this[15]=me,this.check()}setRowMajor(e,r,n,o,c,d,a,y,S,E,M,F,N,G,re,me){return this[0]=e,this[1]=c,this[2]=S,this[3]=N,this[4]=r,this[5]=d,this[6]=E,this[7]=G,this[8]=n,this[9]=a,this[10]=M,this[11]=re,this[12]=o,this[13]=y,this[14]=F,this[15]=me,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy($z)}fromObject(e){return this.check()}fromQuaternion(e){return Dz(this,e),this.check()}frustum(e){const{left:r,right:n,bottom:o,top:c,near:d=P0,far:a=C0}=e;return a===1/0?Xz(this,r,n,o,c,d):Oz(this,r,n,o,c,d,a),this.check()}lookAt(e){const{eye:r,center:n=[0,0,0],up:o=[0,1,0]}=e;return Bz(this,r,n,o),this.check()}ortho(e){const{left:r,right:n,bottom:o,top:c,near:d=P0,far:a=C0}=e;return zz(this,r,n,o,c,d,a),this.check()}orthographic(e){const{fovy:r=Vz,aspect:n=jz,focalDistance:o=1,near:c=P0,far:d=C0}=e;WS(r);const a=r/2,y=o*Math.tan(a),S=y*n;return this.ortho({left:-S,right:S,bottom:-y,top:y,near:c,far:d})}perspective(e){const{fovy:r=45*Math.PI/180,aspect:n=1,near:o=.1,far:c=500}=e;return WS(r),Nz(this,r,n,o,c),this.check()}determinant(){return Mz(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const n=this.getScale(r),o=1/n[0],c=1/n[1],d=1/n[2];return e[0]=this[0]*o,e[1]=this[1]*c,e[2]=this[2]*d,e[3]=0,e[4]=this[4]*o,e[5]=this[5]*c,e[6]=this[6]*d,e[7]=0,e[8]=this[8]*o,e[9]=this[9]*c,e[10]=this[10]*d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const n=this.getScale(r),o=1/n[0],c=1/n[1],d=1/n[2];return e[0]=this[0]*o,e[1]=this[1]*c,e[2]=this[2]*d,e[3]=this[4]*o,e[4]=this[5]*c,e[5]=this[6]*d,e[6]=this[8]*o,e[7]=this[9]*c,e[8]=this[10]*d,e}transpose(){return Cz(this,this),this.check()}invert(){return lb(this,this),this.check()}multiplyLeft(e){return Hc(this,e,this),this.check()}multiplyRight(e){return Hc(this,this,e),this.check()}rotateX(e){return LP(this,this,e),this.check()}rotateY(e){return kz(this,this,e),this.check()}rotateZ(e){return zP(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,r){return Rz(this,this,e,r),this.check()}scale(e){return X1(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return L_(this,this,e),this.check()}transform(e,r){return e.length===4?(r=od(r||[-0,-0,-0,-0],e,this),E0(r,4),r):this.transformAsPoint(e,r)}transformAsPoint(e,r){const{length:n}=e;let o;switch(n){case 2:o=cz(r||[-0,-0],e,this);break;case 3:o=FP(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return E0(o,e.length),o}transformAsVector(e,r){let n;switch(e.length){case 2:n=uz(r||[-0,-0],e,this);break;case 3:n=OP(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return E0(n,e.length),n}transformPoint(e,r){return this.transformAsPoint(e,r)}transformVector(e,r){return this.transformAsPoint(e,r)}transformDirection(e,r){return this.transformAsVector(e,r)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,r,n){return this.identity().translate([e,r,n])}}let mm,_m;function Wz(){return mm||(mm=new Po([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(mm)),mm}function Hz(){return _m||(_m=new Po,Object.freeze(_m)),_m}function WS(t){if(t>Math.PI*2)throw Error("expected radians")}function Xz(t,e,r,n,o,c){const d=2*c/(r-e),a=2*c/(o-n),y=(r+e)/(r-e),S=(o+n)/(o-n),E=-1,M=-1,F=-2*c;return t[0]=d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=y,t[9]=S,t[10]=E,t[11]=M,t[12]=0,t[13]=0,t[14]=F,t[15]=0,t}function UP(t,e=[],r=0){const n=Math.fround(t),o=t-n;return e[r]=n,e[r+1]=o,e}function Zz(t){return t-Math.fround(t)}function qz(t){const e=new Float32Array(32);for(let r=0;r<4;++r)for(let n=0;n<4;++n){const o=r*4+n;UP(t[n*4+r],e,o*2)}return e}const Yz=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,Gz={name:"fp32",vs:Yz},Kz=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,Qz={ONE:1},Jz={name:"fp64arithmetic",vs:Kz,defaultUniforms:Qz,uniformTypes:{ONE:"f32"},fp64ify:UP,fp64LowPart:Zz,fp64ifyMatrix4:qz},eB=[0,1,1,1],tB=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,rB=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,HS={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:eB},vs:tB,fs:rB,getUniforms:nB};function nB(t={},e){const r={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;const n=t.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=n}if(t.highlightColor){const n=Array.from(t.highlightColor,o=>o/255);Number.isFinite(n[3])||(n[3]=1),r.highlightColor=n}return t.isActive!==void 0&&(r.isActive=!!t.isActive,r.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(r.useFloatColors=!!t.useFloatColors),r}const XS=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,iB=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,VP=3,sB=255;var vp;(function(t){t[t.POINT=0]="POINT",t[t.DIRECTIONAL=1]="DIRECTIONAL"})(vp||(vp={}));const jm={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:VP},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:vp.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:iB,vs:XS,fs:XS,getUniforms:oB};function oB(t,e={}){if(t=t&&{...t},!t)return{...jm.defaultUniforms};t.lights&&(t={...t,...lB(t.lights),lights:void 0});const{ambientLight:r,pointLights:n,directionalLights:o}=t||{};if(!(r||n&&n.length>0||o&&o.length>0))return{...jm.defaultUniforms,enabled:0};const d={...jm.defaultUniforms,...e,...aB({ambientLight:r,pointLights:n,directionalLights:o})};return t.enabled!==void 0&&(d.enabled=t.enabled?1:0),d}function aB({ambientLight:t,pointLights:e=[],directionalLights:r=[]}){const n={};n.ambientLightColor=M0(t);let o=0;for(const c of e){n.lightType=vp.POINT;const d=o;n[`lightColor${d}`]=M0(c),n[`lightPosition${d}`]=c.position,n[`lightAttenuation${d}`]=c.attenuation||[1,0,0],o++}for(const c of r){n.lightType=vp.DIRECTIONAL;const d=o;n[`lightColor${d}`]=M0(c),n[`lightDirection${d}`]=c.direction,o++}return o>VP&&lt.warn("MAX_LIGHTS exceeded")(),n.directionalLightCount=r.length,n.pointLightCount=e.length,n}function lB(t){var r,n;const e={pointLights:[],directionalLights:[]};for(const o of t||[])switch(o.type){case"ambient":e.ambientLight=o;break;case"directional":(r=e.directionalLights)==null||r.push(o);break;case"point":(n=e.pointLights)==null||n.push(o);break}return e}function M0(t={}){const{color:e=[0,0,0],intensity:r=1}=t;return e.map(n=>n*r/sB)}const cB=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,uB=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,hB=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,jP={name:"phongMaterial",dependencies:[jm],source:hB,vs:cB,fs:uB,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(r=>r/255)),{...jP.defaultUniforms,...e}}},ZS=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,dB={name:"layer",vs:ZS,fs:ZS,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},fB=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,$P="#define SMOOTH_EDGE_RADIUS 0.5",pB=`${$P}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,gB=`${$P}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,WP={name:"geometry",source:fB,vs:pB,fs:gB},mB=25;var qn;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(qn||(qn={}));var ei;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(ei||(ei={}));var ar;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(ar||(ar={}));const _B="compute",yB="auto",ub="manipulation",$m="none",hb="pan-x",db="pan-y";function vB(t){if(t.includes($m))return $m;const e=t.includes(hb),r=t.includes(db);return e&&r?$m:e||r?e?hb:db:t.includes(ub)?ub:yB}class xB{constructor(e,r){this.actions="",this.manager=e,this.set(r)}set(e){e===_B&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const r of this.manager.recognizers)r.options.enable&&(e=e.concat(r.getTouchAction()));return vB(e.join(" "))}}function z_(t){return t.trim().split(/\s+/g)}function R0(t,e,r){if(t)for(const n of z_(e))t.addEventListener(n,r,!1)}function k0(t,e,r){if(t)for(const n of z_(e))t.removeEventListener(n,r,!1)}function qS(t){return(t.ownerDocument||t).defaultView}function bB(t,e){let r=t;for(;r;){if(r===e)return!0;r=r.parentNode}return!1}function HP(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let r=0,n=0,o=0;for(;o<e;)r+=t[o].clientX,n+=t[o].clientY,o++;return{x:Math.round(r/e),y:Math.round(n/e)}}function YS(t){const e=[];let r=0;for(;r<t.pointers.length;)e[r]={clientX:Math.round(t.pointers[r].clientX),clientY:Math.round(t.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:e,center:HP(e),deltaX:t.deltaX,deltaY:t.deltaY}}function XP(t,e){const r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)}function GS(t,e){const r=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(r*r+n*n)}function wB(t,e){const r=e.x-t.x,n=e.y-t.y;return Math.atan2(n,r)*180/Math.PI}function KS(t,e){const r=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.atan2(n,r)*180/Math.PI}function ZP(t,e){return t===e?ei.None:Math.abs(t)>=Math.abs(e)?t<0?ei.Left:ei.Right:e<0?ei.Up:ei.Down}function TB(t,e){const r=e.center;let n=t.offsetDelta,o=t.prevDelta;const c=t.prevInput;return(e.eventType===qn.Start||(c==null?void 0:c.eventType)===qn.End)&&(o=t.prevDelta={x:(c==null?void 0:c.deltaX)||0,y:(c==null?void 0:c.deltaY)||0},n=t.offsetDelta={x:r.x,y:r.y}),{deltaX:o.x+(r.x-n.x),deltaY:o.y+(r.y-n.y)}}function qP(t,e,r){return{x:e/t||0,y:r/t||0}}function SB(t,e){return GS(e[0],e[1])/GS(t[0],t[1])}function EB(t,e){return KS(e[1],e[0])-KS(t[1],t[0])}function AB(t,e){const r=t.lastInterval||e,n=e.timeStamp-r.timeStamp;let o,c,d,a;if(e.eventType!==qn.Cancel&&(n>mB||r.velocity===void 0)){const y=e.deltaX-r.deltaX,S=e.deltaY-r.deltaY,E=qP(n,y,S);c=E.x,d=E.y,o=Math.abs(E.x)>Math.abs(E.y)?E.x:E.y,a=ZP(y,S),t.lastInterval=e}else o=r.velocity,c=r.velocityX,d=r.velocityY,a=r.direction;e.velocity=o,e.velocityX=c,e.velocityY=d,e.direction=a}function IB(t,e){const{session:r}=t,{pointers:n}=e,{length:o}=n;r.firstInput||(r.firstInput=YS(e)),o>1&&!r.firstMultiple?r.firstMultiple=YS(e):o===1&&(r.firstMultiple=!1);const{firstInput:c,firstMultiple:d}=r,a=d?d.center:c.center,y=e.center=HP(n);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-c.timeStamp,e.angle=wB(a,y),e.distance=XP(a,y);const{deltaX:S,deltaY:E}=TB(r,e);e.deltaX=S,e.deltaY=E,e.offsetDirection=ZP(e.deltaX,e.deltaY);const M=qP(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=M.x,e.overallVelocityY=M.y,e.overallVelocity=Math.abs(M.x)>Math.abs(M.y)?M.x:M.y,e.scale=d?SB(d.pointers,n):1,e.rotation=d?EB(d.pointers,n):0,e.maxPointers=r.prevInput?e.pointers.length>r.prevInput.maxPointers?e.pointers.length:r.prevInput.maxPointers:e.pointers.length;let F=t.element;return bB(e.srcEvent.target,F)&&(F=e.srcEvent.target),e.target=F,AB(r,e),e}function PB(t,e,r){const n=r.pointers.length,o=r.changedPointers.length,c=e&qn.Start&&n-o===0,d=e&(qn.End|qn.Cancel)&&n-o===0;r.isFirst=!!c,r.isFinal=!!d,c&&(t.session={}),r.eventType=e;const a=IB(t,r);t.emit("hammer.input",a),t.recognize(a),t.session.prevInput=a}let CB=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=r=>{this.manager.options.enable&&this.handler(r)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,r){PB(this.manager,e,r)}init(){R0(this.element,this.evEl,this.domHandler),R0(this.target,this.evTarget,this.domHandler),R0(qS(this.element),this.evWin,this.domHandler)}destroy(){k0(this.element,this.evEl,this.domHandler),k0(this.target,this.evTarget,this.domHandler),k0(qS(this.element),this.evWin,this.domHandler)}};const MB={pointerdown:qn.Start,pointermove:qn.Move,pointerup:qn.End,pointercancel:qn.Cancel,pointerout:qn.Cancel},RB="pointerdown",kB="pointermove pointerup pointercancel";class DB extends CB{constructor(e){super(e),this.evEl=RB,this.evWin=kB,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:r}=this;let n=!1;const o=MB[e.type],c=e.pointerType,d=c==="touch";let a=r.findIndex(y=>y.pointerId===e.pointerId);o&qn.Start&&(e.buttons||d)?a<0&&(r.push(e),a=r.length-1):o&(qn.End|qn.Cancel)&&(n=!0),!(a<0)&&(r[a]=e,this.callback(o,{pointers:r,changedPointers:[e],eventType:o,pointerType:c,srcEvent:e}),n&&r.splice(a,1))}}const OB=["","webkit","Moz","MS","ms","o"];function FB(t,e){const r=e[0].toUpperCase()+e.slice(1);for(const n of OB){const o=n?n+r:e;if(o in t)return o}}const NB=1,QS=2,JS={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class LB{constructor(e,r){this.options={...JS,...r,cssProps:{...JS.cssProps,...r.cssProps},inputTarget:r.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new DB(this),this.touchAction=new xB(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?QS:NB}recognize(e){const{session:r}=this;if(r.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let n;const{recognizers:o}=this;let{curRecognizer:c}=r;(!c||c&&c.state&ar.Recognized)&&(c=r.curRecognizer=null);let d=0;for(;d<o.length;)n=o[d],r.stopped!==QS&&(!c||n===c||n.canRecognizeWith(c))?n.recognize(e):n.reset(),!c&&n.state&(ar.Began|ar.Changed|ar.Ended)&&(c=r.curRecognizer=n),d++}get(e){const{recognizers:r}=this;for(let n=0;n<r.length;n++)if(r[n].options.event===e)return r[n];return null}add(e){if(Array.isArray(e)){for(const n of e)this.add(n);return this}const r=this.get(e.options.event);return r&&this.remove(r),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const n of e)this.remove(n);return this}const r=typeof e=="string"?this.get(e):e;if(r){const{recognizers:n}=this,o=n.indexOf(r);o!==-1&&(n.splice(o,1),this.touchAction.update())}return this}on(e,r){if(!e||!r)return;const{handlers:n}=this;for(const o of z_(e))n[o]=n[o]||[],n[o].push(r)}off(e,r){if(!e)return;const{handlers:n}=this;for(const o of z_(e))r?n[o]&&n[o].splice(n[o].indexOf(r),1):delete n[o]}emit(e,r){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const o=r;o.type=e,o.preventDefault=function(){r.srcEvent.preventDefault()};let c=0;for(;c<n.length;)n[c](o),c++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:r}=this;if(r){for(const[n,o]of Object.entries(this.options.cssProps)){const c=FB(r.style,n);e?(this.oldCssProps[c]=r.style[c],r.style[c]=o):r.style[c]=this.oldCssProps[c]||""}e||(this.oldCssProps={})}}}let zB=1;function BB(){return zB++}function e3(t){return t&ar.Cancelled?"cancel":t&ar.Ended?"end":t&ar.Changed?"move":t&ar.Began?"start":""}class YP{constructor(e){this.options=e,this.id=BB(),this.state=ar.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const o of e)this.recognizeWith(o);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;const{simultaneous:n}=this;return n[r.id]||(n[r.id]=r,r.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const n of e)this.dropRecognizeWith(n);return this}let r;return typeof e=="string"?r=this.manager.get(e):r=e,r&&delete this.simultaneous[r.id],this}requireFailure(e){if(Array.isArray(e)){for(const o of e)this.requireFailure(o);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;const{requireFail:n}=this;return n.indexOf(r)===-1&&(n.push(r),r.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const n of e)this.dropRequireFailure(n);return this}let r;if(typeof e=="string"?r=this.manager.get(e):r=e,r){const n=this.requireFail.indexOf(r);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:r}=this;r<ar.Ended&&this.manager.emit(this.options.event+e3(r),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),r>=ar.Ended&&this.manager.emit(this.options.event+e3(r),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=ar.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(ar.Failed|ar.Possible)))return!1;e++}return!0}recognize(e){const r={...e};if(!this.options.enable){this.reset(),this.state=ar.Failed;return}this.state&(ar.Recognized|ar.Cancelled|ar.Failed)&&(this.state=ar.Possible),this.state=this.process(r),this.state&(ar.Began|ar.Changed|ar.Ended|ar.Cancelled)&&this.tryEmit(r)}getEventNames(){return[this.options.event]}reset(){}}class GP extends YP{attrTest(e){const r=this.options.pointers;return r===0||e.pointers.length===r}process(e){const{state:r}=this,{eventType:n}=e,o=r&(ar.Began|ar.Changed),c=this.attrTest(e);return o&&(n&qn.Cancel||!c)?r|ar.Cancelled:o||c?n&qn.End?r|ar.Ended:r&ar.Began?r|ar.Changed:ar.Began:ar.Failed}}class t3 extends YP{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[ub]}process(e){const{options:r}=this,n=e.pointers.length===r.pointers,o=e.distance<r.threshold,c=e.deltaTime<r.time;if(this.reset(),e.eventType&qn.Start&&this.count===0)return this.failTimeout();if(o&&c&&n){if(e.eventType!==qn.End)return this.failTimeout();const d=this.pTime?e.timeStamp-this.pTime<r.interval:!0,a=!this.pCenter||XP(this.pCenter,e.center)<r.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!a||!d?this.count=1:this.count+=1,this._input=e,this.count%r.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=ar.Recognized,this.tryEmit(this._input)},r.interval),ar.Began):ar.Recognized}return ar.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=ar.Failed},this.options.interval),ar.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===ar.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const UB=["","start","move","end","cancel","up","down","left","right"];class r3 extends GP{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:ei.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,r=[];return e&ei.Horizontal&&r.push(db),e&ei.Vertical&&r.push(hb),r}getEventNames(){return UB.map(e=>this.options.event+e)}directionTest(e){const{options:r}=this;let n=!0,{distance:o}=e,{direction:c}=e;const d=e.deltaX,a=e.deltaY;return c&r.direction||(r.direction&ei.Horizontal?(c=d===0?ei.None:d<0?ei.Left:ei.Right,n=d!==this.pX,o=Math.abs(e.deltaX)):(c=a===0?ei.None:a<0?ei.Up:ei.Down,n=a!==this.pY,o=Math.abs(e.deltaY))),e.direction=c,n&&o>r.threshold&&!!(c&r.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&ar.Began)||!(this.state&ar.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const r=ei[e.direction].toLowerCase();r&&(e.additionalEvent=this.options.event+r),super.emit(e)}}const VB=["","start","move","end","cancel","in","out"];class jB extends GP{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[$m]}getEventNames(){return VB.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&ar.Began))}emit(e){if(e.scale!==1){const r=e.scale<1?"in":"out";e.additionalEvent=this.options.event+r}super.emit(e)}}class Ey{constructor(e,r,n){this.element=e,this.callback=r,this.options=n}}const $B=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",WB=$B.indexOf("firefox")!==-1,n3=4.000244140625,HB=40,XB=.25;class ZB extends Ey{constructor(e,r,n){super(e,r,{enable:!0,...n}),this.handleEvent=o=>{if(!this.options.enable)return;let c=o.deltaY;globalThis.WheelEvent&&(WB&&o.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(c/=globalThis.devicePixelRatio),o.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(c*=HB)),c!==0&&c%n3===0&&(c=Math.floor(c/n3)),o.shiftKey&&c&&(c=c*XB),this.callback({type:"wheel",center:{x:o.clientX,y:o.clientY},delta:-c,srcEvent:o,pointerType:"mouse",target:o.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,r){e==="wheel"&&(this.options.enable=r)}}const i3=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class qB extends Ey{constructor(e,r,n){super(e,r,{enable:!0,...n}),this.handleEvent=c=>{this.handleOverEvent(c),this.handleOutEvent(c),this.handleEnterEvent(c),this.handleLeaveEvent(c),this.handleMoveEvent(c)},this.pressed=!1;const{enable:o}=this.options;this.enableMoveEvent=o,this.enableLeaveEvent=o,this.enableEnterEvent=o,this.enableOutEvent=o,this.enableOverEvent=o,i3.forEach(c=>e.addEventListener(c,this.handleEvent))}destroy(){i3.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){switch(e){case"pointermove":this.enableMoveEvent=r;break;case"pointerover":this.enableOverEvent=r;break;case"pointerout":this.enableOutEvent=r;break;case"pointerenter":this.enableEnterEvent=r;break;case"pointerleave":this.enableLeaveEvent=r;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,r){this.callback({type:e,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}}const s3=["keydown","keyup"];class YB extends Ey{constructor(e,r,n){super(e,r,{enable:!0,tabIndex:0,...n}),this.handleEvent=o=>{const c=o.target||o.srcElement;c.tagName==="INPUT"&&c.type==="text"||c.tagName==="TEXTAREA"||(this.enableDownEvent&&o.type==="keydown"&&this.callback({type:"keydown",srcEvent:o,key:o.key,target:o.target}),this.enableUpEvent&&o.type==="keyup"&&this.callback({type:"keyup",srcEvent:o,key:o.key,target:o.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",s3.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){s3.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e==="keydown"&&(this.enableDownEvent=r),e==="keyup"&&(this.enableUpEvent=r)}}class GB extends Ey{constructor(e,r,n){super(e,r,n),this.handleEvent=o=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:o.clientX,y:o.clientY},srcEvent:o,pointerType:"mouse",target:o.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,r){e==="contextmenu"&&(this.options.enable=r)}}const o3=1,fb=2,a3=4,KB={pointerdown:o3,pointermove:fb,pointerup:a3,mousedown:o3,mousemove:fb,mouseup:a3},QB=0,JB=1,e6=2,t6=1,r6=2,n6=4;function i6(t){const e=KB[t.srcEvent.type];if(!e)return null;const{buttons:r,button:n}=t.srcEvent;let o=!1,c=!1,d=!1;return e===fb?(o=!!(r&t6),c=!!(r&n6),d=!!(r&r6)):(o=n===QB,c=n===JB,d=n===e6),{leftButton:o,middleButton:c,rightButton:d}}function s6(t,e){const r=t.center;if(!r)return null;const n=e.getBoundingClientRect(),o=n.width/e.offsetWidth||1,c=n.height/e.offsetHeight||1,d={x:(r.x-n.left-e.clientLeft)/o,y:(r.y-n.top-e.clientTop)/c};return{center:r,offsetCenter:d}}const o6={srcElement:"root",priority:0};class a6{constructor(e,r){this.handleEvent=n=>{if(this.isEmpty())return;const o=this._normalizeEvent(n);let c=n.srcEvent.target;for(;c&&c!==o.rootElement;){if(this._emit(o,c),o.handled)return;c=c.parentNode}this._emit(o,"root")},this.eventManager=e,this.recognizerName=r,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,r,n,o=!1,c=!1){const{handlers:d,handlersByElement:a}=this,y={...o6,...n};let S=a.get(y.srcElement);S||(S=[],a.set(y.srcElement,S));const E={type:e,handler:r,srcElement:y.srcElement,priority:y.priority};o&&(E.once=!0),c&&(E.passive=!0),d.push(E),this._active=this._active||!E.passive;let M=S.length-1;for(;M>=0&&!(S[M].priority>=E.priority);)M--;S.splice(M+1,0,E)}remove(e,r){const{handlers:n,handlersByElement:o}=this;for(let c=n.length-1;c>=0;c--){const d=n[c];if(d.type===e&&d.handler===r){n.splice(c,1);const a=o.get(d.srcElement);a.splice(a.indexOf(d),1),a.length===0&&o.delete(d.srcElement)}}this._active=n.some(c=>!c.passive)}_emit(e,r){const n=this.handlersByElement.get(r);if(n){let o=!1;const c=()=>{e.handled=!0},d=()=>{e.handled=!0,o=!0},a=[];for(let y=0;y<n.length;y++){const{type:S,handler:E,once:M}=n[y];if(E({...e,type:S,stopPropagation:c,stopImmediatePropagation:d}),M&&a.push(n[y]),o)break}for(let y=0;y<a.length;y++){const{type:S,handler:E}=a[y];this.remove(S,E)}}}_normalizeEvent(e){const r=this.eventManager.getElement();return{...e,...i6(e),...s6(e,r),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}}function l6(t){if("recognizer"in t)return t;let e;const r=Array.isArray(t)?[...t]:[t];if(typeof r[0]=="function"){const n=r.shift(),o=r.shift()||{};e=new n(o)}else e=r.shift();return{recognizer:e,recognizeWith:typeof r[0]=="string"?[r[0]]:r[0],requireFailure:typeof r[1]=="string"?[r[1]]:r[1]}}class c6{constructor(e=null,r={}){if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...r},this.events=new Map,this.element=e,!!e){this.manager=new LB(e,this.options);for(const n of this.options.recognizers){const{recognizer:o,recognizeWith:c,requireFailure:d}=l6(n);this.manager.add(o),c&&o.recognizeWith(c),d&&o.requireFailure(d)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new ZB(e,this._onOtherEvent,{enable:!1}),this.moveInput=new qB(e,this._onOtherEvent,{enable:!1}),this.keyInput=new YB(e,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new GB(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,r,n){this._addEventHandler(e,r,n,!1)}once(e,r,n){this._addEventHandler(e,r,n,!0)}watch(e,r,n){this._addEventHandler(e,r,n,!1,!0)}off(e,r){this._removeEventHandler(e,r)}_toggleRecognizer(e,r){var c,d,a,y;const{manager:n}=this;if(!n)return;const o=n.get(e);o&&(o.set({enable:r}),n.touchAction.update()),(c=this.wheelInput)==null||c.enableEventType(e,r),(d=this.moveInput)==null||d.enableEventType(e,r),(a=this.keyInput)==null||a.enableEventType(e,r),(y=this.contextmenuInput)==null||y.enableEventType(e,r)}_addEventHandler(e,r,n,o,c){if(typeof e!="string"){n=r;for(const[S,E]of Object.entries(e))this._addEventHandler(S,E,n,o,c);return}const{manager:d,events:a}=this;if(!d)return;let y=a.get(e);if(!y){const S=this._getRecognizerName(e)||e;y=new a6(this,S),a.set(e,y),d&&d.on(e,y.handleEvent)}y.add(e,r,n,o,c),y.isEmpty()||this._toggleRecognizer(y.recognizerName,!0)}_removeEventHandler(e,r){if(typeof e!="string"){for(const[c,d]of Object.entries(e))this._removeEventHandler(c,d);return}const{events:n}=this,o=n.get(e);if(o&&(o.remove(e,r),o.isEmpty())){const{recognizerName:c}=o;let d=!1;for(const a of n.values())if(a.recognizerName===c&&!a.isEmpty()){d=!0;break}d||this._toggleRecognizer(c,!1)}}_getRecognizerName(e){var r;return(r=this.manager.recognizers.find(n=>n.getEventNames().includes(e)))==null?void 0:r.options.event}}const Ir={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ir,"IDENTITY",{get:()=>(Gr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Os={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},B_={common:0,meters:1,pixels:2},pb={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},l3={multipan:[r3,{threshold:10,direction:ei.Vertical,pointers:2}],pinch:[jB,{},null,["multipan"]],pan:[r3,{threshold:1},["pinch"],["multipan"]],dblclick:[t3,{event:"dblclick",taps:2}],click:[t3,{event:"click"},null,["dblclick"]]};function u6(t,e){if(t===e)return!0;if(Array.isArray(t)){const r=t.length;if(!e||e.length!==r)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}return!1}function Lp(t){let e={},r;return n=>{for(const o in n)if(!u6(n[o],e[o])){r=t(n),e=n;break}return r}}const c3=[0,0,0,0],h6=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],KP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d6=[0,0,0],QP=[0,0,0],f6=Lp(m6);function JP(t,e,r=QP){r.length<3&&(r=[r[0],r[1],0]);let n=r,o,c=!0;switch(e===Ir.LNGLAT_OFFSETS||e===Ir.METER_OFFSETS?o=r:o=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Os.WEB_MERCATOR:(e===Ir.LNGLAT||e===Ir.CARTESIAN)&&(o=[0,0,0],c=!1);break;case Os.WEB_MERCATOR_AUTO_OFFSET:e===Ir.LNGLAT?n=o:e===Ir.CARTESIAN&&(n=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],o=t.unprojectPosition(n),n[0]-=r[0],n[1]-=r[1],n[2]-=r[2]);break;case Os.IDENTITY:n=t.position.map(Math.fround),n[2]=n[2]||0;break;case Os.GLOBE:c=!1,o=null;break;default:c=!1}return{geospatialOrigin:o,shaderCoordinateOrigin:n,offsetMode:c}}function p6(t,e,r){const{viewMatrixUncentered:n,projectionMatrix:o}=t;let{viewMatrix:c,viewProjectionMatrix:d}=t,a=c3,y=c3,S=t.cameraPosition;const{geospatialOrigin:E,shaderCoordinateOrigin:M,offsetMode:F}=JP(t,e,r);return F&&(y=t.projectPosition(E||M),S=[S[0]-y[0],S[1]-y[1],S[2]-y[2]],y[3]=1,a=od([],y,d),c=n||c,d=Hc([],o,c),d=Hc([],d,h6)),{viewMatrix:c,viewProjectionMatrix:d,projectionCenter:a,originCommon:y,cameraPosCommon:S,shaderCoordinateOrigin:M,geospatialOrigin:E}}function g6({viewport:t,devicePixelRatio:e=1,modelMatrix:r=null,coordinateSystem:n=Ir.DEFAULT,coordinateOrigin:o=QP,autoWrapLongitude:c=!1}){n===Ir.DEFAULT&&(n=t.isGeospatial?Ir.LNGLAT:Ir.CARTESIAN);const d=f6({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:o});return d.wrapLongitude=c,d.modelMatrix=r||KP,d}function m6({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:n}){const{projectionCenter:o,viewProjectionMatrix:c,originCommon:d,cameraPosCommon:a,shaderCoordinateOrigin:y,geospatialOrigin:S}=p6(t,r,n),E=t.getDistanceScales(),M=[t.width*e,t.height*e],F=od([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,N={coordinateSystem:r,projectionMode:t.projectionMode,coordinateOrigin:y,commonOrigin:d.slice(0,3),center:o,pseudoMeters:!!t._pseudoMeters,viewportSize:M,devicePixelRatio:e,focalDistance:F,commonUnitsPerMeter:E.unitsPerMeter,commonUnitsPerWorldUnit:E.unitsPerMeter,commonUnitsPerWorldUnit2:d6,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:c,modelMatrix:KP,cameraPosition:a};if(S){const G=t.getDistanceScales(S);switch(r){case Ir.METER_OFFSETS:N.commonUnitsPerWorldUnit=G.unitsPerMeter,N.commonUnitsPerWorldUnit2=G.unitsPerMeter2;break;case Ir.LNGLAT:case Ir.LNGLAT_OFFSETS:t._pseudoMeters||(N.commonUnitsPerMeter=G.unitsPerMeter),N.commonUnitsPerWorldUnit=G.unitsPerDegree,N.commonUnitsPerWorldUnit2=G.unitsPerDegree2;break;case Ir.CARTESIAN:N.commonUnitsPerWorldUnit=[1,1,G.unitsPerMeter[2]],N.commonUnitsPerWorldUnit2=[0,0,G.unitsPerMeter2[2]];break}}return N}const _6=Object.keys(Ir).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${Ir[t]};`).join(""),y6=Object.keys(Os).map(t=>`const PROJECTION_MODE_${t}: i32 = ${Os[t]};`).join(""),v6=Object.keys(B_).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${B_[t]};`).join(""),x6=`${_6}
${y6}
${v6}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,b6=`${x6}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,w6=Object.keys(Ir).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Ir[t]};`).join(""),T6=Object.keys(Os).map(t=>`const int PROJECTION_MODE_${t} = ${Os[t]};`).join(""),S6=Object.keys(B_).map(t=>`const int UNIT_${t.toUpperCase()} = ${B_[t]};`).join(""),E6=`${w6}
${T6}
${S6}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,A6={};function I6(t=A6){return"viewport"in t?g6(t):{}}const Z1={name:"project",dependencies:[Gz,WP],source:b6,vs:E6,getUniforms:I6,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},P6=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,C6=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,M6={name:"project32",dependencies:[Z1],source:P6,vs:C6};function R6(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Vh(t,e){const r=od([],e,t);return BP(r,r,1/r[3]),r}function u3(t,e){const r=t%e;return r<0?e+r:r}function gb(t,e,r){return t<e?e:t>r?r:t}function k6(t){return Math.log(t)*Math.LOG2E}const q1=Math.log2||k6;function Ba(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const To=Math.PI,eC=To/4,Qs=To/180,mb=180/To,ed=512,U_=4003e4,Ml=85.051129,D6=1.5;function O6(t){return q1(t)}function xp(t){const[e,r]=t;Ba(Number.isFinite(e)),Ba(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");const n=e*Qs,o=r*Qs,c=ed*(n+To)/(2*To),d=ed*(To+Math.log(Math.tan(eC+o*.5)))/(2*To);return[c,d]}function td(t){const[e,r]=t,n=e/ed*(2*To)-To,o=2*(Math.atan(Math.exp(r/ed*(2*To)-To))-eC);return[n*mb,o*mb]}function F6(t){const{latitude:e}=t;Ba(Number.isFinite(e));const r=Math.cos(e*Qs);return O6(U_*r)-9}function Wm(t){const e=Math.cos(t*Qs);return ed/U_/e}function _b(t){const{latitude:e,longitude:r,highPrecision:n=!1}=t;Ba(Number.isFinite(e)&&Number.isFinite(r));const o=ed,c=Math.cos(e*Qs),d=o/360,a=d/c,y=o/U_/c,S={unitsPerMeter:[y,y,y],metersPerUnit:[1/y,1/y,1/y],unitsPerDegree:[d,a,y],degreesPerUnit:[1/d,1/a,1/y]};if(n){const E=Qs*Math.tan(e*Qs)/c,M=d*E/2,F=o/U_*E,N=F/a*y;S.unitsPerDegree2=[0,M,F],S.unitsPerMeter2=[N,0,N]}return S}function tC(t,e){const[r,n,o]=t,[c,d,a]=e,{unitsPerMeter:y,unitsPerMeter2:S}=_b({longitude:r,latitude:n,highPrecision:!0}),E=xp(t);E[0]+=c*(y[0]+S[0]*d),E[1]+=d*(y[1]+S[1]*d);const M=td(E),F=(o||0)+(a||0);return Number.isFinite(o)||Number.isFinite(a)?[M[0],M[1],F]:M}function N6(t){const{height:e,pitch:r,bearing:n,altitude:o,scale:c,center:d}=t,a=R6();L_(a,a,[0,0,-o]),LP(a,a,-r*Qs),zP(a,a,n*Qs);const y=c/e;return X1(a,a,[y,y,y]),d&&L_(a,a,mz([],d)),a}function L6(t){const{width:e,height:r,altitude:n,pitch:o=0,offset:c,center:d,scale:a,nearZMultiplier:y=1,farZMultiplier:S=1}=t;let{fovy:E=bp(D6)}=t;n!==void 0&&(E=bp(n));const M=E*Qs,F=o*Qs,N=Y1(E);let G=N;d&&(G+=d[2]*a/Math.cos(F)/r);const re=M*(.5+(c?c[1]:0)/r),me=Math.sin(re)*G/Math.sin(gb(Math.PI/2-F-re,.01,Math.PI-.01)),Y=Math.sin(F)*me+G,q=G*10,Z=Math.min(Y*S,q);return{fov:M,aspect:e/r,focalDistance:N,near:y,far:Z}}function bp(t){return 2*Math.atan(.5/t)*mb}function Y1(t){return .5/Math.tan(.5*t*Qs)}function rC(t,e){const[r,n,o=0]=t;return Ba(Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(o)),Vh(e,[r,n,o,1])}function G1(t,e,r=0){const[n,o,c]=t;if(Ba(Number.isFinite(n)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(c))return Vh(e,[n,o,c,1]);const d=Vh(e,[n,o,0,1]),a=Vh(e,[n,o,1,1]),y=d[2],S=a[2],E=y===S?0:((r||0)-y)/(S-y);return DP([],d,a,E)}function z6(t){const{width:e,height:r,bounds:n,minExtent:o=0,maxZoom:c=24,offset:d=[0,0]}=t,[[a,y],[S,E]]=n,M=B6(t.padding),F=xp([a,gb(E,-Ml,Ml)]),N=xp([S,gb(y,-Ml,Ml)]),G=[Math.max(Math.abs(N[0]-F[0]),o),Math.max(Math.abs(N[1]-F[1]),o)],re=[e-M.left-M.right-Math.abs(d[0])*2,r-M.top-M.bottom-Math.abs(d[1])*2];Ba(re[0]>0&&re[1]>0);const me=re[0]/G[0],Y=re[1]/G[1],q=(M.right-M.left)/2/me,Z=(M.top-M.bottom)/2/Y,le=[(N[0]+F[0])/2+q,(N[1]+F[1])/2+Z],Ae=td(le),we=Math.min(c,q1(Math.abs(Math.min(me,Y))));return Ba(Number.isFinite(we)),{longitude:Ae[0],latitude:Ae[1],zoom:we}}function B6(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Ba(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const h3=Math.PI/180;function U6(t,e=0){const{width:r,height:n,unproject:o}=t,c={targetZ:e},d=o([0,n],c),a=o([r,n],c);let y,S;const E=t.fovy?.5*t.fovy*h3:Math.atan(.5/t.altitude),M=(90-t.pitch)*h3;return E>M-.01?(y=d3(t,0,e),S=d3(t,r,e)):(y=o([0,0],c),S=o([r,0],c)),[d,a,S,y]}function d3(t,e,r){const{pixelUnprojectionMatrix:n}=t,o=Vh(n,[e,0,1,1]),c=Vh(n,[e,t.height,1,1]),a=(r*t.distanceScales.unitsPerMeter[2]-o[2])/(c[2]-o[2]),y=DP([],o,c,a),S=td(y);return S.push(r),S}const f3=512;function V6(t){const{width:e,height:r,pitch:n=0}=t;let{longitude:o,latitude:c,zoom:d,bearing:a=0}=t;(o<-180||o>180)&&(o=u3(o+180,360)-180),(a<-180||a>180)&&(a=u3(a+180,360)-180);const y=q1(r/f3);if(d<=y)d=y,c=0;else{const S=r/2/Math.pow(2,d),E=td([0,S])[1];if(c<E)c=E;else{const M=td([0,f3-S])[1];c>M&&(c=M)}}return{width:e,height:r,longitude:o,latitude:c,zoom:d,pitch:n,bearing:a}}const nC=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,j6=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,$6=`
${nC}
${j6}
`,W6=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,H6=`
${nC}
${W6}
`,X6=Lp(K6),Z6=Lp(Q6),q6=[0,0,0,1],Y6=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function G6(t,e){const[r,n,o]=t,c=G1([r,n,o],e);return Number.isFinite(o)?c:[c[0],c[1],0]}function K6({viewport:t,center:e}){return new Po(t.viewProjectionMatrix).invert().transform(e)}function Q6({viewport:t,shadowMatrices:e}){const r=[],n=t.pixelUnprojectionMatrix,o=t.isGeospatial?void 0:1,c=[[0,0,o],[t.width,0,o],[0,t.height,o],[t.width,t.height,o],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(d=>G6(d,n));for(const d of e){const a=d.clone().translate(new ea(t.center).negate()),y=c.map(E=>a.transform(E)),S=new Po().ortho({left:Math.min(...y.map(E=>E[0])),right:Math.max(...y.map(E=>E[0])),bottom:Math.min(...y.map(E=>E[1])),top:Math.max(...y.map(E=>E[1])),near:Math.min(...y.map(E=>-E[2])),far:Math.max(...y.map(E=>-E[2]))});r.push(S.multiplyRight(d))}return r}function J6(t){const{shadowEnabled:e=!0,project:r}=t;if(!e||!r||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const n=Z1.getUniforms(r),o=X6({viewport:r.viewport,center:n.center}),c=[],d=Z6({shadowMatrices:t.shadowMatrices,viewport:r.viewport}).slice();for(let y=0;y<t.shadowMatrices.length;y++){const S=d[y],E=S.clone().translate(new ea(r.viewport.center).negate());n.coordinateSystem===Ir.LNGLAT&&n.projectionMode===Os.WEB_MERCATOR?(d[y]=E,c[y]=o):(d[y]=S.clone().multiplyRight(Y6),c[y]=E.transform(o))}const a={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||q6,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let y=0;y<d.length;y++)a[`viewProjectionMatrix${y}`]=d[y],a[`projectCenter${y}`]=c[y];for(let y=0;y<2;y++)a[`shadow_uShadowMap${y}`]=t.shadowMaps&&t.shadowMaps[y]||t.dummyShadowMap;return a}const p3={name:"shadow",dependencies:[Z1],vs:$6,fs:H6,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:J6,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},e5={...HS,defaultUniforms:{...HS.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},t5=[WP],r5=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],n5=[];function i5(t){const e=S_.getDefaultShaderAssembler();for(const n of t5)e.addDefaultModule(n);const r=t==="glsl"?r5:n5;for(const n of r)e.addShaderHook(n);return e}const s5=[255,255,255],o5=1;let a5=0;class l5{constructor(e={}){this.type="ambient";const{color:r=s5}=e,{intensity:n=o5}=e;this.id=e.id||`ambient-${a5++}`,this.color=r,this.intensity=n}}const c5=[255,255,255],u5=1,h5=[0,0,-1];let d5=0;class g3{constructor(e={}){this.type="directional";const{color:r=c5}=e,{intensity:n=u5}=e,{direction:o=h5}=e,{_shadow:c=!1}=e;this.id=e.id||`directional-${d5++}`,this.color=r,this.intensity=n,this.type="directional",this.direction=new ea(o).normalize().toArray(),this.shadow=c}getProjectedLight(e){return this}}class f5{constructor(e,r={id:"pass"}){const{id:n}=r;this.id=n,this.device=e,this.props={...r}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class K1 extends f5{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[r,n]=this.device.canvasContext.getDrawingBufferSize(),o=e.clearCanvas??!0,c=e.clearColor??(o?[0,0,0,0]:!1),d=o?1:!1,a=o?0:!1,y=e.colorMask??15,S={viewport:[0,0,r,n]};e.colorMask&&(S.colorMask=y),e.scissorRect&&(S.scissorRect=e.scissorRect);const E=this.device.beginRenderPass({framebuffer:e.target,parameters:S,clearColor:c,clearDepth:d,clearStencil:a});try{return this._drawLayers(E,e)}finally{E.end(),this.device.submit()}}_drawLayers(e,r){const{target:n,shaderModuleProps:o,viewports:c,views:d,onViewportActive:a,clearStack:y=!0}=r;r.pass=r.pass||"unknown",y&&(this._lastRenderIndex=-1);const S=[];for(const E of c){const M=d&&d[E.id];a==null||a(E);const F=this._getDrawLayerParams(E,r),N=E.subViewports||[E];for(const G of N){const re=this._drawLayersInViewport(e,{target:n,shaderModuleProps:o,viewport:G,view:M,pass:r.pass,layers:r.layers},F);S.push(re)}}return S}_getDrawLayerParams(e,{layers:r,pass:n,isPicking:o=!1,layerFilter:c,cullRect:d,effects:a,shaderModuleProps:y},S=!1){var G;const E=[],M=iC(this._lastRenderIndex+1),F={layer:r[0],viewport:e,isPicking:o,renderPass:n,cullRect:d},N={};for(let re=0;re<r.length;re++){const me=r[re],Y=this._shouldDrawLayer(me,F,c,N),q={shouldDrawLayer:Y};Y&&!S&&(q.shouldDrawLayer=!0,q.layerRenderIndex=M(me,Y),q.shaderModuleProps=this._getShaderModuleProps(me,a,n,y),q.layerParameters={...(G=me.context.deck)==null?void 0:G.props.parameters,...this.getLayerParameters(me,re,e)}),E[re]=q}return E}_drawLayersInViewport(e,{layers:r,shaderModuleProps:n,pass:o,target:c,viewport:d,view:a},y){const S=p5(this.device,{shaderModuleProps:n,target:c,viewport:d});if(a&&a.props.clear){const M=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.beginRenderPass({framebuffer:c,parameters:{viewport:S,scissorRect:S},clearColor:M.color?[0,0,0,0]:!1,clearDepth:M.depth?1:!1}).end()}const E={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:S});for(let M=0;M<r.length;M++){const F=r[M],N=y[M],{shouldDrawLayer:G}=N;if(G&&F.props.pickable&&E.pickableCount++,F.isComposite&&E.compositeCount++,F.isDrawable&&N.shouldDrawLayer){const{layerRenderIndex:re,shaderModuleProps:me,layerParameters:Y}=N;E.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,re),me.project&&(me.project.viewport=d),F.context.renderPass=e;try{F._drawLayer({renderPass:e,shaderModuleProps:me,uniforms:{layerIndex:re},parameters:Y})}catch(q){F.raiseError(q,`drawing ${F} to ${o}`)}}}return E}shouldDrawLayer(e){return!0}getShaderModuleProps(e,r,n){return null}getLayerParameters(e,r,n){return e.props.parameters}_shouldDrawLayer(e,r,n,o){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;r.layer=e;let d=e.parent;for(;d;){if(!d.props.visible||!d.filterSubLayer(r))return!1;r.layer=d,d=d.parent}if(n){const a=r.layer.id;if(a in o||(o[a]=n(r)),!o[a])return!1}return e.activateViewport(r.viewport),!0}_getShaderModuleProps(e,r,n,o){var y,S;const c=this.device.canvasContext.cssToDeviceRatio(),d=((y=e.internalState)==null?void 0:y.propsInTransition)||e.props,a={layer:d,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:c,modelMatrix:d.modelMatrix,coordinateSystem:d.coordinateSystem,coordinateOrigin:d.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(r)for(const E of r)m3(a,(S=E.getShaderModuleProps)==null?void 0:S.call(E,e,a));return m3(a,this.getShaderModuleProps(e,r,a),o)}}function iC(t=0,e={}){const r={},n=(o,c)=>{const d=o.props._offset,a=o.id,y=o.parent&&o.parent.id;let S;if(y&&!(y in e)&&n(o.parent,!1),y in r){const E=r[y]=r[y]||iC(e[y],e);S=E(o,c),r[a]=E}else Number.isFinite(d)?(S=d+(e[y]||0),r[a]=null):S=t;return c&&S>=t&&(t=S+1),e[a]=S,S};return n}function p5(t,{shaderModuleProps:e,target:r,viewport:n}){var y;const o=((y=e==null?void 0:e.project)==null?void 0:y.devicePixelRatio)??t.canvasContext.cssToDeviceRatio(),[,c]=t.canvasContext.getDrawingBufferSize(),d=r?r.height:c,a=n;return[a.x*o,d-(a.y+a.height)*o,a.width*o,a.height*o]}function m3(t,...e){for(const r of e)if(r)for(const n in r)t[n]?Object.assign(t[n],r[n]):t[n]=r[n];return t}class g5 extends K1{constructor(e,r){super(e,r);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),o=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:o})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const r=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),o=e.viewports[0],c=o.width*n,d=o.height*n,a=[1,1,1,1];(c!==r.width||d!==r.height)&&r.resize({width:c,height:d}),super.render({...e,clearColor:a,target:r,pass:"shadow"})}getLayerParameters(e,r,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,r,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const m5={color:[255,255,255],intensity:1},_3=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],_5=[0,0,0,200/255];class sC{constructor(e={}){this.id="lighting-effect",this.shadowColor=_5,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:r,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),n._addDefaultShaderModule(p3),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const r in e){const n=e[r];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:r,viewports:n,onViewportActive:o,views:c}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let d=0;d<this.shadowPasses.length;d++)this.shadowPasses[d].render({layers:e,layerFilter:r,viewports:n,onViewportActive:o,views:c,shaderModuleProps:{shadow:{shadowLightId:d,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,r){const n=this.shadow?{project:r.project,shadowMaps:this.shadowPasses.map(d=>d.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},o={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(d=>d.getProjectedLight({layer:e})),pointLights:this.pointLights.map(d=>d.getProjectedLight({layer:e}))},c=e.props.material;return{shadow:n,lighting:o,phongMaterial:c,gouraudMaterial:c}}cleanup(e){for(const r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(p3))}_calculateMatrices(){const e=[];for(const r of this.directionalLights){const n=new Po().lookAt({eye:new ea(r.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let r=0;r<this.directionalLights.length;r++){const n=new g5(e);this.shadowPasses[r]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:r,directionalLights:n}=this;!e&&r.length===0&&n.length===0&&(this.ambientLight=new l5(m5),this.directionalLights.push(new g3(_3[0]),new g3(_3[1])))}}class y5{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,r,{size:n=1,type:o,padding:c=0,copy:d=!1,initialize:a=!1,maxCount:y}){const S=o||e&&e.constructor||Float32Array,E=r*n+c;if(ArrayBuffer.isView(e)){if(E<=e.length)return e;if(E*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new S(e.buffer,0,E)}let M=1/0;y&&(M=y*n+c);const F=this._allocate(S,E,a,M);return e&&d?F.set(e):a||F.fill(0,0,4),this._release(e),F}release(e){this._release(e)}_allocate(e,r,n,o){let c=Math.max(Math.ceil(r*this.opts.overAlloc),1);c>o&&(c=o);const d=this._pool,a=e.BYTES_PER_ELEMENT*c,y=d.findIndex(S=>S.byteLength>=a);if(y>=0){const S=new e(d.splice(y,1)[0],0,c);return n&&S.fill(0),S}return new e(c)}_release(e){if(!ArrayBuffer.isView(e))return;const r=this._pool,{buffer:n}=e,{byteLength:o}=n,c=r.findIndex(d=>d.byteLength>=o);c<0?r.push(n):(c>0||r.length<this.opts.poolSize)&&r.splice(c,0,n),r.length>this.opts.poolSize&&r.shift()}}const wp=new y5;function kf(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function v5(t,e){const r=t%e;return r<0?e+r:r}function x5(t){return[t[12],t[13],t[14]]}function b5(t){return{left:fh(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:fh(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:fh(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:fh(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:fh(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:fh(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const y3=new ea;function fh(t,e,r,n){y3.set(t,e,r);const o=y3.len();return{distance:n/o,normal:new ea(-t/o,-e/o,-r/o)}}function w5(t){return t-Math.fround(t)}let Tf;function D0(t,e){const{size:r=1,startIndex:n=0}=e,o=e.endIndex!==void 0?e.endIndex:t.length,c=(o-n)/r;Tf=wp.allocate(Tf,c,{type:Float32Array,size:r*2});let d=n,a=0;for(;d<o;){for(let y=0;y<r;y++){const S=t[d++];Tf[a+y]=S,Tf[a+y+r]=w5(S)}a+=r*2}return Tf.subarray(0,c*r*2)}function T5(t){let e=null,r=!1;for(const n of t)n&&(e?(r||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],r=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const S5=Math.PI/180,E5=kf(),v3=[0,0,0],A5={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function I5({width:t,height:e,orthographic:r,fovyRadians:n,focalDistance:o,padding:c,near:d,far:a}){const y=t/e,S=r?new Po().orthographic({fovy:n,aspect:y,focalDistance:o,near:d,far:a}):new Po().perspective({fovy:n,aspect:y,near:d,far:a});if(c){const{left:E=0,right:M=0,top:F=0,bottom:N=0}=c,G=Ko((E+t-M)/2,0,t)-t/2,re=Ko((F+e-N)/2,0,e)-e/2;S[8]-=G*2/t,S[9]+=re*2/e}return S}class ad{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||A5,this.focalDistance=e.focalDistance||1,this.position=e.position||v3,this.modelMatrix=e.modelMatrix||null;const{longitude:r,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(r),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Os.WEB_MERCATOR:Os.WEB_MERCATOR_AUTO_OFFSET:Os.IDENTITY}equals(e){return e instanceof ad?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&yp(e.projectionMatrix,this.projectionMatrix)&&yp(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:r=!0}={}){const n=this.projectPosition(e),o=rC(n,this.pixelProjectionMatrix),[c,d]=o,a=r?d:this.height-d;return e.length===2?[c,a]:[c,a,o[2]]}unproject(e,{topLeft:r=!0,targetZ:n}={}){const[o,c,d]=e,a=r?c:this.height-c,y=n&&n*this.distanceScales.unitsPerMeter[2],S=G1([o,a,d],this.pixelUnprojectionMatrix,y),[E,M,F]=this.unprojectPosition(S);return Number.isFinite(d)?[E,M,F]:Number.isFinite(n)?[E,M,n]:[E,M]}projectPosition(e){const[r,n]=this.projectFlat(e),o=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,n,o]}unprojectPosition(e){const[r,n]=this.unprojectFlat(e),o=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[r,n,o]}projectFlat(e){if(this.isGeospatial){const r=xp(e);return r[1]=Ko(r[1],-318,830),r}return e}unprojectFlat(e){return this.isGeospatial?td(e):e}getBounds(e={}){const r={targetZ:e.z||0},n=this.unproject([0,0],r),o=this.unproject([this.width,0],r),c=this.unproject([0,this.height],r),d=this.unproject([this.width,this.height],r);return[Math.min(n[0],o[0],c[0],d[0]),Math.min(n[1],o[1],c[1],d[1]),Math.max(n[0],o[0],c[0],d[0]),Math.max(n[1],o[1],c[1],d[1])]}getDistanceScales(e){return e&&this.isGeospatial?_b({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:r,width:n=1,height:o=1}){return e<this.x+this.width&&this.x<e+n&&r<this.y+this.height&&this.y<r+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,b5(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,r){return null}_initProps(e){const r=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=F6({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||_b({latitude:n,longitude:r}));const o=Math.pow(2,this.zoom);this.scale=o;const{position:c,modelMatrix:d}=e;let a=v3;if(c&&(a=d?new Po(d).transformAsVector(c,[]):c),this.isGeospatial){const y=this.projectPosition([r,n,0]);this.center=new ea(a).scale(this.distanceScales.unitsPerMeter).add(y)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:r=E5,projectionMatrix:n=null,orthographic:o=!1,fovyRadians:c,fovy:d=75,near:a=.1,far:y=1e3,padding:S=null,focalDistance:E=1}=e;this.viewMatrixUncentered=r,this.viewMatrix=new Po().multiplyRight(r).translate(new ea(this.center).negate()),this.projectionMatrix=n||I5({width:this.width,height:this.height,orthographic:o,fovyRadians:c||d*S5,focalDistance:E,padding:S,near:a,far:y});const M=kf();Hc(M,M,this.projectionMatrix),Hc(M,M,this.viewMatrix),this.viewProjectionMatrix=M,this.viewMatrixInverse=lb([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=x5(this.viewMatrixInverse);const F=kf(),N=kf();X1(F,F,[this.width/2,-this.height/2,1]),L_(F,F,[1,-1,0]),Hc(N,F,this.viewProjectionMatrix),this.pixelProjectionMatrix=N,this.pixelUnprojectionMatrix=lb(kf(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Gr.warn("Pixel project matrix not invertible")()}}ad.displayName="Viewport";class ru extends ad{constructor(e={}){const{latitude:r=0,longitude:n=0,zoom:o=0,pitch:c=0,bearing:d=0,nearZMultiplier:a=.1,farZMultiplier:y=1.01,nearZ:S,farZ:E,orthographic:M=!1,projectionMatrix:F,repeat:N=!1,worldOffset:G=0,position:re,padding:me,legacyMeterSizes:Y=!1}=e;let{width:q,height:Z,altitude:le=1.5}=e;const Ae=Math.pow(2,o);q=q||1,Z=Z||1;let we,je=null;if(F)le=F[5]/2,we=bp(le);else{e.fovy?(we=e.fovy,le=Y1(we)):we=bp(le);let Ze;if(me){const{top:qe=0,bottom:Ke=0}=me;Ze=[0,Ko((qe+Z-Ke)/2,0,Z)-Z/2]}je=L6({width:q,height:Z,scale:Ae,center:re&&[0,0,re[2]*Wm(r)],offset:Ze,pitch:c,fovy:we,nearZMultiplier:a,farZMultiplier:y}),Number.isFinite(S)&&(je.near=S),Number.isFinite(E)&&(je.far=E)}let Ue=N6({height:Z,pitch:c,bearing:d,scale:Ae,altitude:le});G&&(Ue=new Po().translate([512*G,0,0]).multiplyLeft(Ue)),super({...e,width:q,height:Z,viewMatrix:Ue,longitude:n,latitude:r,zoom:o,...je,fovy:we,focalDistance:le}),this.latitude=r,this.longitude=n,this.zoom=o,this.pitch=c,this.bearing=d,this.altitude=le,this.fovy=we,this.orthographic=M,this._subViewports=N?[]:null,this._pseudoMeters=Y,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),r=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let o=r;o<=n;o++){const c=o?new ru({...this,worldOffset:o}):this;this._subViewports.push(c)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[r,n]=this.projectFlat(e),o=(e[2]||0)*Wm(e[1]);return[r,n,o]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[r,n]=this.unprojectFlat(e),o=(e[2]||0)/Wm(n);return[r,n,o]}addMetersToLngLat(e,r){return tC(e,r)}panByPosition(e,r){const n=G1(r,this.pixelUnprojectionMatrix),o=this.projectFlat(e),c=$S([],o,lz([],n)),d=$S([],this.center,c),[a,y]=this.unprojectFlat(d);return{longitude:a,latitude:y}}getBounds(e={}){const r=U6(this,e.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(e,r={}){const{width:n,height:o}=this,{longitude:c,latitude:d,zoom:a}=z6({width:n,height:o,bounds:e,...r});return new ru({width:n,height:o,longitude:c,latitude:d,zoom:a})}}ru.displayName="WebMercatorViewport";const x3=[0,0,0];function O0(t,e,r=!1){const n=e.projectPosition(t);if(r&&e instanceof ru){const[o,c,d=0]=t,a=e.getDistanceScales([o,c]);n[2]=d*a.unitsPerMeter[2]}return n}function P5(t){const{viewport:e,modelMatrix:r,coordinateOrigin:n}=t;let{coordinateSystem:o,fromCoordinateSystem:c,fromCoordinateOrigin:d}=t;return o===Ir.DEFAULT&&(o=e.isGeospatial?Ir.LNGLAT:Ir.CARTESIAN),c===void 0&&(c=o),d===void 0&&(d=n),{viewport:e,coordinateSystem:o,coordinateOrigin:n,modelMatrix:r,fromCoordinateSystem:c,fromCoordinateOrigin:d}}function oC(t,{viewport:e,modelMatrix:r,coordinateSystem:n,coordinateOrigin:o,offsetMode:c}){let[d,a,y=0]=t;switch(r&&([d,a,y]=od([],[d,a,y,1],r)),n){case Ir.LNGLAT:return O0([d,a,y],e,c);case Ir.LNGLAT_OFFSETS:return O0([d+o[0],a+o[1],y+(o[2]||0)],e,c);case Ir.METER_OFFSETS:return O0(tC(o,[d,a,y]),e,c);case Ir.CARTESIAN:default:return e.isGeospatial?[d+o[0],a+o[1],y+o[2]]:e.projectPosition([d,a,y])}}function C5(t,e){const{viewport:r,coordinateSystem:n,coordinateOrigin:o,modelMatrix:c,fromCoordinateSystem:d,fromCoordinateOrigin:a}=P5(e),{autoOffset:y=!0}=e,{geospatialOrigin:S=x3,shaderCoordinateOrigin:E=x3,offsetMode:M=!1}=y?JP(r,n,o):{},F=oC(t,{viewport:r,modelMatrix:c,coordinateSystem:d,coordinateOrigin:a,offsetMode:M});if(M){const N=r.projectPosition(S||E);NP(F,F,N)}return F}let M5=1,R5=1;class aC{constructor(){Q(this,"time",0);Q(this,"channels",new Map);Q(this,"animations",new Map);Q(this,"playing",!1);Q(this,"lastEngineTime",-1)}addChannel(e){const{delay:r=0,duration:n=Number.POSITIVE_INFINITY,rate:o=1,repeat:c=1}=e,d=M5++,a={time:0,delay:r,duration:n,rate:o,repeat:c};return this._setChannelTime(a,this.time),this.channels.set(d,a),d}removeChannel(e){this.channels.delete(e);for(const[r,n]of this.animations)n.channel===e&&this.detachAnimation(r)}isFinished(e){const r=this.channels.get(e);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(e){if(e===void 0)return this.time;const r=this.channels.get(e);return r===void 0?-1:r.time}setTime(e){this.time=Math.max(0,e);const r=this.channels.values();for(const o of r)this._setChannelTime(o,this.time);const n=this.animations.values();for(const o of n){const{animation:c,channel:d}=o;c.setTime(this.getTime(d))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,r){const n=R5++;return this.animations.set(n,{animation:e,channel:r}),e.setTime(this.getTime(r)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,r){const n=r-e.delay,o=e.duration*e.repeat;n>=o?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}function k5(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function D5(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let O5=0;const F5={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Kx.stats.get(`animation-loop-${O5++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class N5{constructor(e){Q(this,"device",null);Q(this,"canvas",null);Q(this,"props");Q(this,"animationProps",null);Q(this,"timeline",null);Q(this,"stats");Q(this,"cpuTime");Q(this,"gpuTime");Q(this,"frameRate");Q(this,"display");Q(this,"needsRedraw","initialized");Q(this,"_initialized",!1);Q(this,"_running",!1);Q(this,"_animationFrameId",null);Q(this,"_nextFramePromise",null);Q(this,"_resolveNextFrame",null);Q(this,"_cpuStartTime",0);Q(this,"_error",null);if(this.props={...F5,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:r=!0}=this.props;this.stats=e.stats||new wy({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:r}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var n,o;if(this.props.onError(e),this._error=Error(),((o=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:o.canvas)instanceof HTMLCanvasElement){const c=document.createElement("h1");c.innerHTML=e.message,c.style.position="absolute",c.style.top="20%",c.style.left="10px",c.style.color="black",c.style.backgroundColor="red",document.body.appendChild(c)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const r=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=k5(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(D5(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var r;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(r=this.device)==null||r.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var r,n;const e=(n=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:n.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:r,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=r,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(r);const n=this.props.onAddHTML(r);n&&(r.innerHTML=n)}}_getSizeAndAspect(){var c,d,a,y;if(!this.device)return{width:1,height:1,aspect:1};const[e,r]=((d=(c=this.device)==null?void 0:c.canvasContext)==null?void 0:d.getPixelSize())||[1,1];let n=1;const o=(y=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:y.canvas;return o&&o.clientHeight?n=o.clientWidth/o.clientHeight:e>0&&r>0&&(n=e/r),{width:e,height:r,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,r;this.props.autoResizeDrawingBuffer&&((r=(e=this.device)==null?void 0:e.canvasContext)==null||r.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const F0={};function zp(t="id"){F0[t]=F0[t]||1;const e=F0[t]++;return`${t}-${e}`}class b3{constructor(e){Q(this,"id");Q(this,"userData",{});Q(this,"topology");Q(this,"bufferLayout",[]);Q(this,"vertexCount");Q(this,"indices");Q(this,"attributes");if(this.id=e.id||zp("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&gn.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const r of Object.values(this.attributes))r.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function L5(t,e){if(e instanceof b3)return e;const r=z5(t,e),{attributes:n,bufferLayout:o}=B5(t,e);return new b3({topology:e.topology||"triangle-list",bufferLayout:o,vertexCount:e.vertexCount,indices:r,attributes:n})}function z5(t,e){if(!e.indices)return;const r=e.indices.value;return t.createBuffer({usage:gn.INDEX,data:r})}function B5(t,e){const r=[],n={};for(const[c,d]of Object.entries(e.attributes)){let a=c;switch(c){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(d){n[a]=t.createBuffer({data:d.value,id:`${c}-buffer`});const{value:y,size:S,normalized:E}=d;r.push({name:a,format:bL(y,S,E)})}}const o=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:r,vertexCount:o}}const ny=class ny{constructor(e){Q(this,"device");Q(this,"destroyPolicy");Q(this,"_hashCounter",0);Q(this,"_hashes",{});Q(this,"_renderPipelineCache",{});Q(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new ny(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const r={...Gh.defaultProps,...e},n=this._hashRenderPipeline(r);if(!this._renderPipelineCache[n]){const o=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:void 0});o.hash=n,this._renderPipelineCache[n]={pipeline:o,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const r={...C_.defaultProps,...e},n=this._hashComputePipeline(r);if(!this._computePipelineCache[n]){const o=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0});o.hash=n,this._computePipelineCache[n]={pipeline:o,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const r=e.hash,n=e instanceof C_?this._computePipelineCache:this._renderPipelineCache;n[r].useCount--,n[r].useCount===0&&this.destroyPolicy==="unused"&&(n[r].pipeline.destroy(),delete n[r])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const r=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,o="-",c=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${r}/${n}V${o}BL${c}`;default:const d=this._getHash(JSON.stringify(e.parameters));return`${r}/${n}V${o}T${e.topology}P${d}BL${c}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};Q(ny,"defaultProps",{...Gh.defaultProps});let yb=ny;const iy=class iy{constructor(e){Q(this,"device");Q(this,"destroyPolicy");Q(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var r;return(r=e._lumaData).defaultShaderFactory||(r.defaultShaderFactory=new iy(e)),e._lumaData.defaultShaderFactory}createShader(e){const r=this._hashShader(e);let n=this._cache[r];if(!n){const o=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[r]=n={shader:o,useCount:0}}return n.useCount++,n.shader}release(e){const r=this._hashShader(e),n=this._cache[r];n&&(n.useCount--,n.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[r],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};Q(iy,"defaultProps",{...A_.defaultProps});let vb=iy;function U5(t,e){var o;const r={},n="Values";if(t.attributes.length===0&&!((o=t.varyings)!=null&&o.length))return{"No attributes or varyings":{[n]:"N/A"}};for(const c of t.attributes)if(c){const d=`${c.location} ${c.name}: ${c.type}`;r[`in ${d}`]={[n]:c.stepMode||"vertex"}}for(const c of t.varyings||[]){const d=`${c.location} ${c.name}`;r[`out ${d}`]={[n]:JSON.stringify(c)}}return r}let ci=null,Mc=null;function V5(t,{id:e,minimap:r,opaque:n,top:o="0",left:c="0",rgbaScale:d=1}){ci||(ci=document.createElement("canvas"),ci.id=e,ci.title=e,ci.style.zIndex="100",ci.style.position="absolute",ci.style.top=o,ci.style.left=c,ci.style.border="blue 5px solid",ci.style.transform="scaleY(-1)",document.body.appendChild(ci),Mc=ci.getContext("2d")),(ci.width!==t.width||ci.height!==t.height)&&(ci.width=t.width/2,ci.height=t.height/2,ci.style.width="400px",ci.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),y=Mc==null?void 0:Mc.createImageData(t.width,t.height);if(y){for(let E=0;E<a.length;E+=4)y.data[0+E+0]=a[E+0]*d,y.data[0+E+1]=a[E+1]*d,y.data[0+E+2]=a[E+2]*d,y.data[0+E+3]=n?255:a[E+3]*d;Mc==null||Mc.putImageData(y,0,0)}}function xb(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!xb(t[n],e[n],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),o=Object.keys(e);if(n.length!==o.length)return!1;for(const c of n)if(!e.hasOwnProperty(c)||!xb(t[c],e[c],r-1))return!1;return!0}return!1}function j5(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function $5(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function lC(t){return j5(t)||$5(t)}function W5(t){return lC(t)||typeof t=="number"||typeof t=="boolean"}function cC(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{const n=t[r];W5(n)?e.uniforms[r]=n:e.bindings[r]=n}),e}class H5{constructor(e,r){Q(this,"options",{disableWarnings:!1});Q(this,"modules");Q(this,"moduleUniforms");Q(this,"moduleBindings");Object.assign(this.options,r);const n=F1(Object.values(e).filter(o=>o.dependencies));for(const o of n)e[o.name]=o;lt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[o,c]of Object.entries(e))this._addModule(c),c.name&&o!==c.name&&!this.options.disableWarnings&&lt.warn(`Module name: ${o} vs ${c.name}`)()}destroy(){}setProps(e){var r;for(const n of Object.keys(e)){const o=n,c=e[o]||{},d=this.modules[o];if(!d){this.options.disableWarnings||lt.warn(`Module ${n} not found`)();continue}const a=this.moduleUniforms[o],y=this.moduleBindings[o],S=((r=d.getUniforms)==null?void 0:r.call(d,c,a))||c,{uniforms:E,bindings:M}=cC(S);this.moduleUniforms[o]={...a,...E},this.moduleBindings[o]={...y,...M}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const r of Object.values(this.moduleBindings))Object.assign(e,r);return e}getDebugTable(){var r;const e={};for(const[n,o]of Object.entries(this.moduleUniforms))for(const[c,d]of Object.entries(o))e[`${n}.${c}`]={type:(r=this.modules[n].uniformTypes)==null?void 0:r[c],value:String(d)};return e}_addModule(e){const r=e.name;this.moduleUniforms[r]=e.defaultUniforms||{},this.moduleBindings[r]={}}}let X5="";async function Z5(t,e){const r=new Image;return r.crossOrigin="anonymous",r.src=t.startsWith("http")?t:X5+t,await r.decode(),e?await createImageBitmap(r,e):await createImageBitmap(r)}class N0{constructor(e,r){Q(this,"device");Q(this,"id");Q(this,"texture");Q(this,"sampler");Q(this,"view");Q(this,"ready");Q(this,"isReady",!1);Q(this,"destroyed",!1);Q(this,"resolveReady",()=>{});Q(this,"rejectReady",()=>{});this.device=e,this.id=r.id||zp("async-texture"),typeof(r==null?void 0:r.data)=="string"&&r.dimension==="2d"&&(r={...r,data:Z5(r.data)}),this.ready=new Promise((n,o)=>{this.resolveReady=()=>{this.isReady=!0,n()},this.rejectReady=o}),this.initAsync(r)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const r=e.data;let n;try{n=await uC(r)}catch(c){this.rejectReady(c)}if(this.destroyed)return;const o={...e,data:n};this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const r=this.texture;this.texture=r.clone(e),r.destroy()}return!0}}async function uC(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(uC));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,r=await Promise.all(Object.values(e)),n=Object.keys(e),o={};for(let c=0;c<n.length;c++)o[n[c]]=r[c];return o}return t}const Rc=2,q5=1e4,sy=class sy{constructor(e,r){Q(this,"device");Q(this,"id");Q(this,"source");Q(this,"vs");Q(this,"fs");Q(this,"pipelineFactory");Q(this,"shaderFactory");Q(this,"userData",{});Q(this,"parameters");Q(this,"topology");Q(this,"bufferLayout");Q(this,"isInstanced");Q(this,"instanceCount",0);Q(this,"vertexCount");Q(this,"indexBuffer",null);Q(this,"bufferAttributes",{});Q(this,"constantAttributes",{});Q(this,"bindings",{});Q(this,"uniforms",{});Q(this,"vertexArray");Q(this,"transformFeedback",null);Q(this,"pipeline");Q(this,"shaderInputs");Q(this,"_uniformStore");Q(this,"_attributeInfos",{});Q(this,"_gpuGeometry",null);Q(this,"_getModuleUniforms");Q(this,"props");Q(this,"_pipelineNeedsUpdate","newly created");Q(this,"_needsRedraw","initializing");Q(this,"_destroyed",!1);Q(this,"_lastDrawTimestamp",-1);Q(this,"_lastLogTime",0);Q(this,"_logOpen",!1);Q(this,"_drawCount",0);var y,S,E,M;this.props={...sy.defaultProps,...r},r=this.props,this.id=r.id||zp("model"),this.device=e,Object.assign(this.userData,r.userData);const n=Object.fromEntries(((y=this.props.modules)==null?void 0:y.map(F=>[F.name,F]))||[]),o=r.shaderInputs||new H5(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(o);const c=G5(e),d=(((S=this.props.modules)==null?void 0:S.length)>0?this.props.modules:(E=this.shaderInputs)==null?void 0:E.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:F,getUniforms:N}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:c,...this.props,modules:d});this.source=F,this._getModuleUniforms=N,(M=this.props).shaderLayout||(M.shaderLayout=QL(this.source))}else{const{vs:F,fs:N,getUniforms:G}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:c,...this.props,modules:d});this.vs=F,this.fs=N,this._getModuleUniforms=G}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||yb.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||vb.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.uniforms&&this.setUniformsWebGL(r.uniforms),r.moduleSettings&&this.updateModuleSettingsWebGL(r.moduleSettings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const r=this._areBindingsLoading();if(r)return lt.info(Rc,`>>> DRAWING ABORTED ${this.id}: ${r} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const o=this._getBindings();this.pipeline.setBindings(o,{disableWarnings:this.props.disableWarnings}),bb(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:c}=this.vertexArray,d=c?c.byteLength/(c.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:d,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var n;(n=this._gpuGeometry)==null||n.destroy();const r=e&&L5(this.device,e);if(r){this.setTopology(r.topology||"triangle-list");const o=new w0(this.bufferLayout);this.bufferLayout=o.mergeBufferLayouts(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)}this._gpuGeometry=r}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const r=new w0(this.bufferLayout);this.bufferLayout=this._gpuGeometry?r.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){xb(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new xL(this.shaderInputs.modules);for(const[r,n]of Object.entries(this.shaderInputs.modules))if(Y5(n)){const o=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=o}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,r){const n=(r==null?void 0:r.disableWarnings)??this.props.disableWarnings;e.indices&&lt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=wL(this.pipeline.shaderLayout,this.bufferLayout);const o=new w0(this.bufferLayout);for(const[c,d]of Object.entries(e)){const a=o.getBufferLayout(c);if(!a){n||lt.warn(`Model(${this.id}): Missing layout for buffer "${c}".`)();continue}const y=o.getAttributeNamesForBuffer(a);let S=!1;for(const E of y){const M=this._attributeInfos[E];if(M){const F=this.device.type==="webgpu"?o.getBufferIndex(M.bufferName):M.location;this.vertexArray.setBuffer(F,d),S=!0}}!S&&!n&&lt.warn(`Model(${this.id}): Ignoring buffer "${d.id}" for unknown attribute "${c}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,r){for(const[n,o]of Object.entries(e)){const c=this._attributeInfos[n];c?this.vertexArray.setConstantWebGL(c.location,o):((r==null?void 0:r.disableWarnings)??this.props.disableWarnings)||lt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){bb(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:r,uniforms:n}=cC(this._getModuleUniforms(e));Object.assign(this.bindings,r),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof N0&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[r,n]of Object.entries(this.bindings))n instanceof N0?n.isReady&&(e[r]=n.texture):e[r]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const r of Object.values(this.bindings))r instanceof E_?e=Math.max(e,r.texture.updateTimestamp):r instanceof gn||r instanceof vn?e=Math.max(e,r.updateTimestamp):r instanceof N0?e=r.texture?Math.max(e,r.texture.updateTimestamp):1/0:r instanceof I_||(e=Math.max(e,r.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const r={...e.attributes};for(const[n]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(o=>o.name===n)&&n!=="positions"&&delete r[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,r=null;this.pipeline&&(lt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let o=null;this.source?o=n:this.fs&&(o=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:o}),this._attributeInfos=aP(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),r&&this.shaderFactory.release(r)}return this.pipeline}_logDrawCallStart(){const e=lt.level>3?0:q5;lt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,lt.group(Rc,`>>> DRAWING MODEL ${this.id}`,{collapsed:lt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=U5(this.pipeline.shaderLayout,this.id);lt.table(Rc,e)();const r=this.shaderInputs.getDebugTable();for(const[o,c]of Object.entries(this.uniforms))r[o]={value:c};lt.table(Rc,r)();const n=this._getAttributeDebugTable();lt.table(Rc,this._attributeInfos)(),lt.table(Rc,n)(),lt.groupEnd(Rc)(),this._logOpen=!1}}_logFramebuffer(e){const r=this.device.props.debugFramebuffers;if(this._drawCount++,!r)return;const n=e.props.framebuffer;n&&V5(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[r,n]of Object.entries(this._attributeInfos)){const o=this.vertexArray.attributes[n.location];e[n.location]={name:r,type:n.shaderType,values:o?this._getBufferOrConstantValues(o,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:r}=this.vertexArray,n=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);e.indices={name:"indices",type:r.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,r){const n=uP(r);return(e instanceof gn?new n(e.debugData):e).toString()}};Q(sy,"defaultProps",{...Gh.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:S_.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Tp=sy;function Y5(t){return!!(t.uniformTypes&&!bb(t.uniformTypes))}function G5(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function bb(t){for(const e in t)return!1;return!0}const Jf=class Jf{constructor(e,r=Jf.defaultProps){Q(this,"device");Q(this,"model");Q(this,"transformFeedback");if(!Jf.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Tp(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||TN(),topology:r.topology||"point-list",varyings:r.outputs||r.varyings,...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var r;return((r=e==null?void 0:e.info)==null?void 0:r.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const r=this.device.beginRenderPass(e);this.model.draw(r),r.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const r=this.getBuffer(e);if(!r)throw new Error("BufferTransform#getBuffer");if(r instanceof gn)return r.readAsync();const{buffer:n,byteOffset:o=0,byteLength:c=n.byteLength}=r;return n.readAsync(o,c)}};Q(Jf,"defaultProps",{...Tp.defaultProps,outputs:void 0,feedbackBuffers:void 0});let Sp=Jf;class Hm{constructor(e){Q(this,"id");Q(this,"topology");Q(this,"vertexCount");Q(this,"indices");Q(this,"attributes");Q(this,"userData",{});const{attributes:r={},indices:n=null,vertexCount:o=null}=e;this.id=e.id||zp("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[c,d]of Object.entries(r)){const a=ArrayBuffer.isView(d)?{value:d}:d;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(c)}: must be typed array or object with value as typed array`);if((c==="POSITION"||c==="positions")&&!a.size&&(a.size=3),c==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[c]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,r){return this}_calculateVertexCount(e,r){if(r)return r.value.length;let n=1/0;for(const o of Object.values(e)){const{value:c,size:d,constant:a}=o;!a&&c&&d!==void 0&&d>=1&&(n=Math.min(n,c.length/d))}return n}}class K5 extends Hm{constructor(e={}){const{id:r=zp("sphere-geometry")}=e,{indices:n,attributes:o}=Q5(e);super({...e,id:r,topology:"triangle-list",indices:n,attributes:{...o,...e.attributes}})}}function Q5(t){const{nlat:e=10,nlong:r=10}=t,c=Math.PI-0,y=2*Math.PI-0,S=(e+1)*(r+1),E=(Y,q,Z,le,Ae)=>t.radius||1,M=new Float32Array(S*3),F=new Float32Array(S*3),N=new Float32Array(S*2),G=S>65535?Uint32Array:Uint16Array,re=new G(e*r*6);for(let Y=0;Y<=e;Y++)for(let q=0;q<=r;q++){const Z=q/r,le=Y/e,Ae=q+Y*(r+1),we=Ae*2,je=Ae*3,Ue=y*Z,Ze=c*le,qe=Math.sin(Ue),Ke=Math.cos(Ue),ht=Math.sin(Ze),Pt=Math.cos(Ze),xt=Ke*ht,Zt=Pt,Ot=qe*ht,$t=E();M[je+0]=$t*xt,M[je+1]=$t*Zt,M[je+2]=$t*Ot,F[je+0]=xt,F[je+1]=Zt,F[je+2]=Ot,N[we+0]=Z,N[we+1]=1-le}const me=r+1;for(let Y=0;Y<r;Y++)for(let q=0;q<e;q++){const Z=(Y*e+q)*6;re[Z+0]=q*me+Y,re[Z+1]=q*me+Y+1,re[Z+2]=(q+1)*me+Y,re[Z+3]=(q+1)*me+Y,re[Z+4]=q*me+Y+1,re[Z+5]=(q+1)*me+Y+1}return{indices:{size:1,value:re},attributes:{POSITION:{size:3,value:M},NORMAL:{size:3,value:F},TEXCOORD_0:{size:2,value:N}}}}const J5={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class hC extends K1{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:r,views:n,viewports:o,onViewportActive:c,pickingFBO:d,deviceRect:{x:a,y,width:S,height:E},cullRect:M,effects:F,pass:N="picking",pickZ:G,shaderModuleProps:re}){this.pickZ=G;const me=this._resetColorEncoder(G),Y=[a,y,S,E],q=super.render({target:d,layers:e,layerFilter:r,views:n,viewports:o,onViewportActive:c,cullRect:M,effects:F==null?void 0:F.filter(le=>le.useInPicking),pass:N,isPicking:!0,shaderModuleProps:re,clearColor:[0,0,0,0],colorMask:15,scissorRect:Y});return this._colorEncoderState=null,{decodePickingColor:me&&tU.bind(null,me),stats:q}}shouldDrawLayer(e){const{pickable:r,operation:n}=e.props;return r&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,r,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,r,n){const o={...e.props.parameters},{pickable:c,operation:d}=e.props;return!this._colorEncoderState||d.includes("terrain")?o.blend=!1:c&&d.includes("draw")&&(Object.assign(o,J5),o.blend=!0,o.blendColor=eU(this._colorEncoderState,e,n)),o}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function eU(t,e,r){const{byLayer:n,byAlpha:o}=t;let c,d=n.get(e);return d?(d.viewports.push(r),c=d.a):(c=n.size+1,c<=255?(d={a:c,layer:e,viewports:[r]},n.set(e,d),o[c]=d):(Gr.warn("Too many pickable layers, only picking the first 255")(),c=0)),[0,0,0,c/255]}function tU(t,e){const r=t.byAlpha[e[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(e)}}const gh={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},V_=Symbol.for("component"),Xc=Symbol.for("propTypes"),L0=Symbol.for("deprecatedProps"),jh=Symbol.for("asyncPropDefaults"),nu=Symbol.for("asyncPropOriginal"),Rl=Symbol.for("asyncPropResolved");function Ep(t,e=()=>!0){return Array.isArray(t)?dC(t,e,[]):e(t)?[t]:[]}function dC(t,e,r){let n=-1;for(;++n<t.length;){const o=t[n];Array.isArray(o)?dC(o,e,r):e(o)&&r.push(o)}return r}function rU({target:t,source:e,start:r=0,count:n=1}){const o=e.length,c=n*o;let d=0;for(let a=r;d<o;d++)t[a++]=e[d];for(;d<c;)d<c-d?(t.copyWithin(r+d,r,r+d),d*=2):(t.copyWithin(r+d,r,r+c-d),d=c);return t}class nU{constructor(e,r,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(r)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,r){if(e===this._data&&!r)return;this._data=e;const n=++this._loadCount;let o=e;typeof e=="string"&&(o=Wx(e)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(c=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=c)}).catch(c=>{this._loadCount===n&&(this.isLoaded=!0,this._error=c||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const c of this._subscribers)c.onChange(this.getData())}}class iU{constructor(e){var r;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(r=e.device)==null?void 0:r.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:r,forceUpdate:n=!1,persistent:o=!0}){let c=this._resources[e];c?c.setData(r,n):(c=new nU(e,r,this._context),this._resources[e]=c),c.persistent=o}remove(e){const r=this._resources[e];r&&(r.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const r=this._consumers[e];if(r){for(const n in r){const o=r[n],c=this._resources[o.resourceId];c&&c.unsubscribe(o)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:r,consumerId:n,requestId:o="default"}){const{_resources:c,protocol:d}=this;e.startsWith(d)&&(e=e.replace(d,""),c[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=c[e];if(this._track(n,o,a,r),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,r,n,o){const c=this._consumers,d=c[e]=c[e]||{};let a=d[r];const y=a&&a.resourceId&&this._resources[a.resourceId];y&&(y.unsubscribe(a),this.prune()),n&&(a?(a.onChange=o,a.resourceId=n.id):a={onChange:o,resourceId:n.id},d[r]=a,n.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const r=this._resources[e];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[e])}}}const sU="layerManager.setLayers",oU="layerManager.activateViewport";class aU{constructor(e,r){var a;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=y=>{Ki(oU,this,y),y&&(this.context.viewport=y)};const{deck:n,stats:o,viewport:c,timeline:d}=r||{};this.layers=[],this.resourceManager=new iU({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:n,shaderAssembler:i5(((a=e==null?void 0:e.info)==null?void 0:a.shadingLanguage)||"glsl"),defaultShaderModules:[dB],renderPass:void 0,stats:o||new wy({id:"deck.gl"}),viewport:c||new ad({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:d||new aC,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const o=n.getNeedsRedraw(e);r=r||o}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(r=>e.find(n=>r.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,r){Ki(sU,this,r,e),this._lastRenderedLayers=e;const n=Ep(e,Boolean);for(const o of n)o.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:r}=this.context;r.find(n=>n.name===e.name)||(r.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:r}=this.context,n=r.findIndex(o=>o.name===e.name);n>=0&&(r.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,r,n){n.raiseError(r,`${e} of ${n}`)}_updateLayers(e,r){const n={};for(const d of e)n[d.id]?Gr.warn(`Multiple old layers with same id ${d.id}`)():n[d.id]=d;if(this._defaultShaderModulesChanged){for(const d of e)d.setNeedsUpdate(),d.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const o=[];this._updateSublayersRecursively(r,n,o),this._finalizeOldLayers(n);let c=!1;for(const d of o)if(d.hasUniformTransition()){c=`Uniform transition in ${d}`;break}this._needsUpdate=c,this.layers=o}_updateSublayersRecursively(e,r,n){for(const o of e){o.context=this.context;const c=r[o.id];c===null&&Gr.warn(`Multiple new layers with same id ${o.id}`)(),r[o.id]=null;let d=null;try{this._debug&&c!==o&&o.validateProps(),c?(this._transferLayerState(c,o),this._updateLayer(o)):this._initializeLayer(o),n.push(o),d=o.isComposite?o.getSubLayers():null}catch(a){this._handleError("matching",a,o)}d&&this._updateSublayersRecursively(d,r,n)}}_finalizeOldLayers(e){for(const r in e){const n=e[r];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=gh.INITIALIZED}catch(r){this._handleError("initialization",r,e)}}_transferLayerState(e,r){r._transferState(e),r.lifecycle=gh.MATCHED,r!==e&&(e.lifecycle=gh.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(r){this._handleError("update",r,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=gh.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=gh.FINALIZED}catch(r){this._handleError("finalization",r,e)}}}function So(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!So(t[n],e[n],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),o=Object.keys(e);if(n.length!==o.length)return!1;for(const c of n)if(!e.hasOwnProperty(c)||!So(t[c],e[c],r-1))return!1;return!0}return!1}class lU{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const r=this.controllers[e];r&&r.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const r=this.controllers[e];r&&r.updateTransition()}}getViewports(e){return e?this._viewports.filter(r=>r.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(r=>{e[r.id]=r}),e}getView(e){return this.views.find(r=>r.id===e)}getViewState(e){const r=typeof e=="string"?this.getView(e):e,n=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,r){const n=this.getViewports(),o={x:e[0],y:e[1]};for(let c=n.length-1;c>=0;--c){const d=n[c];if(d.containsPixel(o)){const a=e.slice();return a[0]-=d.x,a[1]-=d.y,d.unproject(a,r)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,r){(e!==this.width||r!==this.height)&&(this.width=e,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Ep(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!So(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Gr.warn("missing `viewState` or `initialViewState`")()}_createController(e,r){const n=r.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:c=>{var d;return(d=this.getView(e.id))==null?void 0:d.makeViewport({viewState:c,width:this.width,height:this.height})}})}_updateController(e,r,n,o){const c=e.controller;if(c&&n){const d={...r,...c,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!o||o.constructor!==c.type)&&(o=this._createController(e,d)),o&&o.setProps(d),o}return null}_rebuildViewports(){const{views:e}=this,r=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let o=e.length;o--;){const c=e[o],d=this.getViewState(c),a=c.makeViewport({viewState:d,width:this.width,height:this.height});let y=r[c.id];const S=!!c.controller;S&&!y&&(n=!0),(n||!S)&&y&&(y.finalize(),y=null),this.controllers[c.id]=this._updateController(c,d,a,y),a&&this._viewports.unshift(a)}for(const o in r){const c=r[o];c&&!this.controllers[o]&&c.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,r){return e.length!==r.length?!0:e.some((n,o)=>!e[o].equals(r[o]))}}const cU=/([0-9]+\.?[0-9]*)(%|px)/;function ml(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=cU.exec(t);if(e&&e.length>=3){const r=e[2]==="%",n=parseFloat(e[1]);return{position:r?n/100:n,relative:r}}default:throw new Error(`Could not parse position string ${t}`)}}function _l(t,e){return t.relative?Math.round(t.position*e):t.position}class fC{constructor(e){const{id:r,x:n=0,y:o=0,width:c="100%",height:d="100%",padding:a=null}=e;this.id=r||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=ml(n),this._y=ml(o),this._width=ml(c),this._height=ml(d),this._padding=a&&{left:ml(a.left||0),right:ml(a.right||0),top:ml(a.top||0),bottom:ml(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&So(this.props,e.props,2)}makeViewport({width:e,height:r,viewState:n}){n=this.filterViewState(n);const o=this.getDimensions({width:e,height:r});if(!o.height||!o.width)return null;const c=this.getViewportType(n);return new c({...n,...this.props,...o})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const r={...e};for(const n in this.props.viewState)n!=="id"&&(r[n]=this.props.viewState[n]);return r}return e}getDimensions({width:e,height:r}){const n={x:_l(this._x,e),y:_l(this._y,r),width:_l(this._width,e),height:_l(this._height,r)};return this._padding&&(n.padding={left:_l(this._padding.left,e),top:_l(this._padding.top,r),right:_l(this._padding.right,e),bottom:_l(this._padding.bottom,r)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Ay{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var r,n;this.cancel(),this.settings=e,this._inProgress=!0,(n=(r=this.settings).onStart)==null||n.call(r,this)}end(){var e,r;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(r=(e=this.settings).onEnd)==null||r.call(e,this))}cancel(){var e,r;this._inProgress&&((r=(e=this.settings).onInterrupt)==null||r.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,r;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:o}=this;this._handle=n.addChannel({delay:n.getTime(),duration:o.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(r=(e=this.settings).onUpdate)==null||r.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const w3=()=>{},wb={BREAK:1,SNAP_TO_END:2,IGNORE:3},uU=t=>t,hU=wb.BREAK;class dU{constructor(e){this._onTransitionUpdate=r=>{const{time:n,settings:{interpolator:o,startProps:c,endProps:d,duration:a,easing:y}}=r,S=y(n/a),E=o.interpolateProps(c,d,S);this.propsInTransition=this.getControllerState({...this.props,...E}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Ay(e.timeline),this.onViewStateChange=e.onViewStateChange||w3,this.onStateChange=e.onStateChange||w3}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let r=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let o=n;if(this.transition.inProgress){const{interruption:c,endProps:d}=this.transition.settings;o={...n,...c===wb.SNAP_TO_END?d:this.propsInTransition||n}}this._triggerTransition(o,e),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:r,transitionInterpolator:n}=e;return(r>0||r==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,r){return this.transition.inProgress?this.transition.settings.interruption===wb.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(e,r):!0}_triggerTransition(e,r){const n=this.getControllerState(e),o=this.getControllerState(r).shortestPathFrom(n),c=r.transitionInterpolator,d=c.getDuration?c.getDuration(e,r):r.transitionDuration;if(d===0)return;const a=c.initializeProps(e,o);this.propsInTransition={};const y={duration:d,easing:r.transitionEasing||uU,interpolator:c,interruption:r.transitionInterruption||hU,startProps:a.start,endProps:a.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(y),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(r)}}}function ri(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class fU{constructor(e){const{compare:r,extract:n,required:o}=e;this._propsToCompare=r,this._propsToExtract=n||r,this._requiredProps=o}arePropsEqual(e,r){for(const n of this._propsToCompare)if(!(n in e)||!(n in r)||!yp(e[n],r[n]))return!1;return!0}initializeProps(e,r){const n={},o={};for(const c of this._propsToExtract)(c in e||c in r)&&(n[c]=e[c],o[c]=r[c]);return this._checkRequiredProps(n),this._checkRequiredProps(o),{start:n,end:o}}getDuration(e,r){return r.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(r=>{const n=e[r];ri(Number.isFinite(n)||Array.isArray(n),`${r} is required for transition`)})}}const pU=["longitude","latitude","zoom","bearing","pitch"],gU=["longitude","latitude","zoom"];class Q1 extends fU{constructor(e={}){const r=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:pU,required:gU},super(n.transitionProps),this.opts=n}initializeProps(e,r){const n=super.initializeProps(e,r),{makeViewport:o,around:c}=this.opts;if(o&&c){const d=o(e),a=o(r),y=d.unproject(c);n.start.around=c,Object.assign(n.end,{around:a.project(y),aroundPosition:y,width:r.width,height:r.height})}return n}interpolateProps(e,r,n){const o={};for(const c of this._propsToExtract)o[c]=N_(e[c]||0,r[c]||0,n);if(r.aroundPosition&&this.opts.makeViewport){const c=this.opts.makeViewport({...r,...o});Object.assign(o,c.panByPosition(r.aroundPosition,N_(e.around,r.around,n)))}return o}}const yl={transitionDuration:0},mU=300,ym=t=>1-(1-t)*(1-t),ph={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},kc={};class pC{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new dU({...e,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const r in this._events)this._events[r]&&((e=this.eventManager)==null||e.off(r,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const r=this._eventStartBlocked;switch(e.type){case"panstart":return r?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return r?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return r?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:r,y:n}=this.props,{offsetCenter:o}=e;return[o.x-r,o.y-n]}isPointInBounds(e,r){const{width:n,height:o}=this.props;if(r&&r.handled)return!1;const c=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=o;return c&&r&&r.stopPropagation(),c}isFunctionKeyPressed(e){const{srcEvent:r}=e;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=r}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:r}=e;this.inertia=Number.isFinite(r)?r:r===!0?mU:0;const{scrollZoom:n=!0,dragPan:o=!0,dragRotate:c=!0,doubleClickZoom:d=!0,touchZoom:a=!0,touchRotate:y=!1,keyboard:S=!0}=e,E=!!this.onViewStateChange;this.toggleEvents(ph.WHEEL,E&&n),this.toggleEvents(ph.PAN,E),this.toggleEvents(ph.PINCH,E&&(a||y)),this.toggleEvents(ph.MULTI_PAN,E&&y),this.toggleEvents(ph.DOUBLE_CLICK,E&&d),this.toggleEvents(ph.KEYBOARD,E&&S),this.scrollZoom=n,this.dragPan=o,this.dragRotate=c,this.doubleClickZoom=d,this.touchZoom=a,this.touchRotate=y,this.keyboard=S}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,r){this.eventManager&&e.forEach(n=>{this._events[n]!==r&&(this._events[n]=r,r?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,r=null,n={}){const o={...e.getViewportProps(),...r},c=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),c){const d=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:o,interactionState:this._interactionState,oldViewState:d,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const o=this.controllerState[n?"panStart":"rotateStart"]({pos:r});return this._panMove=n,this.updateViewport(o,yl,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const r=this.getCenter(e),n=this.controllerState.pan({pos:r});return this.updateViewport(n,yl,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:r}=this;if(this.dragPan&&r&&e.velocity){const n=this.getCenter(e),o=[n[0]+e.velocityX*r/2,n[1]+e.velocityY*r/2],c=this.controllerState.pan({pos:o}).panEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:ym},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const r=this.getCenter(e),n=this.controllerState.rotate({pos:r});return this.updateViewport(n,yl,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:r}=this;if(this.dragRotate&&r&&e.velocity){const n=this.getCenter(e),o=[n[0]+e.velocityX*r/2,n[1]+e.velocityY*r/2],c=this.controllerState.rotate({pos:o}).rotateEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:ym},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:o=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:c}=e;let d=2/(1+Math.exp(-Math.abs(c*n)));c<0&&d!==0&&(d=1/d);const a=this.controllerState.zoom({pos:r,scale:d});return this.updateViewport(a,{...this._getTransitionProps({around:r}),transitionDuration:o?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.controllerState.rotateStart({pos:r});return this.updateViewport(n,yl,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const r=this.getCenter(e);r[0]-=e.deltaX;const n=this.controllerState.rotate({pos:r});return this.updateViewport(n,yl,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this;if(this.touchRotate&&r&&e.velocityY){const n=this.getCenter(e),o=[n[0],n[1]+=e.velocityY*r/2],c=this.controllerState.rotate({pos:o});this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:ym},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return kc._startPinchRotation=e.rotation,kc._lastPinchEvent=e,this.updateViewport(n,yl,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){const{scale:n}=e,o=this.getCenter(e);r=r.zoom({pos:o,scale:n})}if(this.touchRotate){const{rotation:n}=e;r=r.rotate({deltaAngleX:kc._startPinchRotation-n})}return this.updateViewport(r,yl,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),kc._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this,{_lastPinchEvent:n}=kc;if(this.touchZoom&&r&&n&&e.scale!==n.scale){const o=this.getCenter(e);let c=this.controllerState.rotateEnd();const d=Math.log2(e.scale),a=(d-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),y=Math.pow(2,d+a*r/2);c=c.zoom({pos:o,scale:y}).zoomEnd(),this.updateViewport(c,{...this._getTransitionProps({around:o}),transitionDuration:r,transitionEasing:ym},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{const o=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(o,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return kc._startPinchRotation=null,kc._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.isFunctionKeyPressed(e),o=this.controllerState.zoom({pos:r,scale:n?.5:2});return this.updateViewport(o,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const r=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:o,rotateSpeedX:c,rotateSpeedY:d}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let y;const S={};switch(e.srcEvent.code){case"Minus":y=r?a.zoomOut(n).zoomOut(n):a.zoomOut(n),S.isZooming=!0;break;case"Equal":y=r?a.zoomIn(n).zoomIn(n):a.zoomIn(n),S.isZooming=!0;break;case"ArrowLeft":r?(y=a.rotateLeft(c),S.isRotating=!0):(y=a.moveLeft(o),S.isPanning=!0);break;case"ArrowRight":r?(y=a.rotateRight(c),S.isRotating=!0):(y=a.moveRight(o),S.isPanning=!0);break;case"ArrowUp":r?(y=a.rotateUp(d),S.isRotating=!0):(y=a.moveUp(o),S.isPanning=!0);break;case"ArrowDown":r?(y=a.rotateDown(d),S.isRotating=!0):(y=a.moveDown(o),S.isPanning=!0);break;default:return!1}return this.updateViewport(y,this._getTransitionProps(),S),!0}_getTransitionProps(e){const{transition:r}=this;return!r||!r.transitionInterpolator?yl:e?{...r,transitionInterpolator:new Q1({...e,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}}class _U{constructor(e,r){this._viewportProps=this.applyConstraints(e),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}}const T3=5,yU=1.2;class gC extends _U{constructor(e){const{width:r,height:n,latitude:o,longitude:c,zoom:d,bearing:a=0,pitch:y=0,altitude:S=1.5,position:E=[0,0,0],maxZoom:M=20,minZoom:F=0,maxPitch:N=60,minPitch:G=0,startPanLngLat:re,startZoomLngLat:me,startRotatePos:Y,startBearing:q,startPitch:Z,startZoom:le,normalize:Ae=!0}=e;ri(Number.isFinite(c)),ri(Number.isFinite(o)),ri(Number.isFinite(d)),super({width:r,height:n,latitude:o,longitude:c,zoom:d,bearing:a,pitch:y,altitude:S,maxZoom:M,minZoom:F,maxPitch:N,minPitch:G,normalize:Ae,position:E},{startPanLngLat:re,startZoomLngLat:me,startRotatePos:Y,startBearing:q,startPitch:Z,startZoom:le}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:r}){const n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;const c=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(c)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:r=0,deltaAngleY:n=0}){const{startRotatePos:o,startBearing:c,startPitch:d}=this.getState();if(!o||c===void 0||d===void 0)return this;let a;return e?a=this._getNewRotation(e,o,d,c):a={bearing:c+r,pitch:d+n},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:r,scale:n}){let{startZoom:o,startZoomLngLat:c}=this.getState();if(c||(o=this.getViewportProps().zoom,c=this._unproject(r)||this._unproject(e)),!c)return this;const{maxZoom:d,minZoom:a}=this.getViewportProps();let y=o+Math.log2(n);y=Ko(y,a,d);const S=this.makeViewport({...this.getViewportProps(),zoom:y});return this._getUpdatedState({zoom:y,...S.panByPosition(c,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const r=e.getViewportProps(),n={...this.getViewportProps()},{bearing:o,longitude:c}=n;return Math.abs(o-r.bearing)>180&&(n.bearing=o<0?o+360:o-360),Math.abs(c-r.longitude)>180&&(n.longitude=c<0?c+360:c-360),n}applyConstraints(e){const{maxZoom:r,minZoom:n,zoom:o}=e;e.zoom=Ko(o,n,r);const{maxPitch:c,minPitch:d,pitch:a}=e;e.pitch=Ko(a,d,c);const{normalize:y=!0}=e;return y&&Object.assign(e,V6(e)),e}_zoomFromCenter(e){const{width:r,height:n}=this.getViewportProps();return this.zoom({pos:[r/2,n/2],scale:e})}_panFromCenter(e){const{width:r,height:n}=this.getViewportProps();return this.pan({startPos:[r/2,n/2],pos:[r/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const r=this.makeViewport(this.getViewportProps());return e&&r.unproject(e)}_getNewRotation(e,r,n,o){const c=e[0]-r[0],d=e[1]-r[1],a=e[1],y=r[1],{width:S,height:E}=this.getViewportProps(),M=c/S;let F=0;d>0?Math.abs(E-y)>T3&&(F=d/(y-E)*yU):d<0&&y>T3&&(F=1-a/y),F=Ko(F,-1,1);const{minPitch:N,maxPitch:G}=this.getViewportProps(),re=o+180*M;let me=n;return F>0?me=n+F*(G-n):F<0&&(me=n-F*(N-n)),{pitch:me,bearing:re}}}class vU extends pC{constructor(){super(...arguments),this.ControllerState=gC,this.transition={transitionDuration:300,transitionInterpolator:new Q1({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const r=this.props;super.setProps(e),(!r||r.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class J1 extends fC{constructor(e={}){super(e)}getViewportType(){return ru}get ControllerType(){return vU}}J1.displayName="MapView";const xU=new sC;function bU(t,e){const r=t.order??1/0,n=e.order??1/0;return r-n}class wU{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const r=this._defaultEffects;if(!r.find(n=>n.id===e.id)){const n=r.findIndex(o=>bU(o,e)>0);n<0?r.push(e):r.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(So(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(e){const r={};for(const o of this.effects)r[o.id]=o;const n=[];for(const o of e){const c=r[o.id];let d=o;c&&c!==o?c.setProps?(c.setProps(o.props),d=c):c.cleanup(this._context):c||o.setup(this._context),n.push(d),delete r[o.id]}for(const o in r)r[o].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(o=>o instanceof sC)||this._resolvedEffects.push(xU),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class TU extends K1{shouldDrawLayer(e){const{operation:r}=e.props;return r.includes("draw")||r.includes("terrain")}}const SU="deckRenderer.renderLayers";class EU{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new TU(e),this.pickLayersPass=new hC(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const o=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const c=r.render({...n,target:o});n.effects&&this._postRender(n.effects,n),this.renderCount++,Ki(SU,this,c,e)}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){const{renderBuffers:e}=this;for(const r of e)r.delete();e.length=0}_preRender(e,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(const n of e)r.preRenderStats[n.id]=n.preRender(r),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,r=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(n=>{const o=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[o]}))});for(const n of e)n.resize(r)}_postRender(e,r){const{renderBuffers:n}=this,o={...r,inputBuffer:n[0],swapBuffer:n[1]};for(const c of e)if(c.postRender){o.target=c.id===this.lastPostProcessEffect?r.target:void 0;const d=c.postRender(o);o.inputBuffer=d,o.swapBuffer=d===n[0]?n[1]:n[0]}}}const AU={pickedColor:null,pickedObjectIndex:-1};function IU({pickedColors:t,decodePickingColor:e,deviceX:r,deviceY:n,deviceRadius:o,deviceRect:c}){const{x:d,y:a,width:y,height:S}=c;let E=o*o,M=-1,F=0;for(let N=0;N<S;N++){const G=N+a-n,re=G*G;if(re>E)F+=4*y;else for(let me=0;me<y;me++){if(t[F+3]-1>=0){const q=me+d-r,Z=q*q+re;Z<=E&&(E=Z,M=F)}F+=4}}if(M>=0){const N=t.slice(M,M+4),G=e(N);if(G){const re=Math.floor(M/4/y),me=M/4-re*y;return{...G,pickedColor:N,pickedX:d+me,pickedY:a+re}}Gr.error("Picked non-existent layer. Is picking buffer corrupt?")()}return AU}function PU({pickedColors:t,decodePickingColor:e}){const r=new Map;if(t){for(let n=0;n<t.length;n+=4)if(t[n+3]-1>=0){const c=t.slice(n,n+4),d=c.join(",");if(!r.has(d)){const a=e(c);a?r.set(d,{...a,color:c}):Gr.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function mC({pickInfo:t,viewports:e,pixelRatio:r,x:n,y:o,z:c}){let d=e[0];e.length>1&&(d=MU((t==null?void 0:t.pickedViewports)||e,{x:n,y:o}));let a;if(d){const y=[n-d.x,o-d.y];c!==void 0&&(y[2]=c),a=d.unproject(y)}return{color:null,layer:null,viewport:d,index:-1,picked:!1,x:n,y:o,pixel:[n,o],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:r}}function CU(t){const{pickInfo:e,lastPickedInfo:r,mode:n,layers:o}=t,{pickedColor:c,pickedLayer:d,pickedObjectIndex:a}=e,y=d?[d]:[];if(n==="hover"){const M=r.index,F=r.layerId,N=d?d.props.id:null;if(N!==F||a!==M){if(N!==F){const G=o.find(re=>re.props.id===F);G&&y.unshift(G)}r.layerId=N,r.index=a,r.info=null}}const S=mC(t),E=new Map;return E.set(null,S),y.forEach(M=>{let F={...S};M===d&&(F.color=c,F.index=a,F.picked=!0),F=_C({layer:M,info:F,mode:n});const N=F.layer;M===d&&n==="hover"&&(r.info=F),E.set(N.id,F),n==="hover"&&N.updateAutoHighlight(F)}),E}function _C({layer:t,info:e,mode:r}){for(;t&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=t,e=t.getPickingInfo({info:e,mode:r,sourceLayer:n}),t=t.parent}return e}function MU(t,e){for(let r=t.length-1;r>=0;r--){const n=t[r];if(n.containsPixel(e))return n}return t[0]}class RU{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new hC(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:r,layers:n,viewports:o},c=this.lastPickedInfo.info){const d=c&&c.layer&&c.layer.id,a=c&&c.viewport&&c.viewport.id,y=d?n.find(F=>F.id===d):null,S=a&&o.find(F=>F.id===a)||o[0],E=S&&S.unproject([e-S.x,r-S.y]);return{...c,...{x:e,y:r,viewport:S,coordinate:E,layer:y}}}_resizeBuffer(){var r,n;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const o=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=o}const{canvas:e}=this.device.getDefaultCanvasContext();(r=this.pickingFBO)==null||r.resize({width:e.width,height:e.height}),(n=this.depthFBO)==null||n.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const r=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return r.length?r:null}_pickClosestObject({layers:e,views:r,viewports:n,x:o,y:c,radius:d=0,depth:a=1,mode:y="query",unproject3D:S,onViewportActive:E,effects:M}){const F=this.device.canvasContext.cssToDeviceRatio(),N=this._getPickable(e);if(!N||n.length===0)return{result:[],emptyInfo:mC({viewports:n,x:o,y:c,pixelRatio:F})};this._resizeBuffer();const G=this.device.canvasContext.cssToDevicePixels([o,c],!0),re=[G.x+Math.floor(G.width/2),G.y+Math.floor(G.height/2)],me=Math.round(d*F),{width:Y,height:q}=this.pickingFBO,Z=this._getPickingRect({deviceX:re[0],deviceY:re[1],deviceRadius:me,deviceWidth:Y,deviceHeight:q}),le={x:o-d,y:c-d,width:d*2+1,height:d*2+1};let Ae;const we=[],je=new Set;for(let Ue=0;Ue<a;Ue++){let Ze;if(Z){const Ke=this._drawAndSample({layers:N,views:r,viewports:n,onViewportActive:E,deviceRect:Z,cullRect:le,effects:M,pass:`picking:${y}`});Ze=IU({...Ke,deviceX:re[0],deviceY:re[1],deviceRadius:me,deviceRect:Z})}else Ze={pickedColor:null,pickedObjectIndex:-1};let qe;if(Ze.pickedLayer&&S&&this.depthFBO){const{pickedColors:Ke}=this._drawAndSample({layers:[Ze.pickedLayer],views:r,viewports:n,onViewportActive:E,deviceRect:{x:Ze.pickedX,y:Ze.pickedY,width:1,height:1},cullRect:le,effects:M,pass:`picking:${y}:z`},!0);Ke[3]&&(qe=Ke[0])}Ze.pickedLayer&&Ue+1<a&&(je.add(Ze.pickedLayer),Ze.pickedLayer.disablePickingIndex(Ze.pickedObjectIndex)),Ae=CU({pickInfo:Ze,lastPickedInfo:this.lastPickedInfo,mode:y,layers:N,viewports:n,x:o,y:c,z:qe,pixelRatio:F});for(const Ke of Ae.values())Ke.layer&&we.push(Ke);if(!Ze.pickedColor)break}for(const Ue of je)Ue.restorePickingColors();return{result:we,emptyInfo:Ae.get(null)}}_pickVisibleObjects({layers:e,views:r,viewports:n,x:o,y:c,width:d=1,height:a=1,mode:y="query",maxObjects:S=null,onViewportActive:E,effects:M}){const F=this._getPickable(e);if(!F||n.length===0)return[];this._resizeBuffer();const N=this.device.canvasContext.cssToDeviceRatio(),G=this.device.canvasContext.cssToDevicePixels([o,c],!0),re=G.x,me=G.y+G.height,Y=this.device.canvasContext.cssToDevicePixels([o+d,c+a],!0),q=Y.x+Y.width,Z=Y.y,le={x:re,y:Z,width:q-re,height:me-Z},Ae=this._drawAndSample({layers:F,views:r,viewports:n,onViewportActive:E,deviceRect:le,cullRect:{x:o,y:c,width:d,height:a},effects:M,pass:`picking:${y}`}),we=PU(Ae),je=new Map,Ue=[],Ze=Number.isFinite(S);for(let qe=0;qe<we.length&&!(Ze&&Ue.length>=S);qe++){const Ke=we[qe];let ht={color:Ke.pickedColor,layer:null,index:Ke.pickedObjectIndex,picked:!0,x:o,y:c,pixelRatio:N};ht=_C({layer:Ke.pickedLayer,info:ht,mode:y});const Pt=ht.layer.id;je.has(Pt)||je.set(Pt,new Set);const xt=je.get(Pt),Zt=ht.object??ht.index;xt.has(Zt)||(xt.add(Zt),Ue.push(ht))}return Ue}_drawAndSample({layers:e,views:r,viewports:n,onViewportActive:o,deviceRect:c,cullRect:d,effects:a,pass:y},S=!1){const E=S?this.depthFBO:this.pickingFBO,M={layers:e,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:o,pickingFBO:E,deviceRect:c,cullRect:d,effects:a,pass:y,pickZ:S,preRenderStats:{},isPicking:!0};for(const q of a)q.useInPicking&&(M.preRenderStats[q.id]=q.preRender(M));const{decodePickingColor:F}=this.pickLayersPass.render(M),{x:N,y:G,width:re,height:me}=c,Y=new(S?Float32Array:Uint8Array)(re*me*4);return this.device.readPixelsToArrayWebGL(E,{sourceX:N,sourceY:G,sourceWidth:re,sourceHeight:me,target:Y}),{pickedColors:Y,decodePickingColor:F}}_getPickingRect({deviceX:e,deviceY:r,deviceRadius:n,deviceWidth:o,deviceHeight:c}){const d=Math.max(0,e-n),a=Math.max(0,r-n),y=Math.min(o,e+n+1)-d,S=Math.min(c,r+n+1)-a;return y<=0||S<=0?null:{x:d,y:a,width:y,height:S}}}const kU={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},DU="top-left",S3="__root";class OU{constructor({deck:e,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!So(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(r=>r.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const r={};for(const n of this.resolvedWidgets)r[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)r[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const o=r[n.id];o?o.viewId!==n.viewId||o.placement!==n.placement?(this._remove(o),this._add(n)):n!==o&&(o.setProps(n.props),n=o):this._add(n),r[n.id]=null,this.resolvedWidgets.push(n)}for(const n in r){const o=r[n];o&&this._remove(o)}this.widgets=e}_add(e){const{viewId:r=null,placement:n=DU}=e,o=e.onAdd({deck:this.deck,viewId:r});o&&this._getContainer(r,n).append(o),e._element=o}_remove(e){var r;(r=e.onRemove)==null||r.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,r){var d;const n=e||S3;let o=this.containers[n];o||(o=document.createElement("div"),o.style.pointerEvents="none",o.style.position="absolute",o.style.overflow="hidden",(d=this.parentElement)==null||d.append(o),this.containers[n]=o);let c=o.querySelector(`.${r}`);return c||(c=document.createElement("div"),c.className=r,c.style.position="absolute",c.style.zIndex="2",Object.assign(c.style,kU[r]),o.append(c)),c}_updateContainers(){const e=this.deck.width,r=this.deck.height;for(const n in this.containers){const o=this.lastViewports[n]||null,c=n===S3||o,d=this.containers[n];c?(d.style.display="block",d.style.left=`${o?o.x:0}px`,d.style.top=`${o?o.y:0}px`,d.style.width=`${o?o.width:e}px`,d.style.height=`${o?o.height:r}px`):d.style.display="none"}}onRedraw({viewports:e,layers:r}){var o,c;const n=e.reduce((d,a)=>(d[a.id]=a,d),{});for(const d of this.getWidgets()){const{viewId:a}=d;if(a){const y=n[a];y&&(d.onViewportChange&&d.onViewportChange(y),(o=d.onRedraw)==null||o.call(d,{viewports:[y],layers:r}))}else{if(d.onViewportChange)for(const y of e)d.onViewportChange(y);(c=d.onRedraw)==null||c.call(d,{viewports:e,layers:r})}}this.lastViewports=n,this._updateContainers()}onHover(e,r){var n,o;for(const c of this.getWidgets()){const{viewId:d}=c;(!d||d===((n=e.viewport)==null?void 0:n.id))&&((o=c.onHover)==null||o.call(c,e,r))}}onEvent(e,r){var o,c;const n=pb[r.type];if(n)for(const d of this.getWidgets()){const{viewId:a}=d;(!a||a===((o=e.viewport)==null?void 0:o.id))&&((c=d[n])==null||c.call(d,e,r))}}}const FU={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class NU{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const r=document.createElement("div");return r.className="deck-tooltip",Object.assign(r.style,FU),this.deck=e,this.element=r,r}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var r;this.isVisible&&e.id===((r=this.lastViewport)==null?void 0:r.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:r}=this,n=r&&r.props.getTooltip;if(!n)return;const o=n(e);this.lastViewport=e.viewport,this.setTooltip(o,e.x,e.y)}setTooltip(e,r,n){const o=this.element;if(o){if(typeof e=="string")o.innerText=e;else if(e)e.text&&(o.innerText=e.text),e.html&&(o.innerHTML=e.html),e.className&&(o.className=e.className);else{this.isVisible=!1,o.style.display="none";return}this.isVisible=!0,o.style.display="block",o.style.transform=`translate(${r}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(o.style,e.style)}}}var Ch;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Ch||(Ch={}));const ew={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Hn=(t,e,r)=>e?t.enable(r):t.disable(r),E3=(t,e,r)=>t.hint(r,e),Ps=(t,e,r)=>t.pixelStorei(r,e),A3=(t,e,r)=>{const n=r===36006?36009:36008;return t.bindFramebuffer(n,e)},Sf=(t,e,r)=>{const o={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];t.bindBuffer(o,e)};function z0(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const LU={3042:Hn,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Hn,2885:(t,e)=>t.cullFace(e),2929:Hn,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Hn,35723:E3,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var r;return(r=t.bindTransformFeedback)==null?void 0:r.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:A3,36010:A3,34964:Sf,36662:Sf,36663:Sf,35053:Sf,35055:Sf,2886:(t,e)=>t.frontFace(e),33170:E3,2849:(t,e)=>t.lineWidth(e),32823:Hn,32824:"polygonOffset",10752:"polygonOffset",35977:Hn,32926:Hn,32928:Hn,32938:"sampleCoverage",32939:"sampleCoverage",3089:Hn,3088:(t,e)=>t.scissor(...e),2960:Hn,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Hn,10754:Hn,12288:Hn,12289:Hn,12290:Hn,12291:Hn,12292:Hn,12293:Hn,12294:Hn,12295:Hn,3333:Ps,3317:Ps,37440:Ps,37441:Ps,37443:Ps,3330:Ps,3332:Ps,3331:Ps,3314:Ps,32878:Ps,3316:Ps,3315:Ps,32877:Ps,framebuffer:(t,e)=>{const r=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,r)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const r=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...r)},blendFunc:(t,e)=>{const r=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...r)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=z0(e)?e:[e,e];const[r,n]=e;t.stencilMaskSeparate(1028,r),t.stencilMaskSeparate(1029,n)},stencilFunc:(t,e)=>{e=z0(e)&&e.length===3?[...e,...e]:e;const[r,n,o,c,d,a]=e;t.stencilFuncSeparate(1028,r,n,o),t.stencilFuncSeparate(1029,c,d,a)},stencilOp:(t,e)=>{e=z0(e)&&e.length===3?[...e,...e]:e;const[r,n,o,c,d,a]=e;t.stencilOpSeparate(1028,r,n,o),t.stencilOpSeparate(1029,c,d,a)},viewport:(t,e)=>t.viewport(...e)};function Cn(t,e,r){return e[t]!==void 0?e[t]:r[t]}const zU={blendEquation:(t,e,r)=>t.blendEquationSeparate(Cn(32777,e,r),Cn(34877,e,r)),blendFunc:(t,e,r)=>t.blendFuncSeparate(Cn(32969,e,r),Cn(32968,e,r),Cn(32971,e,r),Cn(32970,e,r)),polygonOffset:(t,e,r)=>t.polygonOffset(Cn(32824,e,r),Cn(10752,e,r)),sampleCoverage:(t,e,r)=>t.sampleCoverage(Cn(32938,e,r),Cn(32939,e,r)),stencilFuncFront:(t,e,r)=>t.stencilFuncSeparate(1028,Cn(2962,e,r),Cn(2967,e,r),Cn(2963,e,r)),stencilFuncBack:(t,e,r)=>t.stencilFuncSeparate(1029,Cn(34816,e,r),Cn(36003,e,r),Cn(36004,e,r)),stencilOpFront:(t,e,r)=>t.stencilOpSeparate(1028,Cn(2964,e,r),Cn(2965,e,r),Cn(2966,e,r)),stencilOpBack:(t,e,r)=>t.stencilOpSeparate(1029,Cn(34817,e,r),Cn(34818,e,r),Cn(34819,e,r))},I3={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,r)=>t({[e]:r}),hint:(t,e,r)=>t({[e]:r}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,r)=>t({36007:r}),bindTransformFeedback:(t,e,r)=>t({36389:r}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,r)=>{switch(e){case 36160:return t({36006:r,36010:r});case 36009:return t({36006:r});case 36008:return t({36010:r});default:return null}},bindBuffer:(t,e,r)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?t({[n]:r}):{valueChanged:!0}},blendColor:(t,e,r,n,o)=>t({32773:new Float32Array([e,r,n,o])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,r)=>t({32777:e,34877:r}),blendFunc:(t,e,r)=>t({32969:e,32968:r,32971:e,32970:r}),blendFuncSeparate:(t,e,r,n,o)=>t({32969:e,32968:r,32971:n,32970:o}),clearColor:(t,e,r,n,o)=>t({3106:new Float32Array([e,r,n,o])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,r,n,o)=>t({3107:[e,r,n,o]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,r)=>t({2928:new Float32Array([e,r])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,r)=>t({32824:e,10752:r}),sampleCoverage:(t,e,r)=>t({32938:e,32939:r}),scissor:(t,e,r,n,o)=>t({3088:new Int32Array([e,r,n,o])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,r)=>t({[e===1028?2968:36005]:r}),stencilFunc:(t,e,r,n)=>t({2962:e,2967:r,2963:n,34816:e,36003:r,36004:n}),stencilFuncSeparate:(t,e,r,n,o)=>t({[e===1028?2962:34816]:r,[e===1028?2967:36003]:n,[e===1028?2963:36004]:o}),stencilOp:(t,e,r,n)=>t({2964:e,2965:r,2966:n,34817:e,34818:r,34819:n}),stencilOpSeparate:(t,e,r,n,o)=>t({[e===1028?2964:34817]:r,[e===1028?2965:34818]:n,[e===1028?2966:34819]:o}),viewport:(t,e,r,n,o)=>t({2978:[e,r,n,o]})},Ho=(t,e)=>t.isEnabled(e),P3={3042:Ho,2884:Ho,2929:Ho,3024:Ho,32823:Ho,32926:Ho,32928:Ho,3089:Ho,2960:Ho,35977:Ho},BU=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function ld(t,e){if(VU(e))return;const r={};for(const o in e){const c=Number(o),d=LU[o];d&&(typeof d=="string"?r[d]=!0:d(t,e[o],c))}const n=t.state&&t.state.cache;if(n)for(const o in r){const c=zU[o];c(t,e,n)}}function yC(t,e=ew){if(typeof e=="number"){const o=e,c=P3[o];return c?c(t,o):t.getParameter(o)}const r=Array.isArray(e)?e:Object.keys(e),n={};for(const o of r){const c=P3[o];n[o]=c?c(t,Number(o)):t.getParameter(Number(o))}return n}function UU(t){ld(t,ew)}function VU(t){for(const e in t)return!1;return!0}function jU(t,e){if(t===e)return!0;const r=Array.isArray(t)||ArrayBuffer.isView(t),n=Array.isArray(e)||ArrayBuffer.isView(e);if(r&&n&&t.length===e.length){for(let o=0;o<t.length;++o)if(t[o]!==e[o])return!1;return!0}return!1}class Zc{constructor(e,r){Q(this,"gl");Q(this,"program",null);Q(this,"stateStack",[]);Q(this,"enable",!0);Q(this,"cache",null);Q(this,"log");Q(this,"initialized",!1);this.gl=e,this.log=(r==null?void 0:r.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];ld(this.gl,e),this.stateStack.pop()}trackState(e,r){if(this.cache=r.copyState?yC(e):Object.assign({},ew),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,WU(e);for(const n in I3){const o=I3[n];$U(e,n,o)}C3(e,"getParameter"),C3(e,"isEnabled")}_updateCache(e){let r=!1,n;const o=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const c in e){const d=e[c],a=this.cache[c];jU(d,a)||(r=!0,n=a,o&&!(c in o)&&(o[c]=a),this.cache[c]=d)}return{valueChanged:r,oldValue:n}}}function C3(t,e){const r=t[e].bind(t);t[e]=function(o){if(o===void 0||BU.has(o))return r(o);const c=Zc.get(t);return o in c.cache||(c.cache[o]=r(o)),c.enable?c.cache[o]:r(o)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function $U(t,e,r){if(!t[e])return;const n=t[e].bind(t);t[e]=function(...c){const d=Zc.get(t),{valueChanged:a,oldValue:y}=r(d._updateCache,...c);return a&&n(...c),y},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function WU(t){const e=t.useProgram.bind(t);t.useProgram=function(n){const o=Zc.get(t);o.program!==n&&(e(n),o.program=n)}}function HU(t,e,r){let n="";const o={preserveDrawingBuffer:!0,...r};let c=null;if(c||(c=t.getContext("webgl2",o)),o.failIfMajorPerformanceCaveat&&(n||(n="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!c&&!r.failIfMajorPerformanceCaveat&&(o.failIfMajorPerformanceCaveat=!1,c=t.getContext("webgl2",o),c.luma||(c.luma={}),c.luma.softwareRenderer=!0),c||(c=t.getContext("webgl",{}),c&&(c=null,n||(n="Your browser only supports WebGL1"))),!c)throw n||(n="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:d,onContextRestored:a}=e;return t.addEventListener("webglcontextlost",y=>d(y),!1),t.addEventListener("webglcontextrestored",y=>a(y),!1),c.luma||(c.luma={}),c}function rd(t,e,r){return r[e]===void 0&&(r[e]=t.getExtension(e)||null),r[e]}function XU(t,e){const r=t.getParameter(7936),n=t.getParameter(7937);rd(t,"WEBGL_debug_renderer_info",e);const o=e.WEBGL_debug_renderer_info,c=t.getParameter(o?o.UNMASKED_VENDOR_WEBGL:7936),d=t.getParameter(o?o.UNMASKED_RENDERER_WEBGL:7937),a=c||r,y=d||n,S=t.getParameter(7938),E=vC(a,y),M=ZU(a,y),F=qU(a,y);return{type:"webgl",gpu:E,gpuType:F,gpuBackend:M,vendor:a,renderer:y,version:S,shadingLanguage:"glsl",shadingLanguageVersion:300}}function vC(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function ZU(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function qU(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(vC(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function xC(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Df="WEBGL_compressed_texture_s3tc",Of="WEBGL_compressed_texture_s3tc_srgb",Mh="EXT_texture_compression_rgtc",Rh="EXT_texture_compression_bptc",YU="WEBGL_compressed_texture_etc",GU="WEBGL_compressed_texture_astc",KU="WEBGL_compressed_texture_etc1",QU="WEBGL_compressed_texture_pvrtc",JU="WEBGL_compressed_texture_atc",M3="EXT_texture_norm16",R3="EXT_render_snorm",e8="EXT_color_buffer_float",tw={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[R3],"norm16-renderable-webgl":[M3],"snorm16-renderable-webgl":[M3,R3],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Df,Of,Mh,Rh],"texture-compression-bc5-webgl":[Mh],"texture-compression-bc7-webgl":[Rh],"texture-compression-etc2":[YU],"texture-compression-astc":[GU],"texture-compression-etc1-webgl":[KU],"texture-compression-pvrtc-webgl":[QU],"texture-compression-atc-webgl":[JU]};function t8(t){return t in tw}function r8(t,e,r){return(tw[e]||[]).every(o=>rd(t,o,r))}const rw={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:e8,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Df},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Of},"bc1-rgba-unorm":{gl:33777,x:Df},"bc1-rgba-unorm-srgb":{gl:35916,x:Of},"bc2-rgba-unorm":{gl:33778,x:Df},"bc2-rgba-unorm-srgb":{gl:35918,x:Of},"bc3-rgba-unorm":{gl:33779,x:Df},"bc3-rgba-unorm-srgb":{gl:35919,x:Of},"bc4-r-unorm":{gl:36283,x:Mh},"bc4-r-snorm":{gl:36284,x:Mh},"bc5-rg-unorm":{gl:36285,x:Mh},"bc5-rg-snorm":{gl:36286,x:Mh},"bc6h-rgb-ufloat":{gl:36495,x:Rh},"bc6h-rgb-float":{gl:36494,x:Rh},"bc7-rgba-unorm":{gl:36492,x:Rh},"bc7-rgba-unorm-srgb":{gl:36493,x:Rh},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function n8(t,e,r){let n=e.create;const o=rw[e.format];return(o==null?void 0:o.gl)===void 0&&(n=!1),o!=null&&o.x&&(n=n&&!!rd(t,o.x,r)),{format:e.format,create:n&&e.create,render:n&&e.render,filter:n&&e.filter,blend:n&&e.blend,store:n&&e.store}}function bC(t){var o;const e=rw[t],r=o8(t),n=N1(t);return{internalFormat:r,format:(e==null?void 0:e.dataFormat)||s8(n.channels,n.integer,n.normalized,r),type:n.dataType?xC(n.dataType):((o=e==null?void 0:e.types)==null?void 0:o[0])||5121,compressed:n.compressed||!1}}function i8(t){switch(N1(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function s8(t,e,r,n){if(n===6408||n===6407)return n;switch(t){case"r":return e&&!r?36244:6403;case"rg":return e&&!r?33320:33319;case"rgb":return e&&!r?36248:6407;case"rgba":return e&&!r?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function o8(t){const e=rw[t],r=e==null?void 0:e.gl;if(r===void 0)throw new Error(`Unsupported texture format ${t}`);return r}const k3={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class a8 extends BN{constructor(r,n,o){super([],o);Q(this,"gl");Q(this,"extensions");Q(this,"testedFeatures",new Set);this.gl=r,this.extensions=n,rd(r,"EXT_color_buffer_float",n)}*[Symbol.iterator](){const r=this.getFeatures();for(const n of r)this.has(n)&&(yield n);return[]}has(r){var n;return(n=this.disabledFeatures)!=null&&n[r]?!1:(this.testedFeatures.has(r)||(this.testedFeatures.add(r),t8(r)&&r8(this.gl,r,this.extensions)&&this.features.add(r),this.getWebGLFeature(r)&&this.features.add(r)),this.features.has(r))}initializeFeatures(){const r=this.getFeatures().filter(n=>n!=="polygon-mode-webgl");for(const n of r)this.has(n)}getFeatures(){return[...Object.keys(k3),...Object.keys(tw)]}getWebGLFeature(r){const n=k3[r];return typeof n=="string"?!!rd(this.gl,n,this.extensions):!!n}}class l8 extends zN{constructor(r){super();Q(this,"gl");Q(this,"limits",{});this.gl=r}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(r){return this.limits[r]===void 0&&(this.limits[r]=this.gl.getParameter(r)),this.limits[r]||0}}class Yf extends P_{constructor(r,n){super(r,n);Q(this,"device");Q(this,"gl");Q(this,"handle");Q(this,"colorAttachments",[]);Q(this,"depthStencilAttachment",null);const o=n.handle===null;this.device=r,this.gl=r.gl,this.handle=this.props.handle||o?this.props.handle:this.gl.createFramebuffer(),o||(r.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const r=this.gl.bindFramebuffer(36160,this.handle);for(let n=0;n<this.colorAttachments.length;++n){const o=this.colorAttachments[n];if(o){const c=36064+n;this._attachTextureView(c,o)}}if(this.depthStencilAttachment){const n=i8(this.depthStencilAttachment.props.format);this._attachTextureView(n,this.depthStencilAttachment)}if(this.device.props.debug){const n=this.gl.checkFramebufferStatus(36160);if(n!==36053)throw new Error(`Framebuffer ${u8(n)}`)}this.gl.bindFramebuffer(36160,r)}_attachTextureView(r,n){const{gl:o}=this.device,{texture:c}=n,d=n.props.baseMipLevel,a=n.props.baseArrayLayer;switch(o.bindTexture(c.glTarget,c.handle),c.glTarget){case 35866:case 32879:o.framebufferTextureLayer(36160,r,c.handle,d,a);break;case 34067:const y=c8(a);o.framebufferTexture2D(36160,r,y,c.handle,d);break;case 3553:o.framebufferTexture2D(36160,r,3553,c.handle,d);break;default:throw new Error("Illegal texture type")}o.bindTexture(c.glTarget,null)}}function c8(t){return t<34069?t+34069:t}function u8(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class h8 extends Qx{constructor(r,n){super(n);Q(this,"device");Q(this,"format","rgba8unorm");Q(this,"depthStencilFormat","depth24plus");Q(this,"presentationSize");Q(this,"_framebuffer",null);this.device=r,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Yf(this.device,{handle:null}),this._framebuffer}update(){const r=this.getPixelSize();(r[0]!==this.presentationSize[0]||r[1]!==this.presentationSize[1])&&(this.presentationSize=r,this.resize())}resize(r){if(this.device.gl&&this.canvas){const n=this.getDevicePixelRatio(r==null?void 0:r.useDevicePixels);this.setDevicePixelRatio(n,r);return}}commit(){}}async function wC(t,e){const r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",t),new Promise((o,c)=>{n.onload=o,n.onerror=d=>c(new Error(`Unable to load script '${t}': ${d}`)),r.appendChild(n)})}const d8=1;let Jr=null,D3=!1;const nw={debugSpectorJS:lt.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function f8(t){if(!globalThis.SPECTOR)try{await wC(t.debugSpectorJSUrl||nw.debugSpectorJSUrl)}catch(e){lt.warn(String(e))}}function p8(t){var e;if(t={...nw,...t},!t.debugSpectorJS)return null;if(!Jr&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){lt.probe(d8,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:r}=globalThis.SPECTOR;Jr=new r,globalThis.luma&&(globalThis.luma.spector=Jr)}if(!Jr)return null;if(D3||(D3=!0,Jr.spyCanvases(),Jr==null||Jr.onCaptureStarted.add(r=>lt.info("Spector capture started:",r)()),Jr==null||Jr.onCapture.add(r=>{lt.info("Spector capture complete:",r)(),Jr==null||Jr.getResultUI(),Jr==null||Jr.resultView.display(),Jr==null||Jr.resultView.addCapture(r)})),t.gl){const r=t.gl,n=r.device;Jr==null||Jr.startCapture(t.gl,500),r.device=n,new Promise(o=>setTimeout(o,2e3)).then(o=>{lt.info("Spector capture stopped after 2 seconds")(),Jr==null||Jr.stopCapture()})}return Jr}const g8="https://unpkg.com/webgl-debug@2.0.1/index.js";function TC(t){return t.luma=t.luma||{},t.luma}async function m8(){ou()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await wC(g8))}function _8(t,e={}){return e.debugWebGL||e.traceWebGL?v8(t,e):y8(t)}function y8(t){const e=TC(t);return e.realContext?e.realContext:t}function v8(t,e){if(!globalThis.WebGLDebugUtils)return lt.warn("webgl-debug not loaded")(),t;const r=TC(t);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...Ch,...t});const n=globalThis.WebGLDebugUtils.makeDebugContext(t,x8.bind(null,e),b8.bind(null,e));for(const d in Ch)!(d in n)&&typeof Ch[d]=="number"&&(n[d]=Ch[d]);class o{}Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.setPrototypeOf(o,n);const c=Object.create(o);return r.realContext=t,r.debugContext=c,c.debug=!0,c}function O3(t,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${t}(${r})`}function x8(t,e,r,n){n=Array.from(n).map(a=>a===void 0?"undefined":a);const o=globalThis.WebGLDebugUtils.glEnumToString(e),c=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,n),d=`${o} in gl.${r}(${c})`;lt.error(d)();debugger}function b8(t,e,r){let n="";lt.level>=1&&(n=O3(e,r),t.traceWebGL&&lt.log(1,n)());for(const o of r)if(o===void 0){n=n||O3(e,r);debugger}}const B0={};function w8(t="id"){B0[t]=B0[t]||1;const e=B0[t]++;return`${t}-${e}`}class Gf extends gn{constructor(r,n={}){super(r,n);Q(this,"device");Q(this,"gl");Q(this,"handle");Q(this,"glTarget");Q(this,"glUsage");Q(this,"glIndexType",5123);Q(this,"byteLength");Q(this,"bytesUsed");this.device=r,this.gl=this.device.gl;const o=typeof n=="object"?n.handle:void 0;this.handle=o||this.gl.createBuffer(),r.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=T8(this.props.usage),this.glUsage=S8(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,n.data?this._initWithData(n.data,n.byteOffset,n.byteLength):this._initWithByteLength(n.byteLength||0)}_initWithData(r,n=0,o=r.byteLength+n){const c=this.glTarget;this.gl.bindBuffer(c,this.handle),this.gl.bufferData(c,o,this.glUsage),this.gl.bufferSubData(c,n,r),this.gl.bindBuffer(c,null),this.bytesUsed=o,this.byteLength=o,this._setDebugData(r,n,o),this.trackAllocatedMemory(o)}_initWithByteLength(r){let n=r;r===0&&(n=new Float32Array(0));const o=this.glTarget;return this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,n,this.glUsage),this.gl.bindBuffer(o,null),this.bytesUsed=r,this.byteLength=r,this._setDebugData(null,0,r),this.trackAllocatedMemory(r),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(r,n=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,n,r),this.gl.bindBuffer(36663,null),this._setDebugData(r,n,r.byteLength)}async readAsync(r=0,n){return this.readSyncWebGL(r,n)}readSyncWebGL(r=0,n){n=n??this.byteLength-r;const o=new Uint8Array(n),c=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,r,o,c,n),this.gl.bindBuffer(36662,null),this._setDebugData(o,r,n),o}}function T8(t){return t&gn.INDEX?34963:t&gn.VERTEX?34962:t&gn.UNIFORM?35345:34962}function S8(t){return t&gn.INDEX||t&gn.VERTEX?35044:t&gn.UNIFORM?35048:35044}function E8(t){const e=t.split(/\r?\n/),r=[];for(const n of e){if(n.length<=1)continue;const o=n.split(":");if(o.length===2){const[M,F]=o;r.push({message:F.trim(),type:F3(M),lineNum:0,linePos:0});continue}const[c,d,a,...y]=o;let S=parseInt(a,10);isNaN(S)&&(S=0);let E=parseInt(d,10);isNaN(E)&&(E=0),r.push({message:y.join(":").trim(),type:F3(c),lineNum:S,linePos:E})}return r}function F3(t){const e=["warning","error","info"],r=t.toLowerCase();return e.includes(r)?r:"info"}class A8 extends A_{constructor(r,n){super(r,n);Q(this,"device");Q(this,"handle");switch(this.device=r,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const r=this.device.gl.getShaderInfoLog(this.handle);return r?E8(r):[]}getTranslatedSource(){const n=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(n==null?void 0:n.getTranslatedShaderSource(this.handle))||null}async _compile(r){r=r.startsWith("#version ")?r:`#version 300 es
${r}`;const{gl:n}=this.device;if(n.shaderSource(this.handle,r),n.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}lt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),lt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const r=async c=>await new Promise(d=>setTimeout(d,c));if(!this.device.features.has("compilation-status-async-webgl")){await r(10);return}const{gl:o}=this.device;for(;;){if(o.getShaderParameter(this.handle,37297))return;await r(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function I8(t,e,r,n){if(R8(e))return n(t);const o=t;o.pushState();try{return P8(t,e),ld(o.gl,r),n(t)}finally{o.popState()}}function P8(t,e){const r=t,{gl:n}=r;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(qc("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const c=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,d=qc("provokingVertex",e.provokingVertex,{first:36429,last:36430});c==null||c.provokingVertexWEBGL(d)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const c=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,d=qc("polygonMode",e.polygonMode,{fill:6914,line:6913});c==null||c.polygonModeWEBGL(1028,d),c==null||c.polygonModeWEBGL(1029,d)}e.polygonOffsetLine&&n.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask(M8("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(Tb("depthCompare",e.depthCompare))),e.stencilWriteMask){const o=e.stencilWriteMask;n.stencilMaskSeparate(1028,o),n.stencilMaskSeparate(1029,o)}if(e.stencilReadMask&&lt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const o=e.stencilReadMask||4294967295,c=Tb("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,c,0,o),n.stencilFuncSeparate(1029,c,0,o)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const o=U0("stencilPassOperation",e.stencilPassOperation),c=U0("stencilFailOperation",e.stencilFailOperation),d=U0("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,c,d,o),n.stencilOpSeparate(1029,c,d,o)}switch(e.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const o=N3("blendColorOperation",e.blendColorOperation||"add"),c=N3("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(o,c);const d=vm("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=vm("blendColorDstFactor",e.blendColorDstFactor||"zero"),y=vm("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),S=vm("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(d,a,y,S)}}function Tb(t,e){return qc(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function U0(t,e){return qc(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function N3(t,e){return qc(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function vm(t,e){return qc(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function C8(t,e){return`Illegal parameter ${e} for ${t}`}function qc(t,e,r){if(!(e in r))throw new Error(C8(t,e));return r[e]}function M8(t,e){return e}function R8(t){let e=!0;for(const r in t){e=!1;break}return e}function SC(t){const e={};return t.addressModeU&&(e[10242]=V0(t.addressModeU)),t.addressModeV&&(e[10243]=V0(t.addressModeV)),t.addressModeW&&(e[32882]=V0(t.addressModeW)),t.magFilter&&(e[10240]=Sb(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=k8(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Tb("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function V0(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Sb(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function k8(t,e="none"){if(!e)return Sb(t);switch(e){case"none":return Sb(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class Eb extends I_{constructor(r,n){super(r,n);Q(this,"device");Q(this,"handle");Q(this,"parameters");this.device=r,this.parameters=SC(n),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(r){for(const[n,o]of Object.entries(r)){const c=Number(n);switch(c){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,c,o);break;default:this.device.gl.samplerParameteri(this.handle,c,o);break}}}}class kh extends E_{constructor(r,n){super(r,{...vn.defaultProps,...n});Q(this,"device");Q(this,"gl");Q(this,"handle");Q(this,"texture");this.device=r,this.gl=this.device.gl,this.handle=null,this.texture=n.texture}}const D8="Failed to deduce GL constant from typed array";function O8(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(D8)}}function F8(t,e){const{clamped:r=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function EC(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function N8(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function j_(t,e,r){if(L8(e))return r(t);const{nocatch:n=!0}=e,o=Zc.get(t);o.push(),ld(t,e);let c;if(n)c=r(t),o.pop();else try{c=r(t)}finally{o.pop()}return c}function L8(t){for(const e in t)return!1;return!0}function z8(t,e,r){const{dimension:n,width:o,height:c,depth:d=0}=r,{glInternalFormat:a}=r,y=r.glTarget;switch(n){case"2d-array":case"3d":t.texStorage3D(y,e,a,o,c,d);break;default:t.texStorage2D(y,e,a,o,c)}}function L3(t,e,r,n){const{width:o,height:c}=n,{dimension:d,depth:a=0,mipLevel:y=0}=n,{x:S=0,y:E=0,z:M=0}=n,{glFormat:F,glType:N}=n,G=AC(n.glTarget,d,a),re=n.flipY?{37440:!0}:{};j_(t,re,()=>{switch(d){case"2d-array":case"3d":t.bindTexture(G,e),t.texSubImage3D(G,y,S,E,M,o,c,a,F,N,r),t.bindTexture(G,null);break;case"2d":case"cube":t.bindTexture(G,e),t.texSubImage2D(G,y,S,E,o,c,F,N,r),t.bindTexture(G,null);break;default:throw new Error(d)}})}function z3(t,e,r){const{dimension:n,width:o,height:c,depth:d=0,mipLevel:a=0,byteOffset:y=0}=r,{x:S=0,y:E=0,z:M=0}=r,{glFormat:F,glType:N,compressed:G}=r,re=AC(r.glTarget,n,d);switch(n){case"2d-array":case"3d":G?t.compressedTexSubImage3D(re,a,S,E,M,o,c,d,F,e,y):t.texSubImage3D(re,a,S,E,M,o,c,d,F,N,e,y);break;case"2d":case"cube":G?t.compressedTexSubImage2D(re,a,S,E,o,c,F,e,y):t.texSubImage2D(re,a,S,E,o,c,F,N,e,y);break;default:throw new Error(n)}}function B8(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function AC(t,e,r){return e==="cube"?34069+r:t}function U8(t,e){var Y;const{sourceX:r=0,sourceY:n=0,sourceAttachment:o=0}=e||{};let{target:c=null,sourceWidth:d,sourceHeight:a,sourceDepth:y,sourceFormat:S,sourceType:E}=e||{};const{framebuffer:M,deleteFramebuffer:F}=IC(t),{gl:N,handle:G}=M;d||(d=M.width),a||(a=M.height);const re=(Y=M.colorAttachments[o])==null?void 0:Y.texture;if(!re)throw new Error(`Invalid framebuffer attachment ${o}`);y=(re==null?void 0:re.depth)||1,S||(S=(re==null?void 0:re.glFormat)||6408),E||(E=(re==null?void 0:re.glType)||5121),c=$8(c,E,S,d,a),E=E||O8(c);const me=N.bindFramebuffer(36160,G);return N.readBuffer(36064+o),N.readPixels(r,n,d,a,S,E,c),N.readBuffer(36064),N.bindFramebuffer(36160,me||null),F&&M.destroy(),c}function V8(t,e){const{target:r,sourceX:n=0,sourceY:o=0,sourceFormat:c=6408,targetByteOffset:d=0}=e||{};let{sourceWidth:a,sourceHeight:y,sourceType:S}=e||{};const{framebuffer:E,deleteFramebuffer:M}=IC(t);a=a||E.width,y=y||E.height;const F=E;S=S||5121;let N=r;if(!N){const re=EC(c),me=N8(S),Y=d+a*y*re*me;N=F.device.createBuffer({byteLength:Y})}const G=t.device.createCommandEncoder();return G.copyTextureToBuffer({sourceTexture:t,width:a,height:y,origin:[n,o],destinationBuffer:N,byteOffset:d}),G.destroy(),M&&E.destroy(),N}function IC(t){return t instanceof P_?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:j8(t),deleteFramebuffer:!0}}function j8(t,e){const{device:r,width:n,height:o,id:c}=t;return r.createFramebuffer({...e,id:`framebuffer-for-${c}`,width:n,height:o,colorAttachments:[t]})}function $8(t,e,r,n,o,c){if(t)return t;e||(e=5121);const d=F8(e,{clamped:!1}),a=EC(r);return new d(n*o*a)}class Kf extends vn{constructor(r,n){super(r,n);Q(this,"device");Q(this,"gl");Q(this,"handle");Q(this,"sampler");Q(this,"view");Q(this,"mipmaps");Q(this,"compressed");Q(this,"glTarget");Q(this,"glFormat");Q(this,"glType");Q(this,"glInternalFormat");Q(this,"textureUnit",0);const o={...this.props};o.data=n.data,this.device=r,this.gl=this.device.gl,this.glTarget=B8(this.props.dimension);const c=bC(this.props.format);this.glInternalFormat=c.internalFormat,this.glFormat=c.format,this.glType=c.type,this.compressed=c.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(o),Object.seal(this)}_initialize(r){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:r.data});let{width:n,height:o}=r;if(!n||!o){const c=vn.getTextureDataSize(r.data);n=(c==null?void 0:c.width)||1,o=(c==null?void 0:c.height)||1}if(this.width=n,this.height=o,this.depth=r.depth,this.setSampler(r.sampler),this.view=new kh(this.device,{...this.props,texture:this}),this.bind(),z8(this.gl,this.mipLevels,this),r.data)switch(r.dimension){case"1d":this.setTexture1DData(r.data);break;case"2d":this.setTexture2DData(r.data);break;case"3d":this.setTexture3DData(r.data);break;case"cube":this.setTextureCubeData(r.data);break;case"2d-array":this.setTextureArrayData(r.data);break;case"cube-array":this.setTextureCubeArrayData(r.data);break;default:throw new Error(r.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(r){return new kh(this.device,{...r,texture:this})}setSampler(r={}){let n;r instanceof Eb?(this.sampler=r,n=r.props):(this.sampler=new Eb(this.device,r),n=r);const o=SC(n);this._setSamplerParameters(o)}generateMipmap(r){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(lt.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(r!=null&&r.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(o){lt.warn(`Error generating mipmap for ${this}: ${o.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(r){const n=vn.getExternalImageSize(r.image),o={...vn.defaultCopyExternalImageOptions,...n,...r},{image:c,depth:d,mipLevel:a,x:y,y:S,z:E,flipY:M}=o;let{width:F,height:N}=o;const{dimension:G,glTarget:re,glFormat:me,glInternalFormat:Y,glType:q}=this;if(F=Math.min(F,this.width-y),N=Math.min(N,this.height-S),r.sourceX||r.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return L3(this.device.gl,this.handle,c,{dimension:G,mipLevel:a,x:y,y:S,z:E,width:F,height:N,depth:d,glFormat:me,glType:q,glTarget:re,flipY:M}),{width:o.width,height:o.height}}setTexture1DData(r){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(r,n=0){this.bind();const o=vn.normalizeTextureData(r,this);o.length>1&&this.props.mipmaps!==!1&&lt.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let c=0;c<o.length;c++){const d=o[c];this._setMipLevel(n,c,d)}this.unbind()}setTexture3DData(r){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(r)&&(this.bind(),z3(this.device.gl,r,this),this.unbind())}setTextureCubeData(r,n=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const o of vn.CubeFaces)this.setTextureCubeFaceData(r[o],o)}setTextureArrayData(r){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(r){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(r,n,o=0){Array.isArray(r)&&r.length>1&&this.props.mipmaps!==!1&&lt.warn(`${this.id} has mipmap and multiple LODs.`)();const c=vn.CubeFaces.indexOf(n);this.setTexture2DData(r,c)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(r){const{face:n,width:o,height:c,pixels:d,data:a,format:y=6408,type:S=5121}=r,{gl:E}=this,M=d||a;this.bind(),M instanceof Promise?M.then(F=>this.setImageDataForFace(Object.assign({},r,{face:n,data:F,pixels:F}))):this.width||this.height?E.texImage2D(n,0,y,o,c,0,y,S,M):E.texImage2D(n,0,y,y,S,M)}_getImageDataMap(r){for(let n=0;n<vn.CubeFaces.length;++n){const o=vn.CubeFaces[n];r[o]&&(r[34069+n]=r[o],delete r[o])}return r}_setSamplerParameters(r){lt.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(r))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[n,o]of Object.entries(r)){const c=Number(n),d=o;switch(c){case 33082:case 33083:this.gl.texParameterf(this.glTarget,c,d);break;case 10241:this.gl.texParameteri(this.glTarget,c,d);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,c,d);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,c,d);break;default:this.gl.texParameteri(this.glTarget,c,d);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(r,n,o,c=this.glTarget){if(vn.isExternalImage(o)){L3(this.device.gl,this.handle,o,{...this,depth:r,mipLevel:n,glTarget:c,flipY:this.props.flipY});return}if(vn.isTextureLevelData(o)){z3(this.device.gl,o.data,{...this,depth:r,mipLevel:n,glTarget:c});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(r){const{gl:n}=this;return r!==void 0&&(this.textureUnit=r,n.activeTexture(33984+r)),n.bindTexture(this.glTarget,this.handle),r}unbind(r){const{gl:n}=this;return r!==void 0&&(this.textureUnit=r,n.activeTexture(33984+r)),n.bindTexture(this.glTarget,null),r}}const W8=[1,2,4,8];class H8 extends Jx{constructor(r,n){var d;super(r,n);Q(this,"device");Q(this,"glParameters");this.device=r;let o;if(!((d=n==null?void 0:n.parameters)!=null&&d.viewport))if(n!=null&&n.framebuffer){const{width:a,height:y}=n.framebuffer;o=[0,0,a,y]}else{const[a,y]=r.getCanvasContext().getDrawingBufferSize();o=[0,0,a,y]}this.device.pushState(),this.setParameters({viewport:o,...this.props.parameters});const c=this.props.framebuffer;if(c!=null&&c.handle)if(this.props.framebuffer){const a=this.props.framebuffer.colorAttachments.map((y,S)=>36064+S);this.device.gl.drawBuffers(a)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(r){}popDebugGroup(){}insertDebugMarker(r){}setParameters(r={}){const n={...this.glParameters};n.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(n.depthMask=!this.props.depthReadOnly),n.stencilMask=this.props.stencilReadOnly?0:1,n[35977]=this.props.discard,r.viewport&&(r.viewport.length>=6?(n.viewport=r.viewport.slice(0,4),n.depthRange=[r.viewport[4],r.viewport[5]]):n.viewport=r.viewport),r.scissorRect&&(n.scissorTest=!0,n.scissor=r.scissorRect),r.blendConstant&&(n.blendColor=r.blendConstant),r.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),r[2967]=r.stencilReference),r.colorMask&&(n.colorMask=W8.map(o=>!!(o&r.colorMask))),this.glParameters=n,ld(this.device.gl,n)}beginOcclusionQuery(r){const n=this.props.occlusionQuerySet;n==null||n.beginOcclusionQuery()}endOcclusionQuery(){const r=this.props.occlusionQuerySet;r==null||r.endOcclusionQuery()}clear(){const r={...this.glParameters};let n=0;this.props.clearColors&&this.props.clearColors.forEach((o,c)=>{o&&this.clearColorBuffer(c,o)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(n|=16384,r.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(n|=256,r.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(n|=1024,r.clearStencil=this.props.clearStencil),n!==0&&j_(this.device.gl,r,()=>{this.device.gl.clear(n)})}clearColorBuffer(r=0,n=[0,0,0,0]){j_(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(n.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,r,n);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,r,n);break;case Float32Array:this.device.gl.clearBufferfv(6144,r,n);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function X8(t){return Z8.includes(t)}const Z8=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],PC={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function CC(t){const e=PC[t];if(!e)throw new Error("uniform");const[r,n,,o]=e;return{format:o,components:n,glType:r}}function q8(t){const e=PC[t];if(!e)throw new Error("attribute");const[,r,,n,o]=e;return{attributeType:n,vertexFormat:o,components:r}}function Y8(t,e){const r={attributes:[],bindings:[]};r.attributes=G8(t,e);const n=J8(t,e);for(const a of n){const y=a.uniforms.map(S=>({name:S.name,format:S.format,byteOffset:S.byteOffset,byteStride:S.byteStride,arrayLength:S.arrayLength}));r.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:y})}const o=Q8(t,e);let c=0;for(const a of o)if(X8(a.type)){const{viewDimension:y,sampleType:S}=tV(a.type);r.bindings.push({type:"texture",name:a.name,group:0,location:c,viewDimension:y,sampleType:S}),a.textureUnit=c,c+=1}o.length&&(r.uniforms=o);const d=K8(t,e);return d!=null&&d.length&&(r.varyings=d),r}function G8(t,e){const r=[],n=t.getProgramParameter(e,35721);for(let o=0;o<n;o++){const c=t.getActiveAttrib(e,o);if(!c)throw new Error("activeInfo");const{name:d,type:a}=c,y=t.getAttribLocation(e,d);if(y>=0){const{attributeType:S}=q8(a),E=/instance/i.test(d)?"instance":"vertex";r.push({name:d,location:y,stepMode:E,type:S})}}return r.sort((o,c)=>o.location-c.location),r}function K8(t,e){const r=[],n=t.getProgramParameter(e,35971);for(let o=0;o<n;o++){const c=t.getTransformFeedbackVarying(e,o);if(!c)throw new Error("activeInfo");const{name:d,type:a,size:y}=c,{glType:S,components:E}=CC(a),M={location:o,name:d,type:S,size:y*E};r.push(M)}return r.sort((o,c)=>o.location-c.location),r}function Q8(t,e){const r=[],n=t.getProgramParameter(e,35718);for(let o=0;o<n;o++){const c=t.getActiveUniform(e,o);if(!c)throw new Error("activeInfo");const{name:d,size:a,type:y}=c,{name:S,isArray:E}=rV(d);let M=t.getUniformLocation(e,S);const F={location:M,name:S,size:a,type:y,isArray:E};if(r.push(F),F.size>1)for(let N=0;N<F.size;N++){const G=`${S}[${N}]`;M=t.getUniformLocation(e,G);const re={...F,name:G,location:M};r.push(re)}}return r}function J8(t,e){const r=(c,d)=>t.getActiveUniformBlockParameter(e,c,d),n=[],o=t.getProgramParameter(e,35382);for(let c=0;c<o;c++){const d={name:t.getActiveUniformBlockName(e,c)||"",location:r(c,35391),byteLength:r(c,35392),vertex:r(c,35396),fragment:r(c,35398),uniformCount:r(c,35394),uniforms:[]},a=r(c,35395)||[],y=t.getActiveUniforms(e,a,35383),S=t.getActiveUniforms(e,a,35384),E=t.getActiveUniforms(e,a,35387),M=t.getActiveUniforms(e,a,35388);for(let F=0;F<d.uniformCount;++F){const N=t.getActiveUniform(e,a[F]);if(!N)throw new Error("activeInfo");d.uniforms.push({name:N.name,format:CC(y[F]).format,type:y[F],arrayLength:S[F],byteOffset:E[F],byteStride:M[F]})}n.push(d)}return n.sort((c,d)=>c.location-d.location),n}const eV={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function tV(t){const e=eV[t];if(!e)throw new Error("sampler");const[r,n]=e;return{viewDimension:r,sampleType:n}}function rV(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const r=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!r||r.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:r[1],length:r[2]?1:0,isArray:!!r[2]}}function nV(t,e,r,n){const o=t;let c=n;c===!0&&(c=1),c===!1&&(c=0);const d=typeof c=="number"?[c]:c;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,n);case 5126:return t.uniform1fv(e,d);case 35664:return t.uniform2fv(e,d);case 35665:return t.uniform3fv(e,d);case 35666:return t.uniform4fv(e,d);case 5124:return t.uniform1iv(e,d);case 35667:return t.uniform2iv(e,d);case 35668:return t.uniform3iv(e,d);case 35669:return t.uniform4iv(e,d);case 35670:return t.uniform1iv(e,d);case 35671:return t.uniform2iv(e,d);case 35672:return t.uniform3iv(e,d);case 35673:return t.uniform4iv(e,d);case 5125:return o.uniform1uiv(e,d,1);case 36294:return o.uniform2uiv(e,d,2);case 36295:return o.uniform3uiv(e,d,3);case 36296:return o.uniform4uiv(e,d,4);case 35674:return t.uniformMatrix2fv(e,!1,d);case 35675:return t.uniformMatrix3fv(e,!1,d);case 35676:return t.uniformMatrix4fv(e,!1,d);case 35685:return o.uniformMatrix2x3fv(e,!1,d);case 35686:return o.uniformMatrix2x4fv(e,!1,d);case 35687:return o.uniformMatrix3x2fv(e,!1,d);case 35688:return o.uniformMatrix3x4fv(e,!1,d);case 35689:return o.uniformMatrix4x2fv(e,!1,d);case 35690:return o.uniformMatrix4x3fv(e,!1,d)}throw new Error("Illegal uniform")}function iV(t){return lC(t)!==null||typeof t=="number"||typeof t=="boolean"}function sV(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{const n=t[r];iV(n)?e.uniforms[r]=n:e.bindings[r]=n}),e}function oV(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function aV(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const B3=4;class lV extends Gh{constructor(r,n){super(r,n);Q(this,"device");Q(this,"handle");Q(this,"vs");Q(this,"fs");Q(this,"introspectedLayout");Q(this,"uniforms",{});Q(this,"bindings",{});Q(this,"varyings",null);Q(this,"_uniformCount",0);Q(this,"_uniformSetters",{});this.device=r,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=n.vs,this.fs=n.fs;const{varyings:o,bufferMode:c=35981}=n;o&&o.length>0&&(this.varyings=o,this.device.gl.transformFeedbackVaryings(this.handle,o,c)),this._linkShaders(),lt.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=Y8(this.device.gl,this.handle),lt.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=cV(this.introspectedLayout,n.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(r,n){for(const[o,c]of Object.entries(r)){const d=this.shaderLayout.bindings.find(a=>a.name===o)||this.shaderLayout.bindings.find(a=>a.name===`${o}Uniforms`);if(!d){const a=this.shaderLayout.bindings.map(y=>`"${y.name}"`).join(", ");n!=null&&n.disableWarnings||lt.warn(`No binding "${o}" in render pipeline "${this.id}", expected one of ${a}`,c)();continue}switch(c||lt.warn(`Unsetting binding "${o}" in render pipeline "${this.id}"`)(),d.type){case"uniform":if(!(c instanceof Gf)&&!(c.buffer instanceof Gf))throw new Error("buffer value");break;case"texture":if(!(c instanceof kh||c instanceof Kf||c instanceof Yf))throw new Error("texture value");break;case"sampler":lt.warn(`Ignoring sampler ${o}`)();break;default:throw new Error(d.type)}this.bindings[o]=c}}draw(r){var me;const{renderPass:n,parameters:o=this.props.parameters,topology:c=this.props.topology,vertexArray:d,vertexCount:a,instanceCount:y,isInstanced:S=!1,firstVertex:E=0,transformFeedback:M}=r,F=oV(c),N=!!d.indexBuffer,G=(me=d.indexBuffer)==null?void 0:me.glIndexType;if(this.linkStatus!=="success")return lt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return lt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),d.bindBeforeRender(n),M&&M.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const re=n;return I8(this.device,o,re.glParameters,()=>{N&&S?this.device.gl.drawElementsInstanced(F,a||0,G,E,y||0):N?this.device.gl.drawElements(F,a||0,G,E):S?this.device.gl.drawArraysInstanced(F,E,a||0,y||0):this.device.gl.drawArrays(F,E,a||0),M&&M.end()}),d.unbindAfterRender(n),!0}setUniformsWebGL(r){const{bindings:n}=sV(r);Object.keys(n).forEach(o=>{lt.warn(`Unsupported value "${JSON.stringify(n[o])}" used in setUniforms() for key ${o}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,r)}async _linkShaders(){const{gl:r}=this.device;if(r.attachShader(this.handle,this.vs.handle),r.attachShader(this.handle,this.fs.handle),lt.time(B3,`linkProgram for ${this.id}`)(),r.linkProgram(this.handle),lt.timeEnd(B3,`linkProgram for ${this.id}`)(),lt.level,!this.device.features.has("compilation-status-async-webgl")){const o=this._getLinkStatus();this._reportLinkStatus(o);return}lt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),lt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const n=this._getLinkStatus();this._reportLinkStatus(n)}async _reportLinkStatus(r){var n;switch(r){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((n=this.fs)==null?void 0:n.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const o=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${r}: ${o}`)}}_getLinkStatus(){const{gl:r}=this.device;return r.getProgramParameter(this.handle,35714)?(r.validateProgram(this.handle),r.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const r=async c=>await new Promise(d=>setTimeout(d,c));if(!this.device.features.has("compilation-status-async-webgl")){await r(10);return}const{gl:o}=this.device;for(;;){if(o.getProgramParameter(this.handle,37297))return;await r(10)}}_areTexturesRenderable(){let r=!0;for(const n of this.shaderLayout.bindings)!this.bindings[n.name]&&!this.bindings[n.name.replace(/Uniforms$/,"")]&&(lt.warn(`Binding ${n.name} not found in ${this.id}`)(),r=!1);return r}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:r}=this.device;r.useProgram(this.handle);let n=0,o=0;for(const c of this.shaderLayout.bindings){const d=this.bindings[c.name]||this.bindings[c.name.replace(/Uniforms$/,"")];if(!d)throw new Error(`No value for binding ${c.name} in ${this.id}`);switch(c.type){case"uniform":const{name:a}=c,y=r.getUniformBlockIndex(this.handle,a);if(y===4294967295)throw new Error(`Invalid uniform block name ${a}`);r.uniformBlockBinding(this.handle,o,y),d instanceof Gf?r.bindBufferBase(35345,o,d.handle):r.bindBufferRange(35345,o,d.buffer.handle,d.offset||0,d.size||d.buffer.byteLength-d.offset),o+=1;break;case"texture":if(!(d instanceof kh||d instanceof Kf||d instanceof Yf))throw new Error("texture");let S;if(d instanceof kh)S=d.texture;else if(d instanceof Kf)S=d;else if(d instanceof Yf&&d.colorAttachments[0]instanceof kh)lt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),S=d.colorAttachments[0].texture;else throw new Error("No texture");r.activeTexture(33984+n),r.bindTexture(S.glTarget,S.handle),n+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${c.type}' not supported in WebGL`)}}}_applyUniforms(){for(const r of this.shaderLayout.uniforms||[]){const{name:n,location:o,type:c,textureUnit:d}=r,a=this.uniforms[n]??d;a!==void 0&&nV(this.device.gl,o,c,a)}}}function cV(t,e){const r={...t,attributes:t.attributes.map(n=>({...n}))};for(const n of(e==null?void 0:e.attributes)||[]){const o=r.attributes.find(c=>c.name===n.name);o?(o.type=n.type||o.type,o.stepMode=n.stepMode||o.stepMode):lt.warn(`shader layout attribute ${n.name} not present in shader`)}return r}class uV extends tb{constructor(r){super(r,{});Q(this,"device");Q(this,"commands",[]);this.device=r}submitCommands(r=this.commands){for(const n of r)switch(n.name){case"copy-buffer-to-buffer":hV(this.device,n.options);break;case"copy-buffer-to-texture":dV(this.device,n.options);break;case"copy-texture-to-buffer":fV(this.device,n.options);break;case"copy-texture-to-texture":pV(this.device,n.options);break;default:throw new Error(n.name)}}}function hV(t,e){const r=e.sourceBuffer,n=e.destinationBuffer;t.gl.bindBuffer(36662,r.handle),t.gl.bindBuffer(36663,n.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function dV(t,e){throw new Error("Not implemented")}function fV(t,e){const{sourceTexture:r,mipLevel:n=0,aspect:o="all",width:c=e.sourceTexture.width,height:d=e.sourceTexture.height,depthOrArrayLayers:a=0,origin:y=[0,0],destinationBuffer:S,byteOffset:E=0,bytesPerRow:M,rowsPerImage:F}=e;if(o!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||a!==0||M||F)throw new Error("not implemented");const{framebuffer:N,destroyFramebuffer:G}=MC(r);let re;try{const me=S,Y=c||N.width,q=d||N.height,Z=bC(N.colorAttachments[0].texture.props.format),le=Z.format,Ae=Z.type;t.gl.bindBuffer(35051,me.handle),re=t.gl.bindFramebuffer(36160,N.handle),t.gl.readPixels(y[0],y[1],Y,q,le,Ae,E)}finally{t.gl.bindBuffer(35051,null),re!==void 0&&t.gl.bindFramebuffer(36160,re),G&&N.destroy()}}function pV(t,e){const{sourceTexture:r,destinationMipLevel:n=0,origin:o=[0,0],destinationOrigin:c=[0,0],destinationTexture:d}=e;let{width:a=e.destinationTexture.width,height:y=e.destinationTexture.height}=e;const{framebuffer:S,destroyFramebuffer:E}=MC(r),[M,F]=o,[N,G,re]=c,me=t.gl.bindFramebuffer(36160,S.handle);let Y=null,q;if(d instanceof Kf)Y=d,a=Number.isFinite(a)?a:Y.width,y=Number.isFinite(y)?y:Y.height,Y.bind(0),q=Y.glTarget;else throw new Error("invalid destination");switch(q){case 3553:case 34067:t.gl.copyTexSubImage2D(q,n,N,G,M,F,a,y);break;case 35866:case 32879:t.gl.copyTexSubImage3D(q,n,N,G,re,M,F,a,y);break}Y&&Y.unbind(),t.gl.bindFramebuffer(36160,me),E&&S.destroy()}function MC(t){if(t instanceof vn){const{width:e,height:r,id:n}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:r,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class gV extends eb{constructor(r,n){super(r,n);Q(this,"device");Q(this,"commandBuffer");this.device=r,this.commandBuffer=new uV(r)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(r){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:r})}copyBufferToTexture(r){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:r})}copyTextureToBuffer(r){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:r})}copyTextureToTexture(r){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:r})}pushDebugGroup(r){}popDebugGroup(){}insertDebugMarker(r){}resolveQuerySet(r,n,o){}}function mV(t){const{target:e,source:r,start:n=0,count:o=1}=t,c=r.length,d=o*c;let a=0;for(let y=n;a<c;a++)e[y++]=r[a];for(;a<d;)a<d-a?(e.copyWithin(n+a,n,n+a),a*=2):(e.copyWithin(n+a,n,n+d-a),a=d);return t.target}class iw extends rb{constructor(r,n){super(r,n);Q(this,"device");Q(this,"handle");Q(this,"buffer",null);Q(this,"bufferValue",null);this.device=r,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(r){return ID()==="Chrome"}destroy(){var r;super.destroy(),this.buffer&&((r=this.buffer)==null||r.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(r){const n=r;if(n&&n.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,n?n.handle:null),this.indexBuffer=n,this.device.gl.bindVertexArray(null)}setBuffer(r,n){const o=n;if(o.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:c,type:d,stride:a,offset:y,normalized:S,integer:E,divisor:M}=this._getAccessor(r);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,o.handle),E?this.device.gl.vertexAttribIPointer(r,c,d,a,y):this.device.gl.vertexAttribPointer(r,c,d,S,a,y),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(r),this.device.gl.vertexAttribDivisor(r,M||0),this.attributes[r]=o,this.device.gl.bindVertexArray(null)}setConstantWebGL(r,n){this._enable(r,!1),this.attributes[r]=n}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let r=0;r<this.maxVertexAttributes;++r){const n=this.attributes[r];ArrayBuffer.isView(n)&&this.device.setConstantAttributeWebGL(r,n)}}_getAccessor(r){const n=this.attributeInfos[r];if(!n)throw new Error(`Unknown attribute location ${r}`);const o=xC(n.bufferDataType);return{size:n.bufferComponents,type:o,stride:n.byteStride,offset:n.byteOffset,normalized:n.normalized,integer:n.integer,divisor:n.stepMode==="instance"?1:0}}_enable(r,n=!0){const c=iw.isConstantAttributeZeroSupported(this.device)||r!==0;(n||c)&&(r=Number(r),this.device.gl.bindVertexArray(this.handle),n?this.device.gl.enableVertexAttribArray(r):this.device.gl.disableVertexAttribArray(r),this.device.gl.bindVertexArray(null))}getConstantBuffer(r,n){const o=_V(n),c=o.byteLength*r,d=o.length*r;if(this.buffer&&c!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${c} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:c}),a=a||!yV(o,this.bufferValue),a){const y=pL(n.constructor,d);mV({target:y,source:o,start:0,count:d}),this.buffer.write(y),this.bufferValue=n}return this.buffer}}function _V(t){return Array.isArray(t)?new Float32Array(t):t}function yV(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}class vV extends nb{constructor(r,n){super(r,n);Q(this,"device");Q(this,"gl");Q(this,"handle");Q(this,"layout");Q(this,"buffers",{});Q(this,"unusedBuffers",{});Q(this,"bindOnUse",!0);Q(this,"_bound",!1);this.device=r,this.gl=r.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,n.buffers&&this.setBuffers(n.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(r="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(aV(r))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(r){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const n in r)this.setBuffer(n,r[n])})}setBuffer(r,n){const o=this._getVaryingIndex(r),{buffer:c,byteLength:d,byteOffset:a}=this._getBufferRange(n);if(o<0){this.unusedBuffers[r]=c,lt.warn(`${this.id} unusedBuffers varying buffer ${r}`)();return}this.buffers[o]={buffer:c,byteLength:d,byteOffset:a},this.bindOnUse||this._bindBuffer(o,c,a,d)}getBuffer(r){if(U3(r))return this.buffers[r]||null;const n=this._getVaryingIndex(r);return n>=0?this.buffers[n]:null}bind(r=this.handle){if(typeof r!="function")return this.gl.bindTransformFeedback(36386,r),this;let n;return this._bound?n=r():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,n=r(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),n}unbind(){this.bind(null)}_getBufferRange(r){if(r instanceof Gf)return{buffer:r,byteOffset:0,byteLength:r.byteLength};const{buffer:n,byteOffset:o=0,byteLength:c=r.buffer.byteLength}=r;return{buffer:n,byteOffset:o,byteLength:c}}_getVaryingIndex(r){if(U3(r))return Number(r);for(const n of this.layout.varyings)if(r===n.name)return n.location;return-1}_bindBuffers(){for(const r in this.buffers){const{buffer:n,byteLength:o,byteOffset:c}=this._getBufferRange(this.buffers[r]);this._bindBuffer(Number(r),n,c,o)}}_unbindBuffers(){for(const r in this.buffers)this.gl.bindBufferBase(35982,Number(r),null)}_bindBuffer(r,n,o=0,c){const d=n&&n.handle;!d||c===void 0?this.gl.bindBufferBase(35982,r,d):this.gl.bindBufferRange(35982,r,d,o,c)}}function U3(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class xV extends ib{constructor(r,n){super(r,n);Q(this,"device");Q(this,"handle");Q(this,"target",null);Q(this,"_queryPending",!1);Q(this,"_pollingPromise",null);if(this.device=r,n.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(r){return this._begin(r!=null&&r.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(r){this._queryPending||(this.target=r,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const r=this.device.gl.getQueryParameter(this.handle,34919);return r&&(this._queryPending=!1),r}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(r=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((o,c)=>{const d=()=>{this.isResultAvailable()?(o(this.getResult()),this._pollingPromise=null):n++>r?(c("Timed out"),this._pollingPromise=null):requestAnimationFrame(d)};requestAnimationFrame(d)}),this._pollingPromise}}class Dh extends Ul{constructor(r){var M,F;super({...r,id:r.id||w8("webgl-device")});Q(this,"type","webgl");Q(this,"handle");Q(this,"features");Q(this,"limits");Q(this,"info");Q(this,"canvasContext");Q(this,"lost");Q(this,"_resolveContextLost");Q(this,"gl");Q(this,"debug",!1);Q(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});Q(this,"_extensions",{});Q(this,"_polyfilled",!1);Q(this,"spectorJS");Q(this,"renderPass",null);Q(this,"_constants");const n=Ul._getCanvasContextProps(r);if(!n)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let o=(F=(M=n.canvas)==null?void 0:M.gl)==null?void 0:F.device;if(o)throw new Error(`WebGL context already attached to device ${o.id}`);this.canvasContext=new h8(this,n),this.lost=new Promise(N=>{this._resolveContextLost=N});const c={...r.webgl};n.alphaMode==="premultiplied"&&(c.premultipliedAlpha=!0),r.powerPreference!==void 0&&(c.powerPreference=r.powerPreference);const a=this.props._handle||HU(this.canvasContext.canvas,{onContextLost:N=>{var G;return(G=this._resolveContextLost)==null?void 0:G.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:N=>console.log("WebGL context restored")},c);if(!a)throw new Error("WebGL context creation failed");if(o=a.device,o){if(r._reuseDevices)return lt.log(1,`Not creating a new Device, instead returning a reference to Device ${o.id} already attached to WebGL context`,o)(),o._reused=!0,o;throw new Error(`WebGL context already attached to device ${o.id}`)}this.handle=a,this.gl=a,this.spectorJS=p8({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=XU(this.gl,this._extensions),this.limits=new l8(this.gl),this.features=new a8(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),n.autoResize!==!1&&this.canvasContext.resize(),new Zc(this.gl,{log:(...N)=>lt.log(1,...N)()}).trackState(this.gl,{copyState:!1});const S=r.debugWebGL||r.debug,E=r.debugWebGL;S&&(this.gl=_8(this.gl,{debugWebGL:S,traceWebGL:E}),lt.warn("WebGL debug mode activated. Performance reduced.")(),r.debugWebGL&&(lt.level=Math.max(lt.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(r){throw new Error("WebGL only supports a single canvas")}createBuffer(r){const n=this._normalizeBufferProps(r);return new Gf(this,n)}createTexture(r){return new Kf(this,r)}createExternalTexture(r){throw new Error("createExternalTexture() not implemented")}createSampler(r){return new Eb(this,r)}createShader(r){return new A8(this,r)}createFramebuffer(r){return new Yf(this,r)}createVertexArray(r){return new iw(this,r)}createTransformFeedback(r){return new vV(this,r)}createQuerySet(r){return new xV(this,r)}createRenderPipeline(r){return new lV(this,r)}beginRenderPass(r){return new H8(this,r)}createComputePipeline(r){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(r){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(r={}){return new gV(this,r)}submit(){var r;(r=this.renderPass)==null||r.end(),this.renderPass=null}readPixelsToArrayWebGL(r,n){return U8(r,n)}readPixelsToBufferWebGL(r,n){return V8(r,n)}setParametersWebGL(r){ld(this.gl,r)}getParametersWebGL(r){return yC(this.gl,r)}withParametersWebGL(r,n){return j_(this.gl,r,n)}resetWebGL(){lt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),UU(this.gl)}_getDeviceSpecificTextureFormatCapabilities(r){return n8(this.gl,r,this._extensions)}loseDevice(){var c;let r=!1;const o=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return o&&(r=!0,o.loseContext()),(c=this._resolveContextLost)==null||c.call(this,{reason:"destroyed",message:"Application triggered context loss"}),r}pushState(){Zc.get(this.gl).push()}popState(){Zc.get(this.gl).pop()}setSpectorMetadata(r,n){r.__SPECTOR_Metadata=n}getGLKey(r,n){const o=Number(r);for(const c in this.gl)if(this.gl[c]===o)return`GL.${c}`;return n!=null&&n.emptyIfUnknown?"":String(r)}getGLKeys(r){const n={emptyIfUnknown:!0};return Object.entries(r).reduce((o,[c,d])=>(o[`${c}:${this.getGLKey(c,n)}`]=`${d}:${this.getGLKey(d,n)}`,o),{})}setConstantAttributeWebGL(r,n){const o=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(o).fill(null);const c=this._constants[r];switch(c&&SV(c,n)&&lt.info(1,`setConstantAttributeWebGL(${r}) could have been skipped, value unchanged`)(),this._constants[r]=n,n.constructor){case Float32Array:bV(this,r,n);break;case Int32Array:wV(this,r,n);break;case Uint32Array:TV(this,r,n);break;default:throw new Error("constant")}}getExtension(r){return rd(this.gl,r,this._extensions),this._extensions}}function bV(t,e,r){switch(r.length){case 1:t.gl.vertexAttrib1fv(e,r);break;case 2:t.gl.vertexAttrib2fv(e,r);break;case 3:t.gl.vertexAttrib3fv(e,r);break;case 4:t.gl.vertexAttrib4fv(e,r);break}}function wV(t,e,r){t.gl.vertexAttribI4iv(e,r)}function TV(t,e,r){t.gl.vertexAttribI4uiv(e,r)}function SV(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}const EV={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},AV=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),IV=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),PV=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function CV(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(r,n){if(r==="webgl"||r==="experimental-webgl"){const o=this.originalGetContext("webgl2",n);return o instanceof HTMLElement&&MV(o),o}return this.originalGetContext(r,n)}}function MV(t){t.getExtension("EXT_color_buffer_float");const e={...EV,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:AV(t),OES_vertex_array_object:IV(t),ANGLE_instanced_arrays:PV(t)},r=t.getExtension;t.getExtension=function(o){const c=r.call(t,o);return c||(o in e?e[o]:null)};const n=t.getSupportedExtensions;t.getSupportedExtensions=function(){const o=n.apply(t)||[];return o==null?void 0:o.concat(Object.keys(e))}}const xm=1;class RV extends WN{constructor(){super();Q(this,"type","webgl");Ul.defaultProps={...Ul.defaultProps,...nw},Dh.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(r){CV(r)}async attach(r){if(r instanceof Dh)return r;if((r==null?void 0:r.device)instanceof Ul)return r.device;if(!kV(r))throw new Error("Invalid WebGL2RenderingContext");return new Dh({_handle:r,createCanvasContext:{canvas:r.canvas,autoResize:!1}})}async create(r={}){lt.groupCollapsed(xm,"WebGLDevice created")();const n=[];(r.debugWebGL||r.debug)&&n.push(m8()),r.debugSpectorJS&&n.push(f8(r));const o=await Promise.allSettled(n);for(const a of o)a.status==="rejected"&&lt.error(`Failed to initialize debug libraries ${a.reason}`)();const c=new Dh(r),d=`${c._reused?"Reusing":"Created"} device with WebGL2 ${c.debug?"debug ":""}context: ${c.info.vendor}, ${c.info.renderer} for canvas: ${c.canvasContext.id}`;return lt.probe(xm,d)(),lt.table(xm,c.info)(),lt.groupEnd(xm)(),c}}function kV(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const V3=new RV;function vl(){}const DV=({isDragging:t})=>t?"grabbing":"grab",RC={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:vl,onWebGLInitialized:vl,onResize:vl,onViewStateChange:vl,onInteractionStateChange:vl,onBeforeRender:vl,onAfterRender:vl,onLoad:vl,onError:t=>Gr.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:DV,getTooltip:null,debug:!1,drawPickingColors:!1};class Ap{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new wy({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:o}=this;if(n.type==="pointerleave")o.x=-1,o.y=-1,o.radius=0;else{if(n.leftButton||n.rightButton)return;{const c=n.offsetCenter;if(!c)return;o.x=c.x,o.y=c.y,o.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:o.x,y:o.y}),o.event=n},this._onEvent=n=>{const o=pb[n.type],c=n.offsetCenter;if(!o||!c||!this.layerManager)return;const d=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:c.x,y:c.y,layers:d,viewports:this.getViewports(c)},this._lastPointerDownInfo),{layer:y}=a,S=y&&(y[o]||y.props[o]),E=this.props[o];let M=!1;S&&(M=S.call(y,a,n)),M||(E==null||E(a,n),this.widgetManager.onEvent(a,n))},this._onPointerDown=n=>{var d;if(((d=this.device)==null?void 0:d.type)==="webgpu")return;const o=n.offsetCenter,c=this._pick("pickObject","pickObject Time",{x:o.x,y:o.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=c.result[0]||c.emptyInfo},this.props={...RC,...e},e=this.props,e.viewState&&e.initialViewState&&Gr.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let r=this.device;!r&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Gr.error("WebGL1 context not supported.")(),r=V3.attach(e.gl)),r||(r=Kx.createDevice({type:"best-available",_reuseDevices:!0,adapters:[V3],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(r,e),this.setProps(e),e._typedArrayManagerProps&&wp.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,r,n,o,c,d,a,y,S,E;(e=this.animationLoop)==null||e.stop(),(r=this.animationLoop)==null||r.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)==null||n.finalize(),this.layerManager=null,(o=this.viewManager)==null||o.finalize(),this.viewManager=null,(c=this.effectManager)==null||c.finalize(),this.effectManager=null,(d=this.deckRenderer)==null||d.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(y=this.eventManager)==null||y.destroy(),this.eventManager=null,(S=this.widgetManager)==null||S.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((E=this.canvas.parentElement)==null||E.removeChild(this.canvas),this.canvas=null)}setProps(e){var n;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Gr.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Gr.removed("onLayerClick","onClick")(),e.initialViewState&&!So(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(n=this.animationLoop)==null||n.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),o=this.layerManager.needsRedraw(e),c=this.effectManager.needsRedraw(e),d=this.deckRenderer.needsRedraw(e);return r=r||n||o||c||d,r}redraw(e){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=e||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return ri(this.viewManager),this.viewManager.views}getViewports(e){return ri(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const r=this._pick("pickObject","pickObject Time",e).result;return r.length?r[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,r=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:r})}_removeResources(e){for(const r of e)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var r;(r=this.layerManager)==null||r.removeDefaultShaderModule(e)}_pick(e,r,n){ri(this.deckPicker);const{stats:o}=this;o.get("Pick Count").incrementCount(),o.get(r).timeStart();const c=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return o.get(r).timeEnd(),c}_createCanvas(e){let r=e.canvas;return typeof r=="string"&&(r=document.getElementById(r),ri(r)),r||(r=document.createElement("canvas"),r.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(r)),Object.assign(r.style,e.style),r}_setCanvasSize(e){var o;if(!this.canvas)return;const{width:r,height:n}=e;if(r||r===0){const c=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=c}if(n||n===0){const c=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=((o=e.style)==null?void 0:o.position)||"absolute",this.canvas.style.height=c}}_updateCanvasSize(){var o,c;const{canvas:e}=this;if(!e)return;const r=e.clientWidth??e.width,n=e.clientHeight??e.height;(r!==this.width||n!==this.height)&&(this.width=r,this.height=n,(o=this.viewManager)==null||o.setProps({width:r,height:n}),(c=this.layerManager)==null||c.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:n}))}_createAnimationLoop(e,r){const{gl:n,onError:o,useDevicePixels:c}=r;return new N5({device:e,useDevicePixels:c,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:d=>this._setDevice(d.device),onRender:this._onRenderFrame.bind(this),onError:o})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,r=Array.isArray(e)?e:e?[e]:[new J1({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var r,n,o,c;if(((r=this.device)==null?void 0:r.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:d,emptyInfo:a}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=d.length>0;let y=a,S=!1;for(const E of d)y=E,S=((n=E.layer)==null?void 0:n.onHover(E,e.event))||S;S||((c=(o=this.props).onHover)==null||c.call(o,y,e.event),this.widgetManager.onHover(y,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var o,c;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(o=this.device.canvasContext)==null?void 0:o.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const r=new aC;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new c6(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(l3).map(d=>{var N;const[a,y,S,E]=l3[d],M=(N=this.props.eventRecognizerOptions)==null?void 0:N[d],F={...y,...M,event:d};return{recognizer:new a(F),recognizeWith:S,requestFailure:E}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const d in pb)this.eventManager.on(d,this._onEvent);this.viewManager=new lU({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new aU(this.device,{deck:this,stats:this.stats,viewport:n,timeline:r}),this.effectManager=new wU({deck:this,device:this.device}),this.deckRenderer=new EU(this.device),this.deckPicker=new RU(this.device),this.widgetManager=new OU({deck:this,parentElement:(c=this.canvas)==null?void 0:c.parentElement}),this.widgetManager.addDefault(new NU),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,r){var d;const{device:n,gl:o}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:o});const c={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};(d=this.deckRenderer)==null||d.renderLayers(c),c.pass==="screen"&&this.widgetManager.onRedraw({viewports:c.viewports,layers:c.layers}),this.props.onAfterRender({device:n,gl:o})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Gr.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const r=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const r=this.animationLoop.stats;e.get("GPU Time").addTime(r.get("GPU Time").lastTiming),e.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:r}=this;e.fps=r.get("frameRate").getHz(),e.setPropsTime=r.get("setProps Time").time,e.updateAttributesTime=r.get("Update Attributes").time,e.framesRedrawn=r.get("Redraw Count").count,e.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,e.pickCount=r.get("Pick Count").count,e.gpuTime=r.get("GPU Time").time,e.cpuTime=r.get("CPU Time").time,e.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=r.get("CPU Time").getAverageTime();const n=Kx.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}Ap.defaultProps=RC;Ap.VERSION=YF;function OV(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return uP(t)}}const FV=cP;function bm(t,e,r){const n=r==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${n}x${e.size}`:e.type,byteOffset:e.offset||0}}function Bc(t){return t.stride||t.size*t.bytesPerElement}function NV(t,e){return t.type===e.type&&t.size===e.size&&Bc(t)===Bc(e)&&(t.offset||0)===(e.offset||0)}function Ab(t,e){e.offset&&Gr.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const r=Bc(t),n=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,o=e.elementOffset||0,c=n*r+o*t.bytesPerElement+(t.offset||0);return{...e,offset:c,stride:r}}function LV(t,e){const r=Ab(t,e);return{high:r,low:{...r,offset:r.offset+t.size*4}}}class zV{constructor(e,r,n){this._buffer=null,this.device=e,this.id=r.id||"",this.size=r.size||1;const o=r.logicalType||r.type,c=o==="float64";let{defaultValue:d}=r;d=Number.isFinite(d)?[d]:d||new Array(this.size).fill(0);let a;c?a="float32":!o&&r.isIndexed?a="uint32":a=o||"float32";let y=OV(o||a);this.doublePrecision=c,c&&r.fp64===!1&&(y=Float32Array),this.value=null,this.settings={...r,defaultType:y,defaultValue:d,logicalType:o,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:y.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Bc(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),wp.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,r=null){const n={};if(this.state.constant){const o=this.value;if(r){const c=Ab(this.getAccessor(),r),d=c.offset/o.BYTES_PER_ELEMENT,a=c.size||this.size;n[e]=o.subarray(d,d+a)}else n[e]=o}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,r=null){const n=this.getAccessor(),o=[],c={name:this.id,byteStride:Bc(n),attributes:o};if(this.doublePrecision){const d=LV(n,r||{});o.push(bm(e,{...n,...d.high},this.device.type),bm(`${e}64Low`,{...n,...d.low},this.device.type))}else if(r){const d=Ab(n,r);o.push(bm(e,{...n,...d},this.device.type))}else o.push(bm(e,n,this.device.type));return c}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const r=Array.from(this.value);e=[r,r]}else{const{value:r,numInstances:n,size:o}=this,c=n*o;if(r&&c&&r.length>=c){const d=new Array(o).fill(1/0),a=new Array(o).fill(-1/0);for(let y=0;y<c;)for(let S=0;S<o;S++){const E=r[y++];E<d[S]&&(d[S]=E),E>a[S]&&(a[S]=E)}e=[d,a]}}return this.state.bounds=e,e}setData(e){const{state:r}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof gn?n={buffer:e}:n=e;const o={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)o.type="float32";else{const d=FV(n.value);o.type=o.normalized?d.replace("int","norm"):d}o.bytesPerElement=n.value.BYTES_PER_ELEMENT,o.stride=Bc(o)}if(r.bounds=null,n.constant){let c=n.value;if(c=this._normalizeValue(c,[],0),this.settings.normalized&&(c=this.normalizeConstant(c)),!(!r.constant||!this._areValuesEqual(c,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(c)?c:new Float32Array(c)}else if(n.buffer){const c=n.buffer;r.externalBuffer=c,r.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let c=n.value;r.externalBuffer=null,r.constant=!1,this.value=c;let{buffer:d}=this;const a=Bc(o),y=(o.vertexOffset||0)*a;if(this.doublePrecision&&c instanceof Float64Array&&(c=D0(c,o)),this.settings.isIndexed){const E=this.settings.defaultType;c.constructor!==E&&(c=new E(c))}const S=c.byteLength+y+a*2;(!d||d.byteLength<S)&&(d=this._createBuffer(S)),d.write(c,y)}return this.setAccessor(o),!0}updateSubBuffer(e={}){this.state.bounds=null;const r=this.value,{startOffset:n=0,endOffset:o}=e;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?D0(r,{size:this.size,startIndex:n,endIndex:o}):r.subarray(n,o),n*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,r=!1){const{state:n}=this,o=n.allocatedValue,c=wp.allocate(o,e+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=c;const{byteOffset:d}=this;let{buffer:a}=this;return(!a||a.byteLength<c.byteLength+d)&&(a=this._createBuffer(c.byteLength+d),r&&o&&a.write(o instanceof Float64Array?D0(o,this):o,d)),n.allocatedValue=c,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:r}=e;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let o=!1;if(this.doublePrecision&&(o=r.BYTES_PER_ELEMENT<4),o)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof n)&&this.settings.normalized&&!("normalized"in e)&&Gr.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(e).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(r=>r/255);case"unorm16":return new Float32Array(e).map(r=>r/65535);default:return e}}_normalizeValue(e,r,n){const{defaultValue:o,size:c}=this.settings;if(Number.isFinite(e))return r[n]=e,r;if(!e){let d=c;for(;--d>=0;)r[n+d]=o[d];return r}switch(c){case 4:r[n+3]=Number.isFinite(e[3])?e[3]:o[3];case 3:r[n+2]=Number.isFinite(e[2])?e[2]:o[2];case 2:r[n+1]=Number.isFinite(e[1])?e[1]:o[1];case 1:r[n+0]=Number.isFinite(e[0])?e[0]:o[0];break;default:let d=c;for(;--d>=0;)r[n+d]=Number.isFinite(e[d])?e[d]:o[d]}return r}_areValuesEqual(e,r){if(!e||!r)return!1;const{size:n}=this;for(let o=0;o<n;o++)if(e[o]!==r[o])return!1;return!0}_createBuffer(e){var o;this._buffer&&this._buffer.destroy();const{isIndexed:r,type:n}=this.settings;return this._buffer=this.device.createBuffer({...(o=this._buffer)==null?void 0:o.props,id:this.id,usage:(r?gn.INDEX:gn.VERTEX)|gn.COPY_DST,indexType:r?n:void 0,byteLength:e}),this._buffer}}const j3=[],$3=[];function kC(t,e=0,r=1/0){let n=j3;const o={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?n=t:t.length>0&&($3.length=t.length,n=$3):n=j3,(e>0||Number.isFinite(r))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,r),o.index=e-1),{iterable:n,objectInfo:o}}function DC(t){return t&&t[Symbol.asyncIterator]}function BV(t,e){const{size:r,stride:n,offset:o,startIndices:c,nested:d}=e,a=t.BYTES_PER_ELEMENT,y=n?n/a:r,S=o?o/a:0,E=Math.floor((t.length-S)/y);return(M,{index:F,target:N})=>{if(!c){const Y=F*y+S;for(let q=0;q<r;q++)N[q]=t[Y+q];return N}const G=c[F],re=c[F+1]||E;let me;if(d){me=new Array(re-G);for(let Y=G;Y<re;Y++){const q=Y*y+S;N=new Array(r);for(let Z=0;Z<r;Z++)N[Z]=t[q+Z];me[Y-G]=N}}else if(y===r)me=t.subarray(G*r+S,re*r+S);else{me=new t.constructor((re-G)*r);let Y=0;for(let q=G;q<re;q++){const Z=q*y+S;for(let le=0;le<r;le++)me[Y++]=t[Z+le]}}return me}}const UV=[],Xm=[[0,1/0]];function VV(t,e){if(t===Xm||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const r=[],n=t.length;let o=0;for(let c=0;c<n;c++){const d=t[c];d[1]<e[0]?(r.push(d),o=c+1):d[0]>e[1]?r.push(d):e=[Math.min(d[0],e[0]),Math.max(d[1],e[1])]}return r.splice(o,0,e),r}const jV={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function OC(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const r=t.type||"interpolation";return{...jV[r],...e,...t,type:r}}class FC extends zV{constructor(e,r){super(e,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Xm}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const r=this.state.needsRedraw;return this.state.needsRedraw=r&&!e,r}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var r;(r=this.state).layoutChanged||(r.layoutChanged=!NV(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:r}=this.settings,n=this.settings.transition,o=Array.isArray(r)?e[r.find(c=>e[c])]:e[r];return OC(o,n)}setNeedsUpdate(e=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),r){const{startRow:n=0,endRow:o=1/0}=r;this.state.updateRanges=VV(this.state.updateRanges,[n,o])}else this.state.updateRanges=Xm}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=UV}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:r,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,r.updateRanges!==Xm),!0):!1}updateBuffer({numInstances:e,data:r,props:n,context:o}){if(!this.needsUpdate())return!1;const{state:{updateRanges:c},settings:{update:d,noAlloc:a}}=this;let y=!0;if(d){for(const[S,E]of c)d.call(o,this,{data:r,startRow:S,endRow:E,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[S,E]of c){const M=Number.isFinite(S)?this.getVertexOffset(S):0,F=Number.isFinite(E)?this.getVertexOffset(E):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:M,endOffset:F})}this._checkAttributeArray()}else y=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),y}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:r}=this;return e?(this.clearNeedsUpdate(),r.lastExternalBuffer===e||(r.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(e,r=null){const{state:n,settings:o}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(o.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),o.transform||r!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const d=e;ri(ArrayBuffer.isView(d.value),`invalid ${o.accessor}`);const a=!!d.size&&d.size!==this.size;return n.binaryAccessor=BV(d.value,{size:d.size||this.size,stride:d.stride,offset:d.offset,startIndices:r,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:r}=this;return(r?e<r.length?r[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,r=super.getValue();if(!e)return r;for(const n in e)Object.assign(r,super.getValue(n,e[n]));return r}getBufferLayout(e){this.state.layoutChanged=!1;const r=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:o}=this.settings;if(o==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=o??"vertex",!r)return n;for(const c in r){const d=super._getBufferLayout(c,r[c]);n.attributes.push(...d.attributes)}return n}_autoUpdater(e,{data:r,startRow:n,endRow:o,props:c,numInstances:d}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:a,state:y,value:S,size:E,startIndices:M}=e,{accessor:F,transform:N}=a;let G=y.binaryAccessor||(typeof F=="function"?F:c[F]);typeof G!="function"&&(G=()=>G),ri(typeof G=="function",`accessor "${F}" is not a function`);let re=e.getVertexOffset(n);const{iterable:me,objectInfo:Y}=kC(r,n,o);for(const q of me){Y.index++;let Z=G(q,Y);if(N&&(Z=N.call(this,Z)),M){const le=(Y.index<M.length-1?M[Y.index+1]:d)-M[Y.index];if(Z&&Array.isArray(Z[0])){let Ae=re;for(const we of Z)e._normalizeValue(we,S,Ae),Ae+=E}else Z&&Z.length>E?S.set(Z,re):(e._normalizeValue(Z,Y.target,0),rU({target:S,source:Y.target,start:re,count:le}));re+=le*E}else e._normalizeValue(Z,S,re),re+=E}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,r=Math.min(4,this.size);if(e&&e.length>=r){let n=!0;switch(r){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function j0(t){const{source:e,target:r,start:n=0,size:o,getData:c}=t,d=t.end||r.length,a=e.length,y=d-n;if(a>y){r.set(e.subarray(0,y),n);return}if(r.set(e,n),!c)return;let S=a;for(;S<y;){const E=c(S,e);for(let M=0;M<o;M++)r[n+S]=E[M]||0,S++}}function $V({source:t,target:e,size:r,getData:n,sourceStartIndices:o,targetStartIndices:c}){if(!o||!c)return j0({source:t,target:e,size:r,getData:n}),e;let d=0,a=0;const y=n&&((E,M)=>n(E+a,M)),S=Math.min(o.length,c.length);for(let E=1;E<S;E++){const M=o[E]*r,F=c[E]*r;j0({source:t.subarray(d,M),target:e,start:a,end:F,size:r,getData:y}),d=M,a=F}return a<e.length&&j0({source:[],target:e,start:a,size:r,getData:y}),e}function WV(t){const{device:e,settings:r,value:n}=t,o=new FC(e,r);return o.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),o}function NC(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function LC(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function zC(t){t.push(t.shift())}function HV(t,e){const{doublePrecision:r,settings:n,value:o,size:c}=t,d=r&&o instanceof Float64Array?2:1;let a=0;const{shaderAttributes:y}=t.settings;if(y)for(const S of Object.values(y))a=Math.max(a,S.vertexOffset??0);return(n.noAlloc?o.length:(e+a)*c)*d}function BC({device:t,source:e,target:r}){return(!r||r.byteLength<e.byteLength)&&(r==null||r.destroy(),r=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),r}function UC({device:t,buffer:e,attribute:r,fromLength:n,toLength:o,fromStartIndices:c,getData:d=a=>a}){const a=r.doublePrecision&&r.value instanceof Float64Array?2:1,y=r.size*a,S=r.byteOffset,E=r.settings.bytesPerElement<4?S/r.settings.bytesPerElement*4:S,M=r.startIndices,F=c&&M,N=r.isConstant;if(!F&&e&&n>=o)return e;const G=r.value instanceof Float64Array?Float32Array:r.value.constructor,re=N?r.value:new G(r.getBuffer().readSyncWebGL(S,o*G.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!N){const Z=d;d=(le,Ae)=>r.normalizeConstant(Z(le,Ae))}const me=N?(Z,le)=>d(re,le):(Z,le)=>d(re.subarray(Z+S,Z+S+y),le),Y=e?new Float32Array(e.readSyncWebGL(E,n*4).buffer):new Float32Array(0),q=new Float32Array(o);return $V({source:Y,target:q,sourceStartIndices:c,targetStartIndices:M,size:y,getData:me}),(!e||e.byteLength<q.byteLength+E)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:q.byteLength+E,usage:35050})),e.write(q,E),e}class VC{constructor({device:e,attribute:r,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Ay(n),this.attribute=r,this.attributeInTransition=WV(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(e,r,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=HV(this.attribute,r),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class XV extends VC{constructor({device:e,attribute:r,timeline:n}){super({device:e,attribute:r,timeline:n}),this.type="interpolation",this.transform=GV(e,r)}start(e,r){const n=this.currentLength,o=this.currentStartIndices;if(super.start(e,r,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:c,attribute:d}=this;zC(c),c[0]=UC({device:this.device,buffer:c[0],attribute:d,fromLength:n,toLength:this.currentLength,fromStartIndices:o,getData:e.enter}),c[1]=BC({device:this.device,source:c[0],target:c[1]}),this.setBuffer(c[1]);const{transform:a}=this,y=a.model;let S=Math.floor(this.currentLength/d.size);jC(d)&&(S/=2),y.setVertexCount(S),d.isConstant?(y.setAttributes({aFrom:c[0]}),y.setConstantAttributes({aTo:d.value})):y.setAttributes({aFrom:c[0],aTo:d.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:c[1]})}onUpdate(){const{duration:e,easing:r}=this.settings,{time:n}=this.transition;let o=n/e;r&&(o=r(o));const{model:c}=this.transform,d={time:o};c.shaderInputs.setProps({interpolation:d}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const ZV=`uniform interpolationUniforms {
  float time;
} interpolation;
`,W3={name:"interpolation",vs:ZV,uniformTypes:{time:"f32"}},qV=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,YV=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function jC(t){return t.doublePrecision&&t.value instanceof Float64Array}function GV(t,e){const r=e.size,n=NC(r),o=LC(r),c=e.getBufferLayout();return jC(e)?new Sp(t,{vs:YV,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:o,byteOffset:0},{attribute:"aFrom64Low",format:o,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:o,byteOffset:0},{attribute:"aTo64Low",format:o,byteOffset:4*r}]}],modules:[Jz,W3],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Sp(t,{vs:qV,bufferLayout:[{name:"aFrom",format:o},{name:"aTo",format:c.attributes[0].format}],modules:[W3],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class KV extends VC{constructor({device:e,attribute:r,timeline:n}){super({device:e,attribute:r,timeline:n}),this.type="spring",this.texture=nj(e),this.framebuffer=ij(e,this.texture),this.transform=rj(e,r)}start(e,r){const n=this.currentLength,o=this.currentStartIndices;super.start(e,r);const{buffers:c,attribute:d}=this;for(let y=0;y<2;y++)c[y]=UC({device:this.device,buffer:c[y],attribute:d,fromLength:n,toLength:this.currentLength,fromStartIndices:o,getData:e.enter});c[2]=BC({device:this.device,source:c[0],target:c[2]}),this.setBuffer(c[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/d.size)),d.isConstant?a.setConstantAttributes({aTo:d.value}):a.setAttributes({aTo:d.getBuffer()})}onUpdate(){const{buffers:e,transform:r,framebuffer:n,transition:o}=this,c=this.settings;r.model.setAttributes({aPrev:e[0],aCur:e[1]}),r.transformFeedback.setBuffers({vNext:e[2]});const d={stiffness:c.stiffness,damping:c.damping};r.model.shaderInputs.setProps({spring:d}),r.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),zC(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||o.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const QV=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,JV={name:"spring",vs:QV,uniformTypes:{damping:"f32",stiffness:"f32"}},ej=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,tj=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function rj(t,e){const r=NC(e.size),n=LC(e.size);return new Sp(t,{vs:ej,fs:tj,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[JV],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function nj(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function ij(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const sj={interpolation:XV,spring:KV};class oj{constructor(e,{id:r,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:r,numInstances:n}){this.numInstances=n||1;for(const o in e){const c=e[o],d=c.getTransitionSetting(r);d&&this._updateAttribute(o,c,d)}for(const o in this.transitions){const c=e[o];(!c||!c.getTransitionSetting(r))&&this._removeTransition(o)}}hasAttribute(e){const r=this.transitions[e];return r&&r.inProgress}getAttributes(){const e={};for(const r in this.transitions){const n=this.transitions[r];n.inProgress&&(e[r]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,r,n){const o=this.transitions[e];let c=!o||o.type!==n.type;if(c){o&&this._removeTransition(e);const d=sj[n.type];d?this.transitions[e]=new d({attribute:r,timeline:this.timeline,device:this.device}):(Gr.error(`unsupported transition type '${n.type}'`)(),c=!1)}(c||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const H3="attributeManager.invalidate",aj="attributeManager.updateStart",lj="attributeManager.updateEnd",cj="attribute.updateStart",uj="attribute.allocate",hj="attribute.updateEnd";class dj{constructor(e,{id:r="attribute-manager",stats:n,timeline:o}={}){this.mergeBoundsMemoized=Lp(T5),this.id=r,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new oj(e,{id:`${r}-transitions`,timeline:o}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const r of e)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(e,r){const n=this._invalidateTrigger(e,r);Ki(H3,this,e,n)}invalidateAll(e){for(const r in this.attributes)this.attributes[r].setNeedsUpdate(r,e);Ki(H3,this,"all")}update({data:e,numInstances:r,startIndices:n=null,transitions:o,props:c={},buffers:d={},context:a={}}){let y=!1;Ki(aj,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const S in this.attributes){const E=this.attributes[S],M=E.settings.accessor;E.startIndices=n,E.numInstances=r,c[S]&&Gr.removed(`props.${S}`,`data.attributes.${S}`)(),E.setExternalBuffer(d[S])||E.setBinaryValue(typeof M=="string"?d[M]:void 0,e.startIndices)||typeof M=="string"&&!d[M]&&E.setConstantValue(c[M])||E.needsUpdate()&&(y=!0,this._updateAttribute({attribute:E,numInstances:r,data:e,props:c,context:a})),this.needsRedraw=this.needsRedraw||E.needsRedraw()}y&&Ki(lj,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,r=e.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const r=e.map(n=>{var o;return(o=this.attributes[n])==null?void 0:o.getBounds()});return this.mergeBoundsMemoized(r)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:r,attributeTransitionManager:n}=this,o={...n.getAttributes()};for(const c in r){const d=r[c];d.needsRedraw(e)&&!n.hasAttribute(c)&&(o[c]=d)}return o}getBufferLayouts(e){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(e))}_add(e,r){for(const n in e){const o=e[n],c={...o,id:n,size:o.isIndexed&&1||o.size||1,...r};this.attributes[n]=new FC(this.device,c)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(o=>{e[o]||(e[o]=[]),e[o].push(r)});this.updateTriggers=e}_invalidateTrigger(e,r){const{attributes:n,updateTriggers:o}=this,c=o[e];return c&&c.forEach(d=>{const a=n[d];a&&a.setNeedsUpdate(a.id,r)}),c}_updateAttribute(e){const{attribute:r,numInstances:n}=e;if(Ki(cj,r),r.constant){r.setConstantValue(r.value);return}r.allocate(n)&&Ki(uj,r,n),r.updateBuffer(e)&&(this.needsRedraw=!0,Ki(hj,r,n))}}class fj extends Ay{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:r,toValue:n,duration:o,easing:c}}=this,d=c(e/o);this._value=N_(r,n,d)}}const X3=1e-5;function Z3(t,e,r,n,o){const c=e-t,a=(r-e)*o,y=-c*n;return a+y+c+e}function pj(t,e,r,n,o){if(Array.isArray(r)){const c=[];for(let d=0;d<r.length;d++)c[d]=Z3(t[d],e[d],r[d],n,o);return c}return Z3(t,e,r,n,o)}function q3(t,e){if(Array.isArray(t)){let r=0;for(let n=0;n<t.length;n++){const o=t[n]-e[n];r+=o*o}return Math.sqrt(r)}return Math.abs(t-e)}class gj extends Ay{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:r,damping:n,stiffness:o}=this.settings,{_prevValue:c=e,_currValue:d=e}=this;let a=pj(c,d,r,n,o);const y=q3(a,r),S=q3(a,d);y<X3&&S<X3&&(a=r,this.end()),this._prevValue=d,this._currValue=a}}const mj={interpolation:fj,spring:gj};class _j{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,r,n,o){const{transitions:c}=this;if(c.has(e)){const y=c.get(e),{value:S=y.settings.fromValue}=y;r=S,this.remove(e)}if(o=OC(o),!o)return;const d=mj[o.type];if(!d){Gr.error(`unsupported transition type '${o.type}'`)();return}const a=new d(this.timeline);a.start({...o,fromValue:r,toValue:n}),c.set(e,a)}remove(e){const{transitions:r}=this;r.has(e)&&(r.get(e).cancel(),r.delete(e))}update(){const e={};for(const[r,n]of this.transitions)n.update(),e[r]=n.value,n.inProgress||this.remove(r);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function yj(t){const e=t[Xc];for(const r in e){const n=e[r],{validate:o}=n;if(o&&!o(t[r],n))throw new Error(`Invalid prop ${r}: ${t[r]}`)}}function vj(t,e){const r=$C({newProps:t,oldProps:e,propTypes:t[Xc],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=bj(t,e);let o=!1;return n||(o=wj(t,e)),{dataChanged:n,propsChanged:r,updateTriggersChanged:o,extensionsChanged:Tj(t,e),transitionsChanged:xj(t,e)}}function xj(t,e){if(!t.transitions)return!1;const r={},n=t[Xc];let o=!1;for(const c in t.transitions){const d=n[c],a=d&&d.type;(a==="number"||a==="color"||a==="array")&&Ib(t[c],e[c],d)&&(r[c]=!0,o=!0)}return o?r:!1}function $C({newProps:t,oldProps:e,ignoreProps:r={},propTypes:n={},triggerName:o="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${o} changed shallowly`;if(typeof e!="object"||e===null)return`${o} changed shallowly`;for(const c of Object.keys(t))if(!(c in r)){if(!(c in e))return`${o}.${c} added`;const d=Ib(t[c],e[c],n[c]);if(d)return`${o}.${c} ${d}`}for(const c of Object.keys(e))if(!(c in r)){if(!(c in t))return`${o}.${c} dropped`;if(!Object.hasOwnProperty.call(t,c)){const d=Ib(t[c],e[c],n[c]);if(d)return`${o}.${c} ${d}`}}return!1}function Ib(t,e,r){let n=r&&r.equal;return n&&!n(t,e,r)||!n&&(n=t&&e&&t.equals,n&&!n.call(t,e))?"changed deeply":!n&&e!==t?"changed shallowly":null}function bj(t,e){if(e===null)return"oldProps is null, initial diff";let r=!1;const{dataComparator:n,_dataDiff:o}=t;return n?n(t.data,e.data)||(r="Data comparator detected a change"):t.data!==e.data&&(r="A new data container was supplied"),r&&o&&(r=o(t.data,e.data)||r),r}function wj(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&Y3(t,e,"all"))return{all:!0};const r={};let n=!1;for(const o in t.updateTriggers)o!=="all"&&Y3(t,e,o)&&(r[o]=!0,n=!0);return n?r:!1}function Tj(t,e){if(e===null)return!0;const r=e.extensions,{extensions:n}=t;if(n===r)return!1;if(!r||!n||n.length!==r.length)return!0;for(let o=0;o<n.length;o++)if(!n[o].equals(r[o]))return!0;return!1}function Y3(t,e,r){let n=t.updateTriggers[r];n=n??{};let o=e.updateTriggers[r];return o=o??{},$C({oldProps:o,newProps:n,triggerName:r})}const Sj="count(): argument not an object",Ej="count(): argument not a container";function Aj(t){if(!Pj(t))throw new Error(Sj);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(Ij(t))return Object.keys(t).length;throw new Error(Ej)}function Ij(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function Pj(t){return t!==null&&typeof t=="object"}function G3(t,e){if(!e)return t;const r={...t,...e};if("defines"in e&&(r.defines={...t.defines,...e.defines}),"modules"in e&&(r.modules=(t.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=r.modules.findIndex(o=>o.name==="project32");n>=0&&r.modules.splice(n,1)}if("inject"in e)if(!t.inject)r.inject=e.inject;else{const n={...t.inject};for(const o in e.inject)n[o]=(n[o]||"")+e.inject[o];r.inject=n}return r}const Cj={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Pb={};function Mj(t,e,r,n){if(r instanceof vn)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let o=null;r.compressed&&(o={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});const c=e.createTexture({...r,sampler:{...Cj,...o,...n},mipmaps:!0});return Pb[c.id]=t,c}function Rj(t,e){!e||!(e instanceof vn)||Pb[e.id]===t&&(e.delete(),delete Pb[e.id])}const kj={boolean:{validate(t,e){return!0},equal(t,e,r){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Cb(t)&&(t.length===3||t.length===4)},equal(t,e,r){return So(t,e,1)}},accessor:{validate(t,e){const r=$_(t);return r==="function"||r===$_(e.value)},equal(t,e,r){return typeof e=="function"?!0:So(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Cb(t)},equal(t,e,r){const{compare:n}=r,o=Number.isInteger(n)?n:n?1:0;return n?So(t,e,o):t===e}},object:{equal(t,e,r){if(r.ignore)return!0;const{compare:n}=r,o=Number.isInteger(n)?n:n?1:0;return n?So(t,e,o):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,r){return!r.compare&&r.ignore!==!1||t===e}},data:{transform:(t,e,r)=>{if(!t)return t;const{dataTransform:n}=r.props;return n?n(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,r)=>{const n=r.context;return!n||!n.device?null:Mj(r.id,n.device,t,{...e.parameters,...r.props.textureParameters})},release:(t,e,r)=>{Rj(r.id,t)}}};function Dj(t){const e={},r={},n={};for(const[o,c]of Object.entries(t)){const d=c==null?void 0:c.deprecatedFor;if(d)n[o]=Array.isArray(d)?d:[d];else{const a=Oj(o,c);e[o]=a,r[o]=a.value}}return{propTypes:e,defaultProps:r,deprecatedProps:n}}function Oj(t,e){switch($_(e)){case"object":return Ef(t,e);case"array":return Ef(t,{type:"array",value:e,compare:!1});case"boolean":return Ef(t,{type:"boolean",value:e});case"number":return Ef(t,{type:"number",value:e});case"function":return Ef(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Ef(t,e){return"type"in e?{name:t,...kj[e.type],...e}:"value"in e?{name:t,type:$_(e.value),...e}:{name:t,type:"object",value:e}}function Cb(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function $_(t){return Cb(t)?"array":t===null?"null":typeof t}function Fj(t,e){let r;for(let c=e.length-1;c>=0;c--){const d=e[c];"extensions"in d&&(r=d.extensions)}const n=Mb(t.constructor,r),o=Object.create(n);o[V_]=t,o[nu]={},o[Rl]={};for(let c=0;c<e.length;++c){const d=e[c];for(const a in d)o[a]=d[a]}return Object.freeze(o),o}const Nj="_mergedDefaultProps";function Mb(t,e){if(!(t instanceof Iy.constructor))return{};let r=Nj;if(e)for(const o of e){const c=o.constructor;c&&(r+=`:${c.extensionName||c.name}`)}const n=WC(t,r);return n||(t[r]=Lj(t,e||[]))}function Lj(t,e){if(!t.prototype)return null;const n=Object.getPrototypeOf(t),o=Mb(n),c=WC(t,"defaultProps")||{},d=Dj(c),a=Object.assign(Object.create(null),o,d.defaultProps),y=Object.assign(Object.create(null),o==null?void 0:o[Xc],d.propTypes),S=Object.assign(Object.create(null),o==null?void 0:o[L0],d.deprecatedProps);for(const E of e){const M=Mb(E.constructor);M&&(Object.assign(a,M),Object.assign(y,M[Xc]),Object.assign(S,M[L0]))}return zj(a,t),Uj(a,y),Bj(a,S),a[Xc]=y,a[L0]=S,e.length===0&&!sw(t,"_propTypes")&&(t._propTypes=y),a}function zj(t,e){const r=jj(e);Object.defineProperties(t,{id:{writable:!0,value:r}})}function Bj(t,e){for(const r in e)Object.defineProperty(t,r,{enumerable:!1,set(n){const o=`${this.id}: ${r}`;for(const c of e[r])sw(this,c)||(this[c]=n);Gr.deprecated(o,e[r].join("/"))()}})}function Uj(t,e){const r={},n={};for(const o in e){const c=e[o],{name:d,value:a}=c;c.async&&(r[d]=a,n[d]=Vj(d))}t[jh]=r,t[nu]={},Object.defineProperties(t,n)}function Vj(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||DC(e)?this[nu][t]=e:this[Rl][t]=e},get(){if(this[Rl]){if(t in this[Rl])return this[Rl][t]||this[jh][t];if(t in this[nu]){const e=this[V_]&&this[V_].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[jh][t]}}return this[jh][t]}}}function sw(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function WC(t,e){return sw(t,e)&&t[e]}function jj(t){const e=t.componentName;return e||Gr.warn(`${t.name}.componentName not specified`)(),e||t.name}let $j=0;class Iy{constructor(...e){this.props=Fj(this,e),this.id=this.props.id,this.count=$j++}clone(e){const{props:r}=this,n={};for(const o in r[jh])o in r[Rl]?n[o]=r[Rl][o]:o in r[nu]&&(n[o]=r[nu][o]);return new this.constructor({...r,...n,...e})}}Iy.componentName="Component";Iy.defaultProps={};const Wj=Object.freeze({});class Hj{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const r=this.asyncProps[e];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Wj}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const r=this.asyncProps[e];return r&&r.resolvedValue}isAsyncPropLoading(e){if(e){const r=this.asyncProps[e];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(const r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(e,r){this._watchPromise(e,Promise.resolve(r))}setAsyncProps(e){this.component=e[V_]||this.component;const r=e[Rl]||{},n=e[nu]||e,o=e[jh]||{};for(const c in r){const d=r[c];this._createAsyncPropData(c,o[c]),this._updateAsyncProp(c,d),r[c]=this.getAsyncProp(c)}for(const c in n){const d=n[c];this._createAsyncPropData(c,o[c]),this._updateAsyncProp(c,d)}}_fetch(e,r){return null}_onResolve(e,r){}_onError(e,r){}_updateAsyncProp(e,r){if(this._didAsyncInputValueChange(e,r)){if(typeof r=="string"&&(r=this._fetch(e,r)),r instanceof Promise){this._watchPromise(e,r);return}if(DC(r)){this._resolveAsyncIterable(e,r);return}this._setPropValue(e,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,r){const n=this.asyncProps[e];return r===n.resolvedValue||r===n.lastValue?!1:(n.lastValue=r,!0)}_setPropValue(e,r){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(r=this._postProcessValue(n,r),n.resolvedValue=r,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,r,n){const o=this.asyncProps[e];o&&n>=o.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),o.resolvedValue=r,o.resolvedLoadCount=n,this.onAsyncPropUpdated(e,r))}_watchPromise(e,r){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const o=n.pendingLoadCount;r.then(c=>{this.component&&(c=this._postProcessValue(n,c),this._setAsyncPropValue(e,c,o),this._onResolve(e,c))}).catch(c=>{this._onError(e,c)})}}async _resolveAsyncIterable(e,r){if(e!=="data"){this._setPropValue(e,r);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const o=n.pendingLoadCount;let c=[],d=0;for await(const a of r){if(!this.component)return;const{dataTransform:y}=this.component.props;y?c=y(a,c):c=c.concat(a),Object.defineProperty(c,"__diff",{enumerable:!1,value:[{startRow:d,endRow:c.length}]}),d=c.length,this._setAsyncPropValue(e,c,o)}this._onResolve(e,c)}_postProcessValue(e,r){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(r,n,this.component):r}_createAsyncPropData(e,r){if(!this.asyncProps[e]){const o=this.component&&this.component.props[Xc];this.asyncProps[e]={type:o&&o[e],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}}class Xj extends Hj{constructor({attributeManager:e,layer:r}){super(r),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,r){const n=this.layer,o=n==null?void 0:n.props.fetch;return o?o(r,{propName:e,layer:n}):super._fetch(e,r)}_onResolve(e,r){const n=this.layer;if(n){const o=n.props.onDataLoad;e==="data"&&o&&o(r,{propName:e,layer:n})}}_onError(e,r){const n=this.layer;n&&n.raiseError(r,`loading ${e} of ${this.layer}`)}}const Zj="layer.changeFlag",qj="layer.initialize",Yj="layer.update",Gj="layer.finalize",Kj="layer.matched",K3=2**24-1,Qj=Object.freeze([]),Jj=Lp(({oldViewport:t,viewport:e})=>t.equals(e));let _o=new Uint8ClampedArray(0);const e$={data:{type:"data",value:Qj,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:r,loaders:n,loadOptions:o,signal:c})=>{const{resourceManager:d}=r.context;o=o||r.getLoadOptions(),n=n||r.props.loaders,c&&(o={...o,fetch:{...o==null?void 0:o.fetch,signal:c}});let a=d.contains(t);return!a&&!o&&(d.add({resourceId:t,data:Wx(t,n),persistent:!1}),a=!0),a?d.subscribe({resourceId:t,onChange:y=>{var S;return(S=r.internalState)==null?void 0:S.reloadAsyncProp(e,y)},consumerId:r.id,requestId:e}):Wx(t,n,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Ir.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class ow extends Iy{constructor(){super(...arguments),this.internalState=null,this.lifecycle=gh.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){ri(this.internalState);const r=this.internalState.viewport||this.context.viewport,n=oC(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[o,c,d]=rC(n,r.pixelProjectionMatrix);return e.length===2?[o,c]:[o,c,d]}unproject(e){return ri(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,r){ri(this.internalState);const n=this.internalState.viewport||this.context.viewport;return C5(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const r of this.getModels())r.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ir.DEFAULT||e===Ir.LNGLAT||e===Ir.CARTESIAN}onHover(e,r){return this.props.onHover&&this.props.onHover(e,r)||!1}onClick(e,r){return this.props.onClick&&this.props.onClick(e,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,r=[]){return r[0]=e+1&255,r[1]=e+1>>8&255,r[2]=e+1>>8>>8&255,r}decodePickingColor(e){ri(e instanceof Uint8Array);const[r,n,o]=e;return r+n*256+o*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Aj(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=G3(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const r of this.props.extensions)e=G3(e,r.getShaders.call(this,r));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const r=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&r)if(Array.isArray(n))for(const o of n)r.invalidateAll(o);else r.invalidateAll();if(r){const{props:o}=e,c=this.internalState.hasPickingBuffer,d=Number.isInteger(o.highlightedObjectIndex)||o.pickable||o.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(c!==d){this.internalState.hasPickingBuffer=d;const{pickingColors:a,instancePickingColors:y}=r.attributes,S=a||y;S&&(d&&S.constant&&(S.constant=!1,r.invalidate(S.id)),!S.value&&!d&&(S.constant=!0,S.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const r of this.getModels())r.draw(e.renderPass)}getPickingInfo({info:e,mode:r,sourceLayer:n}){const{index:o}=e;return o>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[o]),e}raiseError(e,r){var n,o,c,d;r&&(e=new Error(`${r}: ${e.message}`,{cause:e})),(o=(n=this.props).onError)!=null&&o.call(n,e)||(d=(c=this.context)==null?void 0:c.onError)==null||d.call(c,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const r=this.internalState.viewport;this.internalState.viewport=e,(!r||!Jj({oldViewport:r,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const r=this.getAttributeManager();r&&(e==="all"?r.invalidateAll():r.invalidate(e))}updateAttributes(e){let r=!1;for(const n in e)e[n].layoutChanged()&&(r=!0);for(const n of this.getModels())this._setModelAttributes(n,e,r)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const r=this.props,n=this.getNumInstances(),o=this.getStartIndices();e.update({data:r.data,numInstances:n,startIndices:o,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});const c=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(c)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const r=e.update(),n=Object.create(this.props);for(const o in r)Object.defineProperty(n,o,{value:r[o]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:r}){if(e.constant)return;const n=Math.floor(_o.length/4);if(this.internalState.usesPickingColorCache=!0,n<r){r>K3&&Gr.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),_o=wp.allocate(_o,r,{size:4,copy:!0,maxCount:Math.max(r,K3)});const o=Math.floor(_o.length/4),c=[0,0,0];for(let d=n;d<o;d++)this.encodePickingColor(d,c),_o[d*4+0]=c[0],_o[d*4+1]=c[1],_o[d*4+2]=c[2],_o[d*4+3]=0}e.value=_o.subarray(0,r*4)}_setModelAttributes(e,r,n=!1){var a;if(!Object.keys(r).length)return;if(n){const y=this.getAttributeManager();e.setBufferLayout(y.getBufferLayouts(e)),r=y.getAttributes()}const o=((a=e.userData)==null?void 0:a.excludeAttributes)||{},c={},d={};for(const y in r){if(o[y])continue;const S=r[y].getValue();for(const E in S){const M=S[E];M instanceof gn?r[y].settings.isIndexed?e.setIndexBuffer(M):c[E]=M:M&&(d[E]=M)}}e.setAttributes(c),e.setConstantAttributes(d)}disablePickingIndex(e){const r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:o}=this.getAttributeManager().attributes,c=n||o,d=c&&r.attributes&&r.attributes[c.id];if(d&&d.value){const a=d.value,y=this.encodePickingColor(e);for(let S=0;S<r.length;S++){const E=c.getVertexOffset(S);a[E]===y[0]&&a[E+1]===y[1]&&a[E+2]===y[2]&&this._disablePickingIndex(S)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,o=r||n;if(!o)return;const c=o.getVertexOffset(e),d=o.getVertexOffset(e+1);o.buffer.write(new Uint8Array(d-c),c)}restorePickingColors(){const{pickingColors:e,instancePickingColors:r}=this.getAttributeManager().attributes,n=e||r;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==_o.buffer&&(n.value=_o.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){ri(!this.internalState),ri(Number.isFinite(this.props.coordinateSystem)),Ki(qj,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Xj({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Gr.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new _j(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ki(Kj,this,this===e);const{state:r,internalState:n}=e;this!==e&&(this.internalState=n,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Ki(Yj,this,e),!e)return;const r=this.props,n=this.context,o=this.internalState,c=n.viewport,d=this._updateUniformTransition();o.propsInTransition=d,n.viewport=o.viewport||c,this.props=d;try{const a=this._getUpdateParams(),y=this.getModels();if(n.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const E of this.props.extensions)E.updateState.call(this,a,E);this.setNeedsRedraw(),this._updateAttributes();const S=this.getModels()[0]!==y[0];this._postUpdate(a,S)}finally{n.viewport=c,this.props=r,this._clearChangeFlags(),o.needsUpdate=!1,o.resetOldProps()}}_finalize(){Ki(Gj,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:r=null,uniforms:n={},parameters:o={}}){this._updateAttributeTransition();const c=this.props,d=this.context;this.props=this.internalState.propsInTransition||c;try{r&&this.setShaderModuleProps(r);const{getPolygonOffset:a}=this.props,y=a&&a(n)||[0,0];d.device instanceof Dh&&d.device.setParametersWebGL({polygonOffset:y});for(const S of this.getModels())S.device.type==="webgpu"?S.setParameters({...S.parameters,...o}):S.setParameters(o);if(d.device instanceof Dh)d.device.withParametersWebGL(o,()=>{const S={renderPass:e,shaderModuleProps:r,uniforms:n,parameters:o,context:d};for(const E of this.props.extensions)E.draw.call(this,S,E);this.draw(S)});else{const S={renderPass:e,shaderModuleProps:r,uniforms:n,parameters:o,context:d};for(const E of this.props.extensions)E.draw.call(this,S,E);this.draw(S)}}finally{this.props=c}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:r}=this.internalState;for(const o in e)if(e[o]){let c=!1;switch(o){case"dataChanged":const d=e[o],a=r[o];d&&Array.isArray(a)&&(r.dataChanged=Array.isArray(d)?a.concat(d):d,c=!0);default:r[o]||(r[o]=e[o],c=!0)}c&&Ki(Zj,this,o,e)}const n=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=n,r.somethingChanged=n||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,r){var o;const n=vj(e,r);if(n.updateTriggersChanged)for(const c in n.updateTriggersChanged)n.updateTriggersChanged[c]&&this.invalidateAttribute(c);if(n.transitionsChanged)for(const c in n.transitionsChanged)this.internalState.uniformTransitions.add(c,r[c],e[c],(o=e.transitions)==null?void 0:o[c]);return this.setChangeFlags(n)}validateProps(){yj(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const r={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(r.highlightColor=n(e)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new dj(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,r){const{props:n,oldProps:o}=e,c=this.state.model;c!=null&&c.isInstanced&&c.setInstanceCount(this.getNumInstances());const{autoHighlight:d,highlightedObjectIndex:a,highlightColor:y}=n;if(r||o.autoHighlight!==d||o.highlightedObjectIndex!==a||o.highlightColor!==y){const S={};Array.isArray(y)&&(S.highlightColor=y),(r||o.autoHighlight!==d||a!==o.highlightedObjectIndex)&&(S.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:S})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),o=n?n.getNeedsRedraw(e):!1;if(r=r||o,r)for(const c of this.props.extensions)c.onNeedsRedraw.call(this,c);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}ow.defaultProps=e$;ow.layerName="Layer";const wm=Math.PI/180,Q3=180/Math.PI,Zm=6370972,Oh=256;function t$(){const t=Oh/Zm,e=Math.PI/180*Oh;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class r$ extends ad{constructor(e={}){const{longitude:r=0,zoom:n=0,nearZMultiplier:o=.5,farZMultiplier:c=1,resolution:d=10}=e;let{latitude:a=0,height:y,altitude:S=1.5,fovy:E}=e;a=Math.max(Math.min(a,Ml),-Ml),y=y||1,E?S=Y1(E):E=bp(S);const M=1/Math.PI/Math.cos(a*Math.PI/180),F=Math.pow(2,n)*M,N=e.nearZ??o,G=e.farZ??(S+Oh*2*F/y)*c,re=new Po().lookAt({eye:[0,-S,0],up:[0,0,1]});re.rotateX(a*wm),re.rotateZ(-r*wm),re.scale(F/y),super({...e,height:y,viewMatrix:re,longitude:r,latitude:a,zoom:n,distanceScales:t$(),fovy:E,focalDistance:S,near:N,far:G}),this.scale=F,this.latitude=a,this.longitude=r,this.resolution=d}get projectionMode(){return Os.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const r={targetZ:e.z||0},n=this.unproject([0,this.height/2],r),o=this.unproject([this.width/2,0],r),c=this.unproject([this.width,this.height/2],r),d=this.unproject([this.width/2,this.height],r);return c[0]<this.longitude&&(c[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],c[0],o[0],d[0]),Math.min(n[1],c[1],o[1],d[1]),Math.max(n[0],c[0],o[0],d[0]),Math.max(n[1],c[1],o[1],d[1])]}unproject(e,{topLeft:r=!0,targetZ:n}={}){const[o,c,d]=e,a=r?c:this.height-c,{pixelUnprojectionMatrix:y}=this;let S;if(Number.isFinite(d))S=$0(y,[o,a,d,1]);else{const N=$0(y,[o,a,-1,1]),G=$0(y,[o,a,1,1]),re=((n||0)/Zm+1)*Oh,me=A0(NP([],N,G)),Y=A0(N),q=A0(G),le=4*((4*Y*q-(me-Y-q)**2)/16)/me,Ae=Math.sqrt(Y-le),we=Math.sqrt(Math.max(0,re*re-le)),je=(Ae-we)/Math.sqrt(me);S=vz([],N,G,je)}const[E,M,F]=this.unprojectPosition(S);return Number.isFinite(d)?[E,M,F]:Number.isFinite(n)?[E,M,n]:[E,M]}projectPosition(e){const[r,n,o=0]=e,c=r*wm,d=n*wm,a=Math.cos(d),y=(o/Zm+1)*Oh;return[Math.sin(c)*a*y,-Math.cos(c)*a*y,Math.sin(d)*y]}unprojectPosition(e){const[r,n,o]=e,c=Az(e),d=Math.asin(o/c),y=Math.atan2(r,-n)*Q3,S=d*Q3,E=(c/Oh-1)*Zm;return[y,S,E]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,r){const n=this.unproject(r);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function $0(t,e){const r=od([],e,t);return BP(r,r,1/r[3]),r}class n$ extends gC{applyConstraints(e){const{maxZoom:r,minZoom:n,zoom:o}=e;e.zoom=Ko(o,n,r);const{longitude:c,latitude:d}=e;return(c<-180||c>180)&&(e.longitude=v5(c+180,360)-180),e.latitude=Ko(d,-Ml,Ml),e}}class i$ extends pC{constructor(){super(...arguments),this.ControllerState=n$,this.transition={transitionDuration:300,transitionInterpolator:new Q1(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class HC extends fC{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?ru:r$}get ControllerType(){return i$}}HC.displayName="GlobeView";const W0=512,s$=Math.PI/180;function XC({map:t,gl:e,deck:r}){if(t.__deck)return t.__deck;const n=r==null?void 0:r.props._customRender,o=r==null?void 0:r.props.onLoad,c={...r==null?void 0:r.props,_customRender:()=>{t.triggerRepaint(),n==null||n("")}};c.parameters={...Rb(t,!0),...c.parameters},c.views||(c.views=W_(t));let d;return(!r||r.props.gl===e)&&(Object.assign(c,{gl:e,width:null,height:null,touchAction:"unset",viewState:Ip(t)}),r!=null&&r.isInitialized?J3(r,t):c.onLoad=()=>{o==null||o(),J3(d,t)}),r?(d=r,r.setProps(c),r.userData.isExternal=!0):(d=new Ap(c),t.on("remove",()=>{ZC(t)})),d.userData.mapboxLayers=new Set,t.__deck=d,t.on("render",()=>{d.isInitialized&&h$(d,t)}),d}function J3(t,e){const r=()=>{t.isInitialized?d$(t,e):e.off("move",r)};e.on("move",r)}function ZC(t){var e;(e=t.__deck)==null||e.finalize(),t.__deck=null}function Rb(t,e){const r=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return qC(t)==="globe"&&(r.cullMode="back"),r}function o$(t,e){t.userData.mapboxLayers.add(e),aw(t)}function a$(t,e){t.userData.mapboxLayers.delete(e),aw(t)}function l$(t,e){aw(t)}function c$(t,e,r,n){let{currentViewport:o}=t.userData,c=!1;o||(o=YC(t,e,n),t.userData.currentViewport=o,c=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[o],layerFilter:d=>(!t.props.layerFilter||t.props.layerFilter(d))&&(r.id===d.layer.id||d.layer.props.operation.includes("terrain")),clearStack:c,clearCanvas:!1})}function qC(t){var n;const e=(n=t.getProjection)==null?void 0:n.call(t),r=(e==null?void 0:e.type)||(e==null?void 0:e.name);if(r==="globe")return"globe";if(r&&r!=="mercator")throw new Error("Unsupported projection");return"mercator"}function W_(t){return qC(t)==="globe"?new HC({id:"mapbox"}):new J1({id:"mapbox"})}function Ip(t){var o;const{lng:e,lat:r}=t.getCenter(),n={longitude:(e+540)%360-180,latitude:r,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return(o=t.getTerrain)!=null&&o.call(t)&&u$(t,n),n}function u$(t,e){if(t.getFreeCameraOptions){const{position:r}=t.getFreeCameraOptions();if(!r||r.z===void 0)return;const n=t.transform.height,{longitude:o,latitude:c,pitch:d}=e,a=r.x*W0,y=(1-r.y)*W0,S=r.z*W0,E=xp([o,c]),M=a-E[0],F=y-E[1],N=Math.sqrt(M*M+F*F),G=d*s$,re=1.5*n,me=G<.001?re*Math.cos(G)/S:re*Math.sin(G)/N;e.zoom=Math.log2(me);const Y=re*Math.cos(G)/me,q=S-Y;e.position=[0,0,q/Wm(c)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function YC(t,e,r){const n=Ip(e),o=W_(e);r&&(o.props.nearZMultiplier=.2);const c=(r==null?void 0:r.nearZ)??e.transform._nearZ,d=(r==null?void 0:r.farZ)??e.transform._farZ;return Number.isFinite(c)&&(n.nearZ=c/e.transform.height,n.farZ=d/e.transform.height),o.makeViewport({width:t.width,height:t.height,viewState:n})}function h$(t,e){const{mapboxLayers:r,isExternal:n}=t.userData;if(n){const o=Array.from(r,E=>E.id),d=Ep(t.props.layers,Boolean).some(E=>E&&!o.includes(E.id));let a=t.getViewports();const y=a.findIndex(E=>E.id==="mapbox"),S=a.length>1||y<0;(d||S)&&(y>=0&&(a=a.slice(),a[y]=YC(t,e)),t._drawLayers("mapbox-repaint",{viewports:a,layerFilter:E=>(!t.props.layerFilter||t.props.layerFilter(E))&&(E.viewport.id!=="mapbox"||!o.includes(E.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function d$(t,e){t.setProps({viewState:Ip(e)}),t.needsRedraw({clearRedrawFlags:!0})}function aw(t){if(t.userData.isExternal)return;const e=[];t.userData.mapboxLayers.forEach(r=>{const n=r.props.type,o=new n(r.props);e.push(o)}),t.setProps({layers:e})}class f${constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,r){this.map=e,this.deck=XC({map:e,gl:r,deck:this.props.deck}),o$(this.deck,this)}onRemove(){this.deck&&a$(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&l$(this.deck)}render(e,r){c$(this.deck,this.map,this,r)}}const H0="__UNDEFINED__";function Tm(t,e,r,n){if(!t||!e||!t.style||!t.style._loaded)return;const o=Ep(n,Boolean);if(r!==n){const a=Ep(r,Boolean),y=new Set(a.map(S=>S.id));for(const S of o)y.delete(S.id);for(const S of y)t.getLayer(S)&&t.removeLayer(S)}for(const a of o){const y=t.getLayer(a.id);y?(y.implementation||y).setProps(a.props):t.addLayer(new f$({id:a.id,deck:e,slot:a.props.slot}),a.props.beforeId)}const c=t.style._order,d={};for(const a of o){let{beforeId:y}=a.props;(!y||!c.includes(y))&&(y=H0),d[y]=d[y]||[],d[y].push(a.id)}for(const a in d){const y=d[a];let S=a===H0?c.length:c.indexOf(a),E=a===H0?void 0:a;for(let M=y.length-1;M>=0;M--){const F=y[M],N=c.indexOf(F);N!==S-1&&(t.moveLayer(F,E),N>S&&S++),S--,E=F}}}class p${constructor(e){this._handleStyleChange=()=>{Tm(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:o,clientHeight:c}=this._map.getContainer();Object.assign(this._container.style,{width:`${o}px`,height:`${c}px`})}},this._updateViewState=()=>{const o=this._deck,c=this._map;o&&c&&(o.setProps({views:this._props.views||W_(c),viewState:Ip(c)}),o.isInitialized&&o.redraw())},this._handleMouseEvent=o=>{const c=this._deck;if(!c||!c.isInitialized)return;const d={type:o.type,offsetCenter:o.point,srcEvent:o},a=this._lastMouseDownPoint;switch(!o.point&&a&&(d.deltaX=o.originalEvent.clientX-a.clientX,d.deltaY=o.originalEvent.clientY-a.clientY,d.offsetCenter={x:a.x+d.deltaX,y:a.y+d.deltaY}),d.type){case"mousedown":c._onPointerDown(d),this._lastMouseDownPoint={...o.point,clientX:o.originalEvent.clientX,clientY:o.originalEvent.clientY};break;case"dragstart":d.type="panstart",c._onEvent(d);break;case"drag":d.type="panmove",c._onEvent(d);break;case"dragend":d.type="panend",c._onEvent(d);break;case"click":d.tapCount=1,c._onEvent(d);break;case"dblclick":d.type="click",d.tapCount=2,c._onEvent(d);break;case"mousemove":d.type="pointermove",c._onPointerMove(d);break;case"mouseout":d.type="pointerleave",c._onPointerMove(d);break;default:return}};const{interleaved:r=!1,...n}=e;this._interleaved=r,this._props=n}setProps(e){this._interleaved&&e.layers&&Tm(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...Rb(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const r=document.createElement("div");return Object.assign(r.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=r,this._deck=new Ap({...this._props,parent:r,parameters:{...Rb(e,!1),...this._props.parameters},views:this._props.views||W_(e),viewState:Ip(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),r}_onAddInterleaved(e){const r=e.painter.context.gl;return r instanceof WebGLRenderingContext&&Gr.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=XC({map:e,gl:r,deck:new Ap({...this._props,gl:r})}),e.on("styledata",this._handleStyleChange),Tm(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){var r;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),(r=this._deck)==null||r.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),Tm(e,this._deck,this._props.layers,[]),ZC(e)}getDefaultPosition(){return"top-left"}pickObject(e){return ri(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return ri(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return ri(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}const X0=Math.PI/180,Sm=new Float32Array(16),eE=new Float32Array(12);function tE(t,e,r){const n=e[0]*X0,o=e[1]*X0,c=e[2]*X0,d=Math.sin(c),a=Math.sin(n),y=Math.sin(o),S=Math.cos(c),E=Math.cos(n),M=Math.cos(o),F=r[0],N=r[1],G=r[2];t[0]=F*M*E,t[1]=F*y*E,t[2]=F*-a,t[3]=N*(-y*S+M*a*d),t[4]=N*(M*S+y*a*d),t[5]=N*E*d,t[6]=G*(y*d+M*a*S),t[7]=G*(-M*d+y*a*S),t[8]=G*E*S}function rE(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const g$={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:r}){const{data:n,getOrientation:o,getScale:c,getTranslation:d,getTransformMatrix:a}=this.props,y=Array.isArray(a),S=y&&a.length===16,E=Array.isArray(c),M=Array.isArray(o),F=Array.isArray(d),N=S||!y&&!!a(n[0]);N?t.constant=S:t.constant=M&&E&&F;const G=t.value;if(t.constant){let re;N?(Sm.set(a),re=rE(Sm)):(re=eE,tE(re,o,c),re.set(d,9)),t.value=new Float32Array(re)}else{let re=e*t.size;const{iterable:me,objectInfo:Y}=kC(n,e,r);for(const q of me){Y.index++;let Z;if(N)Sm.set(S?a:a(q,Y)),Z=rE(Sm);else{Z=eE;const le=M?o:o(q,Y),Ae=E?c:c(q,Y);tE(Z,le,Ae),Z.set(F?d:d(q,Y),9)}G[re++]=Z[0],G[re++]=Z[1],G[re++]=Z[2],G[re++]=Z[3],G[re++]=Z[4],G[re++]=Z[5],G[re++]=Z[6],G[re++]=Z[7],G[re++]=Z[8],G[re++]=Z[9],G[re++]=Z[10],G[re++]=Z[11]}}}};function m$(t,e){return e===Ir.CARTESIAN||e===Ir.METER_OFFSETS||e===Ir.DEFAULT&&!t.isGeospatial}const nE=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,_$={name:"simpleMesh",vs:nE,fs:nE,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},y$=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,v$=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function Z0(t){const e=t.positions||t.POSITION;Gr.assert(e,'no "postions" or "POSITION" attribute in mesh');const r=e.value.length/e.size;let n=t.COLOR_0||t.colors;n||(n={size:3,value:new Float32Array(r*3).fill(1)});let o=t.NORMAL||t.normals;o||(o={size:3,value:new Float32Array(r*3).fill(0)});let c=t.TEXCOORD_0||t.texCoords;return c||(c={size:2,value:new Float32Array(r*2).fill(0)}),{positions:e,colors:n,normals:o,texCoords:c}}function iE(t){return t instanceof Hm?(t.attributes=Z0(t.attributes),t):t.attributes?new Hm({...t,topology:"triangle-list",attributes:Z0(t.attributes)}):new Hm({topology:"triangle-list",attributes:Z0(t)})}const x$=[0,0,0,255],b$={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:x$},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class lw extends ow{getShaders(){return super.getShaders({vs:y$,fs:v$,modules:[M6,jP,e5,_$]})}getBounds(){var n;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:r}=this.props;if(!r)return null;if(e=(n=r.header)==null?void 0:n.boundingBox,!e){const{attributes:o}=iE(r);o.POSITION=o.POSITION||o.positions,e=uF(o)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:g$}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){var c;super.updateState(e);const{props:r,oldProps:n,changeFlags:o}=e;if(r.mesh!==n.mesh||o.extensionsChanged){if(this.state.positionBounds=null,(c=this.state.model)==null||c.destroy(),r.mesh){this.state.model=this.getModel(r.mesh);const d=r.mesh.attributes||r.mesh;this.setState({hasNormals:!!(d.NORMAL||d.normals)})}this.getAttributeManager().invalidateAll()}r.texture!==n.texture&&r.texture instanceof vn&&this.setTexture(r.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:r}=this.state;if(!r)return;const{viewport:n,renderPass:o}=this.context,{sizeScale:c,coordinateSystem:d,_instanced:a}=this.props,y={sizeScale:c,composeModelMatrix:!a||m$(n,d),flatShading:!this.state.hasNormals};r.shaderInputs.setProps({simpleMesh:y}),r.draw(o)}get isLoaded(){var e;return!!((e=this.state)!=null&&e.model&&super.isLoaded)}getModel(e){const r=new Tp(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:iE(e),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:o}=this.state,c={sampler:n||o,hasTexture:!!n};return r.shaderInputs.setProps({simpleMesh:c}),r}setTexture(e){const{emptyTexture:r,model:n}=this.state;if(n){const o={sampler:e||r,hasTexture:!!e};n.shaderInputs.setProps({simpleMesh:o})}}}lw.defaultProps=b$;lw.layerName="SimpleMeshLayer";/*!
 * satellite-js v5.0.0
 * (c) 2013 Shashwat Kandadai and UCSC
 * https://github.com/shashwatak/satellite-js
 * License: MIT
 */var Ui=Math.PI,pn=Ui*2,Ff=Ui/180,w$=180/Ui,T$=1440,S$=398600.8,ks=6378.135,Da=60/Math.sqrt(ks*ks*ks/S$),q0=ks*Da/60,E$=1/Da,Uc=.001082616,A$=-253881e-11,I$=-165597e-11,Vc=A$/Uc,Pp=2/3;function P$(t,e){for(var r=[31,t%4===0?29:28,31,30,31,30,31,31,30,31,30,31],n=Math.floor(e),o=1,c=0;n>c+r[o-1]&&o<12;)c+=r[o-1],o+=1;var d=o,a=n-c,y=(e-n)*24,S=Math.floor(y);y=(y-S)*60;var E=Math.floor(y),M=(y-E)*60;return{mon:d,day:a,hr:S,minute:E,sec:M}}function sE(t,e,r,n,o,c){var d=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;return 367*t-Math.floor(7*(t+Math.floor((e+9)/12))*.25)+Math.floor(275*e/9)+r+17210135e-1+((d/6e4+c/60+o)/60+n)/24}function cw(t,e,r,n,o,c,d){if(t instanceof Date){var a=t;return sE(a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())}return sE(t,e,r,n,o,c,d)}function GC(t,e){var r=t.e3,n=t.ee2,o=t.peo,c=t.pgho,d=t.pho,a=t.pinco,y=t.plo,S=t.se2,E=t.se3,M=t.sgh2,F=t.sgh3,N=t.sgh4,G=t.sh2,re=t.sh3,me=t.si2,Y=t.si3,q=t.sl2,Z=t.sl3,le=t.sl4,Ae=t.t,we=t.xgh2,je=t.xgh3,Ue=t.xgh4,Ze=t.xh2,qe=t.xh3,Ke=t.xi2,ht=t.xi3,Pt=t.xl2,xt=t.xl3,Zt=t.xl4,Ot=t.zmol,$t=t.zmos,Je=e.init,Qe=e.opsmode,gt=e.ep,dt=e.inclp,yt=e.nodep,_r=e.argpp,lr=e.mp,bt,mt,nr,Wt,fr,vr,en,pr,er,Ft,Qt,xr,tr,Jt,sr,Ht,ir,yr,Er,dr,gr,Nr=119459e-10,Mr=.01675,Qr=.00015835218,ve=.0549;gr=$t+Nr*Ae,Je==="y"&&(gr=$t),dr=gr+2*Mr*Math.sin(gr),ir=Math.sin(dr),Ft=.5*ir*ir-.25,Qt=-.5*ir*Math.cos(dr);var $=S*Ft+E*Qt,H=me*Ft+Y*Qt,K=q*Ft+Z*Qt+le*ir,se=M*Ft+F*Qt+N*ir,pe=G*Ft+re*Qt;gr=Ot+Qr*Ae,Je==="y"&&(gr=Ot),dr=gr+2*ve*Math.sin(gr),ir=Math.sin(dr),Ft=.5*ir*ir-.25,Qt=-.5*ir*Math.cos(dr);var be=n*Ft+r*Qt,Ie=Ke*Ft+ht*Qt,xe=Pt*Ft+xt*Qt+Zt*ir,ze=we*Ft+je*Qt+Ue*ir,We=Ze*Ft+qe*Qt;return xr=$+be,sr=H+Ie,Ht=K+xe,tr=se+ze,Jt=pe+We,Je==="n"&&(xr-=o,sr-=a,Ht-=y,tr-=c,Jt-=d,dt+=sr,gt+=xr,Wt=Math.sin(dt),nr=Math.cos(dt),dt>=.2?(Jt/=Wt,tr-=nr*Jt,_r+=tr,yt+=Jt,lr+=Ht):(vr=Math.sin(yt),fr=Math.cos(yt),bt=Wt*vr,mt=Wt*fr,en=Jt*fr+sr*nr*vr,pr=-Jt*vr+sr*nr*fr,bt+=en,mt+=pr,yt%=pn,yt<0&&Qe==="a"&&(yt+=pn),yr=lr+_r+nr*yt,er=Ht+tr-sr*yt*Wt,yr+=er,Er=yt,yt=Math.atan2(bt,mt),yt<0&&Qe==="a"&&(yt+=pn),Math.abs(Er-yt)>Ui&&(yt<Er?yt+=pn:yt-=pn),lr+=Ht,_r=yr-lr-nr*yt)),{ep:gt,inclp:dt,nodep:yt,argpp:_r,mp:lr}}function C$(t){var e=t.epoch,r=t.ep,n=t.argpp,o=t.tc,c=t.inclp,d=t.nodep,a=t.np,y,S,E,M,F,N,G,re,me,Y,q,Z,le,Ae,we,je,Ue,Ze,qe,Ke,ht,Pt,xt,Zt,Ot,$t,Je,Qe,gt,dt,yt,_r,lr,bt,mt,nr,Wt,fr,vr,en,pr,er,Ft,Qt,xr,tr,Jt,sr,Ht,ir,yr,Er,dr,gr,Nr,Mr,Qr,ve,$,H,K,se,pe,be=.01675,Ie=.0549,xe=29864797e-13,ze=47968065e-14,We=.39785416,Ve=.91744867,ft=.1945905,Te=-.98088458,kt=a,Bt=r,_t=Math.sin(d),Mt=Math.cos(d),Gt=Math.sin(n),wr=Math.cos(n),Rr=Math.sin(c),it=Math.cos(c),Dt=Bt*Bt,Ut=1-Dt,kr=Math.sqrt(Ut),$e=0,un=0,Dr=0,Ai=0,ts=0,rt=e+18261.5+o/1440,Vt=(4.523602-.00092422029*rt)%pn,At=Math.sin(Vt),Or=Math.cos(Vt),Ii=.91375164-.03568096*Or,fi=Math.sqrt(1-Ii*Ii),Ct=.089683511*At/fi,_n=Math.sqrt(1-Ct*Ct),Pr=5.8351514+.001944368*rt,rs=.39785416*At/fi,Pi=_n*Or+.91744867*Ct*At;rs=Math.atan2(rs,Pi),rs+=Pr-Vt;var Bs=Math.cos(rs),Xr=Math.sin(rs);Ke=ft,ht=Te,Zt=Ve,Ot=We,Pt=Mt,xt=_t,q=xe;for(var Mo=1/kt,Tn=0;Tn<2;)Tn+=1,y=Ke*Pt+ht*Zt*xt,E=-ht*Pt+Ke*Zt*xt,G=-Ke*xt+ht*Zt*Pt,re=ht*Ot,me=ht*xt+Ke*Zt*Pt,Y=Ke*Ot,S=it*G+Rr*re,M=it*me+Rr*Y,F=-Rr*G+it*re,N=-Rr*me+it*Y,Z=y*wr+S*Gt,le=E*wr+M*Gt,Ae=-y*Gt+S*wr,we=-E*Gt+M*wr,je=F*Gt,Ue=N*Gt,Ze=F*wr,qe=N*wr,K=12*Z*Z-3*Ae*Ae,se=24*Z*le-6*Ae*we,pe=12*le*le-3*we*we,Er=3*(y*y+S*S)+K*Dt,dr=6*(y*E+S*M)+se*Dt,gr=3*(E*E+M*M)+pe*Dt,Nr=-6*y*F+Dt*(-24*Z*Ze-6*Ae*je),Mr=-6*(y*N+E*F)+Dt*(-24*(le*Ze+Z*qe)+-6*(Ae*Ue+we*je)),Qr=-6*E*N+Dt*(-24*le*qe-6*we*Ue),ve=6*S*F+Dt*(24*Z*je-6*Ae*Ze),$=6*(M*F+S*N)+Dt*(24*(le*je+Z*Ue)-6*(we*Ze+Ae*qe)),H=6*M*N+Dt*(24*le*Ue-6*we*qe),Er=Er+Er+Ut*K,dr=dr+dr+Ut*se,gr=gr+gr+Ut*pe,Jt=q*Mo,tr=-.5*Jt/kr,sr=Jt*kr,xr=-15*Bt*sr,Ht=Z*Ae+le*we,ir=le*Ae+Z*we,yr=le*we-Z*Ae,Tn===1&&($t=xr,Je=tr,Qe=Jt,gt=sr,dt=Ht,yt=ir,_r=yr,lr=Er,bt=dr,mt=gr,nr=Nr,Wt=Mr,fr=Qr,vr=ve,en=$,pr=H,er=K,Ft=se,Qt=pe,Ke=Bs,ht=Xr,Zt=Ii,Ot=fi,Pt=_n*Mt+Ct*_t,xt=_t*_n-Mt*Ct,q=ze);var Tr=(4.7199672+(.2299715*rt-Pr))%pn,Va=(6.2565837+.017201977*rt)%pn,no=2*$t*yt,fs=2*$t*_r,ii=2*Je*Wt,ns=2*Je*(fr-nr),ta=-2*Qe*bt,ja=-2*Qe*(mt-lr),$a=-2*Qe*(-21-9*Dt)*be,Vi=2*gt*Ft,Wa=2*gt*(Qt-er),ql=-18*gt*be,ra=-2*Je*en,Ha=-2*Je*(pr-vr),io=2*xr*ir,Us=2*xr*yr,na=2*tr*Mr,Yl=2*tr*(Qr-Nr),Ro=-2*Jt*dr,Gl=-2*Jt*(gr-Er),Kl=-2*Jt*(-21-9*Dt)*Ie,cd=2*sr*se,ko=2*sr*(pe-K),ia=-18*sr*Ie,ji=-2*tr*$,rr=-2*tr*(H-ve);return{snodm:_t,cnodm:Mt,sinim:Rr,cosim:it,sinomm:Gt,cosomm:wr,day:rt,e3:Us,ee2:io,em:Bt,emsq:Dt,gam:Pr,peo:$e,pgho:Ai,pho:ts,pinco:un,plo:Dr,rtemsq:kr,se2:no,se3:fs,sgh2:Vi,sgh3:Wa,sgh4:ql,sh2:ra,sh3:Ha,si2:ii,si3:ns,sl2:ta,sl3:ja,sl4:$a,s1:xr,s2:tr,s3:Jt,s4:sr,s5:Ht,s6:ir,s7:yr,ss1:$t,ss2:Je,ss3:Qe,ss4:gt,ss5:dt,ss6:yt,ss7:_r,sz1:lr,sz2:bt,sz3:mt,sz11:nr,sz12:Wt,sz13:fr,sz21:vr,sz22:en,sz23:pr,sz31:er,sz32:Ft,sz33:Qt,xgh2:cd,xgh3:ko,xgh4:ia,xh2:ji,xh3:rr,xi2:na,xi3:Yl,xl2:Ro,xl3:Gl,xl4:Kl,nm:kt,z1:Er,z2:dr,z3:gr,z11:Nr,z12:Mr,z13:Qr,z21:ve,z22:$,z23:H,z31:K,z32:se,z33:pe,zmol:Tr,zmos:Va}}function M$(t){var e=t.cosim,r=t.argpo,n=t.s1,o=t.s2,c=t.s3,d=t.s4,a=t.s5,y=t.sinim,S=t.ss1,E=t.ss2,M=t.ss3,F=t.ss4,N=t.ss5,G=t.sz1,re=t.sz3,me=t.sz11,Y=t.sz13,q=t.sz21,Z=t.sz23,le=t.sz31,Ae=t.sz33,we=t.t,je=t.tc,Ue=t.gsto,Ze=t.mo,qe=t.mdot,Ke=t.no,ht=t.nodeo,Pt=t.nodedot,xt=t.xpidot,Zt=t.z1,Ot=t.z3,$t=t.z11,Je=t.z13,Qe=t.z21,gt=t.z23,dt=t.z31,yt=t.z33,_r=t.ecco,lr=t.eccsq,bt=t.emsq,mt=t.em,nr=t.argpm,Wt=t.inclm,fr=t.mm,vr=t.nm,en=t.nodem,pr=t.irez,er=t.atime,Ft=t.d2201,Qt=t.d2211,xr=t.d3210,tr=t.d3222,Jt=t.d4410,sr=t.d4422,Ht=t.d5220,ir=t.d5232,yr=t.d5421,Er=t.d5433,dr=t.dedt,gr=t.didt,Nr=t.dmdt,Mr=t.dnodt,Qr=t.domdt,ve=t.del1,$=t.del2,H=t.del3,K=t.xfact,se=t.xlamo,pe=t.xli,be=t.xni,Ie,xe,ze,We,Ve,ft,Te,kt,Bt,_t,Mt,Gt,wr,Rr,it,Dt,Ut,kr,$e,un,Dr,Ai,ts,rt,Vt,At,Or,Ii,fi,Ct,_n,Pr,rs=17891679e-13,Pi=21460748e-13,Bs=22123015e-14,Xr=17891679e-13,Mo=73636953e-16,Tn=21765803e-16,Tr=.0043752690880113,Va=37393792e-14,no=11428639e-14,fs=.00015835218,ii=119459e-10;pr=0,vr<.0052359877&&vr>.0034906585&&(pr=1),vr>=.00826&&vr<=.00924&&mt>=.5&&(pr=2);var ns=S*ii*N,ta=E*ii*(me+Y),ja=-ii*M*(G+re-14-6*bt),$a=F*ii*(le+Ae-6),Vi=-ii*E*(q+Z);(Wt<.052359877||Wt>Ui-.052359877)&&(Vi=0),y!==0&&(Vi/=y);var Wa=$a-e*Vi;dr=ns+n*fs*a,gr=ta+o*fs*($t+Je),Nr=ja-fs*c*(Zt+Ot-14-6*bt);var ql=d*fs*(dt+yt-6),ra=-fs*o*(Qe+gt);(Wt<.052359877||Wt>Ui-.052359877)&&(ra=0),Qr=Wa+ql,Mr=Vi,y!==0&&(Qr-=e/y*ra,Mr+=ra/y);var Ha=0,io=(Ue+je*Tr)%pn;if(mt+=dr*we,Wt+=gr*we,nr+=Qr*we,en+=Mr*we,fr+=Nr*we,pr!==0){if(Ct=Math.pow(vr/Da,Pp),pr===2){_n=e*e;var Us=mt;mt=_r;var na=bt;bt=lr,Pr=mt*bt,Rr=-.306-(mt-.64)*.44,mt<=.65?(it=3.616-13.247*mt+16.29*bt,Ut=-19.302+117.39*mt-228.419*bt+156.591*Pr,kr=-18.9068+109.7927*mt-214.6334*bt+146.5816*Pr,$e=-41.122+242.694*mt-471.094*bt+313.953*Pr,un=-146.407+841.88*mt-1629.014*bt+1083.435*Pr,Dr=-532.114+3017.977*mt-5740.032*bt+3708.276*Pr):(it=-72.099+331.819*mt-508.738*bt+266.724*Pr,Ut=-346.844+1582.851*mt-2415.925*bt+1246.113*Pr,kr=-342.585+1554.908*mt-2366.899*bt+1215.972*Pr,$e=-1052.797+4758.686*mt-7193.992*bt+3651.957*Pr,un=-3581.69+16178.11*mt-24462.77*bt+12422.52*Pr,mt>.715?Dr=-5149.66+29936.92*mt-54087.36*bt+31324.56*Pr:Dr=1464.74-4664.75*mt+3763.64*bt),mt<.7?(rt=-919.2277+4988.61*mt-9064.77*bt+5542.21*Pr,Ai=-822.71072+4568.6173*mt-8491.4146*bt+5337.524*Pr,ts=-853.666+4690.25*mt-8624.77*bt+5341.4*Pr):(rt=-37995.78+161616.52*mt-229838.2*bt+109377.94*Pr,Ai=-51752.104+218913.95*mt-309468.16*bt+146349.42*Pr,ts=-40023.88+170470.89*mt-242699.48*bt+115605.82*Pr),Vt=y*y,Ie=.75*(1+2*e+_n),xe=1.5*Vt,We=1.875*y*(1-2*e-3*_n),Ve=-1.875*y*(1+2*e-3*_n),Te=35*Vt*Ie,kt=39.375*Vt*Vt,Bt=9.84375*y*(Vt*(1-2*e-5*_n)+.33333333*(-2+4*e+6*_n)),_t=y*(4.92187512*Vt*(-2-4*e+10*_n)+6.56250012*(1+2*e-3*_n)),Mt=29.53125*y*(2-8*e+_n*(-12+8*e+10*_n)),Gt=29.53125*y*(-2-8*e+_n*(12+8*e-10*_n)),Ii=vr*vr,fi=Ct*Ct,Or=3*Ii*fi,At=Or*Xr,Ft=At*Ie*Rr,Qt=At*xe*it,Or*=Ct,At=Or*Va,xr=At*We*Ut,tr=At*Ve*kr,Or*=Ct,At=2*Or*Mo,Jt=At*Te*$e,sr=At*kt*un,Or*=Ct,At=Or*no,Ht=At*Bt*Dr,ir=At*_t*ts,At=2*Or*Tn,yr=At*Mt*Ai,Er=At*Gt*rt,se=(Ze+ht+ht-(io+io))%pn,K=qe+Nr+2*(Pt+Mr-Tr)-Ke,mt=Us,bt=na}pr===1&&(wr=1+bt*(-2.5+.8125*bt),Ut=1+2*bt,Dt=1+bt*(-6+6.60937*bt),Ie=.75*(1+e)*(1+e),ze=.9375*y*y*(1+3*e)-.75*(1+e),ft=1+e,ft*=1.875*ft*ft,ve=3*vr*vr*Ct*Ct,$=2*ve*Ie*wr*rs,H=3*ve*ft*Dt*Bs*Ct,ve=ve*ze*Ut*Pi*Ct,se=(Ze+ht+r-io)%pn,K=qe+xt+Nr+Qr+Mr-(Ke+Tr)),pe=se,be=Ke,er=0,vr=Ke+Ha}return{em:mt,argpm:nr,inclm:Wt,mm:fr,nm:vr,nodem:en,irez:pr,atime:er,d2201:Ft,d2211:Qt,d3210:xr,d3222:tr,d4410:Jt,d4422:sr,d5220:Ht,d5232:ir,d5421:yr,d5433:Er,dedt:dr,didt:gr,dmdt:Nr,dndt:Ha,dnodt:Mr,domdt:Qr,del1:ve,del2:$,del3:H,xfact:K,xlamo:se,xli:pe,xni:be}}function oE(t){var e=(t-2451545)/36525,r=-62e-7*e*e*e+.093104*e*e+(876600*3600+8640184812866e-6)*e+67310.54841;return r=r*Ff/240%pn,r<0&&(r+=pn),r}function KC(){return(arguments.length<=0?void 0:arguments[0])instanceof Date||arguments.length>1?oE(cw.apply(void 0,arguments)):oE.apply(void 0,arguments)}function R$(t){var e=t.ecco,r=t.epoch,n=t.inclo,o=t.opsmode,c=t.no,d=e*e,a=1-d,y=Math.sqrt(a),S=Math.cos(n),E=S*S,M=Math.pow(Da/c,Pp),F=.75*Uc*(3*E-1)/(y*a),N=F/(M*M),G=M*(1-N*N-N*(1/3+134*N*N/81));N=F/(G*G),c/=1+N;var re=Math.pow(Da/c,Pp),me=Math.sin(n),Y=re*a,q=1-5*E,Z=-q-E-E,le=1/re,Ae=Y*Y,we=re*(1-e),je="n",Ue;if(o==="a"){var Ze=r-7305,qe=Math.floor(Ze+1e-8),Ke=Ze-qe,ht=.017202791694070362,Pt=1.7321343856509375,xt=5075514194322695e-30,Zt=ht+pn;Ue=(Pt+ht*qe+Zt*Ke+Ze*Ze*xt)%pn,Ue<0&&(Ue+=pn)}else Ue=KC(r+24332815e-1);return{no:c,method:je,ainv:le,ao:re,con41:Z,con42:q,cosio:S,cosio2:E,eccsq:d,omeosq:a,posq:Ae,rp:we,rteosq:y,sinio:me,gsto:Ue}}function k$(t){var e=t.irez,r=t.d2201,n=t.d2211,o=t.d3210,c=t.d3222,d=t.d4410,a=t.d4422,y=t.d5220,S=t.d5232,E=t.d5421,M=t.d5433,F=t.dedt,N=t.del1,G=t.del2,re=t.del3,me=t.didt,Y=t.dmdt,q=t.dnodt,Z=t.domdt,le=t.argpo,Ae=t.argpdot,we=t.t,je=t.tc,Ue=t.gsto,Ze=t.xfact,qe=t.xlamo,Ke=t.no,ht=t.atime,Pt=t.em,xt=t.argpm,Zt=t.inclm,Ot=t.xli,$t=t.mm,Je=t.xni,Qe=t.nodem,gt=t.nm,dt=.13130908,yt=2.8843198,_r=.37448087,lr=5.7686396,bt=.95240898,mt=1.8014998,nr=1.050833,Wt=4.4108898,fr=.0043752690880113,vr=720,en=-720,pr=259200,er,Ft,Qt,xr,tr,Jt,sr,Ht,ir=0,yr=0,Er=(Ue+je*fr)%pn;if(Pt+=F*we,Zt+=me*we,xt+=Z*we,Qe+=q*we,$t+=Y*we,e!==0){(ht===0||we*ht<=0||Math.abs(we)<Math.abs(ht))&&(ht=0,Je=Ke,Ot=qe),we>0?er=vr:er=en;for(var dr=381;dr===381;)e!==2?(sr=N*Math.sin(Ot-dt)+G*Math.sin(2*(Ot-yt))+re*Math.sin(3*(Ot-_r)),tr=Je+Ze,Jt=N*Math.cos(Ot-dt)+2*G*Math.cos(2*(Ot-yt))+3*re*Math.cos(3*(Ot-_r)),Jt*=tr):(Ht=le+Ae*ht,Qt=Ht+Ht,Ft=Ot+Ot,sr=r*Math.sin(Qt+Ot-lr)+n*Math.sin(Ot-lr)+o*Math.sin(Ht+Ot-bt)+c*Math.sin(-Ht+Ot-bt)+d*Math.sin(Qt+Ft-mt)+a*Math.sin(Ft-mt)+y*Math.sin(Ht+Ot-nr)+S*Math.sin(-Ht+Ot-nr)+E*Math.sin(Ht+Ft-Wt)+M*Math.sin(-Ht+Ft-Wt),tr=Je+Ze,Jt=r*Math.cos(Qt+Ot-lr)+n*Math.cos(Ot-lr)+o*Math.cos(Ht+Ot-bt)+c*Math.cos(-Ht+Ot-bt)+y*Math.cos(Ht+Ot-nr)+S*Math.cos(-Ht+Ot-nr)+2*(d*Math.cos(Qt+Ft-mt)+a*Math.cos(Ft-mt)+E*Math.cos(Ht+Ft-Wt)+M*Math.cos(-Ht+Ft-Wt)),Jt*=tr),Math.abs(we-ht)>=vr?dr=381:(yr=we-ht,dr=0),dr===381&&(Ot+=tr*er+sr*pr,Je+=sr*er+Jt*pr,ht+=er);gt=Je+sr*yr+Jt*yr*yr*.5,xr=Ot+tr*yr+sr*yr*yr*.5,e!==1?($t=xr-2*Qe+2*Er,ir=gt-Ke):($t=xr-Qe-xt+Er,ir=gt-Ke),gt=Ke+ir}return{atime:ht,em:Pt,argpm:xt,inclm:Zt,xli:Ot,mm:$t,xni:Je,nodem:Qe,dndt:ir,nm:gt}}function QC(t,e){var r,n,o,c,d,a,y,S,E,M,F,N,G,re,me,Y,q,Z,le,Ae,we,je,Ue,Ze,qe,Ke,ht,Pt=15e-13;t.t=e,t.error=0;var xt=t.mo+t.mdot*t.t,Zt=t.argpo+t.argpdot*t.t,Ot=t.nodeo+t.nodedot*t.t;E=Zt,we=xt;var $t=t.t*t.t;if(Ue=Ot+t.nodecf*$t,q=1-t.cc1*t.t,Z=t.bstar*t.cc4*t.t,le=t.t2cof*$t,t.isimp!==1){y=t.omgcof*t.t;var Je=1+t.eta*Math.cos(xt);a=t.xmcof*(Je*Je*Je-t.delmo),Y=y+a,we=xt+Y,E=Zt-Y,N=$t*t.t,G=N*t.t,q=q-t.d2*$t-t.d3*N-t.d4*G,Z+=t.bstar*t.cc5*(Math.sin(we)-t.sinmao),le=le+t.t3cof*N+G*(t.t4cof+t.t*t.t5cof)}je=t.no;var Qe=t.ecco;if(Ae=t.inclo,t.method==="d"){re=t.t;var gt={irez:t.irez,d2201:t.d2201,d2211:t.d2211,d3210:t.d3210,d3222:t.d3222,d4410:t.d4410,d4422:t.d4422,d5220:t.d5220,d5232:t.d5232,d5421:t.d5421,d5433:t.d5433,dedt:t.dedt,del1:t.del1,del2:t.del2,del3:t.del3,didt:t.didt,dmdt:t.dmdt,dnodt:t.dnodt,domdt:t.domdt,argpo:t.argpo,argpdot:t.argpdot,t:t.t,tc:re,gsto:t.gsto,xfact:t.xfact,xlamo:t.xlamo,no:t.no,atime:t.atime,em:Qe,argpm:E,inclm:Ae,xli:t.xli,mm:we,xni:t.xni,nodem:Ue,nm:je},dt=k$(gt);Qe=dt.em,E=dt.argpm,Ae=dt.inclm,we=dt.mm,Ue=dt.nodem,je=dt.nm}if(je<=0)return t.error=2,[!1,!1];var yt=Math.pow(Da/je,Pp)*q*q;if(je=Da/Math.pow(yt,1.5),Qe-=Z,Qe>=1||Qe<-.001)return t.error=1,[!1,!1];Qe<1e-6&&(Qe=1e-6),we+=t.no*le,qe=we+E+Ue,Ue%=pn,E%=pn,qe%=pn,we=(qe-E-Ue)%pn;var _r=Math.sin(Ae),lr=Math.cos(Ae),bt=Qe;if(Ze=Ae,M=E,ht=Ue,Ke=we,c=_r,o=lr,t.method==="d"){var mt={inclo:t.inclo,init:"n",ep:bt,inclp:Ze,nodep:ht,argpp:M,mp:Ke,opsmode:t.operationmode},nr=GC(t,mt);if(bt=nr.ep,ht=nr.nodep,M=nr.argpp,Ke=nr.mp,Ze=nr.inclp,Ze<0&&(Ze=-Ze,ht+=Ui,M-=Ui),bt<0||bt>1)return t.error=3,[!1,!1]}t.method==="d"&&(c=Math.sin(Ze),o=Math.cos(Ze),t.aycof=-.5*Vc*c,Math.abs(o+1)>15e-13?t.xlcof=-.25*Vc*c*(3+5*o)/(1+o):t.xlcof=-.25*Vc*c*(3+5*o)/Pt);var Wt=bt*Math.cos(M);Y=1/(yt*(1-bt*bt));var fr=bt*Math.sin(M)+Y*t.aycof,vr=Ke+M+ht+Y*t.xlcof*Wt,en=(vr-ht)%pn;S=en,me=9999.9;for(var pr=1;Math.abs(me)>=1e-12&&pr<=10;)n=Math.sin(S),r=Math.cos(S),me=1-r*Wt-n*fr,me=(en-fr*r+Wt*n-S)/me,Math.abs(me)>=.95&&(me>0?me=.95:me=-.95),S+=me,pr+=1;var er=Wt*r+fr*n,Ft=Wt*n-fr*r,Qt=Wt*Wt+fr*fr,xr=yt*(1-Qt);if(xr<0)return t.error=4,[!1,!1];var tr=yt*(1-er),Jt=Math.sqrt(yt)*Ft/tr,sr=Math.sqrt(xr)/tr,Ht=Math.sqrt(1-Qt);Y=Ft/(1+Ht);var ir=yt/tr*(n-fr-Wt*Y),yr=yt/tr*(r-Wt+fr*Y);F=Math.atan2(ir,yr);var Er=(yr+yr)*ir,dr=1-2*ir*ir;Y=1/xr;var gr=.5*Uc*Y,Nr=gr*Y;t.method==="d"&&(d=o*o,t.con41=3*d-1,t.x1mth2=1-d,t.x7thm1=7*d-1);var Mr=tr*(1-1.5*Nr*Ht*t.con41)+.5*gr*t.x1mth2*dr;if(Mr<1)return t.error=6,{position:!1,velocity:!1};F-=.25*Nr*t.x7thm1*Er;var Qr=ht+1.5*Nr*o*Er,ve=Ze+1.5*Nr*o*c*dr,$=Jt-je*gr*t.x1mth2*Er/Da,H=sr+je*gr*(t.x1mth2*dr+1.5*t.con41)/Da,K=Math.sin(F),se=Math.cos(F),pe=Math.sin(Qr),be=Math.cos(Qr),Ie=Math.sin(ve),xe=Math.cos(ve),ze=-pe*xe,We=be*xe,Ve=ze*K+be*se,ft=We*K+pe*se,Te=Ie*K,kt=ze*se-be*K,Bt=We*se-pe*K,_t=Ie*se,Mt={x:Mr*Ve*ks,y:Mr*ft*ks,z:Mr*Te*ks},Gt={x:($*Ve+H*kt)*q0,y:($*ft+H*Bt)*q0,z:($*Te+H*_t)*q0};return{position:Mt,velocity:Gt}}function D$(t,e){var r=e.opsmode,n=e.epoch,o=e.xbstar,c=e.xecco,d=e.xargpo,a=e.xinclo,y=e.xmo,S=e.xno,E=e.xnodeo,M,F,N,G,re,me,Y,q,Z,le,Ae,we,je,Ue,Ze,qe,Ke,ht,Pt,xt,Zt,Ot,$t,Je,Qe,gt,dt,yt,_r,lr,bt,mt,nr,Wt,fr,vr,en,pr,er,Ft,Qt,xr,tr,Jt,sr,Ht,ir,yr,Er,dr,gr,Nr,Mr,Qr,ve,$,H=15e-13;t.isimp=0,t.method="n",t.aycof=0,t.con41=0,t.cc1=0,t.cc4=0,t.cc5=0,t.d2=0,t.d3=0,t.d4=0,t.delmo=0,t.eta=0,t.argpdot=0,t.omgcof=0,t.sinmao=0,t.t=0,t.t2cof=0,t.t3cof=0,t.t4cof=0,t.t5cof=0,t.x1mth2=0,t.x7thm1=0,t.mdot=0,t.nodedot=0,t.xlcof=0,t.xmcof=0,t.nodecf=0,t.irez=0,t.d2201=0,t.d2211=0,t.d3210=0,t.d3222=0,t.d4410=0,t.d4422=0,t.d5220=0,t.d5232=0,t.d5421=0,t.d5433=0,t.dedt=0,t.del1=0,t.del2=0,t.del3=0,t.didt=0,t.dmdt=0,t.dnodt=0,t.domdt=0,t.e3=0,t.ee2=0,t.peo=0,t.pgho=0,t.pho=0,t.pinco=0,t.plo=0,t.se2=0,t.se3=0,t.sgh2=0,t.sgh3=0,t.sgh4=0,t.sh2=0,t.sh3=0,t.si2=0,t.si3=0,t.sl2=0,t.sl3=0,t.sl4=0,t.gsto=0,t.xfact=0,t.xgh2=0,t.xgh3=0,t.xgh4=0,t.xh2=0,t.xh3=0,t.xi2=0,t.xi3=0,t.xl2=0,t.xl3=0,t.xl4=0,t.xlamo=0,t.zmol=0,t.zmos=0,t.atime=0,t.xli=0,t.xni=0,t.bstar=o,t.ecco=c,t.argpo=d,t.inclo=a,t.mo=y,t.no=S,t.nodeo=E,t.operationmode=r;var K=78/ks+1,se=42/ks,pe=se*se*se*se;t.init="y",t.t=0;var be={ecco:t.ecco,epoch:n,inclo:t.inclo,no:t.no,method:t.method,opsmode:t.operationmode},Ie=R$(be),xe=Ie.ao,ze=Ie.con42,We=Ie.cosio,Ve=Ie.cosio2,ft=Ie.eccsq,Te=Ie.omeosq,kt=Ie.posq,Bt=Ie.rp,_t=Ie.rteosq,Mt=Ie.sinio;if(t.no=Ie.no,t.con41=Ie.con41,t.gsto=Ie.gsto,t.a=Math.pow(t.no*E$,-2/3),t.alta=t.a*(1+t.ecco)-1,t.altp=t.a*(1-t.ecco)-1,t.error=0,Te>=0||t.no>=0){if(t.isimp=0,Bt<220/ks+1&&(t.isimp=1),dt=K,Zt=pe,ht=(Bt-1)*ks,ht<156){dt=ht-78,ht<98&&(dt=20);var Gt=(120-dt)/ks;Zt=Gt*Gt*Gt*Gt,dt=dt/ks+1}Pt=1/kt,Ht=1/(xe-dt),t.eta=xe*t.ecco*Ht,we=t.eta*t.eta,Ae=t.ecco*t.eta,xt=Math.abs(1-we),me=Zt*Math.pow(Ht,4),Y=me/Math.pow(xt,3.5),G=Y*t.no*(xe*(1+1.5*we+Ae*(4+we))+.375*Uc*Ht/xt*t.con41*(8+3*we*(8+we))),t.cc1=t.bstar*G,re=0,t.ecco>1e-4&&(re=-2*me*Ht*Vc*t.no*Mt/t.ecco),t.x1mth2=1-Ve,t.cc4=2*t.no*Y*xe*Te*(t.eta*(2+.5*we)+t.ecco*(.5+2*we)-Uc*Ht/(xe*xt)*(-3*t.con41*(1-2*Ae+we*(1.5-.5*Ae))+.75*t.x1mth2*(2*we-Ae*(1+we))*Math.cos(2*t.argpo))),t.cc5=2*Y*xe*Te*(1+2.75*(we+Ae)+Ae*we),q=Ve*Ve,tr=1.5*Uc*Pt*t.no,Jt=.5*tr*Uc*Pt,sr=-.46875*I$*Pt*Pt*t.no,t.mdot=t.no+.5*tr*_t*t.con41+.0625*Jt*_t*(13-78*Ve+137*q),t.argpdot=-.5*tr*ze+.0625*Jt*(7-114*Ve+395*q)+sr*(3-36*Ve+49*q),yr=-tr*We,t.nodedot=yr+(.5*Jt*(4-19*Ve)+2*sr*(3-7*Ve))*We,ir=t.argpdot+t.nodedot,t.omgcof=t.bstar*re*Math.cos(t.argpo),t.xmcof=0,t.ecco>1e-4&&(t.xmcof=-Pp*me*t.bstar/Ae),t.nodecf=3.5*Te*yr*t.cc1,t.t2cof=1.5*t.cc1,Math.abs(We+1)>15e-13?t.xlcof=-.25*Vc*Mt*(3+5*We)/(1+We):t.xlcof=-.25*Vc*Mt*(3+5*We)/H,t.aycof=-.5*Vc*Mt;var wr=1+t.eta*Math.cos(t.mo);if(t.delmo=wr*wr*wr,t.sinmao=Math.sin(t.mo),t.x7thm1=7*Ve-1,2*Ui/t.no>=225){t.method="d",t.isimp=1,Qt=0,Ze=t.inclo;var Rr={epoch:n,ep:t.ecco,argpp:t.argpo,tc:Qt,inclp:t.inclo,nodep:t.nodeo,np:t.no,e3:t.e3,ee2:t.ee2,peo:t.peo,pgho:t.pgho,pho:t.pho,pinco:t.pinco,plo:t.plo,se2:t.se2,se3:t.se3,sgh2:t.sgh2,sgh3:t.sgh3,sgh4:t.sgh4,sh2:t.sh2,sh3:t.sh3,si2:t.si2,si3:t.si3,sl2:t.sl2,sl3:t.sl3,sl4:t.sl4,xgh2:t.xgh2,xgh3:t.xgh3,xgh4:t.xgh4,xh2:t.xh2,xh3:t.xh3,xi2:t.xi2,xi3:t.xi3,xl2:t.xl2,xl3:t.xl3,xl4:t.xl4,zmol:t.zmol,zmos:t.zmos},it=C$(Rr);t.e3=it.e3,t.ee2=it.ee2,t.peo=it.peo,t.pgho=it.pgho,t.pho=it.pho,t.pinco=it.pinco,t.plo=it.plo,t.se2=it.se2,t.se3=it.se3,t.sgh2=it.sgh2,t.sgh3=it.sgh3,t.sgh4=it.sgh4,t.sh2=it.sh2,t.sh3=it.sh3,t.si2=it.si2,t.si3=it.si3,t.sl2=it.sl2,t.sl3=it.sl3,t.sl4=it.sl4,F=it.sinim,M=it.cosim,Z=it.em,le=it.emsq,Ot=it.s1,$t=it.s2,Je=it.s3,Qe=it.s4,gt=it.s5,yt=it.ss1,_r=it.ss2,lr=it.ss3,bt=it.ss4,mt=it.ss5,nr=it.sz1,Wt=it.sz3,fr=it.sz11,vr=it.sz13,en=it.sz21,pr=it.sz23,er=it.sz31,Ft=it.sz33,t.xgh2=it.xgh2,t.xgh3=it.xgh3,t.xgh4=it.xgh4,t.xh2=it.xh2,t.xh3=it.xh3,t.xi2=it.xi2,t.xi3=it.xi3,t.xl2=it.xl2,t.xl3=it.xl3,t.xl4=it.xl4,t.zmol=it.zmol,t.zmos=it.zmos,Ke=it.nm,Er=it.z1,dr=it.z3,gr=it.z11,Nr=it.z13,Mr=it.z21,Qr=it.z23,ve=it.z31,$=it.z33;var Dt={inclo:Ze,init:t.init,ep:t.ecco,inclp:t.inclo,nodep:t.nodeo,argpp:t.argpo,mp:t.mo,opsmode:t.operationmode},Ut=GC(t,Dt);t.ecco=Ut.ep,t.inclo=Ut.inclp,t.nodeo=Ut.nodep,t.argpo=Ut.argpp,t.mo=Ut.mp,je=0,Ue=0,qe=0;var kr={cosim:M,emsq:le,argpo:t.argpo,s1:Ot,s2:$t,s3:Je,s4:Qe,s5:gt,sinim:F,ss1:yt,ss2:_r,ss3:lr,ss4:bt,ss5:mt,sz1:nr,sz3:Wt,sz11:fr,sz13:vr,sz21:en,sz23:pr,sz31:er,sz33:Ft,t:t.t,tc:Qt,gsto:t.gsto,mo:t.mo,mdot:t.mdot,no:t.no,nodeo:t.nodeo,nodedot:t.nodedot,xpidot:ir,z1:Er,z3:dr,z11:gr,z13:Nr,z21:Mr,z23:Qr,z31:ve,z33:$,ecco:t.ecco,eccsq:ft,em:Z,argpm:je,inclm:Ze,mm:qe,nm:Ke,nodem:Ue,irez:t.irez,atime:t.atime,d2201:t.d2201,d2211:t.d2211,d3210:t.d3210,d3222:t.d3222,d4410:t.d4410,d4422:t.d4422,d5220:t.d5220,d5232:t.d5232,d5421:t.d5421,d5433:t.d5433,dedt:t.dedt,didt:t.didt,dmdt:t.dmdt,dnodt:t.dnodt,domdt:t.domdt,del1:t.del1,del2:t.del2,del3:t.del3,xfact:t.xfact,xlamo:t.xlamo,xli:t.xli,xni:t.xni},$e=M$(kr);t.irez=$e.irez,t.atime=$e.atime,t.d2201=$e.d2201,t.d2211=$e.d2211,t.d3210=$e.d3210,t.d3222=$e.d3222,t.d4410=$e.d4410,t.d4422=$e.d4422,t.d5220=$e.d5220,t.d5232=$e.d5232,t.d5421=$e.d5421,t.d5433=$e.d5433,t.dedt=$e.dedt,t.didt=$e.didt,t.dmdt=$e.dmdt,t.dnodt=$e.dnodt,t.domdt=$e.domdt,t.del1=$e.del1,t.del2=$e.del2,t.del3=$e.del3,t.xfact=$e.xfact,t.xlamo=$e.xlamo,t.xli=$e.xli,t.xni=$e.xni}t.isimp!==1&&(N=t.cc1*t.cc1,t.d2=4*xe*Ht*N,xr=t.d2*Ht*t.cc1/3,t.d3=(17*xe+dt)*xr,t.d4=.5*xr*xe*Ht*(221*xe+31*dt)*t.cc1,t.t3cof=t.d2+2*N,t.t4cof=.25*(3*t.d3+t.cc1*(12*t.d2+10*N)),t.t5cof=.2*(3*t.d4+12*t.cc1*t.d3+6*t.d2*t.d2+15*N*(2*t.d2+N)))}QC(t,0),t.init="n"}function O$(t,e){var r="i",n=1440/(2*Ui),o=0,c={};c.error=0,c.satnum=t.substring(2,7),c.epochyr=parseInt(t.substring(18,20),10),c.epochdays=parseFloat(t.substring(20,32)),c.ndot=parseFloat(t.substring(33,43)),c.nddot=parseFloat(".".concat(parseInt(t.substring(44,50),10),"E").concat(t.substring(50,52))),c.bstar=parseFloat("".concat(t.substring(53,54),".").concat(parseInt(t.substring(54,59),10),"E").concat(t.substring(59,61))),c.inclo=parseFloat(e.substring(8,16)),c.nodeo=parseFloat(e.substring(17,25)),c.ecco=parseFloat(".".concat(e.substring(26,33))),c.argpo=parseFloat(e.substring(34,42)),c.mo=parseFloat(e.substring(43,51)),c.no=parseFloat(e.substring(52,63)),c.no/=n,c.inclo*=Ff,c.nodeo*=Ff,c.argpo*=Ff,c.mo*=Ff,c.epochyr<57?o=c.epochyr+2e3:o=c.epochyr+1900;var d=P$(o,c.epochdays),a=d.mon,y=d.day,S=d.hr,E=d.minute,M=d.sec;return c.jdsatepoch=cw(o,a,y,S,E,M),D$(c,{opsmode:r,satn:c.satnum,epoch:c.jdsatepoch-24332815e-1,xbstar:c.bstar,xecco:c.ecco,xargpo:c.argpo,xinclo:c.inclo,xmo:c.mo,xno:c.no,xnodeo:c.nodeo}),c}function F$(t){return N$(t)||L$(t)||z$(t)||B$()}function N$(t){if(Array.isArray(t))return kb(t)}function L$(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function z$(t,e){if(t){if(typeof t=="string")return kb(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kb(t,e)}}function kb(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function B$(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function U$(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=e[0],o=Array.prototype.slice.call(e,1),c=cw.apply(void 0,F$(o)),d=(c-n.jdsatepoch)*T$;return QC(n,d)}function JC(t){return t*w$}function V$(t){if(t<-Ui/2||t>Ui/2)throw new RangeError("Latitude radians must be in range [-pi/2; pi/2].");return JC(t)}function j$(t){if(t<-Ui||t>Ui)throw new RangeError("Longitude radians must be in range [-pi; pi].");return JC(t)}function $$(t,e){for(var r=6378.137,n=6356.7523142,o=Math.sqrt(t.x*t.x+t.y*t.y),c=(r-n)/r,d=2*c-c*c,a=Math.atan2(t.y,t.x)-e;a<-Ui;)a+=pn;for(;a>Ui;)a-=pn;for(var y=20,S=0,E=Math.atan2(t.z,Math.sqrt(t.x*t.x+t.y*t.y)),M;S<y;)M=1/Math.sqrt(1-d*(Math.sin(E)*Math.sin(E))),E=Math.atan2(t.z+r*M*d*Math.sin(E),o),S+=1;var F=o/Math.cos(E)-r*M;return{longitude:a,latitude:E,height:F}}const W$={version:8,projection:{type:"globe"},sources:{satellite:{type:"raster",tiles:["https://tiles.maps.eox.at/wmts/1.0.0/s2cloudless-2020_3857/default/g/{z}/{y}/{x}.jpg"],tileSize:256}},layers:[{id:"Satellite",type:"raster",source:"satellite"}],sky:{"atmosphere-blend":["interpolate",["linear"],["zoom"],0,1,5,1,7,0]},light:{anchor:"map",position:[1.5,90,80]}};function H$(t,e,r){switch(eM(t,e,r)){case"NAV":return[255,80,80,255];case"GEO":return[255,220,0,255];case"OTHER":return[255,150,50,255];case"PAYLOAD":case"ROCKET":case"DEBRIS":default:return[255,150,50,255]}}function eM(t,e,r){const n=(t||"").toUpperCase(),o=/(GPS|NAVSTAR|GLONASS|GALILEO|BEIDOU|BDS|IRNSS|QZSS)/i.test(e),c=r>3e4;return o?"NAV":c?"GEO":n.includes("PAYLOAD")?"PAYLOAD":n.includes("ROCKET")?"ROCKET":n.includes("DEBRIS")?"DEBRIS":"OTHER"}const X$=({tles:t,typesBySatnum:e={}})=>{const r=ui.useRef(null),n=ui.useRef(null),o=ui.useRef(null),[c,d]=ui.useState(!1),a=ui.useMemo(()=>new K5({radius:2.5,nlat:12,nlong:24}),[]),y=ui.useMemo(()=>t.slice(0,300).map(S=>{try{const E=O$(S.l1,S.l2),M=E.satnum;return{id:S.name??(M==null?void 0:M.toString())??Math.random().toString(36).slice(2),rec:E,satnum:M}}catch{return null}}).filter(Boolean),[t]);return ui.useEffect(()=>{if(!r.current)return;const S=new JT.Map({container:r.current,style:W$,center:[140,35],zoom:1.6});return S.addControl(new JT.NavigationControl({visualizePitch:!0}),"top-right"),S.once("load",()=>{var M;const E=new p$({interleaved:!0,layers:[]});S.addControl(E),o.current=E;try{(M=o.current)==null||M.setProps({clearCanvas:!1})}catch{}d(!0)}),n.current=S,()=>{S.remove(),n.current=null}},[]),ui.useEffect(()=>{if(!c||!o.current)return;let S=!0,E=0;const M=12e4,F=3e5,N=2e6,G=202e5,re=35786e3,me=.25,Y=.6,q=.7,Z=.9,le=1.2,Ae=Ue=>{const Ze=Math.max(0,Math.min(Ue,re));let qe=0;if(Ze<=N){const Ke=Ze/N;qe=Math.pow(Ke,q)*me}else if(Ze<=G){const Ke=(Ze-N)/(G-N);qe=me+Math.pow(Ke,Z)*(Y-me)}else{const Ke=(Ze-G)/(re-G);qe=Y+Math.pow(Ke,le)*(1-Y)}return M+qe*F},we=()=>{var Zt,Ot;const Ue=new Date,Ze=KC(Ue),qe={NAV:0,GEO:0,PAYLOAD:0,ROCKET:0,DEBRIS:0,OTHER:0},Ke={};let ht=0;const Pt=y.map($t=>{const Je=U$($t.rec,Ue),Qe=Je==null?void 0:Je.position;if(!Qe)return null;const gt=$$(Qe,Ze),dt=V$(gt.latitude),yt=j$(gt.longitude),_r=Math.max(0,(gt.height??0)*1e3),lr=Ae(_r),bt=$t.satnum&&e[$t.satnum]||"",mt=(bt||"").toString().trim().toUpperCase(),nr=eM(mt,$t.id,gt.height??0);qe[nr]++,nr==="OTHER"&&(mt?Ke[mt]=(Ke[mt]||0)+1:ht++);const Wt=H$(bt,$t.id,gt.height??0);return{position:[yt,dt,lr],color:Wt}}).filter(Boolean);try{(Pt.length??0)%60===0&&console.debug("[MapLibreGlobe] sats=",Pt.length,"sample=",(Zt=Pt[0])==null?void 0:Zt.position)}catch{}try{if(E++,E%5===0){const $t=Object.values(qe).reduce((dt,yt)=>dt+yt,0),Je=Object.entries(qe).filter(([,dt])=>dt>0).map(([dt,yt])=>`${dt}:${yt}`).join(" "),Qe=Object.entries(Ke).sort((dt,yt)=>yt[1]-dt[1]).slice(0,6).map(([dt,yt])=>`${dt}:${yt}`).join(" "),gt=Qe||ht?` | OTHER breakdown: ${Qe}${ht?` EMPTY:${ht}`:""}`:"";console.debug(`[MapLibreGlobe] categories: ${Je} total:${$t}${gt}`)}}catch{}const xt=[new lw({id:"sats-mesh",data:Pt,mesh:a,coordinateSystem:Ir.LNGLAT,getPosition:$t=>$t.position,getColor:$t=>$t.color,getScale:()=>[8e3,8e3,8e3],pickable:!0,parameters:{depthTest:!0},material:{ambient:.2,diffuse:.8,shininess:32}})];(Ot=o.current)==null||Ot.setProps({layers:xt,clearCanvas:!1})};we();const je=setInterval(()=>S&&we(),1e3);return()=>{S=!1,clearInterval(je)}},[c,y,e,a]),Wr.jsx("div",{ref:r,style:{height:"75vh",borderRadius:8,overflow:"hidden"}})};function Z$(){const[t,e]=ui.useState(null),[r,n]=ui.useState(null),[o,c]=ui.useState(!0),d="data/latest/index.json";return ui.useEffect(()=>{let a=!0;return(async()=>{try{c(!0);const y=await fetch(d);if(!y.ok)throw new Error(`HTTP ${y.status}`);const S=await y.json();if(!a)return;e(S)}catch(y){if(!a)return;n((y==null?void 0:y.message)??String(y))}finally{a&&c(!1)}})(),()=>{a=!1}},[d]),o?Wr.jsx("div",{children:"Loading"}):r?Wr.jsxs("div",{children:["Error: ",r]}):t?Wr.jsxs("div",{style:{fontFamily:"system-ui, sans-serif",padding:16},children:[Wr.jsx("h1",{children:" "}),Wr.jsxs("p",{children:[": ",Wr.jsx("code",{children:t.generatedAt})," / : ",Wr.jsx("code",{children:t.hourPath})]}),Wr.jsx("section",{style:{marginTop:16},children:Wr.jsx(q$,{})}),Wr.jsxs("ul",{children:[Wr.jsxs("li",{children:["gp_active : ",Wr.jsx("b",{children:t.counts.gpActive})]}),Wr.jsxs("li",{children:["satcat_onorbit_payloads : ",Wr.jsx("b",{children:t.counts.satcatOnOrbitPayloads})]}),Wr.jsxs("li",{children:["supgp_spacex : ",Wr.jsx("b",{children:t.counts.supgpSpacex})]})]}),Wr.jsx("p",{children:":"}),Wr.jsxs("ul",{children:[Wr.jsx("li",{children:Wr.jsx("a",{href:`data/latest/${t.files.gpActive}`,target:"_blank",rel:"noreferrer",children:t.files.gpActive})}),Wr.jsx("li",{children:Wr.jsx("a",{href:`data/latest/${t.files.satcatOnOrbitPayloads}`,target:"_blank",rel:"noreferrer",children:t.files.satcatOnOrbitPayloads})}),Wr.jsx("li",{children:Wr.jsx("a",{href:`data/latest/${t.files.supgpSpacex}`,target:"_blank",rel:"noreferrer",children:t.files.supgpSpacex})})]})]}):Wr.jsx("div",{children:"No data"})}const q$=()=>{const[t,e]=ui.useState(null),[r,n]=ui.useState({}),[o,c]=ui.useState(null);return ui.useEffect(()=>{(async()=>{try{const[d,a]=await Promise.all([fetch("data/latest/gp_active.tle"),fetch("data/latest/gp_active.json")]);if(!d.ok)throw new Error(`HTTP ${d.status}`);const S=(await d.text()).split(/\r?\n/),E=[];for(let M=0;M<S.length;M++){const F=S[M].trim();if(F.startsWith("1 ")&&M+1<S.length&&S[M+1].startsWith("2 ")){const N=M>0&&!S[M-1].startsWith("1 ")&&!S[M-1].startsWith("2 ")?S[M-1].trim():void 0;E.push({name:N,l1:F,l2:S[M+1].trim()}),M++}}if(e(E),a.ok){const M=await a.json(),F={};for(const N of M){const G=Number(N.NORAD_CAT_ID),re=String(N.OBJECT_TYPE||"");Number.isNaN(G)||(F[G]=re)}n(F)}}catch(d){c((d==null?void 0:d.message)??String(d))}})()},[]),o?Wr.jsxs("div",{children:["Error loading TLE: ",o]}):t?Wr.jsx(X$,{tles:t,typesBySatnum:r}):Wr.jsx("div",{children:"Loading TLE"})},Y$=xI(document.getElementById("root"));Y$.render(Wr.jsx(Z$,{}));
